(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[4233],{64335:function(hr,X,G){"use strict";var Me=G(67294),ve=(0,Me.createContext)({});X.Z=ve},21349:function(hr,X,G){"use strict";var Me=G(84305),ve=G(69224),v=G(17781),ye=G.n(v),Z=G(67294),oe=G(94184),me=G.n(oe),ie=G(64335),fe=function(be){var Pe=(0,Z.useContext)(ie.Z),M=be.children,Jt=be.contentWidth,Ht=be.className,Ft=be.style,jt=(0,Z.useContext)(ve.ZP.ConfigContext),ft=jt.getPrefixCls,dt=be.prefixCls||ft("pro"),Ar=Jt||Pe.contentWidth,cr="".concat(dt,"-grid-content");return Z.createElement("div",{className:me()(cr,Ht,{wide:Ar==="Fixed"}),style:Ft},Z.createElement("div",{className:"".concat(dt,"-grid-content-children")},M))};X.Z=fe},24376:function(hr,X,G){"use strict";G.d(X,{zP:function(){return xC},JE:function(){return xE},ns:function(){return _C}});var Me={};G.r(Me),G.d(Me,{add:function(){return Nc},adjoint:function(){return ff},clone:function(){return Gf},copy:function(){return Hf},create:function(){return gu},determinant:function(){return zu},equals:function(){return fl},exactEquals:function(){return vf},frob:function(){return Ni},fromQuat:function(){return pc},fromQuat2:function(){return hf},fromRotation:function(){return Di},fromRotationTranslation:function(){return pf},fromRotationTranslationScale:function(){return ko},fromRotationTranslationScaleOrigin:function(){return Bc},fromScaling:function(){return Yf},fromTranslation:function(){return cc},fromValues:function(){return Wf},fromXRotation:function(){return dp},fromYRotation:function(){return fc},fromZRotation:function(){return qf},frustum:function(){return wu},getRotation:function(){return Zu},getScaling:function(){return bu},getTranslation:function(){return ca},identity:function(){return Nl},invert:function(){return qi},lookAt:function(){return $s},mul:function(){return Zl},multiply:function(){return La},multiplyScalar:function(){return zl},multiplyScalarAndAdd:function(){return $f},ortho:function(){return Rs},perspective:function(){return Ks},perspectiveFromFieldOfView:function(){return hc},rotate:function(){return _u},rotateX:function(){return Ko},rotateY:function(){return xu},rotateZ:function(){return Oo},scale:function(){return Io},set:function(){return lc},str:function(){return cl},sub:function(){return Uu},subtract:function(){return Kf},targetTo:function(){return df},translate:function(){return Ls},transpose:function(){return Xf}});var ve=G(67294),v=(0,ve.createContext)({});function ye(){return(0,ve.useContext)(v)}var Z=G(28660),oe=G(26729),me=G.n(oe),ie=G(86700),fe=G(84879),J={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},be=G(6610),Pe=G(5991),M=G(96156);function Jt(e){var n=131,r=137,i=0;e+="x";for(var o=Math.floor(9007199254740991/r),c=0;c<e.length;c++)i>o&&(i=Math.floor(i/r)),i=i*n+e.charCodeAt(c);return i}function Ht(e){e=e.toString();for(var n=5381,r=e.length;r;)n=n*33^e.charCodeAt(--r);return n>>>0}var Ft=G(28481),jt=window.document.documentElement.style;function ft(e){var n=e;return typeof e=="string"&&(n=document.getElementById(e)),n}function dt(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function Ar(e){return dt(e).split(/\s+/)}function cr(e){if(!jt)return e[0];for(var n in e)if(e[n]&&e[n]in jt)return e[n];return e[0]}function Bt(e,n,r){var i=document.createElement(e);return i.className=n||"",r&&r.appendChild(i),i}function ot(e){var n=e.parentNode;n&&n.removeChild(e)}function He(e,n){if(e.classList!==void 0)for(var r=Ar(n),i=0,o=r.length;i<o;i++)e.classList.add(r[i]);else if(!Ye(e,n)){var c=ur(e);Lt(e,(c?c+" ":"")+n)}}function ut(e,n){e.classList!==void 0?e.classList.remove(n):Lt(e,dt((" "+ur(e)+" ").replace(" "+n+" "," ")))}function Ye(e,n){if(e.classList!==void 0)return e.classList.contains(n);var r=ur(e);return r.length>0&&new RegExp("(^|\\s)"+n+"(\\s|$)").test(r)}function Lt(e,n){e instanceof HTMLElement?e.className=n:e.className.baseVal=n}function ur(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Ir(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var Vr=cr(["transform","WebkitTransform"]);function Ee(e,n){e.style[Vr]=n}function Ve(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function ke(e){var n=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,n.join(""))}function vt(){var e,n=document.querySelector('meta[name="viewport"]');if(!n)return 1;var r=(e=n.content)===null||e===void 0?void 0:e.split(","),i=r.find(function(o){var c=o.split("="),d=(0,Ft.Z)(c,2),y=d[0],_=d[1];return y==="initial-scale"});return i?i.split("=")[1]*1:1}var Ke=vt()<1?1:window.devicePixelRatio,H=G(63349),Je=G(10379),Et=G(46070),_t=G(77608),Yr=G(14665);function wi(e){return Function.toString.call(e).indexOf("[native code]")!==-1}var On=G(51814);function An(e,n,r){return(0,On.Z)()?An=Reflect.construct:An=function(o,c,d){var y=[null];y.push.apply(y,c);var _=Function.bind.apply(o,y),b=new _;return d&&(0,Yr.Z)(b,d.prototype),b},An.apply(null,arguments)}function gn(e){var n=typeof Map=="function"?new Map:void 0;return gn=function(i){if(i===null||!wi(i))return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(typeof n!="undefined"){if(n.has(i))return n.get(i);n.set(i,o)}function o(){return An(i,arguments,(0,_t.Z)(this).constructor)}return o.prototype=Object.create(i.prototype,{constructor:{value:o,enumerable:!1,writable:!0,configurable:!0}}),(0,Yr.Z)(o,i)},gn(e)}function Cn(e){var n=sn();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function sn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Oi=function(e){(0,Je.Z)(r,e);var n=Cn(r);function r(i,o,c){var d;return(0,be.Z)(this,r),d=n.call(this,i),(0,M.Z)((0,H.Z)(d),"status",void 0),(0,M.Z)((0,H.Z)(d),"url",void 0),d.status=o,d.url=c,d.name=d.constructor.name,d.message=i,d}return(0,Pe.Z)(r,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),r}(gn(Error));function Si(e){var n=new XMLHttpRequest;n.open("GET",e.url,!0);for(var r in e.headers)e.headers.hasOwnProperty(r)&&n.setRequestHeader(r,e.headers[r]);return n.withCredentials=e.credentials==="include",n}var da=function(n,r){var i=Si(n);return i.setRequestHeader("Accept","application/json"),i.onerror=function(){r(new Error(i.statusText))},i.onload=function(){if(i.status>=200&&i.status<300&&i.response){var o;try{o=JSON.parse(i.response)}catch(c){return r(c)}r(null,o)}else i.status===401?r(new Oi("".concat(i.statusText),i.status,n.url)):r(new Oi(i.statusText,i.status,n.url))},i.send(),i},sa=function(n,r){var i=Si(n);return i.responseType="arraybuffer",i.onerror=function(){r(new Error(i.statusText))},i.onload=function(){var o=i.response;if(o.byteLength===0&&i.status===200)return r(new Error("http status 200 returned without content."));i.status>=200&&i.status<300&&i.response?r(null,{data:o,cacheControl:i.getResponseHeader("Cache-Control"),expires:i.getResponseHeader("Expires")}):r(new Oi(i.statusText,i.status,n.url))},i.send(),i};function Ai(e){var n=window.document.createElement("a");return n.href=e,n.protocol===window.document.location.protocol&&n.host===window.document.location.host}var uo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Mi=function(n,r){return sa(n,function(i,o){if(i)r(i);else if(o){var c=new window.Image;c.crossOrigin="anonymous";var d=window.URL||window.webkitURL;c.onload=function(){r(null,c),d.revokeObjectURL(c.src)};var y=new window.Blob([new Uint8Array(o.data)],{type:"image/png"});c.src=o.data.byteLength?d.createObjectURL(y):uo}})},Pi=63710088e-1,To={centimeters:Pi*100,centimetres:Pi*100,degrees:Pi/111325,feet:Pi*3.28084,inches:Pi*39.37,kilometers:Pi/1e3,kilometres:Pi/1e3,meters:Pi,metres:Pi,miles:Pi/1609.344,millimeters:Pi*1e3,millimetres:Pi*1e3,nauticalmiles:Pi/1852,radians:1,yards:Pi*1.0936},le={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Pi,yards:1.0936133},Ha={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ki(e,n,r){r===void 0&&(r={});var i={type:"Feature"};return(r.id===0||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=n||{},i.geometry=e,i}function Wo(e,n,r){switch(r===void 0&&(r={}),e){case"Point":return hu(n).geometry;case"LineString":return Yt(n).geometry;case"Polygon":return ns(n).geometry;case"MultiPoint":return si(n).geometry;case"MultiLineString":return dn(n).geometry;case"MultiPolygon":return Fn(n).geometry;default:throw new Error(e+" is invalid")}}function hu(e,n,r){if(r===void 0&&(r={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!U(e[0])||!U(e[1]))throw new Error("coordinates must contain numbers");var i={type:"Point",coordinates:e};return ki(i,n,r)}function rs(e,n,r){return r===void 0&&(r={}),zr(e.map(function(i){return hu(i,n)}),r)}function ns(e,n,r){r===void 0&&(r={});for(var i=0,o=e;i<o.length;i++){var c=o[i];if(c.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var d=0;d<c[c.length-1].length;d++)if(c[c.length-1][d]!==c[0][d])throw new Error("First and last Position are not equivalent.")}var y={type:"Polygon",coordinates:e};return ki(y,n,r)}function bt(e,n,r){return r===void 0&&(r={}),zr(e.map(function(i){return ns(i,n)}),r)}function Yt(e,n,r){if(r===void 0&&(r={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var i={type:"LineString",coordinates:e};return ki(i,n,r)}function Cr(e,n,r){return r===void 0&&(r={}),zr(e.map(function(i){return Yt(i,n)}),r)}function zr(e,n){n===void 0&&(n={});var r={type:"FeatureCollection"};return n.id&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.features=e,r}function dn(e,n,r){r===void 0&&(r={});var i={type:"MultiLineString",coordinates:e};return ki(i,n,r)}function si(e,n,r){r===void 0&&(r={});var i={type:"MultiPoint",coordinates:e};return ki(i,n,r)}function Fn(e,n,r){r===void 0&&(r={});var i={type:"MultiPolygon",coordinates:e};return ki(i,n,r)}function $n(e,n,r){r===void 0&&(r={});var i={type:"GeometryCollection",geometries:e};return ki(i,n,r)}function Mn(e,n){if(n===void 0&&(n=0),n&&!(n>=0))throw new Error("precision must be a positive number");var r=Math.pow(10,n||0);return Math.round(e*r)/r}function hi(e,n){n===void 0&&(n="kilometers");var r=To[n];if(!r)throw new Error(n+" units is invalid");return e*r}function ni(e,n){n===void 0&&(n="kilometers");var r=To[n];if(!r)throw new Error(n+" units is invalid");return e/r}function eo(e,n){return du(ni(e,n))}function Ao(e){var n=e%360;return n<0&&(n+=360),n}function du(e){var n=e%(2*Math.PI);return n*180/Math.PI}function ks(e){var n=e%360;return n*Math.PI/180}function Ji(e,n,r){if(n===void 0&&(n="kilometers"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("length must be a positive number");return hi(ni(e,n),r)}function N(e,n,r){if(n===void 0&&(n="meters"),r===void 0&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=Ha[n];if(!i)throw new Error("invalid original units");var o=Ha[r];if(!o)throw new Error("invalid final units");return e/i*o}function U(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Y(e){return!!e&&e.constructor===Object}function se(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(n){if(!U(n))throw new Error("bbox must only contain numbers")})}function Te(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}var Ze=2*Math.PI*6378137/2;function We(e){var n=[Infinity,Infinity,-Infinity,-Infinity];return e.forEach(function(r){var i=r.coordinates;te(n,i)}),n}function te(e,n){return Array.isArray(n[0])?n.forEach(function(r){te(e,r)}):(e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])),e}function Ie(e,n){return nt(e,n)}function nt(e,n){return Array.isArray(e[0])?e.map(function(r){return nt(r,n)}):n(e)}function $t(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=Hr(e,n);var i=e[0],o=e[1],c=i*Ze/180,d=Math.log(Math.tan((90+o)*Math.PI/360))/(Math.PI/180);return d=d*Ze/180,r.enable&&(c=Number(c.toFixed(r.decimal)),d=Number(d.toFixed(r.decimal))),e.length===3?[c,d,e[2]]:[c,d]}function lr(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,r=e[0],i=e[1],o=r/Ze*180,c=i/Ze*180;return c=180/Math.PI*(2*Math.atan(Math.exp(c*Math.PI/180))-Math.PI/2),n!=null&&(o=Number(o.toFixed(n)),c=Number(c.toFixed(n))),e.length===3?[o,c,e[2]]:[o,c]}function pt(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function tr(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function Hr(e,n){if(n===!1)return e;var r=pt(e[0]),i=tr(e[1]);return i>85&&(i=85),i<-85&&(i=-85),e.length===3?[r,i,e[2]]:[r,i]}function Rr(e){var n=85.0511287798,r=Math.max(Math.min(n,e[1]),-n),i=256<<20,o=Math.PI/180,c=e[0]*o,d=r*o;d=Math.log(Math.tan(Math.PI/4+d/2));var y=.5/Math.PI,_=.5,b=-.5/Math.PI;return o=.5,c=i*(y*c+_),d=i*(b*d+o),[Math.floor(c),Math.floor(d)]}function Dt(e){var n=.5/Math.PI,r=.5,i=-.5/Math.PI,o=.5,c=256<<20,d=_slicedToArray(e,2),y=d[0],_=d[1];y=(y/c-r)/n,_=(_/c-o)/i,_=(Math.atan(Math.pow(Math.E,_))-Math.PI/4)*2,o=Math.PI/180;var b=_/o,T=y/o;return[T,b]}function Dr(e,n,r){var i=ks(n[1]-e[1]),o=ks(n[0]-e[0]),c=ks(e[1]),d=ks(n[1]),y=Math.pow(Math.sin(i/2),2)+Math.pow(Math.sin(o/2),2)*Math.cos(c)*Math.cos(d);return hi(2*Math.atan2(Math.sqrt(y),Math.sqrt(1-y)),r="meters")}function Pr(e){var n=Math.PI/180,r=85.0511287798,i=6378137,o=Math.max(Math.min(r,e[1]),-r),c=Math.sin(o*n),d=i*e[0]*n,y=i*Math.log((1+c)/(1-c))/2;return[d,y]}function Mr(e,n){var r=Math.abs(e[1][1]-e[0][1])*n,i=Math.abs(e[1][0]-e[0][0])*n;return[[e[0][0]-i,e[0][1]-r],[e[1][0]+i,e[1][1]+r]]}function Nn(e,n){return e[0][0]<=n[0][0]&&e[0][1]<=n[0][1]&&e[1][0]>=n[1][0]&&e[1][1]>=n[1][1]}function Lr(e){return[[e[0],e[1]],[e[2],e[3]]]}var jn=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,r=arguments.length>1?arguments[1]:void 0;(0,be.Z)(this,e),(0,M.Z)(this,"limit",void 0),(0,M.Z)(this,"cache",void 0),(0,M.Z)(this,"destroy",void 0),(0,M.Z)(this,"order",void 0),this.limit=n,this.destroy=r||this.defaultDestroy,this.order=[],this.clear()}return(0,Pe.Z)(e,[{key:"clear",value:function(){var r=this;this.order.forEach(function(i){r.delete(i)}),this.cache={},this.order=[]}},{key:"get",value:function(r){var i=this.cache[r];return i&&(this.deleteOrder(r),this.appendOrder(r)),i}},{key:"set",value:function(r,i){this.cache[r]?(this.delete(r),this.cache[r]=i,this.appendOrder(r)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[r]=i,this.appendOrder(r))}},{key:"delete",value:function(r){var i=this.cache[r];i&&(this.deleteCache(r),this.deleteOrder(r),this.destroy(i,r))}},{key:"deleteCache",value:function(r){delete this.cache[r]}},{key:"deleteOrder",value:function(r){var i=this.order.findIndex(function(o){return o===r});i>=0&&this.order.splice(i,1)}},{key:"appendOrder",value:function(r){this.order.push(r)}},{key:"defaultDestroy",value:function(r,i){return null}}]),e}();function ui(e,n){e.forEach(function(r){!n[r]||(n[r]=n[r].bind(n))})}var zn=G(2650);function Pn(e){var n=zn.ZP(e),r=[0,0,0,0];return n!=null&&(r[0]=n.r/255,r[1]=n.g/255,r[2]=n.b/255,r[3]=n.opacity),r}function Vn(e){var n=e&&e[0],r=e&&e[1],i=e&&e[2],o=n+r*256+i*65536-1;return o}function Sa(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function vi(e){var n=document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),o=null,c=e.positions[0],d=e.positions[e.positions.length-1],y=0;y<e.colors.length;++y){var _=(e.positions[y]-c)/(d-c);i.addColorStop(_,e.colors[y])}return r.fillStyle=i,r.fillRect(0,0,256,1),o=new Uint8ClampedArray(r.getImageData(0,0,256,1).data),new ImageData(o,256,1)}var Li;(function(e){e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e.LEFT="left",e.RIGHT="right"})(Li||(Li={}));var Wn={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zn(e,n,r){var i=e.classList;for(var o in Wn)Wn.hasOwnProperty(o)&&i.remove("l7-".concat(r,"-anchor-").concat(o));i.add("l7-".concat(r,"-anchor-").concat(n))}function Jn(e){if(e.length===0)throw new Error("max requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]>n&&(n=e[r]);return n*1}function Qi(e){if(e.length===0)throw new Error("min requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r]);return n*1}function gs(e){if(e.length===0)return 0;for(var n=e[0]*1,r=1;r<e.length;r++)n+=e[r]*1;return n}function Bi(e){if(e.length===0)throw new Error("mean requires at least one data point");return gs(e)/e.length}function ea(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var n=e[0],r=NaN,i=0,o=1,c=1;c<e.length+1;c++)e[c]!==n?(o>i&&(i=o,r=n),o=1,n=e[c]):o++;return r*1}var Bu={min:Qi,max:Jn,mean:Bi,sum:gs,mode:ea};function qs(e,n){return e.map(function(r){return r[n]})}function ji(e,n){return Bu[e](n)}var Wa=G(49296),Ea=G.n(Wa);function ua(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function xo(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ua(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ua(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function bi(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=bo(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function bo(e,n){if(!!e){if(typeof e=="string")return Xa(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Xa(e,n)}}function Xa(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Mo=30;function Xo(e){var n=e.characterSet,r=e.getFontWidth,i=e.fontHeight,o=e.buffer,c=e.maxCanvasWidth,d=e.mapping,y=d===void 0?{}:d,_=e.xOffset,b=_===void 0?0:_,T=e.yOffset,A=T===void 0?0:T,O=0,F=b;Array.from(n).forEach(function(Q,ue){if(!y[Q]){var Oe=r(Q,ue);F+Mo>c&&(F=0,O++),y[Q]={x:F,y:A+O*Mo,width:Mo,height:Mo,advance:Oe},F+=Mo}});var W=i+o*2;return{mapping:y,xOffset:F,yOffset:A+O*W,canvasHeight:Ca(A+(O+1)*W)}}function Lc(e,n,r){var i=0,o=0,c=0,d=[],y={},_=bi(e),b;try{for(_.s();!(b=_.n()).done;){var T=b.value;if(!y[T.id]){var A=T.size;i+A+n>r&&(Yo(y,d,o),i=0,o=c+o+n,c=0,d=[]),d.push({icon:T,xOffset:i}),i=i+A+n,c=Math.max(c,A)}}}catch(F){_.e(F)}finally{_.f()}d.length>0&&Yo(y,d,o);var O=Ca(c+o+n);return{mapping:y,canvasHeight:O}}function Yo(e,n,r){var i=bi(n),o;try{for(i.s();!(o=i.n()).done;){var c=o.value,d=c.icon,y=c.xOffset;e[d.id]=xo(xo({},d),{},{x:y,y:r,image:d.image,width:d.width,height:d.height})}}catch(_){i.e(_)}finally{i.f()}}function Ca(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var va,Ri;function K(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=he(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function he(e,n){if(!!e){if(typeof e=="string")return je(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return je(e,n)}}function je(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function It(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function _r(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?It(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):It(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var rn=ll(),mi="sans-serif",ma="normal",Ya=24,Ta=3,qo=.25,uc=8,lf=1024,Rc=1,is=1,Nu=3,as=null;function ll(){for(var e=[],n=32;n<128;n++)e.push(String.fromCharCode(n));return e}function vu(e,n,r,i){e.font="".concat(i," ").concat(r,"px ").concat(n),e.fillStyle="black",e.textBaseline="middle"}function _s(e,n){for(var r=0;r<e.length;r++)n.data[4*r+3]=e[r]}var Fl=(va=(0,ie.b2)(),va(Ri=function(){function e(){(0,be.Z)(this,e),(0,M.Z)(this,"fontAtlas",void 0),(0,M.Z)(this,"iconFontMap",void 0),(0,M.Z)(this,"iconFontGlyphs",{}),(0,M.Z)(this,"fontOptions",void 0),(0,M.Z)(this,"key",void 0),(0,M.Z)(this,"cache",new jn(Nu))}return(0,Pe.Z)(e,[{key:"scale",get:function(){return is}},{key:"canvas",get:function(){var r=this.cache.get(this.key);return r&&r.data}},{key:"mapping",get:function(){var r=this.cache.get(this.key);return r&&r.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:mi,fontWeight:ma,characterSet:rn,fontSize:Ya,buffer:Ta,sdf:!0,cutoff:qo,radius:uc,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(r){var i=this;r.forEach(function(o){i.iconFontGlyphs[o.name]=o.unicode})}},{key:"addIconFont",value:function(r,i){this.iconFontMap.set(r,i)}},{key:"getIconFontKey",value:function(r){return this.iconFontMap.get(r)||r}},{key:"getGlyph",value:function(r){return this.iconFontGlyphs[r]?String.fromCharCode(parseInt(this.iconFontGlyphs[r],16)):""}},{key:"setFontOptions",value:function(r){this.fontOptions=_r(_r({},this.fontOptions),r),this.key=this.getKey();var i=this.getNewChars(this.key,this.fontOptions.characterSet),o=this.cache.get(this.key);if(!(o&&i.length===0)){var c=this.generateFontAtlas(this.key,i,o);this.fontAtlas=c,this.cache.set(this.key,c)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(r,i,o){var c=this.fontOptions,d=c.fontFamily,y=c.fontWeight,_=c.fontSize,b=c.buffer,T=c.sdf,A=c.radius,O=c.cutoff,F=c.iconfont,W=o&&o.data;W||(W=document.createElement("canvas"),W.width=lf);var Q=W.getContext("2d");vu(Q,d,_,y);var ue=Xo(_r({getFontWidth:function(Ys){return Q.measureText(Ys).width},fontHeight:_*is,buffer:b,characterSet:i,maxCanvasWidth:lf},o&&{mapping:o.mapping,xOffset:o.xOffset,yOffset:o.yOffset})),Oe=ue.mapping,rt=ue.canvasHeight,lt=ue.xOffset,At=ue.yOffset,Ot=Q.getImageData(0,0,W.width,W.height);if(W.height=rt,Q.putImageData(Ot,0,0),vu(Q,d,_,y),T){var Ut=new(Ea())(_,b,A,O,d,y),Gt=Q.getImageData(0,0,Ut.size,Ut.size),gr=K(i),Nr;try{for(gr.s();!(Nr=gr.n()).done;){var Xr=Nr.value;if(F){var Er=String.fromCharCode(parseInt(Xr.replace("&#x","").replace(";",""),16)),on=Ut.draw(Er);_s(on,Gt)}else _s(Ut.draw(Xr),Gt);Q.putImageData(Gt,Oe[Xr].x,Oe[Xr].y)}}catch(Os){gr.e(Os)}finally{gr.f()}}else{var Ln=K(i),Hn;try{for(Ln.s();!(Hn=Ln.n()).done;){var Ga=Hn.value;Q.fillText(Ga,Oe[Ga].x,Oe[Ga].y+_*Rc)}}catch(Os){Ln.e(Os)}finally{Ln.f()}}return{xOffset:lt,yOffset:At,mapping:Oe,data:W,width:W.width,height:W.height}}},{key:"getKey",value:function(){return"key";var r,i,o,c,d,y,_,b}},{key:"getNewChars",value:function(r,i){var o=this.cache.get(r);if(!o)return i;var c=[],d=o.mapping,y=new Set(Object.keys(d)),_=new Set(i);return _.forEach(function(b){y.has(b)||c.push(b)}),c}}]),e}())||Ri),Po,la;function Bl(e){var n=Dc();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Dc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cf=3,mu=1024,yu=64,Fc=(Po=(0,ie.b2)(),Po(la=function(e){(0,Je.Z)(r,e);var n=Bl(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"canvasHeight",128),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"canvas",void 0),(0,M.Z)((0,H.Z)(i),"iconData",void 0),(0,M.Z)((0,H.Z)(i),"iconMap",void 0),(0,M.Z)((0,H.Z)(i),"ctx",void 0),(0,M.Z)((0,H.Z)(i),"loadingImageCount",0),i}return(0,Pe.Z)(r,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(o,c){var d=this,y=new Image;if(this.loadingImageCount++,this.hasImage(o))throw new Error("Image Id already exists");this.iconData.push({id:o,size:yu}),this.updateIconMap(),this.loadImage(c).then(function(_){y=_;var b=d.iconData.find(function(T){return T.id===o});b&&(b.image=y,b.width=y.width,b.height=y.height),d.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(o){return this.iconMap.hasOwnProperty(o)}},{key:"removeImage",value:function(o){this.hasImage(o)&&(this.iconData=this.iconData.filter(function(c){return c.id!==o}),delete this.iconMap[o],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var o=this;this.canvas.width=mu,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(c){var d=o.iconMap[c],y=d.x,_=d.y,b=d.image,T=d.width,A=T===void 0?64:T,O=d.height,F=O===void 0?64:O,W=Math.max(A,F),Q=W/yu,ue=F/Q,Oe=A/Q;b&&o.ctx.drawImage(b,y+(yu-Oe)/2,_+(yu-ue)/2,Oe,ue)})}},{key:"updateIconMap",value:function(){var o=Lc(this.iconData,cf,mu),c=o.mapping,d=o.canvasHeight;this.iconMap=c,this.canvasHeight=d}},{key:"loadImage",value:function(o){return new Promise(function(c,d){if(o instanceof HTMLImageElement){c(o);return}var y=new Image;y.crossOrigin="anonymous",y.onload=function(){c(y)},y.onerror=function(){d(new Error("Could not load image at "+o))},y.src=o instanceof File?URL.createObjectURL(o):o})}}]),r}(oe.EventEmitter))||la),Ii=G(49685);function gu(){var e=new Ii.WT(16);return Ii.WT!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function Gf(e){var n=new Ii.WT(16);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Hf(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function Wf(e,n,r,i,o,c,d,y,_,b,T,A,O,F,W,Q){var ue=new Ii.WT(16);return ue[0]=e,ue[1]=n,ue[2]=r,ue[3]=i,ue[4]=o,ue[5]=c,ue[6]=d,ue[7]=y,ue[8]=_,ue[9]=b,ue[10]=T,ue[11]=A,ue[12]=O,ue[13]=F,ue[14]=W,ue[15]=Q,ue}function lc(e,n,r,i,o,c,d,y,_,b,T,A,O,F,W,Q,ue){return e[0]=n,e[1]=r,e[2]=i,e[3]=o,e[4]=c,e[5]=d,e[6]=y,e[7]=_,e[8]=b,e[9]=T,e[10]=A,e[11]=O,e[12]=F,e[13]=W,e[14]=Q,e[15]=ue,e}function Nl(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Xf(e,n){if(e===n){var r=n[1],i=n[2],o=n[3],c=n[6],d=n[7],y=n[11];e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=r,e[6]=n[9],e[7]=n[13],e[8]=i,e[9]=c,e[11]=n[14],e[12]=o,e[13]=d,e[14]=y}else e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=n[1],e[5]=n[5],e[6]=n[9],e[7]=n[13],e[8]=n[2],e[9]=n[6],e[10]=n[10],e[11]=n[14],e[12]=n[3],e[13]=n[7],e[14]=n[11],e[15]=n[15];return e}function qi(e,n){var r=n[0],i=n[1],o=n[2],c=n[3],d=n[4],y=n[5],_=n[6],b=n[7],T=n[8],A=n[9],O=n[10],F=n[11],W=n[12],Q=n[13],ue=n[14],Oe=n[15],rt=r*y-i*d,lt=r*_-o*d,At=r*b-c*d,Ot=i*_-o*y,Ut=i*b-c*y,Gt=o*b-c*_,gr=T*Q-A*W,Nr=T*ue-O*W,Xr=T*Oe-F*W,Er=A*ue-O*Q,on=A*Oe-F*Q,Ln=O*Oe-F*ue,Hn=rt*Ln-lt*on+At*Er+Ot*Xr-Ut*Nr+Gt*gr;return Hn?(Hn=1/Hn,e[0]=(y*Ln-_*on+b*Er)*Hn,e[1]=(o*on-i*Ln-c*Er)*Hn,e[2]=(Q*Gt-ue*Ut+Oe*Ot)*Hn,e[3]=(O*Ut-A*Gt-F*Ot)*Hn,e[4]=(_*Xr-d*Ln-b*Nr)*Hn,e[5]=(r*Ln-o*Xr+c*Nr)*Hn,e[6]=(ue*At-W*Gt-Oe*lt)*Hn,e[7]=(T*Gt-O*At+F*lt)*Hn,e[8]=(d*on-y*Xr+b*gr)*Hn,e[9]=(i*Xr-r*on-c*gr)*Hn,e[10]=(W*Ut-Q*At+Oe*rt)*Hn,e[11]=(A*At-T*Ut-F*rt)*Hn,e[12]=(y*Nr-d*Er-_*gr)*Hn,e[13]=(r*Er-i*Nr+o*gr)*Hn,e[14]=(Q*lt-W*Ot-ue*rt)*Hn,e[15]=(T*Ot-A*lt+O*rt)*Hn,e):null}function ff(e,n){var r=n[0],i=n[1],o=n[2],c=n[3],d=n[4],y=n[5],_=n[6],b=n[7],T=n[8],A=n[9],O=n[10],F=n[11],W=n[12],Q=n[13],ue=n[14],Oe=n[15];return e[0]=y*(O*Oe-F*ue)-A*(_*Oe-b*ue)+Q*(_*F-b*O),e[1]=-(i*(O*Oe-F*ue)-A*(o*Oe-c*ue)+Q*(o*F-c*O)),e[2]=i*(_*Oe-b*ue)-y*(o*Oe-c*ue)+Q*(o*b-c*_),e[3]=-(i*(_*F-b*O)-y*(o*F-c*O)+A*(o*b-c*_)),e[4]=-(d*(O*Oe-F*ue)-T*(_*Oe-b*ue)+W*(_*F-b*O)),e[5]=r*(O*Oe-F*ue)-T*(o*Oe-c*ue)+W*(o*F-c*O),e[6]=-(r*(_*Oe-b*ue)-d*(o*Oe-c*ue)+W*(o*b-c*_)),e[7]=r*(_*F-b*O)-d*(o*F-c*O)+T*(o*b-c*_),e[8]=d*(A*Oe-F*Q)-T*(y*Oe-b*Q)+W*(y*F-b*A),e[9]=-(r*(A*Oe-F*Q)-T*(i*Oe-c*Q)+W*(i*F-c*A)),e[10]=r*(y*Oe-b*Q)-d*(i*Oe-c*Q)+W*(i*b-c*y),e[11]=-(r*(y*F-b*A)-d*(i*F-c*A)+T*(i*b-c*y)),e[12]=-(d*(A*ue-O*Q)-T*(y*ue-_*Q)+W*(y*O-_*A)),e[13]=r*(A*ue-O*Q)-T*(i*ue-o*Q)+W*(i*O-o*A),e[14]=-(r*(y*ue-_*Q)-d*(i*ue-o*Q)+W*(i*_-o*y)),e[15]=r*(y*O-_*A)-d*(i*O-o*A)+T*(i*_-o*y),e}function zu(e){var n=e[0],r=e[1],i=e[2],o=e[3],c=e[4],d=e[5],y=e[6],_=e[7],b=e[8],T=e[9],A=e[10],O=e[11],F=e[12],W=e[13],Q=e[14],ue=e[15],Oe=n*d-r*c,rt=n*y-i*c,lt=n*_-o*c,At=r*y-i*d,Ot=r*_-o*d,Ut=i*_-o*y,Gt=b*W-T*F,gr=b*Q-A*F,Nr=b*ue-O*F,Xr=T*Q-A*W,Er=T*ue-O*W,on=A*ue-O*Q;return Oe*on-rt*Er+lt*Xr+At*Nr-Ot*gr+Ut*Gt}function La(e,n,r){var i=n[0],o=n[1],c=n[2],d=n[3],y=n[4],_=n[5],b=n[6],T=n[7],A=n[8],O=n[9],F=n[10],W=n[11],Q=n[12],ue=n[13],Oe=n[14],rt=n[15],lt=r[0],At=r[1],Ot=r[2],Ut=r[3];return e[0]=lt*i+At*y+Ot*A+Ut*Q,e[1]=lt*o+At*_+Ot*O+Ut*ue,e[2]=lt*c+At*b+Ot*F+Ut*Oe,e[3]=lt*d+At*T+Ot*W+Ut*rt,lt=r[4],At=r[5],Ot=r[6],Ut=r[7],e[4]=lt*i+At*y+Ot*A+Ut*Q,e[5]=lt*o+At*_+Ot*O+Ut*ue,e[6]=lt*c+At*b+Ot*F+Ut*Oe,e[7]=lt*d+At*T+Ot*W+Ut*rt,lt=r[8],At=r[9],Ot=r[10],Ut=r[11],e[8]=lt*i+At*y+Ot*A+Ut*Q,e[9]=lt*o+At*_+Ot*O+Ut*ue,e[10]=lt*c+At*b+Ot*F+Ut*Oe,e[11]=lt*d+At*T+Ot*W+Ut*rt,lt=r[12],At=r[13],Ot=r[14],Ut=r[15],e[12]=lt*i+At*y+Ot*A+Ut*Q,e[13]=lt*o+At*_+Ot*O+Ut*ue,e[14]=lt*c+At*b+Ot*F+Ut*Oe,e[15]=lt*d+At*T+Ot*W+Ut*rt,e}function Ls(e,n,r){var i=r[0],o=r[1],c=r[2],d,y,_,b,T,A,O,F,W,Q,ue,Oe;return n===e?(e[12]=n[0]*i+n[4]*o+n[8]*c+n[12],e[13]=n[1]*i+n[5]*o+n[9]*c+n[13],e[14]=n[2]*i+n[6]*o+n[10]*c+n[14],e[15]=n[3]*i+n[7]*o+n[11]*c+n[15]):(d=n[0],y=n[1],_=n[2],b=n[3],T=n[4],A=n[5],O=n[6],F=n[7],W=n[8],Q=n[9],ue=n[10],Oe=n[11],e[0]=d,e[1]=y,e[2]=_,e[3]=b,e[4]=T,e[5]=A,e[6]=O,e[7]=F,e[8]=W,e[9]=Q,e[10]=ue,e[11]=Oe,e[12]=d*i+T*o+W*c+n[12],e[13]=y*i+A*o+Q*c+n[13],e[14]=_*i+O*o+ue*c+n[14],e[15]=b*i+F*o+Oe*c+n[15]),e}function Io(e,n,r){var i=r[0],o=r[1],c=r[2];return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e[4]=n[4]*o,e[5]=n[5]*o,e[6]=n[6]*o,e[7]=n[7]*o,e[8]=n[8]*c,e[9]=n[9]*c,e[10]=n[10]*c,e[11]=n[11]*c,e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function _u(e,n,r,i){var o=i[0],c=i[1],d=i[2],y=Math.hypot(o,c,d),_,b,T,A,O,F,W,Q,ue,Oe,rt,lt,At,Ot,Ut,Gt,gr,Nr,Xr,Er,on,Ln,Hn,Ga;return y<Ii.Ib?null:(y=1/y,o*=y,c*=y,d*=y,_=Math.sin(r),b=Math.cos(r),T=1-b,A=n[0],O=n[1],F=n[2],W=n[3],Q=n[4],ue=n[5],Oe=n[6],rt=n[7],lt=n[8],At=n[9],Ot=n[10],Ut=n[11],Gt=o*o*T+b,gr=c*o*T+d*_,Nr=d*o*T-c*_,Xr=o*c*T-d*_,Er=c*c*T+b,on=d*c*T+o*_,Ln=o*d*T+c*_,Hn=c*d*T-o*_,Ga=d*d*T+b,e[0]=A*Gt+Q*gr+lt*Nr,e[1]=O*Gt+ue*gr+At*Nr,e[2]=F*Gt+Oe*gr+Ot*Nr,e[3]=W*Gt+rt*gr+Ut*Nr,e[4]=A*Xr+Q*Er+lt*on,e[5]=O*Xr+ue*Er+At*on,e[6]=F*Xr+Oe*Er+Ot*on,e[7]=W*Xr+rt*Er+Ut*on,e[8]=A*Ln+Q*Hn+lt*Ga,e[9]=O*Ln+ue*Hn+At*Ga,e[10]=F*Ln+Oe*Hn+Ot*Ga,e[11]=W*Ln+rt*Hn+Ut*Ga,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)}function Ko(e,n,r){var i=Math.sin(r),o=Math.cos(r),c=n[4],d=n[5],y=n[6],_=n[7],b=n[8],T=n[9],A=n[10],O=n[11];return n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[4]=c*o+b*i,e[5]=d*o+T*i,e[6]=y*o+A*i,e[7]=_*o+O*i,e[8]=b*o-c*i,e[9]=T*o-d*i,e[10]=A*o-y*i,e[11]=O*o-_*i,e}function xu(e,n,r){var i=Math.sin(r),o=Math.cos(r),c=n[0],d=n[1],y=n[2],_=n[3],b=n[8],T=n[9],A=n[10],O=n[11];return n!==e&&(e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=c*o-b*i,e[1]=d*o-T*i,e[2]=y*o-A*i,e[3]=_*o-O*i,e[8]=c*i+b*o,e[9]=d*i+T*o,e[10]=y*i+A*o,e[11]=_*i+O*o,e}function Oo(e,n,r){var i=Math.sin(r),o=Math.cos(r),c=n[0],d=n[1],y=n[2],_=n[3],b=n[4],T=n[5],A=n[6],O=n[7];return n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=c*o+b*i,e[1]=d*o+T*i,e[2]=y*o+A*i,e[3]=_*o+O*i,e[4]=b*o-c*i,e[5]=T*o-d*i,e[6]=A*o-y*i,e[7]=O*o-_*i,e}function cc(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Yf(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Di(e,n,r){var i=r[0],o=r[1],c=r[2],d=Math.hypot(i,o,c),y,_,b;return d<Ii.Ib?null:(d=1/d,i*=d,o*=d,c*=d,y=Math.sin(n),_=Math.cos(n),b=1-_,e[0]=i*i*b+_,e[1]=o*i*b+c*y,e[2]=c*i*b-o*y,e[3]=0,e[4]=i*o*b-c*y,e[5]=o*o*b+_,e[6]=c*o*b+i*y,e[7]=0,e[8]=i*c*b+o*y,e[9]=o*c*b-i*y,e[10]=c*c*b+_,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function dp(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=r,e[7]=0,e[8]=0,e[9]=-r,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function fc(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=i,e[1]=0,e[2]=-r,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=r,e[9]=0,e[10]=i,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function qf(e,n){var r=Math.sin(n),i=Math.cos(n);return e[0]=i,e[1]=r,e[2]=0,e[3]=0,e[4]=-r,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function pf(e,n,r){var i=n[0],o=n[1],c=n[2],d=n[3],y=i+i,_=o+o,b=c+c,T=i*y,A=i*_,O=i*b,F=o*_,W=o*b,Q=c*b,ue=d*y,Oe=d*_,rt=d*b;return e[0]=1-(F+Q),e[1]=A+rt,e[2]=O-Oe,e[3]=0,e[4]=A-rt,e[5]=1-(T+Q),e[6]=W+ue,e[7]=0,e[8]=O+Oe,e[9]=W-ue,e[10]=1-(T+F),e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function hf(e,n){var r=new Ii.WT(3),i=-n[0],o=-n[1],c=-n[2],d=n[3],y=n[4],_=n[5],b=n[6],T=n[7],A=i*i+o*o+c*c+d*d;return A>0?(r[0]=(y*d+T*i+_*c-b*o)*2/A,r[1]=(_*d+T*o+b*i-y*c)*2/A,r[2]=(b*d+T*c+y*o-_*i)*2/A):(r[0]=(y*d+T*i+_*c-b*o)*2,r[1]=(_*d+T*o+b*i-y*c)*2,r[2]=(b*d+T*c+y*o-_*i)*2),pf(e,n,r),e}function ca(e,n){return e[0]=n[12],e[1]=n[13],e[2]=n[14],e}function bu(e,n){var r=n[0],i=n[1],o=n[2],c=n[4],d=n[5],y=n[6],_=n[8],b=n[9],T=n[10];return e[0]=Math.hypot(r,i,o),e[1]=Math.hypot(c,d,y),e[2]=Math.hypot(_,b,T),e}function Zu(e,n){var r=new Ii.WT(3);bu(r,n);var i=1/r[0],o=1/r[1],c=1/r[2],d=n[0]*i,y=n[1]*o,_=n[2]*c,b=n[4]*i,T=n[5]*o,A=n[6]*c,O=n[8]*i,F=n[9]*o,W=n[10]*c,Q=d+T+W,ue=0;return Q>0?(ue=Math.sqrt(Q+1)*2,e[3]=.25*ue,e[0]=(A-F)/ue,e[1]=(O-_)/ue,e[2]=(y-b)/ue):d>T&&d>W?(ue=Math.sqrt(1+d-T-W)*2,e[3]=(A-F)/ue,e[0]=.25*ue,e[1]=(y+b)/ue,e[2]=(O+_)/ue):T>W?(ue=Math.sqrt(1+T-d-W)*2,e[3]=(O-_)/ue,e[0]=(y+b)/ue,e[1]=.25*ue,e[2]=(A+F)/ue):(ue=Math.sqrt(1+W-d-T)*2,e[3]=(y-b)/ue,e[0]=(O+_)/ue,e[1]=(A+F)/ue,e[2]=.25*ue),e}function ko(e,n,r,i){var o=n[0],c=n[1],d=n[2],y=n[3],_=o+o,b=c+c,T=d+d,A=o*_,O=o*b,F=o*T,W=c*b,Q=c*T,ue=d*T,Oe=y*_,rt=y*b,lt=y*T,At=i[0],Ot=i[1],Ut=i[2];return e[0]=(1-(W+ue))*At,e[1]=(O+lt)*At,e[2]=(F-rt)*At,e[3]=0,e[4]=(O-lt)*Ot,e[5]=(1-(A+ue))*Ot,e[6]=(Q+Oe)*Ot,e[7]=0,e[8]=(F+rt)*Ut,e[9]=(Q-Oe)*Ut,e[10]=(1-(A+W))*Ut,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Bc(e,n,r,i,o){var c=n[0],d=n[1],y=n[2],_=n[3],b=c+c,T=d+d,A=y+y,O=c*b,F=c*T,W=c*A,Q=d*T,ue=d*A,Oe=y*A,rt=_*b,lt=_*T,At=_*A,Ot=i[0],Ut=i[1],Gt=i[2],gr=o[0],Nr=o[1],Xr=o[2],Er=(1-(Q+Oe))*Ot,on=(F+At)*Ot,Ln=(W-lt)*Ot,Hn=(F-At)*Ut,Ga=(1-(O+Oe))*Ut,Os=(ue+rt)*Ut,Ys=(W+lt)*Gt,Vf=(ue-rt)*Gt,sl=(1-(O+Q))*Gt;return e[0]=Er,e[1]=on,e[2]=Ln,e[3]=0,e[4]=Hn,e[5]=Ga,e[6]=Os,e[7]=0,e[8]=Ys,e[9]=Vf,e[10]=sl,e[11]=0,e[12]=r[0]+gr-(Er*gr+Hn*Nr+Ys*Xr),e[13]=r[1]+Nr-(on*gr+Ga*Nr+Vf*Xr),e[14]=r[2]+Xr-(Ln*gr+Os*Nr+sl*Xr),e[15]=1,e}function pc(e,n){var r=n[0],i=n[1],o=n[2],c=n[3],d=r+r,y=i+i,_=o+o,b=r*d,T=i*d,A=i*y,O=o*d,F=o*y,W=o*_,Q=c*d,ue=c*y,Oe=c*_;return e[0]=1-A-W,e[1]=T+Oe,e[2]=O-ue,e[3]=0,e[4]=T-Oe,e[5]=1-b-W,e[6]=F+Q,e[7]=0,e[8]=O+ue,e[9]=F-Q,e[10]=1-b-A,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wu(e,n,r,i,o,c,d){var y=1/(r-n),_=1/(o-i),b=1/(c-d);return e[0]=c*2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c*2*_,e[6]=0,e[7]=0,e[8]=(r+n)*y,e[9]=(o+i)*_,e[10]=(d+c)*b,e[11]=-1,e[12]=0,e[13]=0,e[14]=d*c*2*b,e[15]=0,e}function Ks(e,n,r,i,o){var c=1/Math.tan(n/2),d;return e[0]=c/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=c,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,o!=null&&o!==Infinity?(d=1/(i-o),e[10]=(o+i)*d,e[14]=2*o*i*d):(e[10]=-1,e[14]=-2*i),e}function hc(e,n,r,i){var o=Math.tan(n.upDegrees*Math.PI/180),c=Math.tan(n.downDegrees*Math.PI/180),d=Math.tan(n.leftDegrees*Math.PI/180),y=Math.tan(n.rightDegrees*Math.PI/180),_=2/(d+y),b=2/(o+c);return e[0]=_,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=b,e[6]=0,e[7]=0,e[8]=-((d-y)*_*.5),e[9]=(o-c)*b*.5,e[10]=i/(r-i),e[11]=-1,e[12]=0,e[13]=0,e[14]=i*r/(r-i),e[15]=0,e}function Rs(e,n,r,i,o,c,d){var y=1/(n-r),_=1/(i-o),b=1/(c-d);return e[0]=-2*y,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*_,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*b,e[11]=0,e[12]=(n+r)*y,e[13]=(o+i)*_,e[14]=(d+c)*b,e[15]=1,e}function $s(e,n,r,i){var o,c,d,y,_,b,T,A,O,F,W=n[0],Q=n[1],ue=n[2],Oe=i[0],rt=i[1],lt=i[2],At=r[0],Ot=r[1],Ut=r[2];return Math.abs(W-At)<Ii.Ib&&Math.abs(Q-Ot)<Ii.Ib&&Math.abs(ue-Ut)<Ii.Ib?Nl(e):(T=W-At,A=Q-Ot,O=ue-Ut,F=1/Math.hypot(T,A,O),T*=F,A*=F,O*=F,o=rt*O-lt*A,c=lt*T-Oe*O,d=Oe*A-rt*T,F=Math.hypot(o,c,d),F?(F=1/F,o*=F,c*=F,d*=F):(o=0,c=0,d=0),y=A*d-O*c,_=O*o-T*d,b=T*c-A*o,F=Math.hypot(y,_,b),F?(F=1/F,y*=F,_*=F,b*=F):(y=0,_=0,b=0),e[0]=o,e[1]=y,e[2]=T,e[3]=0,e[4]=c,e[5]=_,e[6]=A,e[7]=0,e[8]=d,e[9]=b,e[10]=O,e[11]=0,e[12]=-(o*W+c*Q+d*ue),e[13]=-(y*W+_*Q+b*ue),e[14]=-(T*W+A*Q+O*ue),e[15]=1,e)}function df(e,n,r,i){var o=n[0],c=n[1],d=n[2],y=i[0],_=i[1],b=i[2],T=o-r[0],A=c-r[1],O=d-r[2],F=T*T+A*A+O*O;F>0&&(F=1/Math.sqrt(F),T*=F,A*=F,O*=F);var W=_*O-b*A,Q=b*T-y*O,ue=y*A-_*T;return F=W*W+Q*Q+ue*ue,F>0&&(F=1/Math.sqrt(F),W*=F,Q*=F,ue*=F),e[0]=W,e[1]=Q,e[2]=ue,e[3]=0,e[4]=A*ue-O*Q,e[5]=O*W-T*ue,e[6]=T*Q-A*W,e[7]=0,e[8]=T,e[9]=A,e[10]=O,e[11]=0,e[12]=o,e[13]=c,e[14]=d,e[15]=1,e}function cl(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Ni(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Nc(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e[3]=n[3]+r[3],e[4]=n[4]+r[4],e[5]=n[5]+r[5],e[6]=n[6]+r[6],e[7]=n[7]+r[7],e[8]=n[8]+r[8],e[9]=n[9]+r[9],e[10]=n[10]+r[10],e[11]=n[11]+r[11],e[12]=n[12]+r[12],e[13]=n[13]+r[13],e[14]=n[14]+r[14],e[15]=n[15]+r[15],e}function Kf(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e[3]=n[3]-r[3],e[4]=n[4]-r[4],e[5]=n[5]-r[5],e[6]=n[6]-r[6],e[7]=n[7]-r[7],e[8]=n[8]-r[8],e[9]=n[9]-r[9],e[10]=n[10]-r[10],e[11]=n[11]-r[11],e[12]=n[12]-r[12],e[13]=n[13]-r[13],e[14]=n[14]-r[14],e[15]=n[15]-r[15],e}function zl(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=n[3]*r,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=n[7]*r,e[8]=n[8]*r,e[9]=n[9]*r,e[10]=n[10]*r,e[11]=n[11]*r,e[12]=n[12]*r,e[13]=n[13]*r,e[14]=n[14]*r,e[15]=n[15]*r,e}function $f(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e[2]=n[2]+r[2]*i,e[3]=n[3]+r[3]*i,e[4]=n[4]+r[4]*i,e[5]=n[5]+r[5]*i,e[6]=n[6]+r[6]*i,e[7]=n[7]+r[7]*i,e[8]=n[8]+r[8]*i,e[9]=n[9]+r[9]*i,e[10]=n[10]+r[10]*i,e[11]=n[11]+r[11]*i,e[12]=n[12]+r[12]*i,e[13]=n[13]+r[13]*i,e[14]=n[14]+r[14]*i,e[15]=n[15]+r[15]*i,e}function vf(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]&&e[4]===n[4]&&e[5]===n[5]&&e[6]===n[6]&&e[7]===n[7]&&e[8]===n[8]&&e[9]===n[9]&&e[10]===n[10]&&e[11]===n[11]&&e[12]===n[12]&&e[13]===n[13]&&e[14]===n[14]&&e[15]===n[15]}function fl(e,n){var r=e[0],i=e[1],o=e[2],c=e[3],d=e[4],y=e[5],_=e[6],b=e[7],T=e[8],A=e[9],O=e[10],F=e[11],W=e[12],Q=e[13],ue=e[14],Oe=e[15],rt=n[0],lt=n[1],At=n[2],Ot=n[3],Ut=n[4],Gt=n[5],gr=n[6],Nr=n[7],Xr=n[8],Er=n[9],on=n[10],Ln=n[11],Hn=n[12],Ga=n[13],Os=n[14],Ys=n[15];return Math.abs(r-rt)<=Ii.Ib*Math.max(1,Math.abs(r),Math.abs(rt))&&Math.abs(i-lt)<=Ii.Ib*Math.max(1,Math.abs(i),Math.abs(lt))&&Math.abs(o-At)<=Ii.Ib*Math.max(1,Math.abs(o),Math.abs(At))&&Math.abs(c-Ot)<=Ii.Ib*Math.max(1,Math.abs(c),Math.abs(Ot))&&Math.abs(d-Ut)<=Ii.Ib*Math.max(1,Math.abs(d),Math.abs(Ut))&&Math.abs(y-Gt)<=Ii.Ib*Math.max(1,Math.abs(y),Math.abs(Gt))&&Math.abs(_-gr)<=Ii.Ib*Math.max(1,Math.abs(_),Math.abs(gr))&&Math.abs(b-Nr)<=Ii.Ib*Math.max(1,Math.abs(b),Math.abs(Nr))&&Math.abs(T-Xr)<=Ii.Ib*Math.max(1,Math.abs(T),Math.abs(Xr))&&Math.abs(A-Er)<=Ii.Ib*Math.max(1,Math.abs(A),Math.abs(Er))&&Math.abs(O-on)<=Ii.Ib*Math.max(1,Math.abs(O),Math.abs(on))&&Math.abs(F-Ln)<=Ii.Ib*Math.max(1,Math.abs(F),Math.abs(Ln))&&Math.abs(W-Hn)<=Ii.Ib*Math.max(1,Math.abs(W),Math.abs(Hn))&&Math.abs(Q-Ga)<=Ii.Ib*Math.max(1,Math.abs(Q),Math.abs(Ga))&&Math.abs(ue-Os)<=Ii.Ib*Math.max(1,Math.abs(ue),Math.abs(Os))&&Math.abs(Oe-Ys)<=Ii.Ib*Math.max(1,Math.abs(Oe),Math.abs(Ys))}var Zl=La,Uu=Kf,Ds,pl,hl=(Ds=(0,ie.b2)(),Ds(pl=function(){function e(){(0,be.Z)(this,e),(0,M.Z)(this,"viewport",void 0),(0,M.Z)(this,"overridedViewProjectionMatrix",void 0),(0,M.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,M.Z)(this,"jitteredProjectionMatrix",void 0),(0,M.Z)(this,"viewMatrixInverse",void 0),(0,M.Z)(this,"cameraPosition",void 0)}return(0,Pe.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(r){this.viewport=r,this.viewMatrixInverse=gu(),qi(this.viewMatrixInverse,r.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var r=this.viewport.getCenter(),i=(0,Ft.Z)(r,2),o=i[0],c=i[1];return[o,c]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(r,i){return this.viewport.projectFlat(r,i)}},{key:"setViewProjectionMatrix",value:function(r){this.overridedViewProjectionMatrix=r}},{key:"jitterProjectionMatrix",value:function(r,i){var o=cc(gu(),[r,i,0]);this.jitteredProjectionMatrix=La(gu(),o,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=La(gu(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||pl),Su,dc;function dl(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=xs(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function xs(e,n){if(!!e){if(typeof e=="string")return zc(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return zc(e,n)}}function zc(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var mf=(Su=(0,ie.b2)(),Su(dc=function(){function e(){(0,be.Z)(this,e),(0,M.Z)(this,"container",void 0),(0,M.Z)(this,"controlCorners",void 0),(0,M.Z)(this,"controlContainer",void 0),(0,M.Z)(this,"scene",void 0),(0,M.Z)(this,"mapsService",void 0),(0,M.Z)(this,"controls",[]),(0,M.Z)(this,"unAddControls",[])}return(0,Pe.Z)(e,[{key:"init",value:function(r,i){this.container=r.container,this.scene=i,this.mapsService=i.get(J.IMapService),this.initControlPos()}},{key:"addControl",value:function(r,i){var o=i.get(J.IMapService);o.map?(r.addTo(this.scene),this.controls.push(r)):this.unAddControls.push(r)}},{key:"getControlByName",value:function(r){return this.controls.find(function(i){return i.controlOption.name===r})}},{key:"removeControl",value:function(r){var i=this.controls.indexOf(r);return i>-1&&this.controls.splice(i,1),r.remove(),this}},{key:"addControls",value:function(){var r=this;this.unAddControls.forEach(function(i){i.addTo(r.scene),r.controls.push(i)}),this.unAddControls=[]}},{key:"destroy",value:function(){var r=dl(this.controls),i;try{for(r.s();!(i=r.n()).done;){var o=i.value;o.remove()}}catch(c){r.e(c)}finally{r.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var r=this.controlCorners={},i="l7-",o=this.controlContainer=Bt("div",i+"control-container",this.container);function c(d,y){var _=i+d+" "+i+y;r[d+y]=Bt("div",_,o)}c("top","left"),c("top","right"),c("bottom","left"),c("bottom","right")}},{key:"clearControlPos",value:function(){for(var r in this.controlCorners)this.controlCorners[r]&&ot(this.controlCorners[r]);this.controlContainer&&ot(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),e}())||dc),Zc,Eu,Ul=(Zc=(0,ie.b2)(),Zc(Eu=function(){function e(){(0,be.Z)(this,e),(0,M.Z)(this,"container",void 0),(0,M.Z)(this,"scene",void 0),(0,M.Z)(this,"mapsService",void 0),(0,M.Z)(this,"markers",[]),(0,M.Z)(this,"markerLayers",[]),(0,M.Z)(this,"unAddMarkers",[]),(0,M.Z)(this,"unAddMarkerLayers",[])}return(0,Pe.Z)(e,[{key:"addMarkerLayer",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(r),r.addTo(this.scene)):this.unAddMarkerLayers.push(r)}},{key:"removeMarkerLayer",value:function(r){r.destroy(),this.markerLayers.indexOf(r);var i=this.markerLayers.indexOf(r);i>-1&&this.markerLayers.splice(i,1)}},{key:"addMarker",value:function(r){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(r),r.addTo(this.scene)):this.unAddMarkers.push(r)}},{key:"addMarkers",value:function(){var r=this;this.unAddMarkers.forEach(function(i){i.addTo(r.scene),r.markers.push(i)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var r=this;this.unAddMarkerLayers.forEach(function(i){r.markerLayers.push(i),i.addTo(r.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(r){r.remove(),this.markers.indexOf(r);var i=this.markers.indexOf(r);i>-1&&this.markers.splice(i,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(J.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(r){r.remove()}),this.markers=[],this.markerLayers.forEach(function(r){r.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(r){r.destroy()}}]),e}())||Eu),jl,Cu,Vl=(jl=(0,ie.b2)(),jl(Cu=function(){function e(){(0,be.Z)(this,e),(0,M.Z)(this,"scene",void 0),(0,M.Z)(this,"popup",void 0),(0,M.Z)(this,"mapsService",void 0),(0,M.Z)(this,"unAddPopup",void 0)}return(0,Pe.Z)(e,[{key:"removePopup",value:function(r){r.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(r){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(r.addTo(this.scene),this.popup=r):this.unAddPopup=r}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(r){this.scene=r,this.mapsService=r.get(J.IMapService)}}]),e}())||Cu),yf=G(82492),Tu=G.n(yf),gf={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Jf=gf,_f,vl;function Uc(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function vc(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Uc(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Uc(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var xf={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},ml={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Qf=(_f=(0,ie.b2)(),_f(vl=function(){function e(){(0,be.Z)(this,e),(0,M.Z)(this,"sceneConfigCache",{}),(0,M.Z)(this,"layerConfigCache",{})}return(0,Pe.Z)(e,[{key:"getSceneConfig",value:function(r){return this.sceneConfigCache[r]}},{key:"getSceneWarninfo",value:function(r){return Jf[r]}},{key:"setSceneConfig",value:function(r,i){this.sceneConfigCache[r]=vc(vc({},xf),i)}},{key:"getLayerConfig",value:function(r){return this.layerConfigCache[r]}},{key:"setLayerConfig",value:function(r,i,o){this.layerConfigCache[i]=vc({},Tu()({},this.sceneConfigCache[r],ml,o))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||vl);function Tn(e,n,r,i){!r||Object.defineProperty(e,n,{enumerable:r.enumerable,configurable:r.configurable,writable:r.writable,value:r.initializer?r.initializer.call(i):void 0})}function Kr(e,n,r,i,o){var c={};return Object.keys(i).forEach(function(d){c[d]=i[d]}),c.enumerable=!!c.enumerable,c.configurable=!!c.configurable,("value"in c||c.initializer)&&(c.writable=!0),c=r.slice().reverse().reduce(function(d,y){return y(e,n,d)||d},c),o&&c.initializer!==void 0&&(c.value=c.initializer?c.initializer.call(o):void 0,c.initializer=void 0),c.initializer===void 0&&(Object.defineProperty(e,n,c),c=null),c}function Gl(){var e=new Ii.WT(4);return Ii.WT!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function ju(e){var n=new glMatrix.ARRAY_TYPE(4);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n}function Vu(e,n,r,i){var o=new Ii.WT(4);return o[0]=e,o[1]=n,o[2]=r,o[3]=i,o}function ii(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function Vi(e,n,r,i,o){return e[0]=n,e[1]=r,e[2]=i,e[3]=o,e}function bs(e,n,r){return e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e[3]=n[3]+r[3],e}function jc(e,n,r){return e[0]=n[0]-r[0],e[1]=n[1]-r[1],e[2]=n[2]-r[2],e[3]=n[3]-r[3],e}function mc(e,n,r){return e[0]=n[0]*r[0],e[1]=n[1]*r[1],e[2]=n[2]*r[2],e[3]=n[3]*r[3],e}function Vc(e,n,r){return e[0]=n[0]/r[0],e[1]=n[1]/r[1],e[2]=n[2]/r[2],e[3]=n[3]/r[3],e}function rh(e,n){return e[0]=Math.ceil(n[0]),e[1]=Math.ceil(n[1]),e[2]=Math.ceil(n[2]),e[3]=Math.ceil(n[3]),e}function nh(e,n){return e[0]=Math.floor(n[0]),e[1]=Math.floor(n[1]),e[2]=Math.floor(n[2]),e[3]=Math.floor(n[3]),e}function yc(e,n,r){return e[0]=Math.min(n[0],r[0]),e[1]=Math.min(n[1],r[1]),e[2]=Math.min(n[2],r[2]),e[3]=Math.min(n[3],r[3]),e}function Gu(e,n,r){return e[0]=Math.max(n[0],r[0]),e[1]=Math.max(n[1],r[1]),e[2]=Math.max(n[2],r[2]),e[3]=Math.max(n[3],r[3]),e}function Hu(e,n){return e[0]=Math.round(n[0]),e[1]=Math.round(n[1]),e[2]=Math.round(n[2]),e[3]=Math.round(n[3]),e}function fa(e,n,r){return e[0]=n[0]*r,e[1]=n[1]*r,e[2]=n[2]*r,e[3]=n[3]*r,e}function Fo(e,n,r,i){return e[0]=n[0]+r[0]*i,e[1]=n[1]+r[1]*i,e[2]=n[2]+r[2]*i,e[3]=n[3]+r[3]*i,e}function Hl(e,n){var r=n[0]-e[0],i=n[1]-e[1],o=n[2]-e[2],c=n[3]-e[3];return Math.hypot(r,i,o,c)}function Aa(e,n){var r=n[0]-e[0],i=n[1]-e[1],o=n[2]-e[2],c=n[3]-e[3];return r*r+i*i+o*o+c*c}function Gr(e){var n=e[0],r=e[1],i=e[2],o=e[3];return Math.hypot(n,r,i,o)}function os(e){var n=e[0],r=e[1],i=e[2],o=e[3];return n*n+r*r+i*i+o*o}function Gc(e,n){return e[0]=-n[0],e[1]=-n[1],e[2]=-n[2],e[3]=-n[3],e}function Wl(e,n){return e[0]=1/n[0],e[1]=1/n[1],e[2]=1/n[2],e[3]=1/n[3],e}function Fs(e,n){var r=n[0],i=n[1],o=n[2],c=n[3],d=r*r+i*i+o*o+c*c;return d>0&&(d=1/Math.sqrt(d)),e[0]=r*d,e[1]=i*d,e[2]=o*d,e[3]=c*d,e}function ss(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]+e[3]*n[3]}function yl(e,n,r,i){var o=r[0]*i[1]-r[1]*i[0],c=r[0]*i[2]-r[2]*i[0],d=r[0]*i[3]-r[3]*i[0],y=r[1]*i[2]-r[2]*i[1],_=r[1]*i[3]-r[3]*i[1],b=r[2]*i[3]-r[3]*i[2],T=n[0],A=n[1],O=n[2],F=n[3];return e[0]=A*b-O*_+F*y,e[1]=-(T*b)+O*d-F*c,e[2]=T*_-A*d+F*o,e[3]=-(T*y)+A*c-O*o,e}function dr(e,n,r,i){var o=n[0],c=n[1],d=n[2],y=n[3];return e[0]=o+i*(r[0]-o),e[1]=c+i*(r[1]-c),e[2]=d+i*(r[2]-d),e[3]=y+i*(r[3]-y),e}function bf(e,n){n=n||1;var r,i,o,c,d,y;do r=glMatrix.RANDOM()*2-1,i=glMatrix.RANDOM()*2-1,d=r*r+i*i;while(d>=1);do o=glMatrix.RANDOM()*2-1,c=glMatrix.RANDOM()*2-1,y=o*o+c*c;while(y>=1);var _=Math.sqrt((1-d)/y);return e[0]=n*r,e[1]=n*i,e[2]=n*o*_,e[3]=n*c*_,e}function gl(e,n,r){var i=n[0],o=n[1],c=n[2],d=n[3];return e[0]=r[0]*i+r[4]*o+r[8]*c+r[12]*d,e[1]=r[1]*i+r[5]*o+r[9]*c+r[13]*d,e[2]=r[2]*i+r[6]*o+r[10]*c+r[14]*d,e[3]=r[3]*i+r[7]*o+r[11]*c+r[15]*d,e}function Wu(e,n,r){var i=n[0],o=n[1],c=n[2],d=r[0],y=r[1],_=r[2],b=r[3],T=b*i+y*c-_*o,A=b*o+_*i-d*c,O=b*c+d*o-y*i,F=-d*i-y*o-_*c;return e[0]=T*b+F*-d+A*-_-O*-y,e[1]=A*b+F*-y+O*-d-T*-_,e[2]=O*b+F*-_+T*-y-A*-d,e[3]=n[3],e}function ws(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function $o(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function wf(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]}function Sf(e,n){var r=e[0],i=e[1],o=e[2],c=e[3],d=n[0],y=n[1],_=n[2],b=n[3];return Math.abs(r-d)<=glMatrix.EPSILON*Math.max(1,Math.abs(r),Math.abs(d))&&Math.abs(i-y)<=glMatrix.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(o-_)<=glMatrix.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(c-b)<=glMatrix.EPSILON*Math.max(1,Math.abs(c),Math.abs(b))}var us=null,Xu=null,Ef=null,gc=null,ep=null,Cf=null,Js=null,Ss=function(){var e=Gl();return function(n,r,i,o,c,d){var y,_;for(r||(r=4),i||(i=0),o?_=Math.min(o*r+i,n.length):_=n.length,y=i;y<_;y+=r)e[0]=n[y],e[1]=n[y+1],e[2]=n[y+2],e[3]=n[y+3],c(e,e,d),n[y]=e[0],n[y+1]=e[1],n[y+2]=e[2],n[y+3]=e[3];return n}}(),Xn=Math.PI/180,Qs=512,to=4003e4;function Ma(e){var n=e.latitude,r=n===void 0?0:n,i=e.zoom,o=i===void 0?0:i,c=e.scale,d=e.highPrecision,y=d===void 0?!1:d,_=e.flipY,b=_===void 0?!1:_;c=c!==void 0?c:Math.pow(2,o);var T={},A=Qs*c,O=Math.cos(r*Xn),F=A/360,W=F/O,Q=A/to/O;if(T.pixelsPerMeter=[Q,-Q,Q],T.metersPerPixel=[1/Q,-1/Q,1/Q],T.pixelsPerDegree=[F,-W,Q],T.degreesPerPixel=[1/F,-1/W,1/Q],y){var ue=Xn*Math.tan(r*Xn)/O,Oe=F*ue/2,rt=A/to*ue,lt=rt/W*Q;T.pixelsPerDegree2=[0,-Oe,rt],T.pixelsPerMeter2=[lt,0,lt],b&&(T.pixelsPerDegree2[1]=-T.pixelsPerDegree2[1],T.pixelsPerMeter2[1]=-T.pixelsPerMeter2[1])}return b&&(T.pixelsPerMeter[1]=-T.pixelsPerMeter[1],T.metersPerPixel[1]=-T.metersPerPixel[1],T.pixelsPerDegree[1]=-T.pixelsPerDegree[1],T.degreesPerPixel[1]=-T.degreesPerPixel[1]),T}var Bo;(function(e){e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2"})(Bo||(Bo={}));var No={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},ls,lo,_l,nn,Wr,_c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],wo=(ls=(0,ie.b2)(),lo=(0,ie.f3)(J.ICameraService),ls(_l=(nn=function(){function e(){(0,be.Z)(this,e),(0,M.Z)(this,"needRefresh",!0),Tn(this,"cameraService",Wr,this),(0,M.Z)(this,"coordinateSystem",void 0),(0,M.Z)(this,"viewportCenter",void 0),(0,M.Z)(this,"viewportCenterProjection",void 0),(0,M.Z)(this,"pixelsPerDegree",void 0),(0,M.Z)(this,"pixelsPerDegree2",void 0),(0,M.Z)(this,"pixelsPerMeter",void 0)}return(0,Pe.Z)(e,[{key:"refresh",value:function(){var r=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),o=this.cameraService.getCenter(),c=Ma({latitude:o[1],zoom:r}),d=c.pixelsPerMeter,y=c.pixelsPerDegree;this.viewportCenter=o,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=d,this.pixelsPerDegree=y,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Bo.LNGLAT||this.coordinateSystem===Bo.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Bo.LNGLAT_OFFSET?this.calculateLnglatOffset(o,r):this.coordinateSystem===Bo.P20_OFFSET&&this.calculateLnglatOffset(o,r,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(r){this.coordinateSystem=r}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(r,i,o,c){var d=Ma({latitude:r[1],zoom:i,scale:o,flipY:c,highPrecision:!0}),y=d.pixelsPerMeter,_=d.pixelsPerDegree,b=d.pixelsPerDegree2,T=this.cameraService.getViewMatrix(),A=this.cameraService.getProjectionMatrix(),O=La([],A,T),F=this.cameraService.projectFlat([Math.fround(r[0]),Math.fround(r[1])],Math.pow(2,i));this.viewportCenterProjection=gl([],[F[0],F[1],0,1],O),T=this.cameraService.getViewMatrixUncentered()||T,O=La([],A,T),O=La([],O,_c),this.cameraService.setViewProjectionMatrix(O),this.pixelsPerMeter=y,this.pixelsPerDegree=_,this.pixelsPerDegree2=b}}]),e}(),Wr=Kr(nn.prototype,"cameraService",[lo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nn))||_l),Ra=G(50840),ya=G.n(Ra),ta;(function(e){e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag"})(ta||(ta={}));var Es,xl,fi,pa,Hc;function Yu(e){var n=Wc();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Wc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var eu={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},zo=(Es=(0,ie.b2)(),xl=(0,ie.f3)(J.IMapService),Es(fi=(pa=function(e){(0,Je.Z)(r,e);var n=Yu(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),Tn((0,H.Z)(i),"mapService",Hc,(0,H.Z)(i)),(0,M.Z)((0,H.Z)(i),"hammertime",void 0),(0,M.Z)((0,H.Z)(i),"lastClickTime",0),(0,M.Z)((0,H.Z)(i),"lastClickXY",[-1,-1]),(0,M.Z)((0,H.Z)(i),"clickTimer",void 0),(0,M.Z)((0,H.Z)(i),"$containter",void 0),(0,M.Z)((0,H.Z)(i),"onDrag",function(y){var _=i.interactionEvent(y);_.type=eu[_.type],i.emit(ta.Drag,_)}),(0,M.Z)((0,H.Z)(i),"onHammer",function(y){y.srcEvent.stopPropagation();var _=i.interactionEvent(y);i.emit(ta.Hover,_)}),(0,M.Z)((0,H.Z)(i),"onTouch",function(y){var _=y.touches[0];i.onHover({x:_.pageX,y:_.pageY,type:"touch"})}),(0,M.Z)((0,H.Z)(i),"onHover",function(y){var _=y.clientX,b=y.clientY,T=_,A=b,O=y.type,F=i.mapService.getMapContainer();if(F){var W=F.getBoundingClientRect(),Q=W.top,ue=W.left;T=T-ue-F.clientLeft,A=A-Q-F.clientTop}var Oe=i.mapService.containerToLngLat([T,A]);if(O==="click"){if("ontouchstart"in document.documentElement)return;i.isDoubleTap(T,A,Oe);return}if(O==="touch"){i.isDoubleTap(T,A,Oe);return}O!=="click"&&O!=="dblclick"&&i.emit(ta.Hover,{x:T,y:A,lngLat:Oe,type:O,target:y})}),i}return(0,Pe.Z)(r,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(ta.Hover)}},{key:"triggerHover",value:function(o){var c=o.x,d=o.y;this.emit(ta.Hover,{x:c,y:d})}},{key:"triggerSelect",value:function(o){this.emit(ta.Select,{featureId:o})}},{key:"triggerActive",value:function(o){this.emit(ta.Active,{featureId:o})}},{key:"addEventListenerOnMap",value:function(){var o=this.mapService.getMapContainer();if(o){var c=new(ya()).Manager(o);c.add(new(ya()).Tap({event:"dblclick",taps:2})),c.add(new(ya()).Tap({event:"click"})),c.add(new(ya()).Pan({threshold:0,pointers:0})),c.add(new(ya()).Press({})),c.on("dblclick click",this.onHammer),c.on("panstart panmove panend pancancel",this.onDrag),o.addEventListener("mousemove",this.onHover),o.addEventListener("mousedown",this.onHover,!0),o.addEventListener("mouseup",this.onHover),o.addEventListener("contextmenu",this.onHover),this.hammertime=c}}},{key:"removeEventListenerOnMap",value:function(){var o=this.mapService.getMapContainer();o&&(o.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),o.removeEventListener("mousedown",this.onHover),o.removeEventListener("mouseup",this.onHover),o.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(o){var c=o.type,d=o.pointerType,y,_;d==="touch"?(_=Math.floor(o.pointers[0].clientY),y=Math.floor(o.pointers[0].clientX)):(_=Math.floor(o.srcEvent.y),y=Math.floor(o.srcEvent.x));var b=this.mapService.getMapContainer();if(b){var T=b.getBoundingClientRect(),A=T.top,O=T.left;y-=O,_-=A}var F=this.mapService.containerToLngLat([y,_]);return{x:y,y:_,lngLat:F,type:c,target:o.srcEvent}}},{key:"isDoubleTap",value:function(o,c,d){var y=this,_=new Date().getTime(),b="click";_-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-o)<10&&Math.abs(this.lastClickXY[1]-c)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),b="dblclick",this.emit(ta.Hover,{x:o,y:c,lngLat:d,type:b})):(this.lastClickTime=_,this.lastClickXY=[o,c],this.clickTimer=setTimeout(function(){b="click",y.emit(ta.Hover,{x:o,y:c,lngLat:d,type:b})},400))}}]),r}(me()),Hc=Kr(pa.prototype,"mapService",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pa))||fi),Zo=G(92137),tu=G(87757),ga=G.n(tu),re;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(re||(re={}));var Xl,Xc,bl,Au,xc,Mu,cs,wl,Cs,fs,Yc;function Yl(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function qc(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Yl(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yl(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Kc=(Xl=(0,ie.b2)(),Xc=(0,ie.f3)(J.IRendererService),bl=(0,ie.f3)(J.IGlobalConfigService),Au=(0,ie.f3)(J.IInteractionService),xc=(0,ie.f3)(J.ILayerService),Xl(Mu=(cs=function(){function e(){var n=this;(0,be.Z)(this,e),Tn(this,"rendererService",wl,this),Tn(this,"configService",Cs,this),Tn(this,"interactionService",fs,this),Tn(this,"layerService",Yc,this),(0,M.Z)(this,"pickingFBO",void 0),(0,M.Z)(this,"width",0),(0,M.Z)(this,"height",0),(0,M.Z)(this,"alreadyInPicking",!1),(0,M.Z)(this,"pickBufferScale",1),(0,M.Z)(this,"pickFromPickingFBO",function(r,i){var o,c=i.x,d=i.y,y=i.lngLat,_=i.type,b=i.target,T=!1,A=n.rendererService,O=A.getViewportSize,F=A.readPixels,W=A.getContainer,Q=W().getBoundingClientRect(),ue=Q.width,Oe=Q.height;ue*=Ke,Oe*=Ke;var rt=r.getLayerConfig(),lt=rt.enableHighlight,At=rt.enableSelect,Ot=c*Ke,Ut=d*Ke;if(Ot>ue-1*Ke||Ot<0||Ut>Oe-1*Ke||Ut<0)return!1;var Gt;if(Gt=F({x:Math.floor(Ot/n.pickBufferScale),y:Math.floor((Oe-(d+1)*Ke)/n.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Gt[0]!==0||Gt[1]!==0||Gt[2]!==0){var gr=Vn(Gt),Nr=r.getSource().getFeatureById(gr);gr!==r.getCurrentPickId()&&_==="mousemove"&&(_="mouseenter");var Xr={x:c,y:d,type:_,lngLat:y,featureId:gr,feature:Nr,target:b};Nr&&(T=!0,r.setCurrentPickId(gr),n.triggerHoverOnLayer(r,Xr))}else{var Er={x:c,y:d,lngLat:y,type:r.getCurrentPickId()!==null&&_==="mousemove"?"mouseout":"un"+_,featureId:null,target:b,feature:null};n.triggerHoverOnLayer(r,qc(qc({},Er),{},{type:"unpick"})),n.triggerHoverOnLayer(r,Er),r.setCurrentPickId(null)}if(lt&&n.highlightPickedFeature(r,Gt),At&&_==="click"&&((o=Gt)===null||o===void 0?void 0:o.toString())!==[0,0,0,0].toString()){var on=Vn(Gt);r.getCurrentSelectedId()===null||on!==r.getCurrentSelectedId()?(n.selectFeature(r,Gt),r.setCurrentSelectedId(on)):(n.selectFeature(r,new Uint8Array([0,0,0,0])),r.setCurrentSelectedId(null))}return T})}return(0,Pe.Z)(e,[{key:"init",value:function(r){var i=this.rendererService,o=i.createTexture2D,c=i.createFramebuffer,d=i.getViewportSize,y=i.getContainer,_=y().getBoundingClientRect(),b=_.width,T=_.height;b*=Ke,T*=Ke,this.pickBufferScale=this.configService.getSceneConfig(r).pickBufferScale||1,this.pickingFBO=c({color:o({width:Math.round(b/this.pickBufferScale),height:Math.round(T/this.pickBufferScale),wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE})}),this.interactionService.on(ta.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var n=(0,Zo.Z)(ga().mark(function i(o,c,d){var y=this,_,b,T,A;return ga().wrap(function(F){for(;;)switch(F.prev=F.next){case 0:_=this.rendererService,b=_.useFramebuffer,T=_.clear,A=_.getContainer,this.resizePickingFBO(),b(this.pickingFBO,function(){T({framebuffer:y.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),o.hooks.beforePickingEncode.call(),o.renderModels(),o.hooks.afterPickingEncode.call();var W=y.pickBox(o,c);d(W)});case 3:case"end":return F.stop()}},i,this)}));function r(i,o,c){return n.apply(this,arguments)}return r}()},{key:"pickBox",value:function(r,i){var o=this,c=i.map(function(Er){var on=Er<0?0:Er;return Math.floor(on*Ke/o.pickBufferScale)}),d=(0,Ft.Z)(c,4),y=d[0],_=d[1],b=d[2],T=d[3],A=this.rendererService,O=A.getViewportSize,F=A.readPixels,W=A.getContainer,Q=W().getBoundingClientRect(),ue=Q.width,Oe=Q.height;if(ue*=Ke,Oe*=Ke,y>(ue-1)*Ke/this.pickBufferScale||b<0||_>(Oe-1)*Ke/this.pickBufferScale||T<0)return[];var rt,lt=Math.min(ue/this.pickBufferScale,b)-y,At=Math.min(Oe/this.pickBufferScale,T)-_;rt=F({x:y,y:Math.floor(Oe/this.pickBufferScale-(T+1)),width:lt,height:At,data:new Uint8Array(lt*At*4),framebuffer:this.pickingFBO});for(var Ot=[],Ut={},Gt=0;Gt<rt.length/4;Gt=Gt+1){var gr=rt.slice(Gt*4,Gt*4+4),Nr=Vn(gr);if(Nr!==-1&&!Ut[Nr]){var Xr=r.getSource().getFeatureById(Nr);Ot.push(Xr),Ut[Nr]=!0}}return Ot}},{key:"pickingAllLayer",value:function(){var n=(0,Zo.Z)(ga().mark(function i(o){return ga().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){d.next=2;break}return d.abrupt("return");case 2:return this.alreadyInPicking=!0,d.next=5,this.pickingLayers(o);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return d.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"resizePickingFBO",value:function(){var r=this.rendererService.getContainer,i=r().getBoundingClientRect(),o=i.width,c=i.height;o*=Ke,c*=Ke,(this.width!==o||this.height!==c)&&(this.pickingFBO.resize({width:Math.round(o/this.pickBufferScale),height:Math.round(c/this.pickBufferScale)}),this.width=o,this.height=c)}},{key:"pickingLayers",value:function(){var n=(0,Zo.Z)(ga().mark(function i(o){var c=this,d,y,_,b,T;return ga().wrap(function(O){for(;;)switch(O.prev=O.next){case 0:d=this.rendererService,y=d.getViewportSize,_=d.useFramebuffer,b=d.clear,T=d.getContainer,this.resizePickingFBO(),_(this.pickingFBO,function(){var F=c.layerService.getLayers();F.filter(function(W){return W.needPick(o.type)}).reverse().some(function(W){b({framebuffer:c.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),W.hooks.beforePickingEncode.call(),W.renderModels(),W.hooks.afterPickingEncode.call();var Q=c.pickFromPickingFBO(W,o);return Q&&!W.getLayerConfig().enablePropagation})});case 3:case"end":return O.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"triggerHoverOnLayer",value:function(r,i){r.emit(i.type,i)}},{key:"isEventCrash",value:function(r){var i=!0;return r.target.path.map(function(o){o.classList&&o.classList.forEach(function(c){(c==="l7-marker"||c==="l7-popup")&&(i=!1)})}),i}},{key:"highlightPickedFeature",value:function(r,i){var o=(0,Ft.Z)(i,3),c=o[0],d=o[1],y=o[2];r.hooks.beforeHighlight.call([c,d,y])}},{key:"selectFeature",value:function(r,i){var o=(0,Ft.Z)(i,3),c=o[0],d=o[1],y=o[2];r.hooks.beforeSelect.call([c,d,y])}}]),e}(),wl=Kr(cs.prototype,"rendererService",[Xc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cs=Kr(cs.prototype,"configService",[bl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fs=Kr(cs.prototype,"interactionService",[Au],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yc=Kr(cs.prototype,"layerService",[xc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cs))||Mu),u=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,be.Z)(this,e),(0,M.Z)(this,"autoStart",void 0),(0,M.Z)(this,"startTime",0),(0,M.Z)(this,"oldTime",0),(0,M.Z)(this,"running",!1),(0,M.Z)(this,"elapsedTime",0),this.autoStart=n}return(0,Pe.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var r=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var i=(typeof performance=="undefined"?Date:performance).now();r=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=r}return r}}]),e}(),f,l,h,x,S,E,P,R=(f=(0,ie.b2)(),l=(0,ie.f3)(J.IRendererService),h=(0,ie.f3)(J.IGlobalConfigService),f(x=(S=function(){function e(){(0,be.Z)(this,e),(0,M.Z)(this,"clock",new u),(0,M.Z)(this,"alreadyInRendering",!1),(0,M.Z)(this,"layers",[]),(0,M.Z)(this,"layerRenderID",void 0),(0,M.Z)(this,"sceneInited",!1),(0,M.Z)(this,"animateInstanceCount",0),Tn(this,"renderService",E,this),Tn(this,"configService",P,this)}return(0,Pe.Z)(e,[{key:"add",value:function(r){this.sceneInited&&r.init(),this.layers.push(r)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(r){r.inited||r.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(r){return this.layers.find(function(i){return i.id===r})}},{key:"getLayerByName",value:function(r){return this.layers.find(function(i){return i.name===r})}},{key:"remove",value:function(r){var i=this.layers.indexOf(r);i>-1&&this.layers.splice(i,1),r.emit("remove",null),r.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(){this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(r){return r.inited}).filter(function(r){return r.isVisible()}).forEach(function(r){r.hooks.beforeRenderData.call(),r.hooks.beforeRender.call(),r.render(),r.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(r,i){return r.zIndex-i.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(r){return r.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"clear",value:function(){this.renderService.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),e}(),E=Kr(S.prototype,"renderService",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P=Kr(S.prototype,"configService",[h],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S))||x),z=G(81253),j=G(85061),ee=G(14293),ne=G.n(ee),Ae=function(){function e(n){var r=this;(0,be.Z)(this,e),(0,M.Z)(this,"name",void 0),(0,M.Z)(this,"type",void 0),(0,M.Z)(this,"scale",void 0),(0,M.Z)(this,"descriptor",void 0),(0,M.Z)(this,"featureBufferLayout",[]),(0,M.Z)(this,"needRescale",!1),(0,M.Z)(this,"needRemapping",!1),(0,M.Z)(this,"needRegenerateVertices",!1),(0,M.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,M.Z)(this,"vertexAttribute",void 0),(0,M.Z)(this,"defaultCallback",function(i){if(i.length===0){var o;return((o=r.scale)===null||o===void 0?void 0:o.defaultValues)||[]}return i.map(function(c,d){var y,_=(y=r.scale)===null||y===void 0?void 0:y.scalers[d].func,b=_(c);return b})}),this.setProps(n)}return(0,Pe.Z)(e,[{key:"setProps",value:function(r){Object.assign(this,r)}},{key:"mapping",value:function(r){var i;if((i=this.scale)!==null&&i!==void 0&&i.callback){var o,c=(o=this.scale)===null||o===void 0?void 0:o.callback.apply(o,(0,j.Z)(r));if(!ne()(c))return[c]}return this.defaultCallback(r)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),Se=["buffer","update","name"],De,_e,Fe,Ge,at,Ct;function wt(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Mt(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?wt(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wt(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function qt(e){return new Promise(function(n){return setTimeout(n,e)})}var xr=(De={},(0,M.Z)(De,re.FLOAT,4),(0,M.Z)(De,re.UNSIGNED_BYTE,1),(0,M.Z)(De,re.UNSIGNED_SHORT,2),De),pr=(_e=(0,ie.b2)(),Fe=(0,ie.f3)(J.IRendererService),_e(Ge=(at=function(){function e(){(0,be.Z)(this,e),(0,M.Z)(this,"attributesAndIndices",void 0),Tn(this,"rendererService",Ct,this),(0,M.Z)(this,"attributes",[]),(0,M.Z)(this,"triangulation",void 0),(0,M.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Pe.Z)(e,[{key:"registerStyleAttribute",value:function(r){var i=this.getLayerStyleAttribute(r.name||"");return i?i.setProps(r):(i=new Ae(r),this.attributes.push(i)),i}},{key:"updateStyleAttribute",value:function(r,i,o){var c=this.getLayerStyleAttribute(r);c||(c=this.registerStyleAttribute(Mt(Mt({},i),{},{name:r})));var d=i.scale;d&&c&&(c.scale=d,c.needRescale=!0,c.needRemapping=!0,c.needRegenerateVertices=!0,o&&o.featureRange&&(c.featureRange=o.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(r){return this.attributes.find(function(i){return i.name===r})}},{key:"getLayerAttributeScale",value:function(r){var i,o=this.getLayerStyleAttribute(r),c=o==null||(i=o.scale)===null||i===void 0?void 0:i.scalers;return c&&c[0]?c[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(r,i){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,c=arguments.length>3?arguments[3]:void 0,d=this.attributes.find(function(At){return At.name===r});if(d&&d.descriptor){var y=d.descriptor,_=y.update,b=y.buffer,T=y.size,A=T===void 0?0:T,O=xr[b.type||re.FLOAT];if(_){var F=this.featureLayout,W=F.elements,Q=F.sizePerElement,ue=W.slice(o,c);if(!ue.length)return;var Oe=ue[0].offset,rt=Oe*A*O,lt=ue.map(function(At,Ot){for(var Ut=At.featureIdx,Gt=At.vertices,gr=At.normals,Nr=Gt.length/Q,Xr=[],Er=0;Er<Nr;Er++){var on=gr?gr.slice(Er*3,Er*3+3):[];Xr.push.apply(Xr,(0,j.Z)(_(i[Ut],Ut,Gt.slice(Er*Q,Er*Q+Q),Ot,on)))}return Xr}).reduce(function(At,Ot){return At.push.apply(At,(0,j.Z)(Ot)),At},[]);d.vertexAttribute.updateBuffer({data:lt,offset:rt})}}}},{key:"createAttributesAndIndices",value:function(r,i){var o=this;this.featureLayout={sizePerElement:0,elements:[]},i&&(this.triangulation=i);var c=this.attributes.map(function(Oe){return Oe.resetDescriptor(),Oe.descriptor}),d=0,y=[],_=[],b=[],T=3;r.forEach(function(Oe,rt){var lt=o.triangulation(Oe),At=lt.indices,Ot=lt.vertices,Ut=lt.normals,Gt=lt.size;At.forEach(function(Er){_.push(Er+d)}),T=Gt;var gr=Ot.length/Gt;o.featureLayout.sizePerElement=T,o.featureLayout.elements.push({featureIdx:rt,vertices:Ot,normals:Ut,offset:d}),d+=gr;for(var Nr=function(on){var Ln=(Ut==null?void 0:Ut.slice(on*3,on*3+3))||[],Hn=Ot.slice(on*Gt,on*Gt+Gt);c.forEach(function(Ga,Os){if(Ga&&Ga.update){var Ys;(Ys=Ga.buffer.data).push.apply(Ys,(0,j.Z)(Ga.update(Oe,rt,Hn,on,Ln)))}})},Xr=0;Xr<gr;Xr++)Nr(Xr)});var A=this.rendererService,O=A.createAttribute,F=A.createBuffer,W=A.createElements,Q={};c.forEach(function(Oe,rt){if(Oe){var lt=Oe.buffer,At=Oe.update,Ot=Oe.name,Ut=(0,z.Z)(Oe,Se),Gt=O(Mt({buffer:F(lt)},Ut));Q[Oe.name||""]=Gt,o.attributes[rt].vertexAttribute=Gt}});var ue=W({data:_,type:re.UNSIGNED_INT,count:_.length});return this.attributesAndIndices={attributes:Q,elements:ue},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var r;this.attributes.forEach(function(i){i.vertexAttribute&&i.vertexAttribute.destroy()}),(r=this.attributesAndIndices)===null||r===void 0||r.elements.destroy(),this.attributes=[]}}]),e}(),Ct=Kr(at.prototype,"rendererService",[Fe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),at))||Ge),Fr=G(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function tn(e,n,r,i){function o(c){return c instanceof r?c:new r(function(d){d(c)})}return new(r||(r=Promise))(function(c,d){function y(T){try{b(i.next(T))}catch(A){d(A)}}function _(T){try{b(i.throw(T))}catch(A){d(A)}}function b(T){T.done?c(T.value):o(T.value).then(y,_)}b((i=i.apply(e,n||[])).next())})}function pn(e,n){var r={label:0,sent:function(){if(c[0]&1)throw c[1];return c[1]},trys:[],ops:[]},i,o,c,d;return d={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(d[Symbol.iterator]=function(){return this}),d;function y(b){return function(T){return _([b,T])}}function _(b){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,o&&(c=b[0]&2?o.return:b[0]?o.throw||((c=o.return)&&c.call(o),0):o.next)&&!(c=c.call(o,b[1])).done)return c;switch(o=0,c&&(b=[b[0]&2,c.value]),b[0]){case 0:case 1:c=b;break;case 4:return r.label++,{value:b[1],done:!1};case 5:r.label++,o=b[1],b=[0];continue;case 7:b=r.ops.pop(),r.trys.pop();continue;default:if(c=r.trys,!(c=c.length>0&&c[c.length-1])&&(b[0]===6||b[0]===2)){r=0;continue}if(b[0]===3&&(!c||b[1]>c[0]&&b[1]<c[3])){r.label=b[1];break}if(b[0]===6&&r.label<c[1]){r.label=c[1],c=b;break}if(c&&r.label<c[2]){r.label=c[2],r.ops.push(b);break}c[2]&&r.ops.pop(),r.trys.pop();continue}b=n.call(e,r)}catch(T){b=[6,T],o=0}finally{i=c=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function ln(e,n){var r=typeof Symbol=="function"&&e[Symbol.iterator];if(!r)return e;var i=r.call(e),o,c=[],d;try{for(;(n===void 0||n-- >0)&&!(o=i.next()).done;)c.push(o.value)}catch(y){d={error:y}}finally{try{o&&!o.done&&(r=i.return)&&r.call(i)}finally{if(d)throw d.error}}return c}function pi(){for(var e=[],n=0;n<arguments.length;n++)e=e.concat(ln(arguments[n]));return e}function yr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function $r(e,n){return n={exports:{}},e(n,n.exports),n.exports}var kn=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){return i&&typeof i.length=="number"&&i.length>=0&&i.length%1==0}e.exports=n.default});yr(kn);var wn=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(r){return function(){for(var i=[],o=arguments.length;o--;)i[o]=arguments[o];var c=i.pop();return r.call(this,i,c)}},e.exports=n.default});yr(wn);var vn=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.fallback=o,n.wrap=c;var r=n.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,i=n.hasNextTick=typeof Fr=="object"&&typeof Fr.nextTick=="function";function o(y){setTimeout(y,0)}function c(y){return function(_){for(var b=[],T=arguments.length-1;T-- >0;)b[T]=arguments[T+1];return y(function(){return _.apply(void 0,b)})}}var d;r?d=setImmediate:i?d=Fr.nextTick:d=o,n.default=c(d)});yr(vn);var Un=vn.fallback,Sn=vn.wrap,_n=vn.hasSetImmediate,Da=vn.hasNextTick,Wi=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=c;var r=o(wn),i=o(vn);function o(_){return _&&_.__esModule?_:{default:_}}function c(_){return(0,Gi.isAsync)(_)?function(){for(var b=[],T=arguments.length;T--;)b[T]=arguments[T];var A=b.pop(),O=_.apply(this,b);return d(O,A)}:(0,r.default)(function(b,T){var A;try{A=_.apply(this,b)}catch(O){return T(O)}if(A&&typeof A.then=="function")return d(A,T);T(null,A)})}function d(_,b){return _.then(function(T){y(b,null,T)},function(T){y(b,T&&T.message?T:new Error(T))})}function y(_,b,T){try{_(b,T)}catch(A){(0,i.default)(function(O){throw O},A)}}e.exports=n.default});yr(Wi);var Gi=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.isAsyncIterable=n.isAsyncGenerator=n.isAsync=void 0;var r=i(Wi);function i(_){return _&&_.__esModule?_:{default:_}}function o(_){return _[Symbol.toStringTag]==="AsyncFunction"}function c(_){return _[Symbol.toStringTag]==="AsyncGenerator"}function d(_){return typeof _[Symbol.asyncIterator]=="function"}function y(_){if(typeof _!="function")throw new Error("expected a function");return o(_)?(0,r.default)(_):_}n.default=y,n.isAsync=o,n.isAsyncGenerator=c,n.isAsyncIterable=d});yr(Gi);var ro=Gi.isAsyncIterable,ra=Gi.isAsyncGenerator,_a=Gi.isAsync,Fa=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i,o){if(o===void 0&&(o=i.length),!o)throw new Error("arity is undefined");function c(){for(var d=this,y=[],_=arguments.length;_--;)y[_]=arguments[_];return typeof y[o-1]=="function"?i.apply(this,y):new Promise(function(b,T){y[o-1]=function(A){for(var O=[],F=arguments.length-1;F-- >0;)O[F]=arguments[F+1];if(A)return T(A);b(O.length>1?O:O[0])},i.apply(d,y)})}return Object.defineProperty(c,"name",{configurable:!0,value:"awaitable("+i.name+")"}),c}e.exports=n.default});yr(Fa);var no=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=c(kn),i=c(Gi),o=c(Fa);function c(d){return d&&d.__esModule?d:{default:d}}n.default=(0,o.default)(function(d,y,_){var b=(0,r.default)(y)?[]:{};d(y,function(T,A,O){(0,i.default)(T)(function(F){for(var W,Q=[],ue=arguments.length-1;ue-- >0;)Q[ue]=arguments[ue+1];Q.length<2&&(W=Q,Q=W[0]),b[A]=Q,O(F)})},function(T){return _(T,b)})},3),e.exports=n.default});yr(no);var Ts=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){function o(){for(var c=[],d=arguments.length;d--;)c[d]=arguments[d];if(i!==null){var y=i;i=null,y.apply(this,c)}}return Object.assign(o,i),o}e.exports=n.default});yr(Ts);var co=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(r){return r[Symbol.iterator]&&r[Symbol.iterator]()},e.exports=n.default});yr(co);var Jo=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=_;var r=o(kn),i=o(co);function o(b){return b&&b.__esModule?b:{default:b}}function c(b){var T=-1,A=b.length;return function(){return++T<A?{value:b[T],key:T}:null}}function d(b){var T=-1;return function(){var O=b.next();return O.done?null:(T++,{value:O.value,key:T})}}function y(b){var T=b?Object.keys(b):[],A=-1,O=T.length;return function(){var W=T[++A];return A<O?{value:b[W],key:W}:null}}function _(b){if((0,r.default)(b))return c(b);var T=(0,i.default)(b);return T?d(T):y(b)}e.exports=n.default});yr(Jo);var Lo=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=r;function r(i){return function(){for(var o=[],c=arguments.length;c--;)o[c]=arguments[c];if(i===null)throw new Error("Callback was already called.");var d=i;i=null,d.apply(this,o)}}e.exports=n.default});yr(Lo);var ru=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r={};n.default=r,e.exports=n.default});yr(ru);var qu=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=o;var r=i(ru);function i(c){return c&&c.__esModule?c:{default:c}}function o(c,d,y,_){var b=!1,T=!1,A=!1,O=0,F=0;function W(){O>=d||A||b||(A=!0,c.next().then(function(Oe){var rt=Oe.value,lt=Oe.done;if(!(T||b)){if(A=!1,lt){b=!0,O<=0&&_(null);return}O++,y(rt,F,Q),F++,W()}}).catch(ue))}function Q(Oe,rt){if(O-=1,!T){if(Oe)return ue(Oe);if(Oe===!1){b=!0,T=!0;return}if(rt===r.default||b&&O<=0)return b=!0,_(null);W()}}function ue(Oe){T||(A=!1,b=!0,_(Oe))}W()}e.exports=n.default});yr(qu);var nu=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=y(Ts),i=y(Jo),o=y(Lo),c=y(qu),d=y(ru);function y(_){return _&&_.__esModule?_:{default:_}}n.default=function(_){return function(b,T,A){if(A=(0,r.default)(A),_<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!b)return A(null);if((0,Gi.isAsyncGenerator)(b))return(0,c.default)(b,_,T,A);if((0,Gi.isAsyncIterable)(b))return(0,c.default)(b[Symbol.asyncIterator](),_,T,A);var O=(0,i.default)(b),F=!1,W=!1,Q=0,ue=!1;function Oe(lt,At){if(!W)if(Q-=1,lt)F=!0,A(lt);else if(lt===!1)F=!0,W=!0;else{if(At===d.default||F&&Q<=0)return F=!0,A(null);ue||rt()}}function rt(){for(ue=!0;Q<_&&!F;){var lt=O();if(lt===null){F=!0,Q<=0&&A(null);return}Q+=1,T(lt.value,lt.key,(0,o.default)(Oe))}ue=!1}rt()}},e.exports=n.default});yr(nu);var iu=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=c(nu),i=c(Gi),o=c(Fa);function c(y){return y&&y.__esModule?y:{default:y}}function d(y,_,b,T){return(0,r.default)(_)(y,(0,i.default)(b),T)}n.default=(0,o.default)(d,4),e.exports=n.default});yr(iu);var Sl=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=o(iu),i=o(Fa);function o(d){return d&&d.__esModule?d:{default:d}}function c(d,y,_){return(0,r.default)(d,1,y,_)}n.default=(0,i.default)(c,3),e.exports=n.default});yr(Sl);var Bs=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=c;var r=o(no),i=o(Sl);function o(d){return d&&d.__esModule?d:{default:d}}function c(d,y){return(0,r.default)(i.default,d,y)}e.exports=n.default}),Ku=yr(Bs),Ba=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return this.args=r,Ku(this.tasks)},e.prototype.tap=function(n,r){var i=this;this.tasks.push(function(o){r.apply(void 0,pi(i.args)),o(null,n)})},e}(),na=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=b(kn),i=b(ru),o=b(iu),c=b(Ts),d=b(Lo),y=b(Gi),_=b(Fa);function b(F){return F&&F.__esModule?F:{default:F}}function T(F,W,Q){Q=(0,c.default)(Q);var ue=0,Oe=0,rt=F.length,lt=!1;rt===0&&Q(null);function At(Ot,Ut){Ot===!1&&(lt=!0),lt!==!0&&(Ot?Q(Ot):(++Oe===rt||Ut===i.default)&&Q(null))}for(;ue<rt;ue++)W(F[ue],ue,(0,d.default)(At))}function A(F,W,Q){return(0,o.default)(F,Infinity,W,Q)}function O(F,W,Q){var ue=(0,r.default)(F)?T:A;return ue(F,(0,y.default)(W),Q)}n.default=(0,_.default)(O,3),e.exports=n.default});yr(na);var au=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0}),n.default=c;var r=o(na),i=o(no);function o(d){return d&&d.__esModule?d:{default:d}}function c(d,y){return(0,i.default)(r.default,d,y)}e.exports=n.default}),Ns=yr(au),Uo=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.promise=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return Ns(this.tasks)},e.prototype.tapPromise=function(n,r){var i=this;this.tasks.push(function(o){return tn(i,void 0,void 0,function(){return pn(this,function(c){switch(c.label){case 0:return[4,r()];case 1:return c.sent(),o(null,n),[2]}})})})},e}(),di=$r(function(e,n){Object.defineProperty(n,"__esModule",{value:!0});var r=d(Ts),i=d(Lo),o=d(Gi),c=d(Fa);function d(_){return _&&_.__esModule?_:{default:_}}function y(_,b){if(b=(0,r.default)(b),!Array.isArray(_))return b(new Error("First argument to waterfall must be an array of functions"));if(!_.length)return b();var T=0;function A(F){var W=(0,o.default)(_[T++]);W.apply(void 0,F.concat([(0,i.default)(O)]))}function O(F){for(var W=[],Q=arguments.length-1;Q-- >0;)W[Q]=arguments[Q+1];if(F!==!1){if(F||T===_.length)return b.apply(void 0,[F].concat(W));A(W)}}A([])}n.default=(0,c.default)(y),e.exports=n.default}),io=yr(di),ao=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return io(this.tasks)},e.prototype.tap=function(n,r){this.tasks.length===0?this.tasks.push(function(i){var o=r();i(o?null:!1,o)}):this.tasks.push(function(i,o){var c=r();o(c?null:!1,n)})},e}(),ps=function(){function e(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];this.tasks=[]}return e.prototype.call=function(){for(var n=arguments,r=[],i=0;i<arguments.length;i++)r[i]=n[i];return Ku(this.tasks)},e.prototype.tap=function(n,r){this.tasks.push(function(i){var o=r();i(o,n)})},e}(),$u=G(67709),ou=G.n($u),ql=window.document.documentElement.style,Ju=0;function bc(e){var n=e;if(typeof e=="string"&&(n=document.getElementById(e)),n){var r=document.createElement("div");return r.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,r.id="l7-scene-".concat(Ju++),r.classList.add("l7-scene"),n.appendChild(r),r}return null}var zs,El,$c,Zs,qa,ih,vp,mp,yp,gp,ah,Cl,oh,Tf,_p,Qu,Jc,jo,sh,uh,lh,ch,fh,ph,tp,hh,Tl,Af,ia,Kl,Mf,$l,Jl;function Ql(e){var n=rp();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function rp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Pf=(zs=(0,ie.b2)(),El=(0,ie.f3)(J.SceneID),$c=(0,ie.f3)(J.IIconService),Zs=(0,ie.f3)(J.IFontService),qa=(0,ie.f3)(J.IControlService),ih=(0,ie.f3)(J.IGlobalConfigService),vp=(0,ie.f3)(J.IMapService),mp=(0,ie.f3)(J.ICoordinateSystemService),yp=(0,ie.f3)(J.IRendererService),gp=(0,ie.f3)(J.ILayerService),ah=(0,ie.f3)(J.ICameraService),Cl=(0,ie.f3)(J.IInteractionService),oh=(0,ie.f3)(J.IPickingService),Tf=(0,ie.f3)(J.IShaderModuleService),_p=(0,ie.f3)(J.IMarkerService),Qu=(0,ie.f3)(J.IPopupService),zs(Jc=(jo=function(e){(0,Je.Z)(r,e);var n=Ql(r);function r(){var i;return(0,be.Z)(this,r),i=n.call(this),(0,M.Z)((0,H.Z)(i),"destroyed",!1),(0,M.Z)((0,H.Z)(i),"loaded",!1),(0,M.Z)((0,H.Z)(i),"loadFont",!1),(0,M.Z)((0,H.Z)(i),"fontFamily",""),Tn((0,H.Z)(i),"id",sh,(0,H.Z)(i)),Tn((0,H.Z)(i),"iconService",uh,(0,H.Z)(i)),Tn((0,H.Z)(i),"fontService",lh,(0,H.Z)(i)),Tn((0,H.Z)(i),"controlService",ch,(0,H.Z)(i)),Tn((0,H.Z)(i),"configService",fh,(0,H.Z)(i)),Tn((0,H.Z)(i),"map",ph,(0,H.Z)(i)),Tn((0,H.Z)(i),"coordinateSystemService",tp,(0,H.Z)(i)),Tn((0,H.Z)(i),"rendererService",hh,(0,H.Z)(i)),Tn((0,H.Z)(i),"layerService",Tl,(0,H.Z)(i)),Tn((0,H.Z)(i),"cameraService",Af,(0,H.Z)(i)),Tn((0,H.Z)(i),"interactionService",ia,(0,H.Z)(i)),Tn((0,H.Z)(i),"pickingService",Kl,(0,H.Z)(i)),Tn((0,H.Z)(i),"shaderModuleService",Mf,(0,H.Z)(i)),Tn((0,H.Z)(i),"markerService",$l,(0,H.Z)(i)),Tn((0,H.Z)(i),"popupService",Jl,(0,H.Z)(i)),(0,M.Z)((0,H.Z)(i),"inited",!1),(0,M.Z)((0,H.Z)(i),"initPromise",void 0),(0,M.Z)((0,H.Z)(i),"rendering",!1),(0,M.Z)((0,H.Z)(i),"$container",void 0),(0,M.Z)((0,H.Z)(i),"canvas",void 0),(0,M.Z)((0,H.Z)(i),"markerContainer",void 0),(0,M.Z)((0,H.Z)(i),"hooks",void 0),(0,M.Z)((0,H.Z)(i),"handleWindowResized",function(){i.emit("resize"),i.$container&&(i.initContainer(),Ve(),i.coordinateSystemService.needRefresh=!0,i.render())}),(0,M.Z)((0,H.Z)(i),"handleMapCameraChanged",function(o){i.cameraService.update(o),i.render()}),i.hooks={init:new Uo},i}return(0,Pe.Z)(r,[{key:"init",value:function(o){var c=this;this.configService.setSceneConfig(this.id,o),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Zo.Z)(ga().mark(function d(){return ga().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,new Promise(function(b){c.map.onCameraChanged(function(T){c.cameraService.init(),c.cameraService.update(T),c.map.version!=="GAODE2.x"&&b()}),c.map.version!=="GAODE2.x"?c.map.init():b()});case 2:if(!(c.map.version==="GAODE2.x"&&c.map.initViewPort)){_.next=6;break}return _.next=5,c.map.init();case 5:c.map.initViewPort();case 6:c.map.onCameraChanged(c.handleMapCameraChanged),c.map.addMarkerContainer(),c.markerService.addMarkers(),c.markerService.addMarkerLayers(),c.popupService.initPopup(),c.interactionService.init(),c.interactionService.on(ta.Drag,c.addSceneEvent.bind(c));case 13:case"end":return _.stop()}},d)}))),this.hooks.init.tapPromise("initRenderer",(0,Zo.Z)(ga().mark(function d(){var y;return ga().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(y=bc(c.configService.getSceneConfig(c.id).id||""),c.$container=y,!y){b.next=11;break}return c.canvas=Bt("canvas","",y),c.setCanvas(),b.next=7,c.rendererService.init(c.canvas,c.configService.getSceneConfig(c.id));case 7:ou()(c.$container,c.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(c.handleWindowResized),b.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:c.pickingService.init(c.id);case 13:case"end":return b.stop()}},d)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(o){this.layerService.add(o),this.render()}},{key:"render",value:function(){var i=(0,Zo.Z)(ga().mark(function c(){return ga().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(!(this.rendering||this.destroyed)){y.next=2;break}return y.abrupt("return");case 2:if(this.rendering=!0,this.inited){y.next=15;break}return y.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){y.next=10;break}return y.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.renderLayers(),this.rendering=!1;case 17:case"end":return y.stop()}},c,this)}));function o(){return i.apply(this,arguments)}return o}()},{key:"addFontFace",value:function(o,c){this.fontFamily=o;var d=document.createElement("style");d.type="text/css",d.innerText=`
        @font-face{
            font-family: '`.concat(o,`';
            src: url('`).concat(c,`') format('woff2'),
            url('`).concat(c,`') format('woff'),
            url('`).concat(c,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(d),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(o){var c,d=(c=this.$container)===null||c===void 0?void 0:c.getElementsByTagName("canvas")[0];this.render();var y=o==="jpg"?d==null?void 0:d.toDataURL("image/jpeg"):d==null?void 0:d.toDataURL("image/png");return y}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var o=this.$container.parentElement;o!==null&&(this.markerContainer=Bt("div","l7-marker-container",o))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.removeAllListeners(),this.inited=!1,(0,$u.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var o,c,d=Ke,y=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,_=((c=this.$container)===null||c===void 0?void 0:c.clientHeight)||300,b=this.canvas;b&&(b.width=y*d,b.height=_*d,b.style.width="".concat(y,"px"),b.style.height="".concat(_,"px")),this.rendererService.viewport({x:0,y:0,width:d*y,height:d*_})}},{key:"setCanvas",value:function(){var o,c,d=Ke,y=((o=this.$container)===null||o===void 0?void 0:o.clientWidth)||400,_=((c=this.$container)===null||c===void 0?void 0:c.clientHeight)||300,b=this.canvas;b.width=y*d,b.height=_*d,b.style.width="".concat(y,"px"),b.style.height="".concat(_,"px")}},{key:"addSceneEvent",value:function(o){this.emit(o.type,o)}}]),r}(oe.EventEmitter),sh=Kr(jo.prototype,"id",[El],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uh=Kr(jo.prototype,"iconService",[$c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lh=Kr(jo.prototype,"fontService",[Zs],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ch=Kr(jo.prototype,"controlService",[qa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fh=Kr(jo.prototype,"configService",[ih],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ph=Kr(jo.prototype,"map",[vp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tp=Kr(jo.prototype,"coordinateSystemService",[mp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hh=Kr(jo.prototype,"rendererService",[yp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tl=Kr(jo.prototype,"layerService",[gp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Af=Kr(jo.prototype,"cameraService",[ah],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ia=Kr(jo.prototype,"interactionService",[Cl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kl=Kr(jo.prototype,"pickingService",[oh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mf=Kr(jo.prototype,"shaderModuleService",[Tf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),$l=Kr(jo.prototype,"markerService",[_p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Jl=Kr(jo.prototype,"popupService",[Qu],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jo))||Jc),ec=G(44908),wc=G.n(ec);function Sc(e){var n=0;switch(e){case"vec2":case"ivec2":n=2;break;case"vec3":case"ivec3":n=3;break;case"vec4":case"ivec4":case"mat2":n=4;break;case"mat3":n=9;break;case"mat4":n=16;break;default:}return n}var If=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function el(e){var n={};return e=e.replace(If,function(r,i,o){var c=o.split(":"),d=c[0].trim(),y="";switch(c.length>1&&(y=c[1].trim()),i){case"bool":y=y==="true";break;case"float":case"int":y=Number(y);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":y?y=y.replace("[","").replace("]","").split(",").reduce(function(_,b){return _.push(Number(b.trim())),_},[]):y=new Array(Sc(i)).fill(0);break;default:}return n[d]=y,"uniform ".concat(i," ").concat(d,`;
`)}),{content:e,uniforms:n}}var Qc,tc;function xp(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Pu(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?xp(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):xp(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var tl="#define PI 3.14159265359",su=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,bp=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Yh=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,qh=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,Kh=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Al=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,Ec=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,dh=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,vh=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,mh=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,wp=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,$h=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,rl=/precision\s+(high|low|medium)p\s+float/,Cc=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,ef=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,nl=(Qc=(0,ie.b2)(),Qc(tc=function(){function e(){(0,be.Z)(this,e),(0,M.Z)(this,"moduleCache",{}),(0,M.Z)(this,"rawContentCache",{})}return(0,Pe.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:tl,fs:tl}),this.registerModule("decode",{vs:su,fs:""}),this.registerModule("projection",{vs:Ec,fs:""}),this.registerModule("project",{vs:Al,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:dh}),this.registerModule("lighting",{vs:Yh,fs:""}),this.registerModule("light",{vs:bp,fs:""}),this.registerModule("picking",{vs:Kh,fs:qh}),this.registerModule("styleMapping",{vs:vh,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:mh,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:wp,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:$h,fs:""})}},{key:"registerModule",value:function(r,i){if(!this.rawContentCache[r]){var o=i.vs,c=i.fs,d=i.uniforms,y=el(o),_=y.content,b=y.uniforms,T=el(c),A=T.content,O=T.uniforms;this.rawContentCache[r]={fs:A,uniforms:Pu(Pu(Pu({},b),O),d),vs:_}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(r){var i=this;if(this.moduleCache[r])return this.moduleCache[r];var o=this.rawContentCache[r].vs,c=this.rawContentCache[r].fs,d=this.processModule(o,[],"vs"),y=d.content,_=d.includeList,b=this.processModule(c,[],"fs"),T=b.content,A=b.includeList,O=T,F=wc()(_.concat(A).concat(r)).reduce(function(W,Q){return Pu(Pu({},W),i.rawContentCache[Q].uniforms)},{});return rl.test(T)||(O=Cc+T),this.moduleCache[r]={fs:O.trim(),uniforms:F,vs:y.trim()},this.moduleCache[r]}},{key:"processModule",value:function(r,i,o){var c=this,d=r.replace(ef,function(y,_){var b=_.split(" "),T=b[0].replace(/"/g,"");if(i.indexOf(T)>-1)return"";var A=c.rawContentCache[T][o];i.push(T);var O=c.processModule(A,i,o),F=O.content;return F});return{content:d,includeList:i}}}]),e}())||tc),Ml=G(66213),fo;(function(e){e.Normal="normal",e.PostProcessing="post-processing"})(fo||(fo={}));var Of,Sp,Qo,As,Pa,Vo=(Of=(0,ie.b2)(),Sp=(0,ie.f3)(J.IShaderModuleService),Of(Qo=(As=function(){function e(){(0,be.Z)(this,e),Tn(this,"shaderModuleService",Pa,this),(0,M.Z)(this,"rendererService",void 0),(0,M.Z)(this,"cameraService",void 0),(0,M.Z)(this,"mapService",void 0),(0,M.Z)(this,"interactionService",void 0),(0,M.Z)(this,"layerService",void 0),(0,M.Z)(this,"config",void 0)}return(0,Pe.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return fo.Normal}},{key:"init",value:function(r,i){this.config=i,this.rendererService=r.getContainer().get(J.IRendererService),this.cameraService=r.getContainer().get(J.ICameraService),this.mapService=r.getContainer().get(J.IMapService),this.interactionService=r.getContainer().get(J.IInteractionService),this.layerService=r.getContainer().get(J.ILayerService)}},{key:"render",value:function(r){}}]),e}(),Pa=Kr(As.prototype,"shaderModuleService",[Sp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),As))||Qo),Ep,yh;function Jh(e){var n=gh();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function gh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Go=(Ep=(0,ie.b2)(),Ep(yh=function(e){(0,Je.Z)(r,e);var n=Jh(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(o,c){(0,Ml.Z)((0,_t.Z)(r.prototype),"init",this).call(this,o,c)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),r}(Vo))||yh),Cp,Tp,Ap,Mp,Pp;function Qh(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=_h(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function _h(e,n){if(!!e){if(typeof e=="string")return Ip(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ip(e,n)}}function Ip(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Op=(Cp=(0,ie.b2)(),Tp=(0,ie.f3)(J.IPostProcessor),Cp(Ap=(Mp=function(){function e(){(0,be.Z)(this,e),(0,M.Z)(this,"passes",[]),Tn(this,"postProcessor",Pp,this),(0,M.Z)(this,"layer",void 0),(0,M.Z)(this,"renderFlag",void 0),(0,M.Z)(this,"width",0),(0,M.Z)(this,"height",0)}return(0,Pe.Z)(e,[{key:"setLayer",value:function(r){this.layer=r}},{key:"setRenderFlag",value:function(r){this.renderFlag=r}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var n=(0,Zo.Z)(ga().mark(function i(){var o,c,d;return ga().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:o=Qh(this.passes),_.prev=1,o.s();case 3:if((c=o.n()).done){_.next=9;break}return d=c.value,_.next=7,d.render(this.layer);case 7:_.next=3;break;case 9:_.next=14;break;case 11:_.prev=11,_.t0=_.catch(1),o.e(_.t0);case 14:return _.prev=14,o.f(),_.finish(14);case 17:this.layer.renderModels();case 18:case"end":return _.stop()}},i,this,[[1,11,14,17]])}));function r(){return n.apply(this,arguments)}return r}()},{key:"resize",value:function(r,i){(this.width!==r||this.height!==i)&&(this.width=r,this.height=i)}},{key:"add",value:function(r,i){r.getType()===fo.PostProcessing?this.postProcessor.add(r,this.layer,i):(r.init(this.layer,i),this.passes.push(r))}},{key:"insert",value:function(r,i,o){r.init(this.layer,i),this.passes.splice(o,0,r)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),Pp=Kr(Mp.prototype,"postProcessor",[Tp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mp))||Ap),xh,bh;function Tc(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function kp(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Tc(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tc(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function L(e){var n=ae();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function ae(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ge=(xh=(0,ie.b2)(),xh(bh=function(e){(0,Je.Z)(r,e);var n=L(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"pickingFBO",void 0),(0,M.Z)((0,H.Z)(i),"layer",void 0),(0,M.Z)((0,H.Z)(i),"width",0),(0,M.Z)((0,H.Z)(i),"height",0),(0,M.Z)((0,H.Z)(i),"alreadyInRendering",!1),(0,M.Z)((0,H.Z)(i),"pickFromPickingFBO",function(y){var _=y.x,b=y.y,T=y.lngLat,A=y.type;if(!(!i.layer.isVisible()||!i.layer.needPick(A))){var O=i.rendererService,F=O.getViewportSize,W=O.readPixels,Q=O.useFramebuffer,ue=F(),Oe=ue.width,rt=ue.height,lt=i.layer.getLayerConfig(),At=lt.enableHighlight,Ot=lt.enableSelect,Ut=_*Ke,Gt=b*Ke;if(!(Ut>Oe||Ut<0||Gt>rt||Gt<0)){var gr;Q(i.pickingFBO,function(){var Nr;if(gr=W({x:Math.round(Ut),y:Math.round(rt-(b+1)*Ke),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:i.pickingFBO}),gr[0]!==0||gr[1]!==0||gr[2]!==0){var Xr=Vn(gr),Er=i.layer.getSource().getFeatureById(Xr),on={x:_,y:b,type:A,lngLat:T,featureId:Xr,feature:Er};Er&&(i.layer.setCurrentPickId(Xr),i.triggerHoverOnLayer(on))}else{var Ln={x:_,y:b,lngLat:T,type:i.layer.getCurrentPickId()===null?"un"+A:"mouseout",featureId:null,feature:null};i.triggerHoverOnLayer(kp(kp({},Ln),{},{type:"unpick"})),i.triggerHoverOnLayer(Ln),i.layer.setCurrentPickId(null)}At&&i.highlightPickedFeature(gr),Ot&&A==="click"&&((Nr=gr)===null||Nr===void 0?void 0:Nr.toString())!==[0,0,0,0].toString()&&i.selectFeature(gr)})}}}),i}return(0,Pe.Z)(r,[{key:"getType",value:function(){return fo.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(o,c){(0,Ml.Z)((0,_t.Z)(r.prototype),"init",this).call(this,o,c),this.layer=o;var d=this.rendererService,y=d.createTexture2D,_=d.createFramebuffer,b=d.getViewportSize,T=b(),A=T.width,O=T.height;this.pickingFBO=_({color:y({width:A,height:O,wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE})}),this.interactionService.on(ta.Hover,this.pickFromPickingFBO),this.interactionService.on(ta.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(ta.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(o){var c=this;if(!this.alreadyInRendering){var d=this.rendererService,y=d.getViewportSize,_=d.useFramebuffer,b=d.clear,T=y(),A=T.width,O=T.height;this.alreadyInRendering=!0,(this.width!==A||this.height!==O)&&(this.pickingFBO.resize({width:A,height:O}),this.width=A,this.height=O),_(this.pickingFBO,function(){b({framebuffer:c.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var F=c.layer.multiPassRenderer.getRenderFlag();c.layer.multiPassRenderer.setRenderFlag(!1),o.hooks.beforePickingEncode.call(),o.render(),o.hooks.afterPickingEncode.call(),c.layer.multiPassRenderer.setRenderFlag(F),c.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(o){this.layer.emit(o.type,o)}},{key:"highlightPickedFeature",value:function(o){var c=(0,Ft.Z)(o,3),d=c[0],y=c[1],_=c[2];this.layer.hooks.beforeHighlight.call([d,y,_]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(o){var c=(0,Ft.Z)(o,3),d=c[0],y=c[1],_=c[2];this.layer.hooks.beforeSelect.call([d,y,_]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(o){var c=o.featureId,d=Sa(c);this.selectFeature(new Uint8Array(d))}},{key:"highlightFeatureHandle",value:function(o){var c=o.featureId,d=Sa(c);this.highlightPickedFeature(new Uint8Array(d))}}]),r}(Vo))||bh),gt=G(11700),Zt=G.n(gt),ht=G(68929),Pt=G.n(ht),rr,ar,fr,ir,vr;function Tr(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function er(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Tr(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tr(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var br=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,et=(rr=(0,ie.b2)(),ar=(0,ie.f3)(J.IShaderModuleService),rr(fr=(ir=function(){function e(){(0,be.Z)(this,e),Tn(this,"shaderModuleService",vr,this),(0,M.Z)(this,"rendererService",void 0),(0,M.Z)(this,"config",void 0),(0,M.Z)(this,"quad",br),(0,M.Z)(this,"enabled",!0),(0,M.Z)(this,"renderToScreen",!1),(0,M.Z)(this,"model",void 0),(0,M.Z)(this,"name",void 0),(0,M.Z)(this,"optionsToUpdate",{})}return(0,Pe.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(r){this.name=r}},{key:"getType",value:function(){return fo.PostProcessing}},{key:"init",value:function(r,i){this.config=i,this.rendererService=r.getContainer().get(J.IRendererService);var o=this.rendererService,c=o.createAttribute,d=o.createBuffer,y=o.createModel,_=this.setupShaders(),b=_.vs,T=_.fs,A=_.uniforms;this.model=y({vs:b,fs:T,attributes:{a_Position:c({buffer:d({data:[-4,-4,4,-4,0,4],type:re.FLOAT}),size:2})},uniforms:er(er({u_Texture:null},A),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(r){var i=this,o=r.multiPassRenderer.getPostProcessor(),c=this.rendererService,d=c.useFramebuffer,y=c.getViewportSize,_=c.clear,b=y(),T=b.width,A=b.height;d(this.renderToScreen?null:o.getWriteFBO(),function(){_({framebuffer:o.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),i.model.draw({uniforms:er({u_Texture:o.getReadFBO(),u_ViewportSize:[T,A]},i.convertOptionsToUniforms(i.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(r){this.enabled=r}},{key:"setRenderToScreen",value:function(r){this.renderToScreen=r}},{key:"updateOptions",value:function(r){this.optionsToUpdate=er(er({},this.optionsToUpdate),r)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(r){var i={};return Object.keys(r).forEach(function(o){ne()(r[o])||(i["u_".concat(Zt()(Pt()(o)))]=r[o])}),i}}]),e}(),vr=Kr(ir.prototype,"shaderModuleService",[ar],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ir))||fr),Tt,nr;function Or(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Wt(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Or(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Or(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Zr(e){var n=Qt();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Qt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Sr=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Xt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,mr=(Tt=(0,ie.b2)(),Tt(nr=function(e){(0,Je.Z)(r,e);var n=Zr(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Xt,fs:Sr});var o=this.shaderModuleService.getModule("blur-pass"),c=o.vs,d=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),b=_.width,T=_.height;return{vs:c,fs:d,uniforms:Wt(Wt({},y),{},{u_ViewportSize:[b,T]})}}},{key:"convertOptionsToUniforms",value:function(o){var c={};return ne()(o.blurRadius)||(c.u_BlurDir=[o.blurRadius,0]),c}}]),r}(et))||nr),an,hn;function wr(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Kt(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?wr(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wr(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Vt(e){var n=bn();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function bn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var yn=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,qr=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qn=(an=(0,ie.b2)(),an(hn=function(e){(0,Je.Z)(r,e);var n=Vt(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:qr,fs:yn});var o=this.shaderModuleService.getModule("blur-pass"),c=o.vs,d=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),b=_.width,T=_.height;return{vs:c,fs:d,uniforms:Kt(Kt({},y),{},{u_ViewportSize:[b,T]})}}},{key:"convertOptionsToUniforms",value:function(o){var c={};return ne()(o.blurRadius)||(c.u_BlurDir=[0,o.blurRadius]),c}}]),r}(et))||hn),Dn,Yn;function yi(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function xa(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?yi(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yi(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function po(e){var n=ai();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function ai(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ha=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Hi=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Na=(Dn=(0,ie.b2)(),Dn(Yn=function(e){(0,Je.Z)(r,e);var n=po(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Hi,fs:ha});var o=this.shaderModuleService.getModule("colorhalftone-pass"),c=o.vs,d=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),b=_.width,T=_.height;return{vs:c,fs:d,uniforms:xa(xa({},y),{},{u_ViewportSize:[b,T]})}}}]),r}(et))||Yn),za,Ka;function ho(e){var n=So();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function So(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ia=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Gn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ro=(za=(0,ie.b2)(),za(Ka=function(e){(0,Je.Z)(r,e);var n=ho(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:Gn,fs:Ia}),this.shaderModuleService.getModule("copy-pass")}}]),r}(et))||Ka),Ei,mn;function ei(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function li(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ei(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ei(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Oa(e){var n=Us();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Us(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var il=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,xe=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,yt=(Ei=(0,ie.b2)(),Ei(mn=function(e){(0,Je.Z)(r,e);var n=Oa(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:xe,fs:il});var o=this.shaderModuleService.getModule("hexagonalpixelate-pass"),c=o.vs,d=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),b=_.width,T=_.height;return{vs:c,fs:d,uniforms:li(li({},y),{},{u_ViewportSize:[b,T]})}}}]),r}(et))||mn),ct,jr;function ti(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function pe(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?ti(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ti(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function $(e){var n=Be();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Be(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qe=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,tt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ue=(ct=(0,ie.b2)(),ct(jr=function(e){(0,Je.Z)(r,e);var n=$(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:tt,fs:Qe});var o=this.shaderModuleService.getModule("ink-pass"),c=o.vs,d=o.fs,y=o.uniforms,_=this.rendererService.getViewportSize(),b=_.width,T=_.height;return{vs:c,fs:d,uniforms:pe(pe({},y),{},{u_ViewportSize:[b,T]})}}}]),r}(et))||jr),Ne,Xe;function de(e){var n=Re();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Re(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ce=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,$e=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,it=(Ne=(0,ie.b2)(),Ne(Xe=function(e){(0,Je.Z)(r,e);var n=de(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:$e,fs:ce}),this.shaderModuleService.getModule("noise-pass")}}]),r}(et))||Xe),zt,mt;function Rt(e){var n=sr();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function sr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var en=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,qn=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,Jr=(zt=(0,ie.b2)(),zt(mt=function(e){(0,Je.Z)(r,e);var n=Rt(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:en,fs:qn}),this.shaderModuleService.getModule("sepia-pass")}}]),r}(et))||mt),xn,Bn,xi,ba,vo,kf,js=(xn=(0,ie.b2)(),Bn=(0,ie.f3)(J.IRendererService),xi=(0,ie.zY)(),xn(ba=(vo=function(){function e(){(0,be.Z)(this,e),Tn(this,"rendererService",kf,this),(0,M.Z)(this,"passes",[]),(0,M.Z)(this,"readFBO",void 0),(0,M.Z)(this,"writeFBO",void 0)}return(0,Pe.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var n=(0,Zo.Z)(ga().mark(function i(o){var c,d;return ga().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:c=0;case 1:if(!(c<this.passes.length)){_.next=10;break}return d=this.passes[c],d.setRenderToScreen(this.isLastEnabledPass(c)),_.next=6,d.render(o);case 6:c!==this.passes.length-1&&this.swap();case 7:c++,_.next=1;break;case 10:case"end":return _.stop()}},i,this)}));function r(i){return n.apply(this,arguments)}return r}()},{key:"resize",value:function(r,i){this.readFBO.resize({width:r,height:i}),this.writeFBO.resize({width:r,height:i})}},{key:"add",value:function(r,i,o){r.init(i,o),this.passes.push(r)}},{key:"insert",value:function(r,i,o,c){r.init(o,c),this.passes.splice(i,0,r)}},{key:"getPostProcessingPassByName",value:function(r){return this.passes.find(function(i){return i.getName()===r})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(r){for(var i=r+1;i<this.passes.length;i++)if(this.passes[i].isEnabled())return!1;return!0}},{key:"swap",value:function(){var r=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=r}}]),e}(),kf=Kr(vo.prototype,"rendererService",[Bn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Kr(vo.prototype,"init",[xi],Object.getOwnPropertyDescriptor(vo.prototype,"init"),vo.prototype),vo))||ba),np,Vs;function Lf(e){var n=Rf();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Rf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ed=(np=(0,ie.b2)(),np(Vs=function(e){(0,Je.Z)(r,e);var n=Lf(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"getType",value:function(){return fo.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(o,c){(0,Ml.Z)((0,_t.Z)(r.prototype),"init",this).call(this,o,c)}},{key:"render",value:function(o){var c=this.rendererService,d=c.useFramebuffer,y=c.clear;d(null,function(){y({color:[0,0,0,0],depth:1,stencil:0}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)})}}]),r}(Vo))||Vs),Df,td,$a,Xi,rd;function nd(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function id(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?nd(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):nd(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Bd(e){var n=Nd();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Nd(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ad=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,tf=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,Ff=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function od(e,n){for(var r=0,i=1/n,o=e;o>0;)r=r+i*(o%n),o=Math.floor(o/n),i=i/n;return r}var oo=1,Lp=(Df=(0,ie.b2)(),td=(0,ie.f3)(J.IShaderModuleService),Df($a=(Xi=function(e){(0,Je.Z)(r,e);var n=Bd(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),Tn((0,H.Z)(i),"shaderModuleService",rd,(0,H.Z)(i)),(0,M.Z)((0,H.Z)(i),"haltonSequence",[]),(0,M.Z)((0,H.Z)(i),"accumulatingId",0),(0,M.Z)((0,H.Z)(i),"frame",0),(0,M.Z)((0,H.Z)(i),"timer",void 0),(0,M.Z)((0,H.Z)(i),"sampleRenderTarget",void 0),(0,M.Z)((0,H.Z)(i),"prevRenderTarget",void 0),(0,M.Z)((0,H.Z)(i),"outputRenderTarget",void 0),(0,M.Z)((0,H.Z)(i),"copyRenderTarget",void 0),(0,M.Z)((0,H.Z)(i),"blendModel",void 0),(0,M.Z)((0,H.Z)(i),"outputModel",void 0),(0,M.Z)((0,H.Z)(i),"copyModel",void 0),i}return(0,Pe.Z)(r,[{key:"getType",value:function(){return fo.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(o,c){(0,Ml.Z)((0,_t.Z)(r.prototype),"init",this).call(this,o,c);var d=this.rendererService,y=d.createFramebuffer,_=d.createTexture2D;this.sampleRenderTarget=y({color:_({width:1,height:1,wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE})}),this.prevRenderTarget=y({color:_({width:1,height:1,wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE})}),this.outputRenderTarget=y({color:_({width:1,height:1,wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE})}),this.copyRenderTarget=y({color:_({width:1,height:1,wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE})});for(var b=0;b<30;b++)this.haltonSequence.push([od(b,2),od(b,3)]);this.blendModel=this.createTriangleModel("blend-pass",ad),this.outputModel=this.createTriangleModel("copy-pass",tf,{blend:{enable:!0,func:{srcRGB:re.ONE,dstRGB:re.ONE_MINUS_SRC_ALPHA,srcAlpha:re.ONE,dstAlpha:re.ONE_MINUS_SRC_ALPHA},equation:{rgb:re.FUNC_ADD,alpha:re.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",tf)}},{key:"render",value:function(o){var c=this,d=this.rendererService,y=d.clear,_=d.getViewportSize,b=d.useFramebuffer,T=_(),A=T.width,O=T.height;this.sampleRenderTarget.resize({width:A,height:O}),this.prevRenderTarget.resize({width:A,height:O}),this.outputRenderTarget.resize({width:A,height:O}),this.copyRenderTarget.resize({width:A,height:O}),this.resetFrame(),this.stopAccumulating();var F=o.multiPassRenderer.getPostProcessor().getReadFBO();b(F,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:F}),o.multiPassRenderer.setRenderFlag(!1),o.render(),o.multiPassRenderer.setRenderFlag(!0)});var W=function Q(ue){!c.accumulatingId||ue!==c.accumulatingId||c.isFinished()||(c.doRender(o),requestAnimationFrame(function(){Q(ue)}))};this.accumulatingId=oo++,this.timer=window.setTimeout(function(){W(c.accumulatingId)},50)}},{key:"doRender",value:function(o){var c=this,d=this.rendererService,y=d.clear,_=d.getViewportSize,b=d.useFramebuffer,T=_(),A=T.width,O=T.height,F=o.getLayerConfig(),W=F.jitterScale,Q=W===void 0?1:W,ue=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((ue[0]*2-1)/A*Q,(ue[1]*2-1)/O*Q),o.multiPassRenderer.setRenderFlag(!1),o.hooks.beforeRender.call(),b(this.sampleRenderTarget,function(){y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c.sampleRenderTarget}),o.render()}),o.hooks.afterRender.call(),o.multiPassRenderer.setRenderFlag(!0);var Oe=o.getLayerConfig();b(this.outputRenderTarget,function(){c.blendModel.draw({uniforms:{u_opacity:Oe.opacity||1,u_MixRatio:c.frame===0?1:.9,u_Diffuse1:c.sampleRenderTarget,u_Diffuse2:c.frame===0?o.multiPassRenderer.getPostProcessor().getReadFBO():c.prevRenderTarget}})}),this.frame===0&&y({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(b(this.copyRenderTarget,function(){c.outputModel.draw({uniforms:{u_Texture:c.outputRenderTarget}})}),b(o.multiPassRenderer.getPostProcessor().getReadFBO(),function(){c.copyModel.draw({uniforms:{u_Texture:c.copyRenderTarget}})}),o.multiPassRenderer.getPostProcessor().render(o));var rt=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=rt,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(o,c,d){this.shaderModuleService.registerModule(o,{vs:Ff,fs:c});var y=this.shaderModuleService.getModule(o),_=y.vs,b=y.fs,T=y.uniforms,A=this.rendererService,O=A.createAttribute,F=A.createBuffer,W=A.createModel;return W(id({vs:_,fs:b,attributes:{a_Position:O({buffer:F({data:[-4,-4,4,-4,0,4],type:re.FLOAT}),size:2})},uniforms:id({},T),depth:{enable:!1},count:3},d))}}]),r}(Vo),rd=Kr(Xi.prototype,"shaderModuleService",[td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xi))||$a),uu=new ie.W2;uu.bind(J.IGlobalConfigService).to(Qf).inSingletonScope(),uu.bind(J.IShaderModuleService).to(nl).inSingletonScope(),(0,ie.GW)((0,ie.b2)(),oe.EventEmitter),uu.bind(J.IEventEmitter).to(oe.EventEmitter);var Rp=(0,fe.Z)(uu,!1),rf=function(n){var r=Rp.lazyInject(n);return function(i,o,c){r.call(this,i,o),c&&(c.initializer=function(){return i[o]})}},zd=function(n){var r=Rp.lazyMultiInject(n);return function(i,o,c){r.call(this,i,o),c&&(c.initializer=function(){return i[o]})}},es=uu,Ac=0;function Zd(){var e=new ie.W2;return e.parent=uu,e.bind(J.SceneID).toConstantValue("".concat(Ac++)),e.bind(J.ILayerService).to(R).inSingletonScope(),e.bind(J.ISceneService).to(Pf).inSingletonScope(),e.bind(J.ICameraService).to(hl).inSingletonScope(),e.bind(J.ICoordinateSystemService).to(wo).inSingletonScope(),e.bind(J.IInteractionService).to(zo).inSingletonScope(),e.bind(J.IPickingService).to(Kc).inSingletonScope(),e.bind(J.IControlService).to(mf).inSingletonScope(),e.bind(J.IMarkerService).to(Ul).inSingletonScope(),e.bind(J.IIconService).to(Fc).inSingletonScope(),e.bind(J.IFontService).to(Fl).inSingletonScope(),e.bind(J.IPopupService).to(Vl).inSingletonScope(),e.bind(J.INormalPass).to(Go).whenTargetNamed("clear"),e.bind(J.INormalPass).to(ge).whenTargetNamed("pixelPicking"),e.bind(J.INormalPass).to(ed).whenTargetNamed("render"),e.bind(J.INormalPass).to(Lp).whenTargetNamed("taa"),e.bind(J.IFactoryNormalPass).toFactory(function(n){return function(r){return n.container.getNamed(J.INormalPass,r)}}),e.bind(J.IPostProcessingPass).to(Ro).whenTargetNamed("copy"),e.bind(J.IPostProcessingPass).to(mr).whenTargetNamed("blurH"),e.bind(J.IPostProcessingPass).to(Qn).whenTargetNamed("blurV"),e.bind(J.IPostProcessingPass).to(it).whenTargetNamed("noise"),e.bind(J.IPostProcessingPass).to(Jr).whenTargetNamed("sepia"),e.bind(J.IPostProcessingPass).to(Na).whenTargetNamed("colorHalftone"),e.bind(J.IPostProcessingPass).to(yt).whenTargetNamed("hexagonalPixelate"),e.bind(J.IPostProcessingPass).to(Ue).whenTargetNamed("ink"),e.bind(J.IFactoryPostProcessingPass).toFactory(function(n){return function(r){var i=n.container.getNamed(J.IPostProcessingPass,r);return i.setName(r),i}}),e}function Ud(e){var n=new ie.W2;return n.parent=e,n.bind(J.IStyleAttributeService).to(pr).inSingletonScope(),n.bind(J.IMultiPassRenderer).to(Op).inSingletonScope(),n.bind(J.IPostProcessor).to(js).inSingletonScope(),n}var Sm=G(74691),Eo=null;function Bf(e){return Eo.indexOf(e)}var jd=2,t=4,a=64,s=128,p=256,m=512,g=8192,w=16384,C=32768,I=null,k=131072,D=262144,B=524288,V=1048576,q=2097152,we=4194304,Ce=8388608,ze=16777216,Le=null;function qe(e,n){return e=_clamp(Math.floor(e),0,255),n=_clamp(Math.floor(n),0,255),256*e+n}function st(e){var n=e.color,r=e.radius,i=e.tileX,o=e.tileY,c=e.shape,d=e.opacity,y=e.stroke,_=e.strokeWidth,b=e.strokeOpacity,T=[],A=[],O=[],F=[qe(n[0],n[1]),qe(n[2],n[3])],W=[qe(y[0],y[1]),qe(y[2],y[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(Q){var ue=_slicedToArray(Q,2),Oe=ue[0],rt=ue[1];T.push([].concat(F,[(Oe+1)*Ce+(rt+1)*q+getShapeIndex(c)*k+r,(i+512)*B+(o+512)*a])),A.push([].concat(W,[_,b])),O.push([d,0,0,0])}),{packedBuffer:T,packedBuffer2:A,packedBuffer3:O}}function St(e,n){if(e===0&&!n)return 0;if(e===1&&n)return 4294967295;var r=n?1:0,i=Math.floor(e*127);return i*Le+r*ze+i*k+r*I+i*m+r*p+i*jd+r}var xt;(function(e){e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none"})(xt||(xt={}));var kt;(function(e){e.LINEAR="linear",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat"})(kt||(kt={}));var or;(function(e){e.CONSTANT="constant",e.VARIABLE="variable"})(or||(or={}));var Nt;(function(e){e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform"})(Nt||(Nt={}));var un=["mapload"],kr={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},cn=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Br;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft"})(Br||(Br={}));function Kn(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function En(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Kn(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Kn(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Qr(e){var n=oi();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function oi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Rn;(function(e){e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft"})(Rn||(Rn={}));var gi=0,fn=function(e){(0,Je.Z)(r,e);var n=Qr(r);function r(i){var o;return(0,be.Z)(this,r),o=n.call(this),(0,M.Z)((0,H.Z)(o),"controlOption",void 0),(0,M.Z)((0,H.Z)(o),"container",void 0),(0,M.Z)((0,H.Z)(o),"sceneContainer",void 0),(0,M.Z)((0,H.Z)(o),"mapsService",void 0),(0,M.Z)((0,H.Z)(o),"renderService",void 0),(0,M.Z)((0,H.Z)(o),"layerService",void 0),(0,M.Z)((0,H.Z)(o),"controlService",void 0),(0,M.Z)((0,H.Z)(o),"isShow",void 0),o.controlOption=En(En({},o.getDefault()),i||{}),o}return(0,Pe.Z)(r,[{key:"getDefault",value:function(){return{position:Rn.TOPRIGHT,name:"".concat(gi++)}}},{key:"setPosition",value:function(){var o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"bottomright",c=this.controlService;return c&&c.removeControl(this),this.controlOption.position=o,c&&c.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(o){this.mapsService=o.get(J.IMapService),this.renderService=o.get(J.IRendererService),this.layerService=o.get(J.ILayerService),this.controlService=o.get(J.IControlService),this.sceneContainer=o,this.isShow=!0,this.container=this.onAdd();var c=this.container,d=this.controlOption.position,y=this.controlService.controlCorners[d];return He(c,"l7-control"),d.indexOf("bottom")!==-1?y.insertBefore(c,y.firstChild):y.appendChild(c),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var o=this.container;He(o,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var o=this.container;ut(o,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;ot(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(o){if(this.mapsService&&o&&o.screenX>0&&o.screenY>0){var c=this.mapsService.getContainer();c!==null&&c.focus()}}}]),r}(oe.EventEmitter);function Ci(e){var n=aa();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function aa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Za=function(e){(0,Je.Z)(r,e);var n=Ci(r);function r(i){var o;return(0,be.Z)(this,r),o=n.call(this,i),(0,M.Z)((0,H.Z)(o),"layerControlInputs",void 0),(0,M.Z)((0,H.Z)(o),"layers",void 0),(0,M.Z)((0,H.Z)(o),"lastZIndex",void 0),(0,M.Z)((0,H.Z)(o),"handlingClick",void 0),(0,M.Z)((0,H.Z)(o),"layersLink",void 0),(0,M.Z)((0,H.Z)(o),"baseLayersList",void 0),(0,M.Z)((0,H.Z)(o),"separator",void 0),(0,M.Z)((0,H.Z)(o),"overlaysList",void 0),(0,M.Z)((0,H.Z)(o),"form",void 0),o.layerControlInputs=[],o.layers=[],o.lastZIndex=0,o.handlingClick=!1,o.initLayers(),ui(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,H.Z)(o)),o}return(0,Pe.Z)(r,[{key:"getDefault",value:function(){return{collapsed:!0,position:Br.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var o=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(c){c.layer.on("remove",o.onLayerChange),c.layer.on("add",o.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(o,c){return this.addLayer(o,c,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var o=this.renderService.getViewportSize(),c=o.height;He(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var d=c-(this.container.offsetTop+50);return d<this.form.clientHeight?(He(this.form,"l7-control-layers-scrollbar"),this.form.style.height=d+"px"):ut(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return ut(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var o=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(c){c.layer.off("remove",o.onLayerChange),c.layer.off("add",o.onLayerChange)}))}},{key:"initLayout",value:function(){var o="l7-control-layers",c=this.container=Bt("div",o),d=this.controlOption.collapsed;c.setAttribute("aria-haspopup","true");var y=this.form=Bt("form",o+"-list");d&&(this.mapsService.on("click",this.collapse),c.addEventListener("mouseenter",this.expand),c.addEventListener("mouseleave",this.collapse)),this.layersLink=Bt("a",o+"-toggle",c);var _=this.layersLink;_.title="Layers",d||this.expand(),this.baseLayersList=Bt("div",o+"-base",y),this.separator=Bt("div",o+"-separator",y),this.overlaysList=Bt("div",o+"-overlays",y),c.appendChild(y)}},{key:"initLayers",value:function(){var o=this,c=this.controlOption,d=c.baseLayers,y=d===void 0?{}:d,_=c.overlayers,b=_===void 0?{}:_;Object.keys(y).forEach(function(T,A){o.addLayer(y[T],T,!1)}),Object.keys(b).forEach(function(T,A){o.addLayer(b[T],T,!0)})}},{key:"update",value:function(){if(!this.container)return this;Ir(this.baseLayersList),Ir(this.overlaysList),this.layerControlInputs=[];var o,c,d,y,_=0;for(d=0;d<this.layers.length;d++)y=this.layers[d],this.addItem(y),c=c||y.overlay,o=o||!y.overlay,_+=y.overlay?0:1;return this.controlOption.hideSingleBase&&(o=o&&_>1,this.baseLayersList.style.display=o?"":"none"),this.separator.style.display=c&&o?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var o=this.layerControlInputs,c,d,y=this.mapsService.getZoom(),_=o.length-1;_>=0;_--)if(c=o[_],d=this.layerService.getLayer(c.layerId),d&&d.inited){var b=d.getMinZoom(),T=d.getMaxZoom();c.disabled=y<b||y>T}}},{key:"addLayer",value:function(o,c,d){this.mapsService&&(o.on("add",this.onLayerChange),o.on("remove",this.onLayerChange)),this.layers.push({layer:o,name:c,overlay:d});var y=this.controlOption,_=y.sortLayers,b=y.sortFunction,T=y.autoZIndex;_&&this.layers.sort(function(A,O){return b(A.layer,O.layer,A.name,O.name)}),T&&o.setZIndex&&(this.lastZIndex++,o.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(o){this.handlingClick||this.update();var c=this.layerService.getLayer(o.target.layerId),d=c!=null&&c.overlay?o.type==="add"?"overlayadd":"overlayremove":o.type==="add"?"baselayerchange":null;d&&this.emit(d,c)}},{key:"createRadioElement",value:function(o,c){var d='<input type="radio" class="l7-control-layers-selector" name="'+o+'"'+(c?' checked="checked"':"")+"/>",y=document.createElement("div");return y.innerHTML=d,y.firstChild}},{key:"addItem",value:function(o){var c=document.createElement("label"),d=this.layerService.getLayer(o.layer.id),y=d&&d.inited&&o.layer.isVisible(),_;o.overlay?(_=document.createElement("input"),_.type="checkbox",_.className="l7-control-layers-selector",_.defaultChecked=y):_=this.createRadioElement("l7-base-layers",y),this.layerControlInputs.push(_),_.layerId=o.layer.id,_.addEventListener("click",this.onInputClick);var b=document.createElement("span");b.innerHTML=" "+o.name;var T=document.createElement("div");c.appendChild(T),T.appendChild(_),T.appendChild(b);var A=o.overlay?this.overlaysList:this.baseLayersList;return A.appendChild(c),this.checkDisabledLayers(),c}},{key:"onInputClick",value:function(){var o=this.layerControlInputs,c,d,y=[],_=[];this.handlingClick=!0;for(var b=o.length-1;b>=0;b--)c=o[b],d=this.layerService.getLayer(c.layerId),c.checked?y.push(d):c.checked||_.push(d);_.forEach(function(T){T.hide()}),y.forEach(function(T){T.show()}),this.handlingClick=!1}}]),r}(fn);function wa(e){var n=oa();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function oa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ka=function(e){(0,Je.Z)(r,e);var n=wa(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"getDefault",value:function(){return{position:Rn.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var o="l7-control-logo",c=Bt("div",o),d=Bt("a","l7-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://antv.alipay.com/l7",d.setAttribute("aria-label","AntV logo"),d.setAttribute("rel","noopener nofollow"),c.appendChild(d),c}},{key:"onRemove",value:function(){return null}}]),r}(fn);function mo(e){var n=yo();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function yo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hs=function(e){(0,Je.Z)(r,e);var n=mo(r);function r(i){var o;return(0,be.Z)(this,r),o=n.call(this,i),(0,M.Z)((0,H.Z)(o),"mScale",void 0),(0,M.Z)((0,H.Z)(o),"iScale",void 0),ui(["update"],(0,H.Z)(o)),o}return(0,Pe.Z)(r,[{key:"getDefault",value:function(){return{position:Rn.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var o="l7-control-scale",c=Bt("div",o);this.addScales(o+"-line",c);var d=this.controlOption.updateWhenIdle;return this.mapsService.on(d?"moveend":"mapmove",this.update),this.mapsService.on(d?"zoomend":"zoomchange",this.update),this.update(),c}},{key:"onRemove",value:function(){var o=this.controlOption.updateWhenIdle;this.mapsService.off(o?"zoomend":"zoomchange",this.update),this.mapsService.off(o?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var o=this.mapsService,c=this.controlOption.maxWidth,d=o.getSize()[1]/2,y=o.containerToLngLat([0,d]),_=o.containerToLngLat([c,d]),b=Dr([y.lng,y.lat],[_.lng,_.lat]);this.updateScales(b)}},{key:"updateScales",value:function(o){var c=this.controlOption,d=c.metric,y=c.imperial;d&&o&&this.updateMetric(o),y&&o&&this.updateImperial(o)}},{key:"updateMetric",value:function(o){var c=this.getRoundNum(o),d=c<1e3?c+" m":c/1e3+" km";this.updateScale(this.mScale,d,c/o)}},{key:"updateImperial",value:function(o){var c=o*3.2808399,d,y,_;c>5280?(d=c/5280,y=this.getRoundNum(d),this.updateScale(this.iScale,y+" mi",y/d)):(_=this.getRoundNum(c),this.updateScale(this.iScale,_+" ft",_/c))}},{key:"updateScale",value:function(o,c,d){var y=this.controlOption.maxWidth;o.style.width=Math.round(y*d)+"px",o.innerHTML=c}},{key:"getRoundNum",value:function(o){var c=Math.pow(10,(Math.floor(o)+"").length-1),d=o/c;return d=d>=10?10:d>=5?5:d>=3?3:d>=2?2:1,c*d}},{key:"addScales",value:function(o,c){var d=this.controlOption,y=d.metric,_=d.imperial;y&&(this.mScale=Bt("div",o,c)),_&&(this.iScale=Bt("div",o,c))}}]),r}(fn);function Co(e){var n=ts();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function ts(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ja=function(e){(0,Je.Z)(r,e);var n=Co(r);function r(i){var o;return(0,be.Z)(this,r),o=n.call(this,i),(0,M.Z)((0,H.Z)(o),"disabled",void 0),(0,M.Z)((0,H.Z)(o),"zoomInButton",void 0),(0,M.Z)((0,H.Z)(o),"zoomOutButton",void 0),ui(["updateDisabled","zoomIn","zoomOut"],(0,H.Z)(o)),o}return(0,Pe.Z)(r,[{key:"getDefault",value:function(){return{position:Rn.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var o="l7-control-zoom",c=Bt("div",o+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,o+"-in",c,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,o+"-out",c,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),c}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(o,c,d,y,_){var b=Bt("a",d,y);return b.innerHTML=o,b.title=c,b.href="javascript:void(0)",b.addEventListener("click",_),b}},{key:"updateDisabled",value:function(){var o=this.mapsService,c="l7-disabled";ut(this.zoomInButton,c),ut(this.zoomOutButton,c),(this.disabled||o.getZoom()<=o.getMinZoom())&&He(this.zoomOutButton,c),(this.disabled||o.getZoom()>=o.getMaxZoom())&&He(this.zoomInButton,c)}}]),r}(fn);function go(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function ci(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?go(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):go(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Zi(e){var n=Fi();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Fi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _i=function(e){(0,Je.Z)(r,e);var n=Zi(r);function r(i){var o;return(0,be.Z)(this,r),o=n.call(this),(0,M.Z)((0,H.Z)(o),"markerOption",void 0),(0,M.Z)((0,H.Z)(o),"defaultMarker",void 0),(0,M.Z)((0,H.Z)(o),"popup",void 0),(0,M.Z)((0,H.Z)(o),"mapsService",void 0),(0,M.Z)((0,H.Z)(o),"sceneSerive",void 0),(0,M.Z)((0,H.Z)(o),"lngLat",void 0),(0,M.Z)((0,H.Z)(o),"scene",void 0),(0,M.Z)((0,H.Z)(o),"added",!1),(0,M.Z)((0,H.Z)(o),"eventHandle",function(c){o.emit(c.type,{target:c,data:o.markerOption.extData,lngLat:o.lngLat})}),o.markerOption=ci(ci({},o.getDefault()),i),ui(["update","onMove","onUp","addDragHandler","onMapClick"],(0,H.Z)(o)),o.init(),o}return(0,Pe.Z)(r,[{key:"getDefault",value:function(){return{element:void 0,anchor:Li.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(o){this.scene=o,this.mapsService=o.get(J.IMapService),this.sceneSerive=o.get(J.ISceneService);var c=this.markerOption,d=c.element,y=c.draggable;return this.mapsService.getMarkerContainer().appendChild(d),this.registerMarkerEvent(d),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var o=this.markerOption.element;return o&&ot(o),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(o){var c=this;if(!this.added)return this.once("added",function(){c.setElement(o)}),this;var d=this.markerOption.element;return d&&ot(d),this.markerOption.element=o,this.init(),this.mapsService.getMarkerContainer().appendChild(o),this.registerMarkerEvent(o),this.update(),this}},{key:"openPopup",value:function(){var o=this;if(!this.added)return this.once("added",function(){o.openPopup()}),this;var c=this.popup;return c?(c.isOpen()||c.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var o=this;this.added||this.once("added",function(){o.closePopup()});var c=this.popup;return c&&c.remove(),this}},{key:"setPopup",value:function(o){return this.popup=o,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var o=this.popup;if(o)o.isOpen()?o.remove():o.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(o){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(o){this.markerOption.extData=o}},{key:"update",value:function(){if(!!this.mapsService){var o=this.markerOption,c=o.element,d=o.anchor;this.updatePosition(),Ee(c,"".concat(Wn[d]))}}},{key:"onMapClick",value:function(o){var c=this.markerOption.element;this.popup&&c&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.markerOption,c=o.element,d=o.offsets,y=this.lngLat,_=y.lng,b=y.lat,T=this.mapsService.getBounds(),A=this.mapsService.lngLatToContainer([_,b]);if(c){c.style.display="block";var O=this.mapsService.getContainer(),F=0,W=0;if(O&&(F=O.scrollWidth,W=O.scrollHeight),Math.abs(T[0][0])>180||Math.abs(T[1][0])>180){if(A.x>F){var Q=this.mapsService.lngLatToContainer([_-360,b]);A.x=Q.x}if(A.x<0){var ue=this.mapsService.lngLatToContainer([_+360,b]);A.x=ue.x}}(A.x>F||A.x<0||A.y>W||A.y<0)&&(c.style.display="none"),c.style.left=A.x+d[0]+"px",c.style.top=A.y-d[1]+"px"}}}},{key:"init",value:function(){var o=this,c=this.markerOption.element,d=this.markerOption,y=d.color,_=d.anchor;if(!c){this.defaultMarker=!0,c=Bt("div"),this.markerOption.element=c;var b=document.createElementNS("http://www.w3.org/2000/svg","svg");b.setAttributeNS(null,"display","block"),b.setAttributeNS(null,"height","48px"),b.setAttributeNS(null,"width","48px"),b.setAttributeNS(null,"viewBox","0 0 1024 1024");var T=document.createElementNS("http://www.w3.org/2000/svg","path");T.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),T.setAttributeNS(null,"fill",y),b.appendChild(T),c.appendChild(b)}He(c,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(A){var O,F,W=((O=o.markerOption)===null||O===void 0?void 0:O.style)&&((F=o.markerOption)===null||F===void 0?void 0:F.style[A]);c&&(c.style[A]=W)}),c.addEventListener("click",function(A){o.onMapClick(A)}),c.addEventListener("click",this.eventHandle),Zn(c,_,"marker")}},{key:"registerMarkerEvent",value:function(o){o.addEventListener("mousemove",this.eventHandle),o.addEventListener("click",this.eventHandle),o.addEventListener("mousedown",this.eventHandle),o.addEventListener("mouseup",this.eventHandle),o.addEventListener("dblclick",this.eventHandle),o.addEventListener("contextmenu",this.eventHandle),o.addEventListener("mouseover",this.eventHandle),o.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var o=this.getElement();o.removeEventListener("mousemove",this.eventHandle),o.removeEventListener("click",this.eventHandle),o.removeEventListener("mousedown",this.eventHandle),o.removeEventListener("mouseup",this.eventHandle),o.removeEventListener("dblclick",this.eventHandle),o.removeEventListener("contextmenu",this.eventHandle),o.removeEventListener("mouseover",this.eventHandle),o.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(o){throw new Error("Method not implemented.")}},{key:"onUp",value:function(o){throw new Error("Method not implemented.")}}]),r}(oe.EventEmitter),ds=G(69848),Do=G.n(ds);function Yi(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Ua(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Yi(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Yi(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Ho(e){var n=Ti();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Ti(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Mc=function(e){(0,Je.Z)(r,e);var n=Ho(r);function r(i){var o,c;return(0,be.Z)(this,r),c=n.call(this),(0,M.Z)((0,H.Z)(c),"markers",[]),(0,M.Z)((0,H.Z)(c),"markerLayerOption",void 0),(0,M.Z)((0,H.Z)(c),"clusterIndex",void 0),(0,M.Z)((0,H.Z)(c),"points",[]),(0,M.Z)((0,H.Z)(c),"clusterMarkers",[]),(0,M.Z)((0,H.Z)(c),"mapsService",void 0),(0,M.Z)((0,H.Z)(c),"scene",void 0),(0,M.Z)((0,H.Z)(c),"zoom",void 0),(0,M.Z)((0,H.Z)(c),"bbox",void 0),c.markerLayerOption=Tu()(c.getDefault(),i),ui(["update"],(0,H.Z)(c)),c.zoom=((o=c.markerLayerOption.clusterOption)===null||o===void 0?void 0:o.zoom)||-99,c}return(0,Pe.Z)(r,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(o){return this.scene=o,this.mapsService=o.get(J.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(o){var c=this.markerLayerOption.cluster;c&&this.addPoint(o,this.markers.length),this.markers.push(o)}},{key:"removeMarker",value:function(o){this.markers.indexOf(o);var c=this.markers.indexOf(o);c>-1&&this.markers.splice(c,1)}},{key:"hide",value:function(){this.markers.map(function(o){o.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(o){o.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var o=this.markerLayerOption.cluster;return o?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var o=this;this.getMarkers().forEach(function(c){c.addTo(o.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(o){o.remove()}),this.clusterMarkers.forEach(function(o){o.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(o,c){var d=o.getLnglat(),y=d.lng,_=d.lat,b={geometry:{type:"Point",coordinates:[y,_]},properties:Ua(Ua({},o.getExtData()),{},{marker_id:c})};this.points.push(b)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var o=this.markerLayerOption.clusterOption,c=o.radius,d=o.minZoom,y=d===void 0?0:d,_=o.maxZoom;this.clusterIndex=new(Do())({radius:c,minZoom:y,maxZoom:_}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(o,c){var d=this,y=o[0].concat(o[1]),_=this.clusterIndex.getClusters(y,c);this.clusterMarkers.forEach(function(b){b.remove()}),this.clusterMarkers=[],_.forEach(function(b){var T,A=d.markerLayerOption.clusterOption,O=A.field,F=A.method;if(b.properties&&(T=b.properties)!==null&&T!==void 0&&T.cluster_id){var W,Q=d.getLeaves((W=b.properties)===null||W===void 0?void 0:W.cluster_id);if(b.properties.clusterData=Q,O&&F){var ue=Q==null?void 0:Q.map(function(Ot){var Ut=(0,M.Z)({},O,Ot.properties[O]);return Ut}),Oe=qs(ue,O),rt=ji(F,Oe),lt="point_"+F;b.properties[lt]=rt.toFixed(2)}}var At=d.clusterMarker(b);d.clusterMarkers.push(At),At.addTo(d.scene)})}},{key:"getLeaves",value:function(o){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return o?this.clusterIndex.getLeaves(o,c,d):null}},{key:"clusterMarker",value:function(o){var c=this.markerLayerOption.clusterOption,d=c,y=d.element,_=y===void 0?this.generateElement.bind(this):y,b=new _i({element:_(o)}).setLnglat({lng:o.geometry.coordinates[0],lat:o.geometry.coordinates[1]});return b}},{key:"normalMarker",value:function(o){var c=o.properties.marker_id;return this.markers[c]}},{key:"update",value:function(){var o=this.mapsService.getZoom(),c=this.mapsService.getBounds();(!this.bbox||Math.abs(o-this.zoom)>=1||!Nn(this.bbox,c))&&(this.bbox=Mr(c,.5),this.zoom=Math.floor(o),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(o){var c=Bt("div","l7-marker-cluster"),d=Bt("div","",c),y=Bt("span","",d),_=this.markerLayerOption.clusterOption,b=_.field,T=_.method;o.properties.point_count=o.properties.point_count||1;var A=b&&T?o.properties["point_"+T]||o.properties[b]:o.properties.point_count;return y.textContent=A,c}}]),r}(oe.EventEmitter);function Gs(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Pl(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Gs(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Gs(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ja(e){var n=rc();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function rc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Iu=function(e){(0,Je.Z)(r,e);var n=ja(r);function r(i){var o;return(0,be.Z)(this,r),o=n.call(this),(0,M.Z)((0,H.Z)(o),"popupOption",void 0),(0,M.Z)((0,H.Z)(o),"mapsService",void 0),(0,M.Z)((0,H.Z)(o),"sceneSerive",void 0),(0,M.Z)((0,H.Z)(o),"lngLat",void 0),(0,M.Z)((0,H.Z)(o),"content",void 0),(0,M.Z)((0,H.Z)(o),"closeButton",void 0),(0,M.Z)((0,H.Z)(o),"timeoutInstance",void 0),(0,M.Z)((0,H.Z)(o),"container",void 0),(0,M.Z)((0,H.Z)(o),"tip",void 0),(0,M.Z)((0,H.Z)(o),"scene",void 0),o.popupOption=Pl(Pl({},o.getdefault()),i),ui(["update","onClickClose","remove"],(0,H.Z)(o)),o}return(0,Pe.Z)(r,[{key:"addTo",value:function(o){var c=this;return this.mapsService=o.get(J.IMapService),this.sceneSerive=o.get(J.ISceneService),this.mapsService.on("camerachange",this.update),this.scene=o,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){c.mapsService.on("click",c.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(o){var c=window.document.createDocumentFragment(),d=window.document.createElement("body"),y;for(d.innerHTML=o;y=d.firstChild,!!y;)c.appendChild(y);return this.setDOMContent(c)}},{key:"setLnglat",value:function(o){return this.lngLat=o,Array.isArray(o)&&(this.lngLat={lng:o[0],lat:o[1]}),this.mapsService&&this.mapsService.on("camerachange",this.update),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(o){return this.setDOMContent(window.document.createTextNode(o))}},{key:"setMaxWidth",value:function(o){return this.popupOption.maxWidth=o,this.update(),this}},{key:"setDOMContent",value:function(o){return this.createContent(),this.content.appendChild(o),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&ot(this.content),this.content=Bt("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Bt("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(o,c,d){var y=window.document.createElement(o);return c!==void 0&&(y.className=c),d&&d.appendChild(y),y}},{key:"removeDom",value:function(o){o.parentNode&&o.parentNode.removeChild(o)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Li.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(o){o.stopPropagation&&o.stopPropagation(),this.remove()}},{key:"update",value:function(){var o=this,c=this.lngLat,d=this.popupOption,y=d.className,_=d.maxWidth,b=d.anchor;if(!(!this.mapsService||!c||!this.content)){var T=this.mapsService.getMarkerContainer();if(!this.container&&T){this.container=this.creatDom("div","l7-popup",T),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),y&&y.split(" ").forEach(function(O){return o.container.classList.add(O)});var A=this.popupOption.stopPropagation;A&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(O){o.container.addEventListener(O,function(F){F.stopPropagation()})})}_&&this.container.style.maxWidth!==_&&(this.container.style.maxWidth=_),this.updatePosition(),Ee(this.container,"".concat(Wn[b])),Zn(this.container,b,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var o=this.lngLat,c=o.lng,d=o.lat,y=this.popupOption.offsets,_=this.mapsService.lngLatToContainer([c,d]);this.container.style.left=_.x+y[0]+"px",this.container.style.top=_.y-y[1]+"px"}}}]),r}(oe.EventEmitter);function ip(e,n){if(n||(n=document),!!n){var r=n.head||n.getElementsByTagName("head")[0];if(!r){r=n.createElement("head");var i=n.body||n.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(r,i):n.documentElement.appendChild(r)}var o=n.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(n.createTextNode(e)),r.appendChild(o),o}}ip(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
 }

.l7-marker {
	position: absolute !important;
	top: 0;
	left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px "Helvetica Neue", Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
    -webkit-box-orient: vertical;
    -webkit-box-direction: reverse;
        -ms-flex-direction: column-reverse;
            flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 5px;
	}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
    -webkit-box-orient: vertical;
    -webkit-box-direction: normal;
        -ms-flex-direction: column;
            flex-direction: column;
}


.l7-popup-anchor-left {
    -webkit-box-orient: horizontal;
    -webkit-box-direction: normal;
        -ms-flex-direction: row;
            flex-direction: row;
}

.l7-popup-anchor-right {
    -webkit-box-orient: horizontal;
    -webkit-box-direction: reverse;
        -ms-flex-direction: row-reverse;
            flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-top: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-top: none;
	border-left: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-top: none;
	border-right: none;
	border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-bottom: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
	-webkit-align-self: flex-start;
	-ms-flex-item-align: start;
	    align-self: flex-start;
	border-bottom: none;
	border-left: none;
	border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
	-webkit-align-self: flex-end;
	-ms-flex-item-align: end;
	    align-self: flex-end;
	border-bottom: none;
	border-right: none;
	border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-left: none;
	border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
	-webkit-align-self: center;
	-ms-flex-item-align: center;
	    align-self: center;
	border-right: none;
	border-left-color: #fff;
}

.l7-popup-close-button {
	position: absolute;
	right: 0;
	top: 0;
	border: 0;
	padding: 0;
	font-size: 25px;
	line-height: 20px;
	border-radius: 0 3px 0 0;
	cursor: pointer;
	background-color: transparent;
}

.l7-popup-close-button:hover {
	background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
	position: relative;
	background: #fff;
	border-radius: 3px;
	-webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
	padding: 10px 10px 15px;
	pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
	border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
	border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
	border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
	border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
	display: none;
}

.l7-popup-track-pointer * {
	pointer-events: none;
	-webkit-user-select: none;
	   -moz-user-select: none;
	    -ms-user-select: none;
	        user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
	display: -webkit-box;
	display: -ms-flexbox;
	display: flex;
}

.l7-map:active .l7-popup-track-pointer {
	display: none;
}


.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
	-webkit-box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	        box-shadow: 0 1px 5px rgba(0,0,0,0.65);
	border-radius: 4px;
	}
.l7-bar a,
.l7-bar a:hover {
	background-color: #fff;
	width: 30px;
	height: 30px;
  font-size: 20px;
	display: block;
	text-align: center;
	text-decoration: none;
	color: #8E9DAB;
	}
.l7-bar a,
.l7-control-layers-toggle {
	background-position: 50% 50%;
	background-repeat: no-repeat;
	display: block;
	}
.l7-bar a:hover {
	background-color: #f4f4f4;
	}
.l7-bar a:first-child {
	border-top-left-radius: 2px;
	border-top-right-radius: 2px;
	}
.l7-bar a:last-child {
	border-bottom-left-radius: 2px;
	border-bottom-right-radius: 2px;
	border-bottom: none;
	}
.l7-bar a.l7-disabled {
	cursor: default;
	background-color: #f4f4f4;
	color: #bbb;
	}


/* control positioning */

.l7-control-container {
	font: 12px/1.5 "Helvetica Neue", Arial, Helvetica, sans-serif;
}
.l7-control-hide {
	display: none;
}
.l7-control {
	position: relative;
	z-index: 800;
	pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
	pointer-events: auto;
	}
.l7-control {
	float: left;
	clear: both;
	}.l7-top,
  .l7-bottom {
    position: absolute;
    z-index: 1000;
    pointer-events: none;
    }
  .l7-top {
    top: 0;
    }
  .l7-right {
    right: 0;
    }
  .l7-bottom {
    bottom: 0;
    }
  .l7-left {
    left: 0;
    }

  .l7-control {
    float: left;
    clear: both;
    }
  .l7-right .l7-control {
    float: right;
    }
  .l7-top .l7-control {
    margin-top: 10px;
    }
  .l7-bottom .l7-control {
    margin-bottom: 10px;
    }
  .l7-left .l7-control {
    margin-left: 10px;
    }
  .l7-right .l7-control {
    margin-right: 10px;
    }

  /* attribution and scale controls */

.l7-control-container .l7-control-attribution {
	background: #fff;
	background: rgba(255, 255, 255, 0.7);
	margin: 0;
	}
.l7-control-attribution,
.l7-control-scale-line {
	padding: 0 5px;
  color: #333;
	}
.l7-control-attribution a {
	text-decoration: none;
	}
.l7-control-attribution a:hover {
	text-decoration: underline;
	}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
	}
.l7-left .l7-control-scale {
	margin-left: 5px;
	}
.l7-bottom .l7-control-scale {
	margin-bottom: 5px;
	}
.l7-control-scale-line {
	border: 2px solid #000;
  border-top: none;
  color: #000;
	line-height: 1.1;
	padding: 2px 5px 1px;
	font-size: 11px;
	white-space: nowrap;
	overflow: hidden;
	-webkit-box-sizing: border-box;
	        box-sizing: border-box;

	background: #fff;
	}
.l7-control-scale-line:not(:first-child) {
	border-top: 2px solid #777;
	border-bottom: none;
	margin-top: -2px;
	}
.l7-control-scale-line:not(:first-child):not(:last-child) {
	border-bottom: 2px solid #777;
	}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	-webkit-box-shadow: none;
	        box-shadow: none;
	}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
	border: 2px solid rgba(0,0,0,0.2);
	background-clip: padding-box;
  }
  /*logo */

  .l7-ctrl-logo {
    background-size: 100% 100%;
    width: 89px;
    height: 16px;
    margin: 0 0 -3px -3px;
    display: -webkit-box;
    display: -ms-flexbox;
    display: flex;
    background-repeat: no-repeat;
    cursor: pointer;
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}


	/* layers control */

.l7-control-layers {
	-webkit-box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	        box-shadow: 0 1px 8px rgba(0,0,0,0.4);
	background: #fff;
	border-radius: 2px;
	}
.l7-control-layers-toggle {
	background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
	width: 30px;
  height: 30px;
  background-size: 20px 20px;
	}

.l7-touch .l7-control-layers-toggle {
	width: 44px;
	height: 44px;
	}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
	display: none;
	}
.l7-control-layers-expanded .l7-control-layers-list {
	display: block;
	position: relative;
	}
.l7-control-layers-expanded {
	padding: 6px 10px 6px 6px;
	color: #59626B;
	background: #fff;
	}
.l7-control-layers-scrollbar {
	overflow-y: scroll;
	overflow-x: hidden;
	padding-right: 5px;
	}
.l7-control-layers-selector {
	margin-top: 2px;
	position: relative;
	top: 1px;
	}
.l7-control-layers label {
  display: block;
  padding: 8px;
  }
  .l7-control-layers label input[type="radio"],
  .l7-control-layers label input[type="checkbox"] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
	height: 0;
	border-top: 1px solid #D8D8D8;
	margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
 }
 .amap-logo{
  display: none !important;
 }
`);var Nf=G(81550),ap=G.n(Nf),Pc=function(){function e(n,r){(0,be.Z)(this,e),(0,M.Z)(this,"attribute",void 0),(0,M.Z)(this,"buffer",void 0);var i=r.buffer,o=r.offset,c=r.stride,d=r.normalized,y=r.size,_=r.divisor;this.buffer=i,this.attribute={buffer:i.get(),offset:o||0,stride:c||0,normalized:d||!1,divisor:_||0},y&&(this.attribute.size=y)}return(0,Pe.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(r){this.buffer.subData(r)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),lu,nf,cu,Ms,af,Il,Ou,of,Hs,fu,_o,ku,Lu,sf,Dp=(lu={},(0,M.Z)(lu,re.POINTS,"points"),(0,M.Z)(lu,re.LINES,"lines"),(0,M.Z)(lu,re.LINE_LOOP,"line loop"),(0,M.Z)(lu,re.LINE_STRIP,"line strip"),(0,M.Z)(lu,re.TRIANGLES,"triangles"),(0,M.Z)(lu,re.TRIANGLE_FAN,"triangle fan"),(0,M.Z)(lu,re.TRIANGLE_STRIP,"triangle strip"),lu),Fp=(nf={},(0,M.Z)(nf,re.STATIC_DRAW,"static"),(0,M.Z)(nf,re.DYNAMIC_DRAW,"dynamic"),(0,M.Z)(nf,re.STREAM_DRAW,"stream"),nf),zf=(cu={},(0,M.Z)(cu,re.BYTE,"int8"),(0,M.Z)(cu,re.UNSIGNED_INT,"int16"),(0,M.Z)(cu,re.INT,"int32"),(0,M.Z)(cu,re.UNSIGNED_BYTE,"uint8"),(0,M.Z)(cu,re.UNSIGNED_SHORT,"uint16"),(0,M.Z)(cu,re.UNSIGNED_INT,"uint32"),(0,M.Z)(cu,re.FLOAT,"float"),cu),Bp=(Ms={},(0,M.Z)(Ms,re.ALPHA,"alpha"),(0,M.Z)(Ms,re.LUMINANCE,"luminance"),(0,M.Z)(Ms,re.LUMINANCE_ALPHA,"luminance alpha"),(0,M.Z)(Ms,re.RGB,"rgb"),(0,M.Z)(Ms,re.RGBA,"rgba"),(0,M.Z)(Ms,re.RGBA4,"rgba4"),(0,M.Z)(Ms,re.RGB5_A1,"rgb5 a1"),(0,M.Z)(Ms,re.RGB565,"rgb565"),(0,M.Z)(Ms,re.DEPTH_COMPONENT,"depth"),(0,M.Z)(Ms,re.DEPTH_STENCIL,"depth stencil"),Ms),Np=(af={},(0,M.Z)(af,re.DONT_CARE,"dont care"),(0,M.Z)(af,re.NICEST,"nice"),(0,M.Z)(af,re.FASTEST,"fast"),af),zp=(Il={},(0,M.Z)(Il,re.NEAREST,"nearest"),(0,M.Z)(Il,re.LINEAR,"linear"),(0,M.Z)(Il,re.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,M.Z)(Il,re.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,M.Z)(Il,re.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,M.Z)(Il,re.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Il),Zf=(Ou={},(0,M.Z)(Ou,re.REPEAT,"repeat"),(0,M.Z)(Ou,re.CLAMP_TO_EDGE,"clamp"),(0,M.Z)(Ou,re.MIRRORED_REPEAT,"mirror"),Ou),wh=(of={},(0,M.Z)(of,re.NONE,"none"),(0,M.Z)(of,re.BROWSER_DEFAULT_WEBGL,"browser"),of),op=(Hs={},(0,M.Z)(Hs,re.NEVER,"never"),(0,M.Z)(Hs,re.ALWAYS,"always"),(0,M.Z)(Hs,re.LESS,"less"),(0,M.Z)(Hs,re.LEQUAL,"lequal"),(0,M.Z)(Hs,re.GREATER,"greater"),(0,M.Z)(Hs,re.GEQUAL,"gequal"),(0,M.Z)(Hs,re.EQUAL,"equal"),(0,M.Z)(Hs,re.NOTEQUAL,"notequal"),Hs),sp=(fu={},(0,M.Z)(fu,re.FUNC_ADD,"add"),(0,M.Z)(fu,re.MIN_EXT,"min"),(0,M.Z)(fu,re.MAX_EXT,"max"),(0,M.Z)(fu,re.FUNC_SUBTRACT,"subtract"),(0,M.Z)(fu,re.FUNC_REVERSE_SUBTRACT,"reverse subtract"),fu),nc=(_o={},(0,M.Z)(_o,re.ZERO,"zero"),(0,M.Z)(_o,re.ONE,"one"),(0,M.Z)(_o,re.SRC_COLOR,"src color"),(0,M.Z)(_o,re.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,M.Z)(_o,re.SRC_ALPHA,"src alpha"),(0,M.Z)(_o,re.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,M.Z)(_o,re.DST_COLOR,"dst color"),(0,M.Z)(_o,re.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,M.Z)(_o,re.DST_ALPHA,"dst alpha"),(0,M.Z)(_o,re.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,M.Z)(_o,re.CONSTANT_COLOR,"constant color"),(0,M.Z)(_o,re.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,M.Z)(_o,re.CONSTANT_ALPHA,"constant alpha"),(0,M.Z)(_o,re.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,M.Z)(_o,re.SRC_ALPHA_SATURATE,"src alpha saturate"),_o),Zp=(ku={},(0,M.Z)(ku,re.NEVER,"never"),(0,M.Z)(ku,re.ALWAYS,"always"),(0,M.Z)(ku,re.LESS,"less"),(0,M.Z)(ku,re.LEQUAL,"lequal"),(0,M.Z)(ku,re.GREATER,"greater"),(0,M.Z)(ku,re.GEQUAL,"gequal"),(0,M.Z)(ku,re.EQUAL,"equal"),(0,M.Z)(ku,re.NOTEQUAL,"notequal"),ku),Ol=(Lu={},(0,M.Z)(Lu,re.ZERO,"zero"),(0,M.Z)(Lu,re.KEEP,"keep"),(0,M.Z)(Lu,re.REPLACE,"replace"),(0,M.Z)(Lu,re.INVERT,"invert"),(0,M.Z)(Lu,re.INCR,"increment"),(0,M.Z)(Lu,re.DECR,"decrement"),(0,M.Z)(Lu,re.INCR_WRAP,"increment wrap"),(0,M.Z)(Lu,re.DECR_WRAP,"decrement wrap"),Lu),sd=(sf={},(0,M.Z)(sf,re.FRONT,"front"),(0,M.Z)(sf,re.BACK,"back"),sf),Vd=function(){function e(n,r){(0,be.Z)(this,e),(0,M.Z)(this,"buffer",void 0);var i=r.data,o=r.usage,c=r.type;this.buffer=n.buffer({data:i,usage:Fp[o||re.STATIC_DRAW],type:zf[c||re.UNSIGNED_BYTE]})}return(0,Pe.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(r){var i=r.data,o=r.offset;this.buffer.subdata(i,o)}}]),e}(),ud=function(){function e(n,r){(0,be.Z)(this,e),(0,M.Z)(this,"elements",void 0);var i=r.data,o=r.usage,c=r.type,d=r.count;this.elements=n.elements({data:i,usage:Fp[o||re.STATIC_DRAW],type:zf[c||re.UNSIGNED_BYTE],count:d})}return(0,Pe.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(r){var i=r.data;this.elements.subdata(i)}},{key:"destroy",value:function(){}}]),e}(),Gd=function(){function e(n,r){(0,be.Z)(this,e),(0,M.Z)(this,"framebuffer",void 0);var i=r.width,o=r.height,c=r.color,d=r.colors,y=r.depth,_=r.stencil,b={width:i,height:o};Array.isArray(d)&&(b.colors=d.map(function(T){return T.get()})),c&&typeof c!="boolean"&&(b.color=c.get()),this.framebuffer=n.framebuffer(b)}return(0,Pe.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(r){var i=r.width,o=r.height;this.framebuffer.resize(i,o)}}]),e}(),ld=G(90484),Nv=G(36719),Up=G.n(Nv),Va=G(68630),kl=G.n(Va);function Hd(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Ru(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Hd(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hd(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var cd=function(){function e(n,r){(0,be.Z)(this,e),(0,M.Z)(this,"reGl",void 0),(0,M.Z)(this,"destroyed",!1),(0,M.Z)(this,"drawCommand",void 0),(0,M.Z)(this,"drawParams",void 0),(0,M.Z)(this,"options",void 0),(0,M.Z)(this,"uniforms",{}),this.reGl=n;var i=r.vs,o=r.fs,c=r.attributes,d=r.uniforms,y=r.primitive,_=r.count,b=r.elements,T=r.depth,A=r.blend,O=r.stencil,F=r.cull,W=r.instances,Q={};this.options=r,d&&(this.uniforms=this.extractUniforms(d),Object.keys(d).forEach(function(rt){Q[rt]=n.prop(rt)}));var ue={};Object.keys(c).forEach(function(rt){ue[rt]=c[rt].get()});var Oe={attributes:ue,frag:o,uniforms:Q,vert:i,primitive:Dp[y===void 0?re.TRIANGLES:y]};W&&(Oe.instances=W),_&&(Oe.count=_),b&&(Oe.elements=b.get()),this.initDepthDrawParams({depth:T},Oe),this.initBlendDrawParams({blend:A},Oe),this.initStencilDrawParams({stencil:O},Oe),this.initCullDrawParams({cull:F},Oe),this.drawCommand=n(Oe),this.drawParams=Oe}return(0,Pe.Z)(e,[{key:"addUniforms",value:function(r){this.uniforms=Ru(Ru({},this.uniforms),this.extractUniforms(r))}},{key:"draw",value:function(r){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=Ru(Ru({},this.uniforms),this.extractUniforms(r.uniforms||{})),o={};Object.keys(i).forEach(function(c){var d=(0,ld.Z)(i[c]);d==="boolean"||d==="number"||Array.isArray(i[c])||i[c].BYTES_PER_ELEMENT?o[c]=i[c]:o[c]=i[c].get()}),this.drawCommand(o)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(r){r.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(r,i){var o=r.depth;o&&(i.depth={enable:o.enable===void 0?!0:!!o.enable,mask:o.mask===void 0?!0:!!o.mask,func:op[o.func||re.LESS],range:o.range||[0,1]})}},{key:"initBlendDrawParams",value:function(r,i){var o=r.blend;if(o){var c=o.enable,d=o.func,y=o.equation,_=o.color,b=_===void 0?[0,0,0,0]:_;i.blend={enable:!!c,func:{srcRGB:nc[d&&d.srcRGB||re.SRC_ALPHA],srcAlpha:nc[d&&d.srcAlpha||re.SRC_ALPHA],dstRGB:nc[d&&d.dstRGB||re.ONE_MINUS_SRC_ALPHA],dstAlpha:nc[d&&d.dstAlpha||re.ONE_MINUS_SRC_ALPHA]},equation:{rgb:sp[y&&y.rgb||re.FUNC_ADD],alpha:sp[y&&y.alpha||re.FUNC_ADD]},color:b}}}},{key:"initStencilDrawParams",value:function(r,i){var o=r.stencil;if(o){var c=o.enable,d=o.mask,y=d===void 0?-1:d,_=o.func,b=_===void 0?{cmp:re.ALWAYS,ref:0,mask:-1}:_,T=o.opFront,A=T===void 0?{fail:re.KEEP,zfail:re.KEEP,zpass:re.KEEP}:T,O=o.opBack,F=O===void 0?{fail:re.KEEP,zfail:re.KEEP,zpass:re.KEEP}:O;i.stencil={enable:!!c,mask:y,func:Ru(Ru({},b),{},{cmp:Zp[b.cmp]}),opFront:{fail:Ol[A.fail],zfail:Ol[A.zfail],zpass:Ol[A.zpass]},opBack:{fail:Ol[F.fail],zfail:Ol[F.zfail],zpass:Ol[F.zpass]}}}}},{key:"initCullDrawParams",value:function(r,i){var o=r.cull;if(o){var c=o.enable,d=o.face,y=d===void 0?re.BACK:d;i.cull={enable:!!c,face:sd[y]}}}},{key:"extractUniforms",value:function(r){var i=this,o={};return Object.keys(r).forEach(function(c){i.extractUniformsRecursively(c,r[c],o,"")}),o}},{key:"extractUniformsRecursively",value:function(r,i,o,c){var d=this;if(i===null||typeof i=="number"||typeof i=="boolean"||Array.isArray(i)&&typeof i[0]=="number"||Up()(i)||i===""||"resize"in i){o["".concat(c&&c+".").concat(r)]=i;return}kl()(i)&&Object.keys(i).forEach(function(y){d.extractUniformsRecursively(y,i[y],o,"".concat(c&&c+".").concat(r))}),Array.isArray(i)&&i.forEach(function(y,_){Object.keys(y).forEach(function(b){d.extractUniformsRecursively(b,y[b],o,"".concat(c&&c+".").concat(r,"[").concat(_,"]"))})})}}]),e}(),Wd=function(){function e(n,r){(0,be.Z)(this,e),(0,M.Z)(this,"texture",void 0),(0,M.Z)(this,"width",void 0),(0,M.Z)(this,"height",void 0);var i=r.data,o=r.type,c=o===void 0?re.UNSIGNED_BYTE:o,d=r.width,y=r.height,_=r.flipY,b=_===void 0?!1:_,T=r.format,A=T===void 0?re.RGBA:T,O=r.mipmap,F=O===void 0?!1:O,W=r.wrapS,Q=W===void 0?re.CLAMP_TO_EDGE:W,ue=r.wrapT,Oe=ue===void 0?re.CLAMP_TO_EDGE:ue,rt=r.aniso,lt=rt===void 0?0:rt,At=r.alignment,Ot=At===void 0?1:At,Ut=r.premultiplyAlpha,Gt=Ut===void 0?!1:Ut,gr=r.mag,Nr=gr===void 0?re.NEAREST:gr,Xr=r.min,Er=Xr===void 0?re.NEAREST:Xr,on=r.colorSpace,Ln=on===void 0?re.BROWSER_DEFAULT_WEBGL:on;this.width=d,this.height=y;var Hn={width:d,height:y,type:zf[c],format:Bp[A],wrapS:Zf[Q],wrapT:Zf[Oe],mag:zp[Nr],min:zp[Er],alignment:Ot,flipY:b,colorSpace:wh[Ln],premultiplyAlpha:Gt,aniso:lt};i&&(Hn.data=i),typeof F=="number"?Hn.mipmap=Np[F]:typeof F=="boolean"&&(Hn.mipmap=F),this.texture=n.texture(Hn)}return(0,Pe.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(r)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(r){var i=r.width,o=r.height;this.texture.resize(i,o),this.width=i,this.height=o}},{key:"destroy",value:function(){this.texture.destroy()}}]),e}(),jp,Ll,Sh=(jp=(0,ie.b2)(),jp(Ll=function(){function e(){var n=this;(0,be.Z)(this,e),(0,M.Z)(this,"extensionObject",void 0),(0,M.Z)(this,"gl",void 0),(0,M.Z)(this,"$container",void 0),(0,M.Z)(this,"canvas",void 0),(0,M.Z)(this,"width",void 0),(0,M.Z)(this,"height",void 0),(0,M.Z)(this,"isDirty",void 0),(0,M.Z)(this,"createModel",function(r){return new cd(n.gl,r)}),(0,M.Z)(this,"createAttribute",function(r){return new Pc(n.gl,r)}),(0,M.Z)(this,"createBuffer",function(r){return new Vd(n.gl,r)}),(0,M.Z)(this,"createElements",function(r){return new ud(n.gl,r)}),(0,M.Z)(this,"createTexture2D",function(r){return new Wd(n.gl,r)}),(0,M.Z)(this,"createFramebuffer",function(r){return new Gd(n.gl,r)}),(0,M.Z)(this,"useFramebuffer",function(r,i){n.gl({framebuffer:r?r.get():null})(i)}),(0,M.Z)(this,"clear",function(r){var i=r.color,o=r.depth,c=r.stencil,d=r.framebuffer,y=d===void 0?null:d,_={color:i,depth:o,stencil:c};_.framebuffer=y===null?y:y.get(),n.gl.clear(_)}),(0,M.Z)(this,"viewport",function(r){var i=r.x,o=r.y,c=r.width,d=r.height;n.gl._gl.viewport(i,o,c,d),n.width=c,n.height=d,n.gl._refresh()}),(0,M.Z)(this,"readPixels",function(r){var i=r.framebuffer,o=r.x,c=r.y,d=r.width,y=r.height,_={x:o,y:c,width:d,height:y};return i&&(_.framebuffer=i.get()),n.gl.read(_)}),(0,M.Z)(this,"getViewportSize",function(){return{width:n.gl._gl.drawingBufferWidth,height:n.gl._gl.drawingBufferHeight}}),(0,M.Z)(this,"getContainer",function(){var r;return(r=n.canvas)===null||r===void 0?void 0:r.parentElement}),(0,M.Z)(this,"getCanvas",function(){return n.canvas}),(0,M.Z)(this,"getGLContext",function(){return n.gl._gl}),(0,M.Z)(this,"destroy",function(){n.gl.destroy()})}return(0,Pe.Z)(e,[{key:"init",value:function(){var n=(0,Zo.Z)(ga().mark(function i(o,c){var d=this;return ga().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return this.canvas=o,_.next=3,new Promise(function(b,T){ap()({canvas:d.canvas,attributes:{alpha:!0,antialias:c.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:c.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(O,F){(O||!F)&&T(O),b(F)}})});case 3:this.gl=_.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return _.stop()}},i,this)}));function r(i,o){return n.apply(this,arguments)}return r}()},{key:"testExtension",value:function(r){return!!this.getGLContext().getExtension(r)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var r=this.getGLContext();r.disable(r.CULL_FACE)}},{key:"setDirty",value:function(r){this.isDirty=r}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||Ll);function up(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Vp(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?up(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):up(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var Eh=function(){function e(n){(0,be.Z)(this,e),(0,M.Z)(this,"sceneService",void 0),(0,M.Z)(this,"mapService",void 0),(0,M.Z)(this,"controlService",void 0),(0,M.Z)(this,"layerService",void 0),(0,M.Z)(this,"iconService",void 0),(0,M.Z)(this,"markerService",void 0),(0,M.Z)(this,"popupService",void 0),(0,M.Z)(this,"fontService",void 0),(0,M.Z)(this,"interactionService",void 0),(0,M.Z)(this,"container",void 0);var r=n.id,i=n.map,o=Zd();this.container=o,i.setContainer(o,r),o.bind(J.IRendererService).to(Sh).inSingletonScope(),this.sceneService=o.get(J.ISceneService),this.mapService=o.get(J.IMapService),this.iconService=o.get(J.IIconService),this.fontService=o.get(J.IFontService),this.controlService=o.get(J.IControlService),this.layerService=o.get(J.ILayerService),this.markerService=o.get(J.IMarkerService),this.interactionService=o.get(J.IInteractionService),this.popupService=o.get(J.IPopupService),this.initComponent(r),this.sceneService.init(n),this.initControl()}return(0,Pe.Z)(e,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(r){return this.sceneService.exportPng(r)}},{key:"exportMap",value:function(r){return this.sceneService.exportPng(r)}},{key:"registerRenderService",value:function(r){var i=this;if(this.sceneService.loaded){var o=new r(this);o.init()}else this.on("loaded",function(){var c=new r(i);c.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"addLayer",value:function(r){var i=Ud(this.container);r.setContainer(i),this.sceneService.addLayer(r)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(r){return this.layerService.getLayer(r)}},{key:"getLayerByName",value:function(r){return this.layerService.getLayerByName(r)}},{key:"removeLayer",value:function(r){this.layerService.remove(r)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(r,i){this.fontService.addIconFont(r,i)}},{key:"addIconFonts",value:function(r){var i=this;r.forEach(function(o){var c=(0,Ft.Z)(o,2),d=c[0],y=c[1];i.fontService.addIconFont(d,y)})}},{key:"addFontFace",value:function(r,i){this.sceneService.addFontFace(r,i)}},{key:"addImage",value:function(r,i){this.iconService.addImage(r,i)}},{key:"hasImage",value:function(r){return this.iconService.hasImage(r)}},{key:"removeImage",value:function(r){this.iconService.removeImage(r)}},{key:"addIconFontGlyphs",value:function(r,i){this.fontService.addIconGlyphs(i)}},{key:"addControl",value:function(r){this.controlService.addControl(r,this.container)}},{key:"removeControl",value:function(r){this.controlService.removeControl(r)}},{key:"getControlByName",value:function(r){return this.controlService.getControlByName(r)}},{key:"addMarker",value:function(r){this.markerService.addMarker(r)}},{key:"addMarkerLayer",value:function(r){this.markerService.addMarkerLayer(r)}},{key:"removeMarkerLayer",value:function(r){this.markerService.removeMarkerLayer(r)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(r){this.popupService.addPopup(r)}},{key:"on",value:function(r,i){cn.indexOf(r)===-1?this.mapService.on(r,i):this.sceneService.on(r,i)}},{key:"once",value:function(r,i){cn.indexOf(r)===-1?this.mapService.once(r,i):this.sceneService.once(r,i)}},{key:"off",value:function(r,i){cn.indexOf(r)===-1?this.mapService.off(r,i):this.sceneService.off(r,i)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(r){return this.mapService.getCenter(r)}},{key:"setCenter",value:function(r,i){return this.mapService.setCenter(r,i)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(r){return this.mapService.setPitch(r)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(r){this.mapService.setRotation(r)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(r){this.mapService.panTo(r)}},{key:"panBy",value:function(r){this.mapService.panBy(r)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(r){this.mapService.setZoom(r)}},{key:"fitBounds",value:function(r,i){var o=this.sceneService.getSceneConfig(),c=o.fitBoundsOptions,d=o.animate;this.mapService.fitBounds(r,i||Vp(Vp({},c),{},{animate:d}))}},{key:"setZoomAndCenter",value:function(r,i){this.mapService.setZoomAndCenter(r,i)}},{key:"setMapStyle",value:function(r){this.mapService.setMapStyle(r)}},{key:"setMapStatus",value:function(r){this.mapService.setMapStatus(r)}},{key:"pixelToLngLat",value:function(r){return this.mapService.pixelToLngLat(r)}},{key:"lngLatToPixel",value:function(r){return this.mapService.lngLatToPixel(r)}},{key:"containerToLngLat",value:function(r){return this.mapService.containerToLngLat(r)}},{key:"lngLatToContainer",value:function(r){return this.mapService.lngLatToContainer(r)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(r,i){this.container.bind(J.IPostProcessingPass).to(r).whenTargetNamed(i)}},{key:"initComponent",value:function(r){this.controlService.init({container:ft(r)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var r=this.sceneService.getSceneConfig(),i=r.logoVisible,o=r.logoPosition;i&&this.addControl(new ka({position:o}))}}]),e}(),fd=G(13218),Du=G.n(fd),Gp=G(23560),uf=G.n(Gp),pd,hd,dd,Ch,Ws;function Th(e){return e.map(function(n){return typeof n=="string"&&(n=[n,{}]),n})}var Xd=(pd=(0,ie.b2)(),hd=(0,ie.f3)(J.IGlobalConfigService),pd(dd=(Ch=function(){function e(){(0,be.Z)(this,e),Tn(this,"configService",Ws,this),(0,M.Z)(this,"enabled",void 0)}return(0,Pe.Z)(e,[{key:"apply",value:function(r,i){var o=this,c=i.rendererService,d=i.postProcessingPassFactory,y=i.normalPassFactory;r.hooks.init.tap("MultiPassRendererPlugin",function(){var _=r.getLayerConfig(),b=_.enableMultiPassRenderer,T=_.passes,A=T===void 0?[]:T;o.enabled=!!b&&r.getLayerConfig().enableMultiPassRenderer!==!1,o.enabled&&(r.multiPassRenderer=o.createMultiPassRenderer(r,A,d,y),r.multiPassRenderer.setRenderFlag(!0))}),r.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(r,i,o,c){var d=r.multiPassRenderer,y=r.getLayerConfig(),_=y.enablePicking,b=y.enableTAA;return _&&d.add(c("pixelPicking")),d}}]),e}(),Ws=Kr(Ch.prototype,"configService",[hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ch))||dd),vs,Yd=(vs={},(0,M.Z)(vs,xt.additive,{enable:!0,func:{srcRGB:re.ONE,dstRGB:re.ONE,srcAlpha:1,dstAlpha:1}}),(0,M.Z)(vs,xt.none,{enable:!1}),(0,M.Z)(vs,xt.normal,{enable:!0,func:{srcRGB:re.SRC_ALPHA,dstRGB:re.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,M.Z)(vs,xt.subtractive,{enable:!0,func:{srcRGB:re.ONE,dstRGB:re.ONE,srcAlpha:re.ZERO,dstAlpha:re.ONE_MINUS_SRC_COLOR},equation:{rgb:re.FUNC_SUBTRACT,alpha:re.FUNC_SUBTRACT}}),(0,M.Z)(vs,xt.max,{enable:!0,func:{srcRGB:re.ONE,dstRGB:re.ONE},equation:{rgb:re.MAX_EXT}}),(0,M.Z)(vs,xt.min,{enable:!0,func:{srcRGB:re.ONE,dstRGB:re.ONE},equation:{rgb:re.MIN_EXT}}),vs),qd=G(47037),ms=G.n(qd),lp=G(81763),Ui=G.n(lp),cp=G(1469),al=G.n(cp),zv=1024;function Ps(e,n,r,i,o){n.updateStyleAttribute(e,r,i,o)}function Kd(e,n){e.opacity&&Ah("opacity",n,e.opacity),e.strokeWidth&&Ah("strokeWidth",n,e.strokeWidth),e.strokeOpacity&&Ah("strokeOpacity",n,e.strokeOpacity),e.stroke&&vd("stroke",n,e.stroke),e.offsets&&Mh("offsets",n,e.offsets),e.textOffset&&Mh("textOffset",n,e.textOffset)}function Ah(e,n,r){ms()(r)?Ps(e,n,r,function(i){return i}):Ui()(r)?Ps(e,n,[r],void 0):al()(r)&&r.length===2?ms()(r[0])&&uf()(r[1])||ms()(r[0])&&al()(r[1])&&Ui()(r[1][0])&&Ui()(r[1][1])?Ps(e,n,r[0],r[1]):Ps(e,n,[1],void 0):Ps(e,n,[1],void 0)}function Mh(e,n,r){ms()(r)?Ps(e,n,r,function(i){return i}):al()(r)&&r.length===2&&ms()(r[0])&&uf()(r[1])?Ps(e,n,r[0],r[1]):al()(r)&&r.length===2&&Ui()(r[0])&&Ui()(r[1])?Ps(e,n,r,void 0):Ps(e,n,[0,0],void 0)}function vd(e,n,r){ms()(r)?Ps(e,n,r,void 0):al()(r)&&r.length===2&&(ms()(r[0])&&uf()(r[1])||ms()(r[0])&&al()(r[1])&&r[1].length>0)?Ps(e,n,r[0],r[1]):Ps(e,n,"#fff",void 0)}var Ic=["passes"],$d=["moduleName","vertexShader","fragmentShader","triangulation"],Ph,Ih,Hp,Oh,md;function Jd(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=yd(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function yd(e,n){if(!!e){if(typeof e=="string")return gd(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gd(e,n)}}function gd(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function fp(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function ys(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?fp(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):fp(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function kh(e){var n=Zv();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Zv(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _d=0,Uf=(Ph=rf(J.IGlobalConfigService),Ih=rf(J.IShaderModuleService),Hp=function(e){(0,Je.Z)(r,e);var n=kh(r);function r(){var i,o=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,be.Z)(this,r),i=n.call(this),(0,M.Z)((0,H.Z)(i),"id","".concat(_d++)),(0,M.Z)((0,H.Z)(i),"name","".concat(_d)),(0,M.Z)((0,H.Z)(i),"type",void 0),(0,M.Z)((0,H.Z)(i),"visible",!0),(0,M.Z)((0,H.Z)(i),"zIndex",0),(0,M.Z)((0,H.Z)(i),"minZoom",void 0),(0,M.Z)((0,H.Z)(i),"maxZoom",void 0),(0,M.Z)((0,H.Z)(i),"inited",!1),(0,M.Z)((0,H.Z)(i),"layerModelNeedUpdate",!1),(0,M.Z)((0,H.Z)(i),"pickedFeatureID",null),(0,M.Z)((0,H.Z)(i),"selectedFeatureID",null),(0,M.Z)((0,H.Z)(i),"styleNeedUpdate",!1),(0,M.Z)((0,H.Z)(i),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,M.Z)((0,H.Z)(i),"hooks",{init:new ps,afterInit:new ps,beforeRender:new ps,beforeRenderData:new ao,afterRender:new Ba,beforePickingEncode:new Ba,afterPickingEncode:new Ba,beforeHighlight:new Ba(["pickedColor"]),afterHighlight:new Ba,beforeSelect:new Ba(["pickedColor"]),afterSelect:new Ba,beforeDestroy:new Ba,afterDestroy:new Ba}),(0,M.Z)((0,H.Z)(i),"models",[]),(0,M.Z)((0,H.Z)(i),"multiPassRenderer",void 0),(0,M.Z)((0,H.Z)(i),"plugins",void 0),(0,M.Z)((0,H.Z)(i),"sourceOption",void 0),(0,M.Z)((0,H.Z)(i),"layerModel",void 0),Tn((0,H.Z)(i),"configService",Oh,(0,H.Z)(i)),Tn((0,H.Z)(i),"shaderModuleService",md,(0,H.Z)(i)),(0,M.Z)((0,H.Z)(i),"cameraService",void 0),(0,M.Z)((0,H.Z)(i),"coordinateService",void 0),(0,M.Z)((0,H.Z)(i),"iconService",void 0),(0,M.Z)((0,H.Z)(i),"fontService",void 0),(0,M.Z)((0,H.Z)(i),"pickingService",void 0),(0,M.Z)((0,H.Z)(i),"rendererService",void 0),(0,M.Z)((0,H.Z)(i),"layerService",void 0),(0,M.Z)((0,H.Z)(i),"interactionService",void 0),(0,M.Z)((0,H.Z)(i),"mapService",void 0),(0,M.Z)((0,H.Z)(i),"styleAttributeService",void 0),(0,M.Z)((0,H.Z)(i),"layerSource",void 0),(0,M.Z)((0,H.Z)(i),"postProcessingPassFactory",void 0),(0,M.Z)((0,H.Z)(i),"normalPassFactory",void 0),(0,M.Z)((0,H.Z)(i),"animateOptions",{enable:!1}),(0,M.Z)((0,H.Z)(i),"container",void 0),(0,M.Z)((0,H.Z)(i),"encodedData",void 0),(0,M.Z)((0,H.Z)(i),"configSchema",void 0),(0,M.Z)((0,H.Z)(i),"currentPickId",null),(0,M.Z)((0,H.Z)(i),"rawConfig",void 0),(0,M.Z)((0,H.Z)(i),"needUpdateConfig",void 0),(0,M.Z)((0,H.Z)(i),"pendingStyleAttributes",[]),(0,M.Z)((0,H.Z)(i),"scaleOptions",{}),(0,M.Z)((0,H.Z)(i),"animateStartTime",void 0),(0,M.Z)((0,H.Z)(i),"aniamateStatus",!1),(0,M.Z)((0,H.Z)(i),"sourceEvent",function(){i.dataState.dataSourceNeedUpdate=!0;var c=i.getLayerConfig(),d=c.autoFit,y=c.fitBoundsOptions;d&&i.fitBounds(y),i.emit("dataUpdate"),i.reRender()}),i.name=o.name||i.id,i.zIndex=o.zIndex||0,i.rawConfig=o,i}return(0,Pe.Z)(r,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(o){if(!this.inited)this.needUpdateConfig=ys(ys({},this.needUpdateConfig),o);else{var c=this.container.get(J.SceneID);Kd(o,this),this.configService.setLayerConfig(c,this.id,ys(ys(ys({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),o)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(o){this.container=o}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(o){return this.plugins.push(o),this}},{key:"init",value:function(){var o=this,c=this.container.get(J.SceneID),d=this.rawConfig.enableMultiPassRenderer,y=d===void 0?!1:d;this.configService.setLayerConfig(c,this.id,{enableMultiPassRenderer:y}),this.iconService=this.container.get(J.IIconService),this.fontService=this.container.get(J.IFontService),this.rendererService=this.container.get(J.IRendererService),this.layerService=this.container.get(J.ILayerService),this.interactionService=this.container.get(J.IInteractionService),this.pickingService=this.container.get(J.IPickingService),this.mapService=this.container.get(J.IMapService),this.cameraService=this.container.get(J.ICameraService),this.coordinateService=this.container.get(J.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(J.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(J.IFactoryNormalPass),this.styleAttributeService=this.container.get(J.IStyleAttributeService),this.multiPassRenderer=this.container.get(J.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(A){var O=A.attributeName,F=A.attributeField,W=A.attributeValues,Q=A.updateOptions;o.styleAttributeService.updateStyleAttribute(O,{scale:ys({field:F},o.splitValuesAndCallbackInAttribute(W,o.getLayerConfig()[O]))},Q)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(J.ILayerPlugin);var _=Jd(this.plugins),b;try{for(_.s();!(b=_.n()).done;){var T=b.value;T.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(A){_.e(A)}finally{_.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(ys(ys({},this.getDefaultConfig()),this.rawConfig));var o=this.getLayerConfig(),c=o.animateOption;c!=null&&c.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(o,c,d){return this.updateStyleAttribute("color",o,c,d),this}},{key:"texture",value:function(o,c,d){return this.updateStyleAttribute("texture",o,c,d),this}},{key:"rotate",value:function(o,c,d){return this.updateStyleAttribute("rotate",o,c,d),this}},{key:"size",value:function(o,c,d){return this.updateStyleAttribute("size",o,c,d),this}},{key:"filter",value:function(o,c,d){return this.updateStyleAttribute("filter",o,c,d),this}},{key:"shape",value:function(o,c,d){return this.updateStyleAttribute("shape",o,c,d),this}},{key:"label",value:function(o,c,d){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:o,attributeValues:c,updateOptions:d}),this}},{key:"animate",value:function(o){var c={};return Du()(o)?(c.enable=!0,c=ys(ys({},c),o)):c.enable=o,this.updateLayerConfig({animateOption:c}),this}},{key:"source",value:function(o,c){return this.sourceOption={data:o,options:c},this}},{key:"setData",value:function(o,c){var d=this;return this.inited?this.layerSource.setData(o,c):this.on("inited",function(){d.layerSource.setData(o,c)}),this}},{key:"style",value:function(o){var c=this,d=o.passes,y=(0,z.Z)(o,Ic);return d&&Th(d).forEach(function(_){var b=c.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(_[0]);b&&b.updateOptions(_[1])}),this.rawConfig=ys(ys({},this.rawConfig),y),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(o,c){return Du()(o)?this.scaleOptions=ys(ys({},this.scaleOptions),o):this.scaleOptions[o]=c,this}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(o){var c={};return c.enableHighlight=Du()(o)?!0:o,Du()(o)?(c.enableHighlight=!0,o.color&&(c.highlightColor=o.color)):c.enableHighlight=!!o,this.updateLayerConfig(c),this}},{key:"setActive",value:function(o,c){var d=this;if(Du()(o)){var y=o.x,_=y===void 0?0:y,b=o.y,T=b===void 0?0:b;this.updateLayerConfig({highlightColor:Du()(c)?c.color:this.getLayerConfig().highlightColor}),this.pick({x:_,y:T})}else this.updateLayerConfig({pickedFeatureID:o,highlightColor:Du()(c)?c.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call(Sa(o)).then(function(){setTimeout(function(){d.reRender()},1)})}},{key:"select",value:function(o){var c={};return c.enableSelect=Du()(o)?!0:o,Du()(o)?(c.enableSelect=!0,o.color&&(c.selectColor=o.color)):c.enableSelect=!!o,this.updateLayerConfig(c),this}},{key:"setSelect",value:function(o,c){var d=this;if(Du()(o)){var y=o.x,_=y===void 0?0:y,b=o.y,T=b===void 0?0:b;this.updateLayerConfig({selectColor:Du()(c)?c.color:this.getLayerConfig().selectColor}),this.pick({x:_,y:T})}else this.updateLayerConfig({pickedFeatureID:o,selectColor:Du()(c)?c.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call(Sa(o)).then(function(){setTimeout(function(){d.reRender()},1)})}},{key:"setBlend",value:function(o){this.updateLayerConfig({blend:o}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(o){return this.zIndex=o,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(o){this.currentPickId=o}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(o){this.selectedFeatureID=o}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var o=this.mapService.getZoom(),c=this.getLayerConfig(),d=c.visible,y=c.minZoom,_=y===void 0?-Infinity:y,b=c.maxZoom,T=b===void 0?Infinity:b;return!!d&&o>=_&&o<=T}},{key:"setMinZoom",value:function(o){return this.updateLayerConfig({minZoom:o}),this}},{key:"getMinZoom",value:function(){var o=this.getLayerConfig(),c=o.minZoom;return c}},{key:"getMaxZoom",value:function(){var o=this.getLayerConfig(),c=o.maxZoom;return c}},{key:"get",value:function(o){var c=this.getLayerConfig();return c[o]}},{key:"setMaxZoom",value:function(o){return this.updateLayerConfig({maxZoom:o}),this}},{key:"fitBounds",value:function(o){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var c=this.getSource(),d=c.extent,y=d.some(function(_){return Math.abs(_)===Infinity});return y?this:(this.mapService.fitBounds([[d[0],d[1]],[d[2],d[3]]],o),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(o){return o.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(o){return o.needRescale||o.needRemapping||o.needRegenerateVertices}).length}},{key:"setSource",value:function(o){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=o,this.inited&&this.layerSource.cluster){var c=this.mapService.getZoom();this.layerSource.updateClusterData(c)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(o){this.encodedData=o}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(o){var c=this.styleAttributeService.getLayerAttributeScale(o);if(c){if(c.ticks){var d=c.ticks().map(function(_){return(0,M.Z)({value:_},o,c(_))});return d}else if(c.invertExtent){var y=c.range().map(function(_){return(0,M.Z)({value:c.invertExtent(_)},o,_)});return y}}else return[]}},{key:"pick",value:function(o){var c=o.x,d=o.y;this.interactionService.triggerHover({x:c,y:d})}},{key:"boxSelect",value:function(o,c){this.pickingService.boxPickLayer(this,o,c)}},{key:"buildLayerModel",value:function(o){var c=o.moduleName,d=o.vertexShader,y=o.fragmentShader,_=o.triangulation,b=(0,z.Z)(o,$d);this.shaderModuleService.registerModule(c,{vs:d,fs:y});var T=this.shaderModuleService.getModule(c),A=T.vs,O=T.fs,F=T.uniforms,W=this.rendererService.createModel,Q=this.styleAttributeService.createAttributesAndIndices(this.encodedData,_),ue=Q.attributes,Oe=Q.elements;return W(ys({attributes:ue,uniforms:F,fs:O,vs:A,elements:Oe,blend:Yd[xt.normal]},b))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(o){var c=this.getLayerConfig(),d=c.enableHighlight,y=d===void 0?!0:d,_=c.enableSelect,b=_===void 0?!0:_,T=this.eventNames().indexOf(o)!==-1||this.eventNames().indexOf("un"+o)!==-1;return(o==="click"||o==="dblclick")&&b&&(T=!0),o==="mousemove"&&(y||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(T=!0),this.isVisible()&&T}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var o=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(c){c.draw({uniforms:o.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(o,c,d,y){this.inited?this.styleAttributeService.updateStyleAttribute(o,{scale:ys({field:c},this.splitValuesAndCallbackInAttribute(d,this.getLayerConfig()[c]))},y):this.pendingStyleAttributes.push({attributeName:o,attributeField:c,attributeValues:d,updateOptions:y})}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(o,c){return{values:uf()(o)?void 0:o||c,callback:uf()(o)?o:void 0}}}]),r}(oe.EventEmitter),Oh=Kr(Hp.prototype,"configService",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),md=Kr(Hp.prototype,"shaderModuleService",[Ih],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hp),Uv=G(18446),Wp=G.n(Uv),Qd,ev,Lh,tv,rv;function ic(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Rh(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function Rh(e,n){if(!!e){if(typeof e=="string")return xd(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xd(e,n)}}function xd(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var so=(Qd=rf(J.IGlobalConfigService),ev=rf(J.IShaderModuleService),Lh=function(){function e(n){(0,be.Z)(this,e),(0,M.Z)(this,"triangulation",void 0),(0,M.Z)(this,"createTexture2D",void 0),(0,M.Z)(this,"layer",void 0),(0,M.Z)(this,"dataTexture",void 0),(0,M.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,M.Z)(this,"rowCount",void 0),(0,M.Z)(this,"cacheStyleProperties",void 0),(0,M.Z)(this,"cellLength",void 0),(0,M.Z)(this,"cellProperties",void 0),(0,M.Z)(this,"cellTypeLayout",void 0),(0,M.Z)(this,"stylePropertyesExist",void 0),(0,M.Z)(this,"dataTextureTest",void 0),Tn(this,"configService",tv,this),Tn(this,"shaderModuleService",rv,this),(0,M.Z)(this,"rendererService",void 0),(0,M.Z)(this,"iconService",void 0),(0,M.Z)(this,"fontService",void 0),(0,M.Z)(this,"styleAttributeService",void 0),(0,M.Z)(this,"mapService",void 0),(0,M.Z)(this,"cameraService",void 0),(0,M.Z)(this,"layerService",void 0),this.layer=n,this.rendererService=n.getContainer().get(J.IRendererService),this.styleAttributeService=n.getContainer().get(J.IStyleAttributeService),this.mapService=n.getContainer().get(J.IMapService),this.iconService=n.getContainer().get(J.IIconService),this.fontService=n.getContainer().get(J.IFontService),this.cameraService=n.getContainer().get(J.ICameraService),this.layerService=n.getContainer().get(J.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var r=this.rendererService.createTexture2D;this.createTexture2D=r,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:re.NEAREST,min:re.NEAREST,width:1,height:1}))}return(0,Pe.Z)(e,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(r){var i=!1;return Wp()(r.opacity,this.cacheStyleProperties.opacity)||(i=!0,this.cacheStyleProperties.opacity=r.opacity),Wp()(r.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(i=!0,this.cacheStyleProperties.strokeOpacity=r.strokeOpacity),Wp()(r.strokeWidth,this.cacheStyleProperties.strokeWidth)||(i=!0,this.cacheStyleProperties.strokeWidth=r.strokeWidth),Wp()(r.stroke,this.cacheStyleProperties.stroke)||(i=!0,this.cacheStyleProperties.stroke=r.stroke),Wp()(r.offsets,this.cacheStyleProperties.offsets)||(i=!0,this.cacheStyleProperties.offsets=r.offsets),this.dataTexture===void 0&&(i=!0),i}},{key:"judgeStyleAttributes",value:function(r){this.clearLastCalRes(),r.opacity!==void 0&&!Ui()(r.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),r.strokeOpacity!==void 0&&!Ui()(r.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),r.strokeWidth!==void 0&&!Ui()(r.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),r.stroke!==void 0&&!this.isStaticColor(r.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),r.offsets!==void 0&&!this.isOffsetStatic(r.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(r){return ms()(r)?!!(0,zn.ZP)(r):!1}},{key:"getStrokeColor",value:function(r){if(this.isStaticColor(r)){var i=Pn(r);return i[0]=i[0]?i[0]:0,i[1]=i[1]?i[1]:0,i[2]=i[2]?i[2]:0,i[3]=i[3]?i[3]:0,i}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(r){return!!(al()(r)&&r.length===2&&Ui()(r[0])&&Ui()(r[1]))}},{key:"patchMod",value:function(r,i){for(var o=0;o<i;o++)r.push(-1)}},{key:"patchData",value:function(r,i,o){var c=ic(o),d;try{for(c.s();!(d=c.n()).done;){var y=d.value,_=y.attr,b=y.count,T=i[_];T?_==="stroke"?r.push.apply(r,(0,j.Z)(Pn(T))):_==="offsets"?this.isOffsetStatic(T)?r.push(-T[0],T[1]):r.push(0,0):r.push(Ui()(T)?T:1):this.patchMod(r,b)}}catch(A){c.e(A)}finally{c.f()}}},{key:"calDataFrame",value:function(r,i,o){for(var c=i.length,d=Math.ceil(c*r/this.DATA_TEXTURE_WIDTH),y=d*this.DATA_TEXTURE_WIDTH,_=[],b=0;b<c;b++){var T=i[b];this.patchData(_,T,o)}for(var A=_.length;A<y;A++)_.push(-1);return{data:_,width:this.DATA_TEXTURE_WIDTH,height:d}}},{key:"getBlend",value:function(){var r=this.layer.getLayerConfig(),i=r.blend,o=i===void 0?"normal":i;return Yd[xt[o]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(r){return[r.enable?0:1,r.duration||4,r.interval||.2,r.trailLength||.1]}},{key:"startModelAnimate",value:function(){var r=this.layer.getLayerConfig(),i=r.animateOption;i.enable&&this.layer.setAnimateStartTime()}}]),e}(),tv=Kr(Lh.prototype,"configService",[Qd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rv=Kr(Lh.prototype,"shaderModuleService",[ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lh),nv=G(9187),pp=G.n(nv),ri=G(31437),iv=ri.create(),HC=ri.create(),pu=ri.create(),Dh=ri.create(),av=ri.create();function Em(e,n,r,i,o){ri.add(e,r,i),ri.normalize(e,e),n=ri.fromValues(-e[1],e[0]);var c=ri.fromValues(-r[1],r[0]);return[o/ri.dot(n,c),n]}function Fh(e,n){return ri.set(e,-n[1],n[0])}function ov(e,n,r){return ri.sub(e,n,r),ri.normalize(e,e),e}function Cm(e,n){return e[0]===n[0]&&e[1]===n[1]}function WC(e){for(var n=new Map,r=0;r<e.length;r++){var i=e[0].toString()+"-"+e[1].toString();n.get(i)?(e.splice(r,1),r++):n.set(i,i)}return e}var M_=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,be.Z)(this,e),(0,M.Z)(this,"complex",void 0),(0,M.Z)(this,"join",void 0),(0,M.Z)(this,"cap",void 0),(0,M.Z)(this,"miterLimit",void 0),(0,M.Z)(this,"thickness",void 0),(0,M.Z)(this,"normal",void 0),(0,M.Z)(this,"lastFlip",-1),(0,M.Z)(this,"miter",ri.fromValues(0,0)),(0,M.Z)(this,"started",!1),(0,M.Z)(this,"dash",!1),(0,M.Z)(this,"totalDistance",0),this.join=n.join||"miter",this.cap=n.cap||"butt",this.miterLimit=n.miterLimit||10,this.thickness=n.thickness||1,this.dash=n.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,Pe.Z)(e,[{key:"extrude_gaode2",value:function(r,i){var o=this.complex;if(r.length<=1)return o;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var c=r.length,d=o.startIndex,y=1;y<c;y++){var _=r[y-1],b=i[y-1],T=r[y],A=i[y],O=y<r.length-1?r[y+1]:null,F=y<i.length-1?i[y+1]:null,W=this.segment_gaode2(o,d,_,T,O,b,A,F);d+=W}if(this.dash)for(var Q=0;Q<o.positions.length/6;Q++)o.positions[Q*6+5]=this.totalDistance;return o.startIndex=o.positions.length/6,o}},{key:"extrude",value:function(r){var i=this.complex;if(r.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var o=r.length,c=i.startIndex,d=1;d<o;d++){var y=r[d-1],_=r[d],b=d<r.length-1?r[d+1]:null,T=this.segment(i,c,y,_,b);c+=T}if(this.dash)for(var A=0;A<i.positions.length/6;A++)i.positions[A*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"segment_gaode2",value:function(r,i,o,c,d,y,_,b){var T=0,A=r.indices,O=r.positions,F=r.normals,W=this.cap==="square",Q=this.join==="bevel",ue=Rr([_[0],_[1]]),Oe=Rr([y[0],y[1]]);ov(pu,c,o);var rt=0;if(this.dash&&(rt=this.lineSegmentDistance(ue,Oe),this.totalDistance+=rt),this.normal||(this.normal=ri.create(),Fh(this.normal,pu)),!this.started)if(this.started=!0,W){var lt=ri.create(),At=ri.create();ri.add(lt,this.normal,pu),ri.add(At,this.normal,pu),F.push(At[0],At[1],0),F.push(lt[0],lt[1],0),O.push(o[0],o[1],0,this.totalDistance-rt,-this.thickness,0),O.push(o[0],o[1],0,this.totalDistance-rt,this.thickness,0)}else this.extrusions(O,F,o,this.normal,this.thickness,this.totalDistance-rt);if(A.push(i+0,i+1,i+2),d){Cm(c,d)&&ri.add(d,c,ri.normalize(d,ri.subtract(d,c,o))),ov(Dh,d,c);var Gt=Em(av,ri.create(),pu,Dh,this.thickness),gr=(0,Ft.Z)(Gt,2),Nr=gr[0],Xr=gr[1],Er=ri.dot(av,this.normal)<0?-1:1,on=Q;if(!on&&this.join==="miter"){var Ln=Nr;Ln>this.miterLimit&&(on=!0)}on?(F.push(this.normal[0],this.normal[1],0),F.push(Xr[0],Xr[1],0),O.push(c[0],c[1],0,this.totalDistance,-this.thickness*Er,0),O.push(c[0],c[1],0,this.totalDistance,this.thickness*Er,0),A.push.apply(A,(0,j.Z)(this.lastFlip!==-Er?[i,i+2,i+3]:[i+2,i+1,i+3])),A.push(i+2,i+3,i+4),Fh(iv,Dh),ri.copy(this.normal,iv),F.push(this.normal[0],this.normal[1],0),O.push(c[0],c[1],0,this.totalDistance,-this.thickness*Er,0),T+=3):(this.extrusions(O,F,c,Xr,Nr,this.totalDistance),A.push.apply(A,(0,j.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Er=-1,ri.copy(this.normal,Xr),T+=2),this.lastFlip=Er}else{if(Fh(this.normal,pu),W){var Ot=ri.create(),Ut=ri.create();ri.sub(Ut,pu,this.normal),ri.add(Ot,pu,this.normal),F.push(Ut[0],Ut[1],0),F.push(Ot[0],Ot[1],0),O.push(c[0],c[1],0,this.totalDistance,this.thickness,0),O.push(c[0],c[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(O,F,c,this.normal,this.thickness,this.totalDistance);A.push.apply(A,(0,j.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),T+=2}return T}},{key:"segment",value:function(r,i,o,c,d){var y=0,_=r.indices,b=r.positions,T=r.normals,A=this.cap==="square",O=this.join==="bevel",F=Rr([c[0],c[1]]),W=Rr([o[0],o[1]]);ov(pu,F,W);var Q=0;if(this.dash&&(Q=this.lineSegmentDistance(F,W),this.totalDistance+=Q),this.normal||(this.normal=ri.create(),Fh(this.normal,pu)),!this.started)if(this.started=!0,A){var ue=ri.create(),Oe=ri.create();ri.add(ue,this.normal,pu),ri.add(Oe,this.normal,pu),T.push(Oe[0],Oe[1],0),T.push(ue[0],ue[1],0),b.push(o[0],o[1],0,this.totalDistance-Q,-this.thickness,0),b.push(o[0],o[1],0,this.totalDistance-Q,this.thickness,0)}else this.extrusions(b,T,o,this.normal,this.thickness,this.totalDistance-Q);if(_.push(i+0,i+1,i+2),d){var At=Rr([d[0],d[1]]);Cm(F,At)&&ri.add(At,F,ri.normalize(At,ri.subtract(At,F,W))),ov(Dh,At,F);var Ot=Em(av,ri.create(),pu,Dh,this.thickness),Ut=(0,Ft.Z)(Ot,2),Gt=Ut[0],gr=Ut[1],Nr=ri.dot(av,this.normal)<0?-1:1,Xr=O;if(!Xr&&this.join==="miter"){var Er=Gt;Er>this.miterLimit&&(Xr=!0)}Xr?(T.push(this.normal[0],this.normal[1],0),T.push(gr[0],gr[1],0),b.push(c[0],c[1],0,this.totalDistance,-this.thickness*Nr,0),b.push(c[0],c[1],0,this.totalDistance,this.thickness*Nr,0),_.push.apply(_,(0,j.Z)(this.lastFlip!==-Nr?[i,i+2,i+3]:[i+2,i+1,i+3])),_.push(i+2,i+3,i+4),Fh(iv,Dh),ri.copy(this.normal,iv),T.push(this.normal[0],this.normal[1],0),b.push(c[0],c[1],0,this.totalDistance,-this.thickness*Nr,0),y+=3):(this.extrusions(b,T,c,gr,Gt,this.totalDistance),_.push.apply(_,(0,j.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),Nr=-1,ri.copy(this.normal,gr),y+=2),this.lastFlip=Nr}else{if(Fh(this.normal,pu),A){var rt=ri.create(),lt=ri.create();ri.sub(lt,pu,this.normal),ri.add(rt,pu,this.normal),T.push(lt[0],lt[1],0),T.push(rt[0],rt[1],0),b.push(c[0],c[1],0,this.totalDistance,this.thickness,0),b.push(c[0],c[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(b,T,c,this.normal,this.thickness,this.totalDistance);_.push.apply(_,(0,j.Z)(this.lastFlip===1?[i,i+2,i+3]:[i+2,i+1,i+3])),y+=2}return y}},{key:"extrusions",value:function(r,i,o,c,d,y){i.push(c[0],c[1],0),i.push(c[0],c[1],0),r.push(o[0],o[1],0,y,-d,0),r.push(o[0],o[1],0,y,d,0)}},{key:"lineSegmentDistance",value:function(r,i){var o=i[0]-r[0],c=i[1]-r[1];return Math.sqrt(o*o+c*c)}}]),e}();function Bh(e){if(Ui()(e[0]))return e;if(Ui()(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Ui()(e[0][0][0])){var n=e,r=0,i=0,o=0;return n.forEach(function(c){c.forEach(function(d){r+=d[0],i+=d[1],o++})}),[r/o,i/o,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var Xs=G(77160);function P_(e){var n=e[0][0],r=e[0][e[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,o=pp().flatten(e),c=o.vertices,d=o.dimensions,y=[],_=[],b=0;b<c.length/d;b++)d===2?y.push(c[b*2],c[b*2+1],1):y.push(c[b*3],c[b*3+1],1);var T=pp()(o.vertices,o.holes,o.dimensions);_.push.apply(_,(0,j.Z)(T));for(var A=function(W){var Q=o.vertices.slice(W*d,(W+1)*d),ue=o.vertices.slice((W+1)*d,(W+2)*d);ue.length===0&&(ue=o.vertices.slice(0,d));var Oe=y.length/3;y.push(Q[0],Q[1],1,ue[0],ue[1],1,Q[0],Q[1],0,ue[0],ue[1],0),_.push.apply(_,(0,j.Z)([0,2,1,2,3,1].map(function(rt){return rt+Oe})))},O=0;O<i;O++)A(O);return{positions:y,index:_}}function I_(e){var n=pp().flatten(e),r=pp()(n.vertices,n.holes,n.dimensions);return{positions:n.vertices,index:r}}function Tm(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,r=e[0][0],i=e[0][e[0].length-1];r[0]===i[0]&&r[1]===i[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var o=e[0].length,c=pp().flatten(e),d=c.vertices,y=c.dimensions,_=[],b=[],T=[],A=0;A<d.length/y;A++)y===2?_.push(d[A*2],d[A*2+1],1,-1,-1):_.push(d[A*3],d[A*3+1],1,-1,-1),T.push(0,0,1);var O=pp()(c.vertices,c.holes,c.dimensions);b.push.apply(b,(0,j.Z)(O));for(var F=function(ue){var Oe=c.vertices.slice(ue*y,(ue+1)*y),rt=c.vertices.slice((ue+1)*y,(ue+2)*y);rt.length===0&&(rt=c.vertices.slice(0,y));var lt=_.length/5;_.push(Oe[0],Oe[1],1,0,0,rt[0],rt[1],1,.1,0,Oe[0],Oe[1],0,0,.8,rt[0],rt[1],0,.1,.8);var At=O_([rt[0],rt[1],1],[Oe[0],Oe[1],0],[Oe[0],Oe[1],1],n);T.push.apply(T,(0,j.Z)(At).concat((0,j.Z)(At),(0,j.Z)(At),(0,j.Z)(At))),b.push.apply(b,(0,j.Z)([1,2,0,3,2,1].map(function(Ot){return Ot+lt})))},W=0;W<o;W++)F(W);return{positions:_,index:b,normals:T}}function O_(e,n,r){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=Xs.create(),c=Xs.create(),d=Xs.create();i&&(e=$t(e),n=$t(n),r=$t(r));var y=Xs.fromValues.apply(Xs,(0,j.Z)(e)),_=Xs.fromValues.apply(Xs,(0,j.Z)(n)),b=Xs.fromValues.apply(Xs,(0,j.Z)(r));Xs.sub(o,b,_),Xs.sub(c,y,_),Xs.cross(d,o,c);var T=Xs.create();return Xs.normalize(T,d),T}var ac,Xp;(function(e){e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn"})(Xp||(Xp={}));var Yp;(function(e){e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon"})(Yp||(Yp={}));function bd(e){for(var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=Math.PI*2/e,i=[],o=0;o<e;o++)i.push(r*o+n*Math.PI/12);var c=i.map(function(d){var y=Math.sin(d+Math.PI/4),_=Math.cos(d+Math.PI/4);return[y,_,0]});return c}function Am(){return bd(30)}function Mm(){return bd(4)}function Pm(){return bd(3)}function Im(){return bd(6,1)}function Om(){return bd(5)}var Nh=(ac={},(0,M.Z)(ac,Yp.CIRCLE,Am),(0,M.Z)(ac,Yp.HEXAGON,Im),(0,M.Z)(ac,Yp.TRIANGLE,Pm),(0,M.Z)(ac,Yp.SQUARE,Mm),(0,M.Z)(ac,Yp.PENTAGON,Om),(0,M.Z)(ac,Xp.CYLINDER,Am),(0,M.Z)(ac,Xp.HEXAGONCOLUMN,Im),(0,M.Z)(ac,Xp.TRIANGLECOLUMN,Pm),(0,M.Z)(ac,Xp.SQUARECOLUMN,Mm),(0,M.Z)(ac,Xp.PENTAGONCOLUMN,Om),ac),sv={};function km(e){var n=Bh(e.coordinates);return{vertices:[].concat((0,j.Z)(n),(0,j.Z)(n),(0,j.Z)(n),(0,j.Z)(n)),indices:[0,1,2,2,3,0],size:n.length}}function Lm(e){var n=e.shape,r=D_(n,!1),i=r.positions,o=r.index,c=r.normals;return{vertices:i,indices:o,normals:c,size:5}}function Rm(e){var n=Bh(e.coordinates);return{vertices:(0,j.Z)(n),indices:[0],size:n.length}}function k_(e){var n=e.coordinates,r=e.originCoordinates,i=e.version,o=new M_({dash:!0,join:"bevel"});if(i==="GAODE2.x"){var c=n;Array.isArray(c[0][0])||(c=[n]);var d=r;Array.isArray(d[0][0])||(d=[r]);for(var y=0;y<c.length;y++){var _=c[y],b=d[y];o.extrude_gaode2(_,b)}}else{var T=n;Array.isArray(T[0][0])||(T=[n]),T.forEach(function(O){o.extrude(O)})}var A=o.complex;return{vertices:A.positions,indices:A.indices,normals:A.normals,size:6}}function L_(e){var n=e.coordinates,r=pp().flatten(n),i=r.vertices,o=r.dimensions,c=r.holes;return{indices:pp()(i,c,o),vertices:i,size:o}}function Dm(e){var n=e.coordinates,r=Tm(n,!0),i=r.positions,o=r.index,c=r.normals;return{vertices:i,indices:o,normals:c,size:5}}function Fm(e){var n=e.shape,r=B_(n),i=r.positions,o=r.index;return{vertices:i,indices:o,size:3}}function Bm(e){var n=e.coordinates,r=[].concat((0,j.Z)(n[0]),[0,0,1,n[1][0],n[0][1],0,1,1],(0,j.Z)(n[1]),[0,1,0],(0,j.Z)(n[0]),[0,0,1],(0,j.Z)(n[1]),[0,1,0,n[0][0],n[1][1],0,0,0]),i=[0,1,2,3,4,5];return{vertices:r,indices:i,size:5}}function jv(e){for(var n=30,r=e.coordinates,i=[],o=[],c=function(_){i.push(_,1,_,r[0][0],r[0][1],r[1][0],r[1][1],_,-1,_,r[0][0],r[0][1],r[1][0],r[1][1]),_!==n-1&&o.push.apply(o,(0,j.Z)([0,1,2,1,3,2].map(function(b){return _*2+b})))},d=0;d<n;d++)c(d);return{vertices:i,indices:o,size:7}}function R_(e){var n=e.coordinates;n.length===2&&n.push(0);var r=e.size,i=uv(-1,1),o=uv(1,1),c=uv(-1,-1),d=uv(1,-1),y=[].concat((0,j.Z)(n),(0,j.Z)(i),(0,j.Z)(n),(0,j.Z)(c),(0,j.Z)(n),(0,j.Z)(d),(0,j.Z)(n),(0,j.Z)(o)),_=[0,1,2,3,0,2];return{vertices:y,indices:_,size:5}}function D_(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(sv&&sv[e])return sv[e];var r=Nh[e]?Nh[e]():Nh.cylinder(),i=Tm([r],n);return sv[e]=i,i}function XC(e,n){for(var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,o=new Float32Array(e.length/r*3),c,d,y,_=vec3.create(),b=vec3.create(),T=vec3.create(),A=0,O=n.length;A<O;A+=3){c=n[A+0]*3,d=n[A+1]*3,y=n[A+2]*3;var F=[e[c],e[c+1]],W=[e[d],e[d+1]],Q=[e[y],e[y+1]];i&&(F=lngLatToMeters(F),W=lngLatToMeters(W),Q=lngLatToMeters(Q));var ue=F,Oe=_slicedToArray(ue,2),rt=Oe[0],lt=Oe[1],At=vec3.fromValues(rt,lt,e[c+2]),Ot=W,Ut=_slicedToArray(Ot,2),Gt=Ut[0],gr=Ut[1],Nr=vec3.fromValues(Gt,gr,e[d+2]),Xr=Q,Er=_slicedToArray(Xr,2),on=Er[0],Ln=Er[1],Hn=vec3.fromValues(on,Ln,e[y+2]);vec3.sub(_,Hn,Nr),vec3.sub(b,At,Nr),vec3.cross(T,_,b),o[c]+=_[0],o[c+1]+=_[1],o[c+2]+=_[2],o[d]+=_[0],o[d+1]+=_[1],o[d+2]+=_[2],o[y]+=_[0],o[y+1]+=_[1],o[y+2]+=_[2]}return F_(o),o}function F_(e){for(var n=0,r=e.length;n<r;n+=3){var i=vec3.fromValues(e[n],e[n+1],e[n+2]),o=vec3.create();vec3.normalize(o,i),e.set(o,n)}}function YC(e){var n=e[0][0],r=e[0][e[0].length-1];return n[0]===r[0]&&n[1]===r[1]}function B_(e){var n=["cylinder","triangleColumn","hexagonColumn","squareColumn"],r=Nh[e]?Nh[e]():Nh.circle(),i=n.indexOf(e)===-1?I_([r]):P_([r]);return i}function uv(e,n){var r=(e+1)/2,i=(n+1)/2;return[r,i]}function N_(e){var n=z_();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function z_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z_=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,U_=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,j_=function(e){(0,Je.Z)(r,e);var n=N_(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c,y=o.baseColor,_=y===void 0?"rgb(16,16,16)":y,b=o.brightColor,T=b===void 0?"rgb(255,176,38)":b,A=o.windowColor,O=A===void 0?"rgb(30,60,89)":A,F=o.time,W=F===void 0?0:F;return{u_opacity:d,u_baseColor:Pn(_),u_brightColor:Pn(T),u_windowColor:Pn(O),u_time:this.layer.getLayerAnimateTime()||W}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:U_,fragmentShader:Z_,triangulation:Dm})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nt.Attribute,descriptor:{name:"a_Normal",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d,y,_,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.size,T=b===void 0?10:b;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nt.Attribute,descriptor:{name:"a_Uv",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(c,d,y,_){var b=c.size;return[y[3],y[4]]}}})}}]),r}(so);function V_(e){var n=G_();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function G_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H_=function(e){(0,Je.Z)(r,e);var n=V_(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","PolygonLayer"),i}return(0,Pe.Z)(r,[{key:"buildModels",value:function(){this.layerModel=new j_(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(o){this.updateLayerConfig({time:o})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),r}(Uf);function W_(e){var n=X_();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function X_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y_=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,q_=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,K_=function(e){(0,Je.Z)(r,e);var n=W_(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.coverage,y=o.angle;return{u_opacity:c||1,u_coverage:d||.9,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:Y_,fragmentShader:q_,triangulation:Fm,depth:{enable:!1},primitive:re.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Nt.Attribute,descriptor:{name:"a_Pos",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d){var y=c.version==="GAODE2.x"?c.originCoordinates:c.coordinates;return[y[0],y[1],0]}}})}}]),r}(so);function $_(e){var n=J_();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function J_(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Q_=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,e1=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,t1=function(e){(0,Je.Z)(r,e);var n=$_(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.coverage,y=o.angle;return{u_opacity:c||1,u_coverage:d||1,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:Q_,fragmentShader:e1,triangulation:Lm,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.size;return Array.isArray(b)?[b[0]]:[b]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nt.Attribute,descriptor:{name:"a_Normal",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d,y,_,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Nt.Attribute,descriptor:{name:"a_Pos",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d){var y=c.version==="GAODE2.x"?c.originCoordinates:c.coordinates;return[y[0],y[1],0]}}})}}]),r}(so);function r1(e,n){for(var r=[],i=[],o=[],c=e+1,d=n+1,y=e/2,_=n/2,b=0;b<d;b++)for(var T=b-_,A=0;A<c;A++){var O=A-y;i.push(O/y,-T/_,0),o.push(A/e),o.push(1-b/n)}for(var F=0;F<n;F++)for(var W=0;W<e;W++){var Q=W+c*F,ue=W+c*(F+1),Oe=W+1+c*(F+1),rt=W+1+c*F;r.push(Q,ue,rt),r.push(ue,Oe,rt)}return{vertices:i,indices:r,uvs:o}}var Nm,zm;function Zm(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Um(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Zm(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zm(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function n1(e){var n=i1();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function i1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a1=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,o1=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,s1=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,u1=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,l1=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,c1=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,jm=(Nm=(0,ie.b2)(),Nm(zm=function(e){(0,Je.Z)(r,e);var n=n1(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"colorTexture",void 0),(0,M.Z)((0,H.Z)(i),"heatmapFramerBuffer",void 0),(0,M.Z)((0,H.Z)(i),"intensityModel",void 0),(0,M.Z)((0,H.Z)(i),"colorModel",void 0),(0,M.Z)((0,H.Z)(i),"shapeType",void 0),i}return(0,Pe.Z)(r,[{key:"render",value:function(){var o=this,c=this.rendererService,d=c.clear,y=c.useFramebuffer;y(this.heatmapFramerBuffer,function(){d({color:[0,0,0,0],depth:1,stencil:0,framebuffer:o.heatmapFramerBuffer}),o.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var o,c=this.rendererService,d=c.createFramebuffer,y=c.clear,_=c.getViewportSize,b=c.createTexture2D,T=c.useFramebuffer,A=this.styleAttributeService.getLayerStyleAttribute("shape"),O=(A==null||(o=A.scale)===null||o===void 0?void 0:o.field)||"heatmap";this.shapeType=O,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=O==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var F=this.layer.getLayerConfig(),W=F.rampColors,Q=vi(W),ue=_(),Oe=ue.width,rt=ue.height;return this.heatmapFramerBuffer=d({color:b({width:Math.floor(Oe/4),height:Math.floor(rt/4),wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE,min:re.LINEAR,mag:re.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Nt.Attribute,descriptor:{name:"a_Dir",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(c,d,y,_){return[y[3],y[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.size,T=b===void 0?1:b;return[T]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:l1,fragmentShader:u1,triangulation:R_,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:re.ONE,srcAlpha:1,dstRGB:re.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:c1,fs:s1});var o=this.shaderModuleService.getModule("heatmapColor"),c=o.vs,d=o.fs,y=o.uniforms,_=this.rendererService,b=_.createAttribute,T=_.createElements,A=_.createBuffer,O=_.createModel;return O({vs:c,fs:d,attributes:{a_Position:b({buffer:A({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:re.FLOAT}),size:3}),a_Uv:b({buffer:A({data:[0,1,1,1,0,0,1,0],type:re.FLOAT}),size:2})},uniforms:Um({},y),depth:{enable:!1},blend:this.getBlend(),count:6,elements:T({data:[0,2,1,2,3,1],type:re.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.intensity,y=d===void 0?10:d,_=o.radius,b=_===void 0?5:_;this.intensityModel.draw({uniforms:{u_opacity:c||1,u_radius:b,u_intensity:y}})}},{key:"drawColorMode",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity;this.colorModel.draw({uniforms:{u_opacity:c||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=gu();qi(d,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:c||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,j.Z)(d)}})}},{key:"build3dHeatMap",value:function(){var o=this.rendererService.getViewportSize,c=o(),d=c.width,y=c.height,_=r1(d/4,y/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:o1,fs:a1});var b=this.shaderModuleService.getModule("heatmap3dColor"),T=b.vs,A=b.fs,O=b.uniforms,F=this.rendererService,W=F.createAttribute,Q=F.createElements,ue=F.createBuffer,Oe=F.createModel;return Oe({vs:T,fs:A,attributes:{a_Position:W({buffer:ue({data:_.vertices,type:re.FLOAT}),size:3}),a_Uv:W({buffer:ue({data:_.uvs,type:re.FLOAT}),size:2})},primitive:re.TRIANGLES,uniforms:Um({},O),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:re.SRC_ALPHA,srcAlpha:1,dstRGB:re.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:Q({data:_.indices,type:re.UNSIGNED_INT,count:_.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var o=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var c=this.layer.getLayerConfig(),d=c.rampColors,y=vi(d);this.colorTexture=o({data:new Uint8Array(y.data),width:y.width,height:y.height,wrapS:re.CLAMP_TO_EDGE,wrapT:re.CLAMP_TO_EDGE,min:re.NEAREST,mag:re.NEAREST,flipY:!1})}}]),r}(so))||zm);function f1(e){var n=p1();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function p1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var h1=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,d1=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,v1=function(e){(0,Je.Z)(r,e);var n=f1(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.coverage,y=o.angle;return{u_opacity:c||1,u_coverage:d||.9,u_angle:y||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:d1,fragmentShader:h1,triangulation:Fm,depth:{enable:!1},primitive:re.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Nt.Attribute,descriptor:{name:"a_Pos",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d){var y=c.version==="GAODE2.x"?c.originCoordinates:c.coordinates;return[y[0],y[1],0]}}})}}]),r}(so),m1={heatmap:jm,heatmap3d:jm,grid:K_,grid3d:t1,hexagon:v1},y1=m1;function g1(e){var n=_1();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function _1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var x1=function(e){(0,Je.Z)(r,e);var n=g1(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","HeatMapLayer"),i}return(0,Pe.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new y1[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var o=this,c=this.getModelType();return c==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(d){return d.draw({uniforms:o.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,c=this.styleAttributeService.getLayerStyleAttribute("shape"),d=this.getLayerConfig(),y=d.shape3d,_=this.getSource(),b=_.data.type,T=(c==null||(o=c.scale)===null||o===void 0?void 0:o.field)||"heatmap";return T==="heatmap"||T==="heatmap3d"?"heatmap":b==="hexagon"?(y==null?void 0:y.indexOf(T))===-1?"hexagon":"grid3d":b==="grid"?(y==null?void 0:y.indexOf(T))===-1?"grid":"grid3d":"heatmap"}}]),r}(Uf);function b1(e){var n=w1();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function w1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var S1=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,E1=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,C1=function(e){(0,Je.Z)(r,e);var n=b1(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),i}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity;return{u_opacity:c||1,u_texture:this.texture}}},{key:"initModels",value:function(){var o=this,c=this.layer.getSource(),d=this.rendererService.createTexture2D;return this.texture=d({height:0,width:0}),c.data.images.then(function(y){o.texture=d({data:y[0],width:y[0].width,height:y[0].height}),o.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:E1,fragmentShader:S1,triangulation:Bm,primitive:re.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nt.Attribute,descriptor:{name:"a_Uv",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(c,d,y,_){return[y[3],y[4]]}}})}}]),r}(so),T1={image:C1},A1=T1;function M1(e){var n=P1();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function P1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var I1=function(e){(0,Je.Z)(r,e);var n=M1(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","ImageLayer"),i}return(0,Pe.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new A1[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),c={image:{}};return c[o]}},{key:"getModelType",value:function(){return"image"}}]),r}(Uf);function O1(e){var n=k1();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function k1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // gl_FragColor = v_color;
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, v_distance_ratio);
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = 1.0 - fract(arcRadio * count + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);

}`,R1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;
  

  vec2 source = a_Instance.rg;
  vec2 target =  a_Instance.ba;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  if(u_line_type == LineTypeDash) {
      v_distance_ratio = segmentIndex / segmentNumber;
      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        v_distance_ratio = 1.0 - v_distance_ratio;
      }
  }

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));

  v_segmentIndex = a_Position.x + 1.0;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // v_arcDistrance *= 8.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;
    v_pixelLen = project_pixel(u_icon_step);
    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,D1={solid:0,dash:1},F1=function(e){(0,Je.Z)(r,e);var n=O1(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:re.NEAREST,min:re.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.sourceColor,y=o.targetColor,_=o.textureBlend,b=_===void 0?"normal":_,T=o.lineType,A=T===void 0?"solid":T,O=o.dashArray,F=O===void 0?[10,5]:O,W=o.forward,Q=W===void 0?!0:W,ue=o.lineTexture,Oe=ue===void 0?!1:ue,rt=o.iconStep,lt=rt===void 0?100:rt;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:c})){this.judgeStyleAttributes({opacity:c});var At=this.layer.getEncodedData(),Ot=this.calDataFrame(this.cellLength,At,this.cellProperties),Ut=Ot.data,Gt=Ot.width,gr=Ot.height;this.rowCount=gr,this.dataTexture=this.cellLength>0&&Ut.length>0?this.createTexture2D({flipY:!0,data:Ut,format:re.LUMINANCE,type:re.FLOAT,width:Gt,height:gr}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}F.length===2&&F.push(0,0);var Nr=0,Xr=[0,0,0,0],Er=[0,0,0,0];return d&&y&&(Xr=Pn(d),Er=Pn(y),Nr=1),this.rendererService.getDirty()&&this.texture.bind(),{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(c)?c:1,u_textureBlend:b==="normal"?0:1,segmentNumber:30,u_line_type:D1[A||"solid"],u_dash_array:F,u_blur:.9,u_lineDir:Q?1:-1,u_texture:this.texture,u_line_texture:Oe?1:0,u_icon_step:lt,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Nr,u_sourceColor:Xr,u_targetColor:Er}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),c=o.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,c;(o=this.texture)===null||o===void 0||o.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:R1,fragmentShader:L1,triangulation:jv,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.size,A=T===void 0?1:T;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Nt.Attribute,descriptor:{name:"a_Instance",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:4,update:function(d,y,_,b){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nt.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(d,y,_,b){var T=o.iconService.getIconMap(),A=d.texture,O=T[A]||{x:0,y:0},F=O.x,W=O.y;return[F,W]}}})}}]),r}(so);function B1(e){var n=N1();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function N1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var z1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,Z1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;
varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying float v_a;
varying vec2 v_offset;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

   if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    v_arcDistrance = length(source - target);
    v_pixelLen = project_pixel(u_icon_step);

    vec2 projectOffset = project_pixel(offset);
    v_offset = projectOffset + projectOffset * sign(a_Position.y);
    v_a = project_pixel(a_Size);
    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,U1={solid:0,dash:1},j1=function(e){(0,Je.Z)(r,e);var n=B1(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:re.NEAREST,min:re.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.sourceColor,y=o.targetColor,_=o.textureBlend,b=_===void 0?"normal":_,T=o.lineType,A=T===void 0?"solid":T,O=o.dashArray,F=O===void 0?[10,5]:O,W=o.lineTexture,Q=W===void 0?!1:W,ue=o.iconStep,Oe=ue===void 0?100:ue;F.length===2&&F.push(0,0);var rt=0,lt=[0,0,0,0],At=[0,0,0,0];if(d&&y&&(lt=Pn(d),At=Pn(y),rt=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:c})){this.judgeStyleAttributes({opacity:c});var Ot=this.layer.getEncodedData(),Ut=this.calDataFrame(this.cellLength,Ot,this.cellProperties),Gt=Ut.data,gr=Ut.width,Nr=Ut.height;this.rowCount=Nr,this.dataTexture=this.cellLength>0&&Gt.length>0?this.createTexture2D({flipY:!0,data:Gt,format:re.LUMINANCE,type:re.FLOAT,width:gr,height:Nr}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(c)?c:1,u_textureBlend:b==="normal"?0:1,segmentNumber:30,u_line_type:U1[A]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:Q?1:0,u_icon_step:Oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:rt,u_sourceColor:lt,u_targetColor:At}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),c=o.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,c;(o=this.texture)===null||o===void 0||o.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:Z1,fragmentShader:z1,triangulation:jv,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.size,A=T===void 0?1:T;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Nt.Attribute,descriptor:{name:"a_Instance",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:4,update:function(d,y,_,b){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nt.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(d,y,_,b){var T=o.iconService.getIconMap(),A=d.texture,O=T[A]||{x:0,y:0},F=O.x,W=O.y;return[F,W]}}})}}]),r}(so);function V1(e){var n=G1();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function G1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var H1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  // gl_FragColor = v_color;
  
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F
    float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = floor(v_arcDistrance/v_pixelLen);
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = length(v_offset)/(v_a); // \u6A2A\u5411

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,W1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;
varying float v_arcDistrance;
varying float v_pixelLen;
varying vec2 v_offset;
varying float v_a;

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // v_arcDistrance = length(source - target);
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    v_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      v_arcDistrance = v_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
    //   v_arcDistrance *= 10.0;
      v_arcDistrance = project_pixel_allmap(v_arcDistrance);
    }
    v_pixelLen = project_pixel(u_icon_step)/8.0;

    v_a = project_pixel(a_Size);
    v_offset = offset + offset * sign(a_Position.y);
    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,X1={solid:0,dash:1},Y1=function(e){(0,Je.Z)(r,e);var n=V1(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:re.NEAREST,min:re.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.sourceColor,y=o.targetColor,_=o.textureBlend,b=_===void 0?"normal":_,T=o.lineType,A=T===void 0?"solid":T,O=o.dashArray,F=O===void 0?[10,5]:O,W=o.lineTexture,Q=W===void 0?!1:W,ue=o.iconStep,Oe=ue===void 0?100:ue;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var rt=0,lt=[0,0,0,0],At=[0,0,0,0];if(d&&y&&(lt=Pn(d),At=Pn(y),rt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:c})){this.judgeStyleAttributes({opacity:c});var Ot=this.layer.getEncodedData(),Ut=this.calDataFrame(this.cellLength,Ot,this.cellProperties),Gt=Ut.data,gr=Ut.width,Nr=Ut.height;this.rowCount=Nr,this.dataTexture=this.cellLength>0&&Gt.length>0?this.createTexture2D({flipY:!0,data:Gt,format:re.LUMINANCE,type:re.FLOAT,width:gr,height:Nr}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(c)?c:1,u_textureBlend:b==="normal"?0:1,segmentNumber:30,u_line_type:X1[A]||0,u_dash_array:F,u_texture:this.texture,u_line_texture:Q?1:0,u_icon_step:Oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:rt,u_sourceColor:lt,u_targetColor:At}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),c=o.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,c;(o=this.texture)===null||o===void 0||o.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:W1,fragmentShader:H1,triangulation:jv,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.size,A=T===void 0?1:T;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Nt.Attribute,descriptor:{name:"a_Instance",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:4,update:function(d,y,_,b){return[_[3],_[4],_[5],_[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nt.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(d,y,_,b){var T=o.iconService.getIconMap(),A=d.texture,O=T[A]||{x:0,y:0},F=O.x,W=O.y;return[F,W]}}})}}]),r}(so);function q1(e){var n=K1();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function K1(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var $1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying float v_distance_ratio;
varying vec4 v_dash_array;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  
  // gl_FragColor = v_color;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
    // gl_FragColor.a *=(1.0- step(v_dash_array.x, mod(v_distance_ratio, dashLength)));
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float u = fract(mod(v_distance, v_pixelLen)/v_pixelLen - animateSpeed);
    float v = length(v_offset)/(v_a*2.0);
    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // float v = length(v_offset)/(v_a*2.0);
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,J1=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;
varying float v_distance_ratio;
varying float v_side;

varying float v_distance;
varying vec2 v_offset;
varying float v_size;
varying float v_a;
varying float v_pixelLen;
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_iconMapUV = a_iconMapUV;
  v_distance = a_Distance;
  v_pixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    v_pixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = a_Distance / a_Total_Distance;
    // v_distance_ratio = 0.01;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      v_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;
  v_a = project_pixel(a_Size.x);
  

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  v_offset = offset + offset * sign(a_Miter);

  v_side = a_Miter * a_Size.x;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Q1={solid:0,dash:1},Vm=function(e){(0,Je.Z)(r,e);var n=q1(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:re.NEAREST,min:re.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.sourceColor,y=o.targetColor,_=o.textureBlend,b=_===void 0?"normal":_,T=o.lineType,A=T===void 0?"solid":T,O=o.dashArray,F=O===void 0?[10,5,0,0]:O,W=o.lineTexture,Q=W===void 0?!1:W,ue=o.iconStep,Oe=ue===void 0?100:ue;F.length===2&&F.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var rt=0,lt=[0,0,0,0],At=[0,0,0,0];if(d&&y&&(lt=Pn(d),At=Pn(y),rt=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:c})){this.judgeStyleAttributes({opacity:c});var Ot=this.layer.getEncodedData(),Ut=this.calDataFrame(this.cellLength,Ot,this.cellProperties),Gt=Ut.data,gr=Ut.width,Nr=Ut.height;this.rowCount=Nr,this.dataTexture=this.cellLength>0&&Gt.length>0?this.createTexture2D({flipY:!0,data:Gt,format:re.LUMINANCE,type:re.FLOAT,width:gr,height:Nr}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(c)?c:1,u_textureBlend:b==="normal"?0:1,u_line_type:Q1[A],u_dash_array:F,u_texture:this.texture,u_line_texture:Q?1:0,u_icon_step:Oe,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:rt,u_sourceColor:lt,u_targetColor:At}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),c=o.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,c;(o=this.texture)===null||o===void 0||o.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:J1,fragmentShader:$1,triangulation:k_,primitive:re.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var o=this,c=this.layer.getLayerConfig(),d=c.lineType,y=d===void 0?"solid":d;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Nt.Attribute,descriptor:{name:"a_Distance",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(b,T,A,O){return[A[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Nt.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(b,T,A,O){return[A[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(b,T,A,O){var F=b.size,W=F===void 0?1:F;return Array.isArray(W)?[W[0],W[1]]:[W,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nt.Attribute,descriptor:{name:"a_Normal",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(b,T,A,O,F){return F}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Nt.Attribute,descriptor:{name:"a_Miter",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(b,T,A,O){return[A[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nt.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(b,T,A,O){var F=o.iconService.getIconMap(),W=b.texture,Q=F[W]||{x:0,y:0},ue=Q.x,Oe=Q.y;return[ue,Oe]}}})}},{key:"loadImage",value:function(o){return new Promise(function(c,d){if(o instanceof HTMLImageElement){c(o);return}var y=new Image;y.crossOrigin="anonymous",y.onload=function(){c(y)},y.onerror=function(){d(new Error("Could not load image at "+o))},y.src=o instanceof File?URL.createObjectURL(o):o})}}]),r}(so),ex={arc:F1,arc3d:j1,greatcircle:Y1,line:Vm},tx=ex;function rx(e){var n=nx();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function nx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ix=function(e){(0,Je.Z)(r,e);var n=rx(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","LineLayer"),i}return(0,Pe.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new tx[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),c={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return c[o]}},{key:"getModelType",value:function(){var o,c=this.styleAttributeService.getLayerStyleAttribute("shape"),d=c==null||(o=c.scale)===null||o===void 0?void 0:o.field;return d||"line"}}]),r}(Uf);function ax(e){var n=ox();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function ox(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sx=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ux=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  setPickingColor(a_PickingColor);
}
`,Gm=function(e){(0,Je.Z)(r,e);var n=ax(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var y=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,y,this.cellProperties),b=_.data,T=_.width,A=_.height;this.rowCount=A,this.dataTexture=this.cellLength>0&&b.length>0?this.createTexture2D({flipY:!0,data:b,format:re.LUMINANCE,type:re.FLOAT,width:T,height:A}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(d)?d:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:ux,fragmentShader:sx,triangulation:Lm,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d,y,_){var b=c.size;if(b){var T=[];return Array.isArray(b)&&(T=b.length===2?[b[0],b[0],b[1]]:b),Array.isArray(b)||(T=[b]),T}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nt.Attribute,descriptor:{name:"a_Normal",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d,y,_,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Nt.Attribute,descriptor:{name:"a_Pos",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d){var y=Bh(c.coordinates);return[y[0],y[1],0]}}})}}]),r}(so);function lx(e){var n=cx();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function cx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fx=`#define Animate 0.0

uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  
  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

}
`,px=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec2 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec2 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  v_data = vec4(extrude, antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,Hm=function(e){(0,Je.Z)(r,e);var n=lx(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c,y=o.strokeOpacity,_=y===void 0?1:y,b=o.strokeWidth,T=b===void 0?0:b,A=o.stroke,O=A===void 0?"rgba(0,0,0,0)":A,F=o.offsets,W=F===void 0?[0,0]:F;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,strokeOpacity:_,strokeWidth:T,stroke:O,offsets:W})){this.judgeStyleAttributes({opacity:d,strokeOpacity:_,strokeWidth:T,stroke:O,offsets:W});var Q=this.layer.getEncodedData(),ue=this.calDataFrame(this.cellLength,Q,this.cellProperties),Oe=ue.data,rt=ue.width,lt=ue.height;this.rowCount=lt,this.dataTexture=this.cellLength>0&&Oe.length>0?this.createTexture2D({flipY:!0,data:Oe,format:re.LUMINANCE,type:re.FLOAT,width:rt,height:lt}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(d)?d:1,u_stroke_opacity:Ui()(_)?_:1,u_stroke_width:Ui()(T)?T:0,u_stroke_color:this.getStrokeColor(O),u_offsets:this.isOffsetStatic(W)?W:[0,0]}}},{key:"getAnimateUniforms",value:function(){var o=this.layer.getLayerConfig(),c=o.animateOption;return{u_aimate:this.animateOption2Array(c),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),km)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:px,fragmentShader:fx,triangulation:km,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"animateOption2Array",value:function(o){return[o.enable?0:1,o.speed||1,o.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Nt.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(d,y,_,b){var T=[1,1,-1,1,-1,-1,1,-1],A=b%4*2;return[T[A],T[A+1]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.size,A=T===void 0?5:T;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Nt.Attribute,descriptor:{name:"a_Shape",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.shape,A=T===void 0?2:T,O=o.layer.getLayerConfig().shape2d,F=O.indexOf(A);return[F]}}})}}]),r}(so);function hx(e){var n=dx();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function dx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vx=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,mx=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,yx=function(e){(0,Je.Z)(r,e);var n=hx(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),i}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity;return{u_opacity:c||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var o=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){o.updateTexture(),o.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:mx,fragmentShader:vx,triangulation:Rm,primitive:re.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.size;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nt.Attribute,descriptor:{name:"a_Uv",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(d,y,_,b){var T=o.fontService.mapping,A=d.shape,O=o.fontService.getGlyph(A),F=T[O],W=F.x,Q=F.y;return[W,Q]}}})}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,c=this.fontService.canvas;this.texture=o({data:c,mag:re.LINEAR,min:re.LINEAR,width:c.width,height:c.height})}},{key:"initIconFontGlyphs",value:function(){var o=this,c=this.layer.getLayerConfig(),d=c.fontWeight,y=d===void 0?"normal":d,_=c.fontFamily,b=_===void 0?"sans-serif":_,T=this.layer.getEncodedData(),A=[];T.forEach(function(O){var F=O.shape,W=F===void 0?"":F;W=W.toString();var Q=o.fontService.getGlyph(W);A.indexOf(Q)===-1&&A.push(Q)}),this.fontService.setFontOptions({characterSet:A,fontWeight:y,fontFamily:b,fontSize:48})}}]),r}(so);function gx(e){var n=_x();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function _x(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xx=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying float v_size;
#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,bx=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;
varying float v_size;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   v_size = a_Size;
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Wm=function(e){(0,Je.Z)(r,e);var n=gx(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"updateTexture",function(){var y=i.rendererService.createTexture2D;if(i.texture){i.texture.update({data:i.iconService.getCanvas()}),i.layer.render();return}i.texture=y({data:i.iconService.getCanvas(),mag:re.NEAREST,min:re.NEAREST,premultiplyAlpha:!1,width:1024,height:i.iconService.canvasHeight||128})}),i}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=o.offsets,y=d===void 0?[0,0]:d;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:c,offsets:y})){this.judgeStyleAttributes({opacity:c,offsets:y});var _=this.layer.getEncodedData(),b=this.calDataFrame(this.cellLength,_,this.cellProperties),T=b.data,A=b.width,O=b.height;this.rowCount=O,this.dataTexture=this.cellLength>0&&T.length>0?this.createTexture2D({flipY:!0,data:T,format:re.LUMINANCE,type:re.FLOAT,width:A,height:O}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Ui()(c)?c:1,u_offsets:this.isOffsetStatic(y)?y:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var o,c;(o=this.texture)===null||o===void 0||o.destroy(),(c=this.dataTexture)===null||c===void 0||c.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:bx,fragmentShader:xx,triangulation:Rm,primitive:re.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var o=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(d,y,_,b){var T=d.size,A=T===void 0?5:T;return Array.isArray(A)?[A[0]]:[A]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nt.Attribute,descriptor:{name:"a_Uv",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(d,y,_,b){var T=o.iconService.getIconMap(),A=d.shape,O=T[A]||{x:0,y:0},F=O.x,W=O.y;return[F,W]}}})}}]),r}(so);function wx(e){var n=Sx();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Sx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Ex=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Cx=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;



uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Tx(e){var n=e.coordinates;return{vertices:(0,j.Z)(n),indices:[0],size:n.length}}var Xm=function(e){(0,Je.Z)(r,e);var n=wx(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c,y=o.offsets,_=y===void 0?[0,0]:y;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,offsets:_})){this.judgeStyleAttributes({opacity:d,offsets:_});var b=this.layer.getEncodedData(),T=this.calDataFrame(this.cellLength,b,this.cellProperties),A=T.data,O=T.width,F=T.height;this.rowCount=F,this.dataTexture=this.cellLength>0&&A.length>0?this.createTexture2D({flipY:!0,data:A,format:re.LUMINANCE,type:re.FLOAT,width:O,height:F}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(d)?d:1,u_offsets:this.isOffsetStatic(_)?_:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:Cx,fragmentShader:Ex,triangulation:Tx,depth:{enable:!1},primitive:re.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.size,T=b===void 0?1:b;return Array.isArray(T)?[T[0]]:[T]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:xt.additive}}}]),r}(so);function Ax(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Mx(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function Mx(e,n){if(!!e){if(typeof e=="string")return Ym(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ym(e,n)}}function Ym(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Px=function(){function e(n,r,i){(0,be.Z)(this,e),(0,M.Z)(this,"boxCells",[]),(0,M.Z)(this,"xCellCount",void 0),(0,M.Z)(this,"yCellCount",void 0),(0,M.Z)(this,"boxKeys",void 0),(0,M.Z)(this,"bboxes",void 0),(0,M.Z)(this,"width",void 0),(0,M.Z)(this,"height",void 0),(0,M.Z)(this,"xScale",void 0),(0,M.Z)(this,"yScale",void 0),(0,M.Z)(this,"boxUid",void 0);var o=this.boxCells;this.xCellCount=Math.ceil(n/i),this.yCellCount=Math.ceil(r/i);for(var c=0;c<this.xCellCount*this.yCellCount;c++)o.push([]);this.boxKeys=[],this.bboxes=[],this.width=n,this.height=r,this.xScale=this.xCellCount/n,this.yScale=this.yCellCount/r,this.boxUid=0}return(0,Pe.Z)(e,[{key:"insert",value:function(r,i,o,c,d){this.forEachCell(i,o,c,d,this.insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(i),this.bboxes.push(o),this.bboxes.push(c),this.bboxes.push(d)}},{key:"query",value:function(r,i,o,c,d){return this.queryHitTest(r,i,o,c,!1,d)}},{key:"hitTest",value:function(r,i,o,c,d){return this.queryHitTest(r,i,o,c,!0,d)}},{key:"insertBoxCell",value:function(r,i,o,c,d,y){this.boxCells[d].push(y)}},{key:"queryHitTest",value:function(r,i,o,c,d,y){if(o<0||r>this.width||c<0||i>this.height)return d?!1:[];var _=[];if(r<=0&&i<=0&&this.width<=o&&this.height<=c){if(d)return!0;for(var b=0;b<this.boxKeys.length;b++)_.push({key:this.boxKeys[b],x1:this.bboxes[b*4],y1:this.bboxes[b*4+1],x2:this.bboxes[b*4+2],y2:this.bboxes[b*4+3]});return y?_.filter(y):_}var T={hitTest:d,seenUids:{box:{},circle:{}}};return this.forEachCell(r,i,o,c,this.queryCell,_,T,y),d?_.length>0:_}},{key:"queryCell",value:function(r,i,o,c,d,y,_,b){var T=_.seenUids,A=this.boxCells[d];if(A!==null){var O=this.bboxes,F=Ax(A),W;try{for(F.s();!(W=F.n()).done;){var Q=W.value;if(!T.box[Q]){T.box[Q]=!0;var ue=Q*4;if(r<=O[ue+2]&&i<=O[ue+3]&&o>=O[ue+0]&&c>=O[ue+1]&&(!b||b(this.boxKeys[Q]))){if(_.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[Q],x1:O[ue],y1:O[ue+1],x2:O[ue+2],y2:O[ue+3]})}}}}catch(Oe){F.e(Oe)}finally{F.f()}}return!1}},{key:"forEachCell",value:function(r,i,o,c,d,y,_,b){for(var T=this.convertToXCellCoord(r),A=this.convertToYCellCoord(i),O=this.convertToXCellCoord(o),F=this.convertToYCellCoord(c),W=T;W<=O;W++)for(var Q=A;Q<=F;Q++){var ue=this.xCellCount*Q+W;if(d.call(this,r,i,o,c,ue,y,_,b))return}}},{key:"convertToXCellCoord",value:function(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}},{key:"convertToYCellCoord",value:function(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}}]),e}(),Ix=Px,Ox=function(){function e(n,r){(0,be.Z)(this,e),(0,M.Z)(this,"width",void 0),(0,M.Z)(this,"height",void 0),(0,M.Z)(this,"grid",void 0),(0,M.Z)(this,"viewportPadding",100),(0,M.Z)(this,"screenRightBoundary",void 0),(0,M.Z)(this,"screenBottomBoundary",void 0),(0,M.Z)(this,"gridRightBoundary",void 0),(0,M.Z)(this,"gridBottomBoundary",void 0),this.width=n,this.height=r,this.viewportPadding=Math.max(n,r),this.grid=new Ix(n+this.viewportPadding,r+this.viewportPadding,25),this.screenRightBoundary=n+this.viewportPadding,this.screenBottomBoundary=r+this.viewportPadding,this.gridRightBoundary=n+2*this.viewportPadding,this.gridBottomBoundary=r+2*this.viewportPadding}return(0,Pe.Z)(e,[{key:"placeCollisionBox",value:function(r){var i=r.x1+r.anchorPointX+this.viewportPadding,o=r.y1+r.anchorPointY+this.viewportPadding,c=r.x2+r.anchorPointX+this.viewportPadding,d=r.y2+r.anchorPointY+this.viewportPadding;return!this.isInsideGrid(i,o,c,d)||this.grid.hitTest(i,o,c,d)?{box:[]}:{box:[i,o,c,d]}}},{key:"insertCollisionBox",value:function(r,i){var o={featureIndex:i};this.grid.insert(o,r[0],r[1],r[2],r[3])}},{key:"project",value:function(r,i,o){var c=Vu(i,o,0,1),d=Gl(),y=Wf.apply(Me,(0,j.Z)(r));return gl(d,c,y),{x:(d[0]/d[3]+1)/2*this.width+this.viewportPadding,y:(-d[1]/d[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(r,i,o,c){return o>=0&&r<this.gridRightBoundary&&c>=0&&i<this.gridBottomBoundary}}]),e}();function qm(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=kx(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function kx(e,n){if(!!e){if(typeof e=="string")return Km(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Km(e,n)}}function Km(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function $m(e){var n=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":n=1;break;case"left":case"top-left":case"bottom-left":n=0;break;default:n=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0;break;default:r=.5}return{horizontalAlign:n,verticalAlign:r}}function Jm(e,n,r,i,o){if(!!o){var c=e[i],d=c.glyph;if(d)for(var y=n[d].advance*c.scale,_=(e[i].x+y)*o,b=r;b<=i;b++)e[b].x-=_}}function Qm(e,n,r,i,o,c,d){var y=(n-r)*o,_=(-i*d+.5)*c,b=qm(e),T;try{for(b.s();!(T=b.n()).done;){var A=T.value;A.x+=y,A.y+=_}}catch(O){b.e(O)}finally{b.f()}}function Lx(e,n,r,i,o,c,d){var y=-8,_=0,b=y,T=0,A=e.positionedGlyphs,O=c==="right"?1:c==="left"?0:.5,F=A.length;r.forEach(function(rt){if(rt.split("").forEach(function(At){var Ot=n[At],Ut=0;Ot&&(A.push({glyph:At,x:_,y:b+Ut,vertical:!1,scale:1,metrics:Ot}),_+=Ot.advance+d)}),A.length!==F){var lt=_-d;T=Math.max(lt,T),Jm(A,n,F,A.length-1,O)}_=0,b+=i});var W=$m(o),Q=W.horizontalAlign,ue=W.verticalAlign;Qm(A,O,Q,ue,T,i,r.length);var Oe=b-y;e.top+=-ue*Oe,e.bottom=e.top+Oe,e.left+=-Q*T,e.right=e.left+T}function Rx(e,n,r,i,o,c,d){var y=-8,_=0,b=y,T=0,A=e.positionedGlyphs,O=c==="right"?1:c==="left"?0:.5,F=A.length;r.forEach(function(rt){var lt=n[rt],At=0;if(lt&&(A.push({glyph:rt,x:_,y:b+At,vertical:!1,scale:1,metrics:lt}),_+=lt.advance+d),A.length!==F){var Ot=_-d;T=Math.max(Ot,T),Jm(A,n,F,A.length-1,O)}_=0,b+=i});var W=$m(o),Q=W.horizontalAlign,ue=W.verticalAlign;Qm(A,O,Q,ue,T,i,r.length);var Oe=b-y;e.top+=-ue*Oe,e.bottom=e.top+Oe,e.left+=-Q*T,e.right=e.left+T}function Dx(e,n,r,i,o,c){var d=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],y=arguments.length>7?arguments[7]:void 0,_=e.split(`
`),b=[],T={positionedGlyphs:b,top:d[1],bottom:d[1],left:d[0],right:d[0],lineCount:_.length,text:e};return y?Rx(T,n,_,r,i,o,c):Lx(T,n,_,r,i,o,c),b.length?T:!1}function Fx(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=e.positionedGlyphs,o=i===void 0?[]:i,c=[],d=qm(o),y;try{for(d.s();!(y=d.n()).done;){var _=y.value,b=_.metrics,T=4,A=b.advance*_.scale/2,O=r?[_.x+A,_.y]:[0,0],F=r?[0,0]:[_.x+A+n[0],_.y+n[1]],W=(0-T)*_.scale-A+F[0],Q=(0-T)*_.scale+F[1],ue=W+b.width*_.scale,Oe=Q+b.height*_.scale,rt={x:W,y:Q},lt={x:ue,y:Q},At={x:W,y:Oe},Ot={x:ue,y:Oe};c.push({tl:rt,tr:lt,bl:At,br:Ot,tex:b,glyphOffset:O})}}catch(Ut){d.e(Ut)}finally{d.f()}return c}function Bx(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Nx(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function Nx(e,n){if(!!e){if(typeof e=="string")return ey(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return ey(e,n)}}function ey(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function zx(e){var n=Zx();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Zx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ty=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,ry=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function ny(e){var n=this,r=e.id,i=[],o=[];if(!n.glyphInfoMap||!n.glyphInfoMap[r])return{vertices:[],indices:[],size:7};var c=n.glyphInfoMap[r].centroid,d=c.length===2?[c[0],c[1],0]:c;return n.glyphInfoMap[r].glyphQuads.forEach(function(y,_){i.push.apply(i,(0,j.Z)(d).concat([y.tex.x,y.tex.y+y.tex.height,y.tl.x,y.tl.y],(0,j.Z)(d),[y.tex.x+y.tex.width,y.tex.y+y.tex.height,y.tr.x,y.tr.y],(0,j.Z)(d),[y.tex.x+y.tex.width,y.tex.y,y.br.x,y.br.y],(0,j.Z)(d),[y.tex.x,y.tex.y,y.bl.x,y.bl.y])),o.push(0+_*4,1+_*4,2+_*4,2+_*4,3+_*4,0+_*4)}),{vertices:i,indices:o,size:7}}var iy=function(e){(0,Je.Z)(r,e);var n=zx(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"glyphInfo",void 0),(0,M.Z)((0,H.Z)(i),"glyphInfoMap",{}),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"currentZoom",-1),(0,M.Z)((0,H.Z)(i),"extent",void 0),(0,M.Z)((0,H.Z)(i),"textureHeight",0),(0,M.Z)((0,H.Z)(i),"textCount",0),(0,M.Z)((0,H.Z)(i),"preTextStyle",{}),(0,M.Z)((0,H.Z)(i),"buildModels",function(){return i.initGlyph(),i.updateTexture(),i.filterGlyphs(),i.reBuildModel(),[i.layer.buildLayerModel({moduleName:"pointText",vertexShader:ry,fragmentShader:ty,triangulation:ny.bind((0,H.Z)(i)),depth:{enable:!1},blend:i.getBlend()})]}),i}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c,y=o.stroke,_=y===void 0?"#fff":y,b=o.strokeWidth,T=b===void 0?0:b,A=o.textAnchor,O=A===void 0?"center":A,F=o.textAllowOverlap,W=F===void 0?!1:F,Q=o.halo,ue=Q===void 0?.5:Q,Oe=o.gamma,rt=Oe===void 0?2:Oe,lt=this.fontService,At=lt.canvas,Ot=lt.mapping;if(Object.keys(Ot).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Ot).length),this.preTextStyle={textAnchor:O,textAllowOverlap:W},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d,strokeWidth:T,stroke:_})){this.judgeStyleAttributes({opacity:d,strokeWidth:T,stroke:_});var Ut=this.layer.getEncodedData(),Gt=this.calDataFrame(this.cellLength,Ut,this.cellProperties),gr=Gt.data,Nr=Gt.width,Xr=Gt.height;this.rowCount=Xr,this.dataTexture=this.cellLength>0&&gr.length>0?this.createTexture2D({flipY:!0,data:gr,format:re.LUMINANCE,type:re.FLOAT,width:Nr,height:Xr}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(d)?d:1,u_stroke_width:Ui()(T)?T:0,u_stroke_color:this.getStrokeColor(_),u_sdf_map:this.texture,u_halo_blur:ue,u_gamma_scale:rt,u_sdf_map_size:[At.width,At.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var o=this.layer.getLayerConfig(),c=o.textAnchor,d=c===void 0?"center":c,y=o.textAllowOverlap,_=y===void 0?!0:y;return this.preTextStyle={textAnchor:d,textAllowOverlap:_},this.buildModels()}},{key:"needUpdate",value:function(){var o=this.layer.getLayerConfig(),c=o.textAllowOverlap,d=c===void 0?!1:c,y=this.mapService.getZoom(),_=this.mapService.getBounds(),b=Nn(this.extent,_);return!d&&(Math.abs(this.currentZoom-y)>1||!b)||d!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Nt.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.rotate,T=b===void 0?0:b;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Nt.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(c,d,y,_){return[y[5],y[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.size,T=b===void 0?12:b;return Array.isArray(T)?[T[0]]:[T]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Nt.Attribute,descriptor:{name:"a_tex",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(c,d,y,_){return[y[3],y[4]]}}})}},{key:"textExtent",value:function(){var o=this.mapService.getBounds();return Mr(o,.5)}},{key:"initTextFont",value:function(){var o=this.layer.getLayerConfig(),c=o.fontWeight,d=c===void 0?"400":c,y=o.fontFamily,_=y===void 0?"sans-serif":y,b=this.layer.getEncodedData(),T=[];b.forEach(function(A){var O=A.shape,F=O===void 0?"":O;F=F.toString();var W=Bx(F),Q;try{for(W.s();!(Q=W.n()).done;){var ue=Q.value;T.indexOf(ue)===-1&&T.push(ue)}}catch(Oe){W.e(Oe)}finally{W.f()}}),this.fontService.setFontOptions({characterSet:T,fontWeight:d,fontFamily:_,iconfont:!1})}},{key:"initIconFontTex",value:function(){var o=this.layer.getLayerConfig(),c=o.fontWeight,d=c===void 0?"400":c,y=o.fontFamily,_=y===void 0?"sans-serif":y,b=this.layer.getEncodedData(),T=[];b.forEach(function(A){var O=A.shape,F=O===void 0?"":O;F=F.toString(),T.indexOf(F)===-1&&T.push(F)}),this.fontService.setFontOptions({characterSet:T,fontWeight:d,fontFamily:_,iconfont:!0})}},{key:"generateGlyphLayout",value:function(o){var c=this,d=this.fontService.mapping,y=this.layer.getLayerConfig(),_=y.spacing,b=_===void 0?2:_,T=y.textAnchor,A=T===void 0?"center":T,O=this.layer.getEncodedData();this.glyphInfo=O.map(function(F){var W=F.shape,Q=W===void 0?"":W,ue=F.id,Oe=F.size,rt=Oe===void 0?1:Oe,lt=F.textOffset,At=lt===void 0?[0,0]:lt,Ot=Dx(Q.toString(),d,rt,A,"center",b,At,o),Ut=Fx(Ot,At,!1);return F.shaping=Ot,F.glyphQuads=Ut,F.centroid=Bh(F.coordinates),F.originCentroid=F.version==="GAODE2.x"?Bh(F.originCoordinates):F.originCentroid=F.centroid,c.glyphInfoMap[ue]={shaping:Ot,glyphQuads:Ut,centroid:Bh(F.coordinates)},F})}},{key:"filterGlyphs",value:function(){var o=this,c=this.layer.getLayerConfig(),d=c.padding,y=d===void 0?[4,4]:d,_=c.textAllowOverlap,b=_===void 0?!1:_;if(!b){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var T=this.rendererService.getViewportSize(),A=T.width,O=T.height,F=new Ox(A,O),W=this.glyphInfo.filter(function(Q){var ue=Q.shaping,Oe=Q.id,rt=Oe===void 0?0:Oe,lt=Q.version==="GAODE2.x"?Q.originCentroid:Q.centroid,At=Q.size,Ot=At/24,Ut=o.mapService.lngLatToContainer(lt),Gt=F.placeCollisionBox({x1:ue.left*Ot-y[0],x2:ue.right*Ot+y[0],y1:ue.top*Ot-y[1],y2:ue.bottom*Ot+y[1],anchorPointX:Ut.x,anchorPointY:Ut.y}),gr=Gt.box;return gr&&gr.length?(F.insertCollisionBox(gr,rt),!0):!1});W.forEach(function(Q){o.glyphInfoMap[Q.id]=Q})}}},{key:"initGlyph",value:function(){var o=this.layer.getLayerConfig(),c=o.iconfont,d=c===void 0?!1:c;d?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(d)}},{key:"updateTexture",value:function(){var o=this.rendererService.createTexture2D,c=this.fontService.canvas;this.textureHeight=c.height,this.texture&&this.texture.destroy(),this.texture=o({data:c,mag:re.LINEAR,min:re.LINEAR,width:c.width,height:c.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:ry,fragmentShader:ty,triangulation:ny.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),r}(so),Ux={fill:Hm,image:Wm,normal:Xm,extrude:Gm,text:iy,icon:yx},jx=Ux;function Vx(e){var n=Gx();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Gx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Hx=function(e){(0,Je.Z)(r,e);var n=Vx(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","PointLayer"),i}return(0,Pe.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new jx[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),c={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return c[o]}},{key:"getModelType",value:function(){var o=this.getEncodedData(),c=this.getLayerConfig(),d=c.shape2d,y=c.shape3d,_=this.iconService.getIconMap(),b=o.find(function(A){return A.hasOwnProperty("shape")});if(b){var T=b.shape;return T==="dot"?"normal":(d==null?void 0:d.indexOf(T))!==-1?"fill":(y==null?void 0:y.indexOf(T))!==-1?"extrude":_.hasOwnProperty(T)?"image":this.fontService.getGlyph(T)!==""?"icon":"text"}else return"normal"}}]),r}(Uf);function Wx(e){var n=Xx();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Xx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yx=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,qx=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Kx=function(e){(0,Je.Z)(r,e);var n=Wx(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var y=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,y,this.cellProperties),b=_.data,T=_.width,A=_.height;this.rowCount=A,this.dataTexture=this.cellLength>0&&b.length>0?this.createTexture2D({flipY:!0,data:b,format:re.LUMINANCE,type:re.FLOAT,width:T,height:A}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(d)?d:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:qx,fragmentShader:Yx,triangulation:Dm})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Nt.Attribute,descriptor:{name:"a_Normal",buffer:{usage:re.STATIC_DRAW,data:[],type:re.FLOAT},size:3,update:function(c,d,y,_,b){return b}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Nt.Attribute,descriptor:{name:"a_Size",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(c,d,y,_){var b=c.size,T=b===void 0?10:b;return Array.isArray(T)?[T[0]]:[T]}}})}}]),r}(so);function $x(e){var n=Jx();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Jx(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qx=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,eb=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,tb=function(e){(0,Je.Z)(r,e);var n=$x(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:d})){this.judgeStyleAttributes({opacity:d});var y=this.layer.getEncodedData(),_=this.calDataFrame(this.cellLength,y,this.cellProperties),b=_.data,T=_.width,A=_.height;this.rowCount=A,this.dataTexture=this.cellLength>0&&b.length>0?this.createTexture2D({flipY:!0,data:b,format:re.LUMINANCE,type:re.FLOAT,width:T,height:A}):this.createTexture2D({flipY:!0,data:[1],format:re.LUMINANCE,type:re.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Ui()(d)?d:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:eb,fragmentShader:Qx,triangulation:L_,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var o;(o=this.dataTexture)===null||o===void 0||o.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),r}(so),rb={fill:tb,line:Vm,extrude:Kx,text:iy,point_fill:Hm,point_image:Wm,point_normal:Xm,point_extrude:Gm},nb=rb;function ib(e){var n=ab();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function ab(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ay=function(e){(0,Je.Z)(r,e);var n=ib(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","PolygonLayer"),i}return(0,Pe.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new nb[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var o,c=this.styleAttributeService.getLayerStyleAttribute("shape"),d=c==null||(o=c.scale)===null||o===void 0?void 0:o.field;return d==="fill"?"fill":d==="extrude"?"extrude":d==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var o=this.getEncodedData(),c=this.getLayerConfig(),d=c.shape2d,y=c.shape3d,_=this.iconService.getIconMap(),b=o.find(function(A){return A.hasOwnProperty("shape")});if(b){var T=b.shape;return T==="dot"?"point_normal":(d==null?void 0:d.indexOf(T))!==-1?"point_fill":(y==null?void 0:y.indexOf(T))!==-1?"point_extrude":_.hasOwnProperty(T)?"point_image":"text"}else return"fill"}}]),r}(Uf);function ob(e){var n=sb();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function sb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ub=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,lb=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,oy=function(e){(0,Je.Z)(r,e);var n=ob(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"texture",void 0),(0,M.Z)((0,H.Z)(i),"colorTexture",void 0),i}return(0,Pe.Z)(r,[{key:"getUninforms",value:function(){var o=this.layer.getLayerConfig(),c=o.opacity,d=c===void 0?1:c,y=o.clampLow,_=y===void 0?!0:y,b=o.clampHigh,T=b===void 0?!0:b,A=o.noDataValue,O=A===void 0?-9999999:A,F=o.domain,W=F===void 0?[0,1]:F;return this.updateColorTexure(),{u_opacity:d||1,u_texture:this.texture,u_domain:W,u_clampLow:_,u_clampHigh:typeof T!="undefined"?T:_,u_noDataValue:O,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var o=this.layer.getSource(),c=this.rendererService.createTexture2D,d=o.data.dataArray[0];this.texture=c({data:d.data,width:d.width,height:d.height,format:re.LUMINANCE,type:re.FLOAT});var y=this.layer.getLayerConfig(),_=y.rampColors,b=vi(_);return this.colorTexture=c({data:b.data,width:b.width,height:b.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:lb,fragmentShader:ub,triangulation:Bm,primitive:re.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Nt.Attribute,descriptor:{name:"a_Uv",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:2,update:function(c,d,y,_){return[y[3],y[4]]}}})}},{key:"updateColorTexure",value:function(){var o=this.rendererService.createTexture2D,c=this.layer.getLayerConfig(),d=c.rampColors,y=vi(d);this.colorTexture=o({data:y.data,width:y.width,height:y.height,flipY:!1})}}]),r}(so),cb={raster:oy,raster3d:oy},fb=cb;function pb(e){var n=hb();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function hb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var db=function(e){(0,Je.Z)(r,e);var n=pb(r);function r(){var i;(0,be.Z)(this,r);for(var o=arguments.length,c=new Array(o),d=0;d<o;d++)c[d]=arguments[d];return i=n.call.apply(n,[this].concat(c)),(0,M.Z)((0,H.Z)(i),"type","RasterLayer"),i}return(0,Pe.Z)(r,[{key:"buildModels",value:function(){var o=this.getModelType();this.layerModel=new fb[o](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var o=this.getModelType(),c={raster:{},raster3d:{}};return c[o]}},{key:"getModelType",value:function(){return"raster"}}]),r}(Uf),vb=G(50361),Vv=G.n(vb),sy,uy,ly,cy,fy,wd,py,hy,dy;function vy(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function mb(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?vy(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):vy(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var yb=(sy=(0,ie.b2)(),uy=(0,ie.f3)(J.IGlobalConfigService),ly=(0,ie.f3)(J.IMapService),cy=(0,ie.f3)(J.IFontService),sy(fy=(wd=function(){function e(){(0,be.Z)(this,e),Tn(this,"configService",py,this),Tn(this,"mapService",hy,this),Tn(this,"fontService",dy,this)}return(0,Pe.Z)(e,[{key:"apply",value:function(r,i){var o=this,c=i.styleAttributeService;r.hooks.init.tap("DataMappingPlugin",function(){o.generateMaping(r,{styleAttributeService:c})}),r.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return r.dataState.dataMappingNeedUpdate=!1,o.generateMaping(r,{styleAttributeService:c}),!0}),r.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!r.layerModelNeedUpdate){var d=c.getLayerStyleAttributes()||[],y=c.getLayerStyleAttribute("filter"),_=r.getSource().data.dataArray,b=d.filter(function(A){return A.needRemapping}),T=_;y!=null&&y.needRemapping&&y!==null&&y!==void 0&&y.scale&&(T=_.filter(function(A){return o.applyAttributeMapping(y,A)[0]})),b.length&&(y!=null&&y.needRemapping?(r.setEncodedData(o.mapping(d,T)),y.needRemapping=!1):r.setEncodedData(o.mapping(b,T,r.getEncodedData())),r.emit("remapping",null))}})}},{key:"generateMaping",value:function(r,i){var o=this,c=i.styleAttributeService,d=c.getLayerStyleAttributes()||[],y=c.getLayerStyleAttribute("filter"),_=r.getSource().data.dataArray,b=_;y!=null&&y.scale&&(b=_.filter(function(T){return o.applyAttributeMapping(y,T)[0]})),r.setEncodedData(this.mapping(d,b))}},{key:"mapping",value:function(r,i,o){var c=this,d=i.map(function(y,_){var b=o?o[_]:{},T=mb({id:y._id,coordinates:y.coordinates},b);return r.filter(function(A){return A.scale!==void 0}).forEach(function(A){var O=c.applyAttributeMapping(A,y);A.needRemapping=!1,A.name==="color"&&(O=O.map(function(F){return Pn(F)})),T[A.name]=Array.isArray(O)&&O.length===1?O[0]:O,A.name==="shape"&&(T.shape=c.fontService.getIconFontKey(T[A.name]))}),T});return d.length>0&&this.mapService.version==="GAODE2.x"&&(typeof d[0].coordinates[0]=="number"?d.map(function(y){y.version="GAODE2.x",y.originCoordinates=Vv()(y.coordinates),y.coordinates=c.mapService.lngLatToCoord(y.coordinates)}):d.map(function(y){y.version="GAODE2.x",y.originCoordinates=Vv()(y.coordinates),y.coordinates=c.mapService.lngLatToCoords(y.coordinates)})),d}},{key:"applyAttributeMapping",value:function(r,i){var o;if(!r.scale)return[];var c=(r==null||(o=r.scale)===null||o===void 0?void 0:o.scalers)||[],d=[];return c.forEach(function(y){var _,b=y.field;(i.hasOwnProperty(b)||((_=r.scale)===null||_===void 0?void 0:_.type)==="variable")&&d.push(i[b])}),r.mapping?r.mapping(d):[]}}]),e}(),py=Kr(wd.prototype,"configService",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hy=Kr(wd.prototype,"mapService",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dy=Kr(wd.prototype,"fontService",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd))||fy),my={},yy={},gy=function(n){return yy[n]},Sd=function(n,r){yy[n]=r},gb=function(n){return my[n]},zh=function(n,r){my[n]=r},_y={},Gv={},Hv=34,Ed=10,Wv=13;function xy(e){return new Function("d","return {"+e.map(function(n,r){return JSON.stringify(n)+": d["+r+'] || ""'}).join(",")+"}")}function _b(e,n){var r=xy(e);return function(i,o){return n(r(i),o,e)}}function by(e){var n=Object.create(null),r=[];return e.forEach(function(i){for(var o in i)o in n||r.push(n[o]=o)}),r}function ol(e,n){var r=e+"",i=r.length;return i<n?new Array(n-i+1).join(0)+r:r}function xb(e){return e<0?"-"+ol(-e,6):e>9999?"+"+ol(e,6):ol(e,4)}function bb(e){var n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),o=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":xb(e.getUTCFullYear(),4)+"-"+ol(e.getUTCMonth()+1,2)+"-"+ol(e.getUTCDate(),2)+(o?"T"+ol(n,2)+":"+ol(r,2)+":"+ol(i,2)+"."+ol(o,3)+"Z":i?"T"+ol(n,2)+":"+ol(r,2)+":"+ol(i,2)+"Z":r||n?"T"+ol(n,2)+":"+ol(r,2)+"Z":"")}function wb(e){var n=new RegExp('["'+e+`
\r]`),r=e.charCodeAt(0);function i(A,O){var F,W,Q=o(A,function(ue,Oe){if(F)return F(ue,Oe-1);W=ue,F=O?_b(ue,O):xy(ue)});return Q.columns=W||[],Q}function o(A,O){var F=[],W=A.length,Q=0,ue=0,Oe,rt=W<=0,lt=!1;A.charCodeAt(W-1)===Ed&&--W,A.charCodeAt(W-1)===Wv&&--W;function At(){if(rt)return Gv;if(lt)return lt=!1,_y;var Ut,Gt=Q,gr;if(A.charCodeAt(Gt)===Hv){for(;Q++<W&&A.charCodeAt(Q)!==Hv||A.charCodeAt(++Q)===Hv;);return(Ut=Q)>=W?rt=!0:(gr=A.charCodeAt(Q++))===Ed?lt=!0:gr===Wv&&(lt=!0,A.charCodeAt(Q)===Ed&&++Q),A.slice(Gt+1,Ut-1).replace(/""/g,'"')}for(;Q<W;){if((gr=A.charCodeAt(Ut=Q++))===Ed)lt=!0;else if(gr===Wv)lt=!0,A.charCodeAt(Q)===Ed&&++Q;else if(gr!==r)continue;return A.slice(Gt,Ut)}return rt=!0,A.slice(Gt,W)}for(;(Oe=At())!==Gv;){for(var Ot=[];Oe!==_y&&Oe!==Gv;)Ot.push(Oe),Oe=At();O&&(Ot=O(Ot,ue++))==null||F.push(Ot)}return F}function c(A,O){return A.map(function(F){return O.map(function(W){return T(F[W])}).join(e)})}function d(A,O){return O==null&&(O=by(A)),[O.map(T).join(e)].concat(c(A,O)).join(`
`)}function y(A,O){return O==null&&(O=by(A)),c(A,O).join(`
`)}function _(A){return A.map(b).join(`
`)}function b(A){return A.map(T).join(e)}function T(A){return A==null?"":A instanceof Date?bb(A):n.test(A+="")?'"'+A.replace(/"/g,'""')+'"':A}return{parse:i,parseRows:o,format:d,formatBody:y,formatRows:_,formatRow:b,formatValue:T}}var qp=wb(","),Sb=qp.parse,qC=qp.parseRows,KC=qp.format,$C=qp.formatBody,JC=qp.formatRows,QC=qp.formatRow,eT=qp.formatValue,Eb=G(6563),wy=G.n(Eb);function Sy(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Ey(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Sy(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Sy(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Cy(e,n){var r=n.x,i=n.y,o=n.x1,c=n.y1,d=n.coordinates,y=[];return e.forEach(function(_,b){var T=[];if(r&&i&&(T=[parseFloat(_[r]),parseFloat(_[i])]),r&&i&&o&&c){var A=[parseFloat(_[r]),parseFloat(_[i])],O=[parseFloat(_[o]),parseFloat(_[c])];T=[A,O]}if(d){var F="Polygon";Array.isArray(d[0])||(F="Point"),Array.isArray(d[0])&&!Array.isArray(d[0][0])&&(F="LineString");var W={type:F,coordinates:(0,j.Z)(_[d])};wy()(W,!0),T=W.coordinates}var Q=Ey(Ey({},_),{},{_id:b,coordinates:T});y.push(Q)}),{dataArray:y}}function Cb(e,n){var r=Sb(e);return Cy(r,n)}function tT(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Tb(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Ab(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Ab(e[0]);throw new Error("coordinates must only contain numbers")}function rT(e,n,r){if(!n||!r)throw new Error("type and name required");if(!e||e.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+e.type)}function nT(e,n,r){if(!e)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!e.geometry||e.geometry.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+e.geometry.type)}function iT(e,n,r){if(!e)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(var i=0,o=e.features;i<o.length;i++){var c=o[i];if(!c||c.type!=="Feature"||!c.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!c.geometry||c.geometry.type!==n)throw new Error("Invalid input to "+r+": must be a "+n+", given "+c.geometry.type)}}function aT(e){return e.type==="Feature"?e.geometry:e}function oT(e,n){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function lv(e,n,r){if(e!==null)for(var i,o,c,d,y,_,b,T=0,A=0,O,F=e.type,W=F==="FeatureCollection",Q=F==="Feature",ue=W?e.features.length:1,Oe=0;Oe<ue;Oe++){b=W?e.features[Oe].geometry:Q?e.geometry:e,O=b?b.type==="GeometryCollection":!1,y=O?b.geometries.length:1;for(var rt=0;rt<y;rt++){var lt=0,At=0;if(d=O?b.geometries[rt]:b,d!==null){_=d.coordinates;var Ot=d.type;switch(T=r&&(Ot==="Polygon"||Ot==="MultiPolygon")?1:0,Ot){case null:break;case"Point":if(n(_,A,Oe,lt,At)===!1)return!1;A++,lt++;break;case"LineString":case"MultiPoint":for(i=0;i<_.length;i++){if(n(_[i],A,Oe,lt,At)===!1)return!1;A++,Ot==="MultiPoint"&&lt++}Ot==="LineString"&&lt++;break;case"Polygon":case"MultiLineString":for(i=0;i<_.length;i++){for(o=0;o<_[i].length-T;o++){if(n(_[i][o],A,Oe,lt,At)===!1)return!1;A++}Ot==="MultiLineString"&&lt++,Ot==="Polygon"&&At++}Ot==="Polygon"&&lt++;break;case"MultiPolygon":for(i=0;i<_.length;i++){for(At=0,o=0;o<_[i].length;o++){for(c=0;c<_[i][o].length-T;c++){if(n(_[i][o][c],A,Oe,lt,At)===!1)return!1;A++}At++}lt++}break;case"GeometryCollection":for(i=0;i<d.geometries.length;i++)if(lv(d.geometries[i],n,r)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function sT(e,n,r,i){var o=r;return lv(e,function(c,d,y,_,b){d===0&&r===void 0?o=c:o=n(o,c,d,y,_,b)},i),o}function Mb(e,n){var r;switch(e.type){case"FeatureCollection":for(r=0;r<e.features.length&&n(e.features[r].properties,r)!==!1;r++);break;case"Feature":n(e.properties,0);break}}function uT(e,n,r){var i=r;return Mb(e,function(o,c){c===0&&r===void 0?i=o:i=n(i,o,c)}),i}function Pb(e,n){if(e.type==="Feature")n(e,0);else if(e.type==="FeatureCollection")for(var r=0;r<e.features.length&&n(e.features[r],r)!==!1;r++);}function lT(e,n,r){var i=r;return Pb(e,function(o,c){c===0&&r===void 0?i=o:i=n(i,o,c)}),i}function cT(e){var n=[];return lv(e,function(r){n.push(r)}),n}function Ty(e,n){var r,i,o,c,d,y,_,b,T,A,O=0,F=e.type==="FeatureCollection",W=e.type==="Feature",Q=F?e.features.length:1;for(r=0;r<Q;r++){for(y=F?e.features[r].geometry:W?e.geometry:e,b=F?e.features[r].properties:W?e.properties:{},T=F?e.features[r].bbox:W?e.bbox:void 0,A=F?e.features[r].id:W?e.id:void 0,_=y?y.type==="GeometryCollection":!1,d=_?y.geometries.length:1,o=0;o<d;o++){if(c=_?y.geometries[o]:y,c===null){if(n(null,O,b,T,A)===!1)return!1;continue}switch(c.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(n(c,O,b,T,A)===!1)return!1;break}case"GeometryCollection":{for(i=0;i<c.geometries.length;i++)if(n(c.geometries[i],O,b,T,A)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}O++}}function fT(e,n,r){var i=r;return Ty(e,function(o,c,d,y,_){c===0&&r===void 0?i=o:i=n(i,o,c,d,y,_)}),i}function cv(e,n){Ty(e,function(r,i,o,c,d){var y=r===null?null:r.type;switch(y){case null:case"Point":case"LineString":case"Polygon":return n(ki(r,o,{bbox:c,id:d}),i,0)===!1?!1:void 0}var _;switch(y){case"MultiPoint":_="Point";break;case"MultiLineString":_="LineString";break;case"MultiPolygon":_="Polygon";break}for(var b=0;b<r.coordinates.length;b++){var T=r.coordinates[b],A={type:_,coordinates:T};if(n(ki(A,o),i,b)===!1)return!1}})}function pT(e,n,r){var i=r;return cv(e,function(o,c,d){c===0&&d===0&&r===void 0?i=o:i=n(i,o,c,d)}),i}function Ib(e,n){cv(e,function(r,i,o){var c=0;if(!!r.geometry){var d=r.geometry.type;if(!(d==="Point"||d==="MultiPoint")){var y,_=0,b=0,T=0;if(lv(r,function(A,O,F,W,Q){if(y===void 0||i>_||W>b||Q>T){y=A,_=i,b=W,T=Q,c=0;return}var ue=lineString([y,A],r.properties);if(n(ue,i,o,Q,c)===!1)return!1;c++,y=A})===!1)return!1}}})}function hT(e,n,r){var i=r,o=!1;return Ib(e,function(c,d,y,_,b){o===!1&&r===void 0?i=c:i=n(i,c,d,y,_,b),o=!0}),i}function Ob(e,n){if(!e)throw new Error("geojson is required");cv(e,function(r,i,o){if(r.geometry!==null){var c=r.geometry.type,d=r.geometry.coordinates;switch(c){case"LineString":if(n(r,i,o,0,0)===!1)return!1;break;case"Polygon":for(var y=0;y<d.length;y++)if(n(lineString(d[y],r.properties),i,o,y)===!1)return!1;break}}})}function dT(e,n,r){var i=r;return Ob(e,function(o,c,d,y){c===0&&r===void 0?i=o:i=n(i,o,c,d,y)}),i}function vT(e,n){if(n=n||{},!isObject(n))throw new Error("options is invalid");var r=n.featureIndex||0,i=n.multiFeatureIndex||0,o=n.geometryIndex||0,c=n.segmentIndex||0,d=n.properties,y;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),d=d||e.features[r].properties,y=e.features[r].geometry;break;case"Feature":d=d||e.properties,y=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":y=e;break;default:throw new Error("geojson is invalid")}if(y===null)return null;var _=y.coordinates;switch(y.type){case"Point":case"MultiPoint":return null;case"LineString":return c<0&&(c=_.length+c-1),lineString([_[c],_[c+1]],d,n);case"Polygon":return o<0&&(o=_.length+o),c<0&&(c=_[o].length+c-1),lineString([_[o][c],_[o][c+1]],d,n);case"MultiLineString":return i<0&&(i=_.length+i),c<0&&(c=_[i].length+c-1),lineString([_[i][c],_[i][c+1]],d,n);case"MultiPolygon":return i<0&&(i=_.length+i),o<0&&(o=_[i].length+o),c<0&&(c=_[i][o].length-c-1),lineString([_[i][o][c],_[i][o][c+1]],d,n)}throw new Error("geojson is invalid")}function mT(e,n){if(n=n||{},!isObject(n))throw new Error("options is invalid");var r=n.featureIndex||0,i=n.multiFeatureIndex||0,o=n.geometryIndex||0,c=n.coordIndex||0,d=n.properties,y;switch(e.type){case"FeatureCollection":r<0&&(r=e.features.length+r),d=d||e.features[r].properties,y=e.features[r].geometry;break;case"Feature":d=d||e.properties,y=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":y=e;break;default:throw new Error("geojson is invalid")}if(y===null)return null;var _=y.coordinates;switch(y.type){case"Point":return point(_,d,n);case"MultiPoint":return i<0&&(i=_.length+i),point(_[i],d,n);case"LineString":return c<0&&(c=_.length+c),point(_[c],d,n);case"Polygon":return o<0&&(o=_.length+o),c<0&&(c=_[o].length+c),point(_[o][c],d,n);case"MultiLineString":return i<0&&(i=_.length+i),c<0&&(c=_[i].length+c),point(_[i][c],d,n);case"MultiPolygon":return i<0&&(i=_.length+i),o<0&&(o=_[i].length+o),c<0&&(c=_[i][o].length-c),point(_[i][o][c],d,n)}throw new Error("geojson is invalid")}function Ay(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function My(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ay(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ay(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function kb(e,n){var r=[],i={};if(e.features=e.features.filter(function(c){var d=c.geometry;return c!=null&&d&&d.type&&d.coordinates&&d.coordinates.length>0}),wy()(e,!0),e.features.length===0)return{dataArray:[],featureKeys:i};var o=0;return cv(e,function(c,d){var y=Tb(c),_=d,b=My(My({},c.properties),{},{coordinates:y,_id:_});r.push(b)}),{dataArray:r,featureKeys:i}}function Py(e,n){var r=n.extent,i=new Promise(function(c){Lb(e,function(d){c(d)})}),o={images:i,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return o}function Lb(e,n){var r=e,i=[];if(typeof r=="string")Mi({url:r},function(d,y){i.push(y),n(i)});else{var o=r.length,c=0;r.forEach(function(d){Mi({url:d},function(y,_){c++,i.push(_),c===o&&n(i)})})}return Py}function Rb(e,n){var r=n.extent,i=n.width,o=n.height,c=n.min,d=n.max,y={_id:1,dataArray:[{_id:1,data:Array.from(e),width:i,height:o,min:c,max:d,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return y}var Db=G(30236),Fb=G.n(Db);function Iy(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Oy(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Iy(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Iy(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ky(e,n){var r=n.radius,i=r===void 0?40:r,o=n.maxZoom,c=o===void 0?18:o,d=n.minZoom,y=d===void 0?0:d,_=n.zoom,b=_===void 0?2:_;if(e.pointIndex){var T=e.pointIndex.getClusters(e.extent,Math.floor(b));return e.dataArray=Bb(T),e}var A=new(Do())({radius:i,minZoom:y,maxZoom:c}),O={type:"FeatureCollection",features:[]};return O.features=e.dataArray.map(function(F){return{type:"Feature",geometry:{type:"Point",coordinates:F.coordinates},properties:Oy({},F)}}),A.load(O.features),A}function Bb(e){return e.map(function(n,r){return Oy({coordinates:n.geometry.coordinates,_id:r+1},n.properties)})}function Nb(e){if(e.length===0)throw new Error("max requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]>n&&(n=e[r]);return n}function zb(e){if(e.length===0)throw new Error("min requires at least one data point");for(var n=e[0],r=1;r<e.length;r++)e[r]<n&&(n=e[r]);return n}function Ly(e){if(e.length===0)return 0;for(var n=e[0],r=0,i,o=1;o<e.length;o++)i=n+e[o]*1,Math.abs(n)>=Math.abs(e[o])?r+=n-i+e[o]:r+=e[o]-i+n,n=i;return n+r*1}function Zb(e){if(e.length===0)throw new Error("mean requires at least one data point");return Ly(e)/e.length}var Ub={min:zb,max:Nb,mean:Zb,sum:Ly};function jb(e,n){return e.map(function(r){return r[n]*1})}function Ry(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Dy(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ry(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ry(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function Vb(e){var n=Gb();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function Gb(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Hb(e,n){if(Array.isArray(n))return n}var Wb=function(e){(0,Je.Z)(r,e);var n=Vb(r);function r(i,o){var c;return(0,be.Z)(this,r),c=n.call(this),(0,M.Z)((0,H.Z)(c),"data",void 0),(0,M.Z)((0,H.Z)(c),"extent",void 0),(0,M.Z)((0,H.Z)(c),"hooks",{init:new Ba}),(0,M.Z)((0,H.Z)(c),"parser",{type:"geojson"}),(0,M.Z)((0,H.Z)(c),"transforms",[]),(0,M.Z)((0,H.Z)(c),"cluster",!1),(0,M.Z)((0,H.Z)(c),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,M.Z)((0,H.Z)(c),"mapService",void 0),(0,M.Z)((0,H.Z)(c),"invalidExtent",!1),(0,M.Z)((0,H.Z)(c),"originData",void 0),(0,M.Z)((0,H.Z)(c),"rawData",void 0),(0,M.Z)((0,H.Z)(c),"cfg",{}),(0,M.Z)((0,H.Z)(c),"clusterIndex",void 0),c.originData=i,c.initCfg(o),c.hooks.init.tap("parser",function(){c.excuteParser()}),c.hooks.init.tap("cluster",function(){c.initCluster()}),c.hooks.init.tap("transform",function(){c.executeTrans()}),c.init(),c}return(0,Pe.Z)(r,[{key:"setData",value:function(o,c){this.rawData=o,this.originData=o,this.initCfg(c),this.init(),this.emit("update")}},{key:"getClusters",value:function(o){return this.clusterIndex.getClusters(this.caculClusterExtent(2),o)}},{key:"getClustersLeaves",value:function(o){return this.clusterIndex.getLeaves(o,Infinity)}},{key:"updateClusterData",value:function(o){var c=this,d=this.clusterOptions,y=d.method,_=y===void 0?"sum":y,b=d.field,T=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(o));this.clusterOptions.zoom=o,T.forEach(function(A){A.id||(A.properties.point_count=1)}),(b||uf()(_))&&(T=T.map(function(A){var O=A.id;if(O){var F=c.clusterIndex.getLeaves(O,Infinity),W=F.map(function(Oe){return Oe.properties}),Q;if(ms()(_)&&b){var ue=jb(W,b);Q=Ub[_](ue)}uf()(_)&&(Q=_(W)),A.properties.stat=Q}else A.properties.point_count=1;return A})),this.data=gy("geojson")({type:"FeatureCollection",features:T}),this.executeTrans()}},{key:"getFeatureById",value:function(o){var c=this.parser.type,d=c===void 0?"geojson":c;if(d==="geojson"&&!this.cluster){var y=o<this.originData.features.length?this.originData.features[o]:"null",_=Vv()(y);if(this.transforms.length!==0){var b=this.data.dataArray.find(function(T){return T._id===o});_.properties=b}return _}else return o<this.data.dataArray.length?this.data.dataArray[o]:"null"}},{key:"getFeatureId",value:function(o,c){var d=this.data.dataArray.find(function(y){return y[o]===name});return d==null?void 0:d._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(o){var c=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(c=Mr(Lr(this.extent),o)),c[0].concat(c[1])}},{key:"initCfg",value:function(o){this.cfg=Fb()(this.cfg,o,Hb);var c=this.cfg;c&&(c.parser&&(this.parser=c.parser),c.transforms&&(this.transforms=c.transforms),this.cluster=c.cluster||!1,c.clusterOptions&&(this.cluster=!0,this.clusterOptions=Dy(Dy({},this.clusterOptions),c.clusterOptions)))}},{key:"excuteParser",value:function(){var o=this.parser,c=o.type||"geojson",d=gy(c);this.data=d(this.originData,o),this.extent=We(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var o=this,c=this.transforms;c.forEach(function(d){var y=d.type,_=gb(y)(o.data,d);Object.assign(o.data,_)})}},{key:"initCluster",value:function(){if(!!this.cluster){var o=this.clusterOptions||{};this.clusterIndex=ky(this.data,o)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),r}(oe.EventEmitter);function Xb(e,n){var r=n.callback;return r&&(e.dataArray=e.dataArray.filter(r)),e}function Fy(e,n){var r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Yb(e))||n&&e&&typeof e.length=="number"){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(b){throw b},f:o}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c=!0,d=!1,y;return{s:function(){r=r.call(e)},n:function(){var b=r.next();return c=b.done,b},e:function(b){d=!0,y=b},f:function(){try{!c&&r.return!=null&&r.return()}finally{if(d)throw y}}}}function Yb(e,n){if(!!e){if(typeof e=="string")return By(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return By(e,n)}}function By(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}var Xv=6378e3;function qb(e,n){var r=e.dataArray,i=n.size,o=i===void 0?10:i,c=o/(2*Math.PI*Xv)*(256<<20)/2,d=Kb(r,o),y=d.gridHash,_=d.gridOffset,b=e2(y,_,n);return{yOffset:c,xOffset:c,radius:c,type:"grid",dataArray:b}}function Kb(e,n){var r=Infinity,i=-Infinity,o,c=Fy(e),d;try{for(c.s();!(d=c.n()).done;){var y=d.value;o=y.coordinates[1],Number.isFinite(o)&&(r=o<r?o:r,i=o>i?o:i)}}catch(lt){c.e(lt)}finally{c.f()}var _=(r+i)/2,b=$b(n,_);if(b.xOffset<=0||b.yOffset<=0)return{gridHash:{},gridOffset:b};var T={},A=Fy(e),O;try{for(A.s();!(O=A.n()).done;){var F=O.value,W=F.coordinates[1],Q=F.coordinates[0];if(Number.isFinite(W)&&Number.isFinite(Q)){var ue=Math.floor((W+90)/b.yOffset),Oe=Math.floor((Q+180)/b.xOffset),rt="".concat(ue,"-").concat(Oe);T[rt]=T[rt]||{count:0,points:[]},T[rt].count+=1,T[rt].points.push(F)}}}catch(lt){A.e(lt)}finally{A.f()}return{gridHash:T,gridOffset:b}}function $b(e,n){var r=Jb(e),i=Qb(n,e);return{yOffset:r,xOffset:i}}function Jb(e){return e/Xv*(180/Math.PI)}function Qb(e,n){return n/Xv*(180/Math.PI)/Math.cos(e*Math.PI/180)}function e2(e,n,r){return Object.keys(e).reduce(function(i,o,c){var d=o.split("-"),y=parseInt(d[0],10),_=parseInt(d[1],10),b={};if(r.field&&r.method){var T=qs(e[o].points,r.field);b[r.method]=Bu[r.method](T)}return Object.assign(b,{_id:c,coordinates:Rr([-180+n.xOffset*(_+.5),-90+n.yOffset*(y+.5)]),rawData:e[o].points,count:e[o].count}),i.push(b),i},[])}var Zh=Math.PI/3,t2=[0,Zh,2*Zh,3*Zh,4*Zh,5*Zh];function r2(e){return e[0]}function n2(e){return e[1]}function i2(){var e=0,n=0,r=1,i=1,o=r2,c=n2,d,y,_;function b(A){var O={},F=[],W,Q=A.length;for(W=0;W<Q;++W)if(!(isNaN(Oe=+o.call(null,ue=A[W],W,A))||isNaN(rt=+c.call(null,ue,W,A)))){var ue,Oe,rt,lt=Math.round(rt=rt/_),At=Math.round(Oe=Oe/y-(lt&1)/2),Ot=rt-lt;if(Math.abs(Ot)*3>1){var Ut=Oe-At,Gt=At+(Oe<At?-1:1)/2,gr=lt+(rt<lt?-1:1),Nr=Oe-Gt,Xr=rt-gr;Ut*Ut+Ot*Ot>Nr*Nr+Xr*Xr&&(At=Gt+(lt&1?1:-1)/2,lt=gr)}var Er=At+"-"+lt,on=O[Er];on?on.push(ue):(F.push(on=O[Er]=[ue]),on.x=(At+(lt&1)/2)*y,on.y=lt*_)}return F}function T(A){var O=0,F=0;return t2.map(function(W){var Q=Math.sin(W)*A,ue=-Math.cos(W)*A,Oe=Q-O,rt=ue-F;return O=Q,F=ue,[Oe,rt]})}return b.hexagon=function(A){return"m"+T(A==null?d:+A).join("l")+"z"},b.centers=function(){for(var A=[],O=Math.round(n/_),F=Math.round(e/y),W=O*_;W<i+d;W+=_,++O)for(var Q=F*y+(O&1)*y/2;Q<r+y/2;Q+=y)A.push([Q,W]);return A},b.mesh=function(){var A=T(d).slice(0,4).join("l");return b.centers().map(function(O){return"M"+O+"m"+A}).join("")},b.x=function(A){return arguments.length?(o=A,b):o},b.y=function(A){return arguments.length?(c=A,b):c},b.radius=function(A){return arguments.length?(d=+A,y=d*2*Math.sin(Zh),_=d*1.5,b):d},b.size=function(A){return arguments.length?(e=n=0,r=+A[0],i=+A[1],b):[r-e,i-n]},b.extent=function(A){return arguments.length?(e=+A[0][0],n=+A[0][1],r=+A[1][0],i=+A[1][1],b):[[e,n],[r,i]]},b.radius(1)}function Ny(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function zy(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Ny(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ny(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var a2=6378e3;function o2(e,n){var r=e.dataArray,i=n.size,o=i===void 0?10:i,c=n.method,d=c===void 0?"sum":c,y=o/(2*Math.PI*a2)*(256<<20)/2,_=r.map(function(O){var F=Rr(O.coordinates),W=(0,Ft.Z)(F,2),Q=W[0],ue=W[1];return zy(zy({},O),{},{coordinates:[Q,ue]})}),b=i2().radius(y).x(function(O){return O.coordinates[0]}).y(function(O){return O.coordinates[1]}),T=b(_),A={dataArray:T.map(function(O,F){var W;if(n.field&&d){var Q=qs(O,n.field);O[d]=Bu[d](Q)}return W={},(0,M.Z)(W,n.method,O[d]),(0,M.Z)(W,"count",O.length),(0,M.Z)(W,"rawData",O),(0,M.Z)(W,"coordinates",[O.x,O.y]),(0,M.Z)(W,"_id",F),W}),radius:y,xOffset:y,yOffset:y,type:"hexagon"};return A}function Zy(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Uy(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?Zy(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zy(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function s2(e,n){var r=n.sourceField,i=n.targetField,o=n.data,c={};return o.forEach(function(d){c[d[r]]=d}),e.dataArray=e.dataArray.map(function(d){var y=d[i];return Uy(Uy({},d),c[y])}),e}function u2(e,n){var r=n.callback;return r&&(e.dataArray=e.dataArray.map(r)),e}var l2=Wb;Sd("geojson",kb),Sd("image",Py),Sd("csv",Cb),Sd("json",Cy),Sd("raster",Rb),zh("cluster",ky),zh("filter",Xb),zh("join",s2),zh("map",u2),zh("grid",qb),zh("hexagon",o2);var jy,Vy,c2=(jy=(0,ie.b2)(),jy(Vy=function(){function e(){(0,be.Z)(this,e),(0,M.Z)(this,"mapService",void 0)}return(0,Pe.Z)(e,[{key:"apply",value:function(r){var i=this;this.mapService=r.getContainer().get(J.IMapService),r.hooks.init.tap("DataSourcePlugin",function(){var o=r.getSource();if(!o){var c=r.sourceOption,d=c.data,y=c.options;r.setSource(new l2(d,y))}i.updateClusterData(r)}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var o=i.updateClusterData(r),c=r.dataState.dataSourceNeedUpdate;return r.dataState.dataSourceNeedUpdate=!1,o||c})}},{key:"updateClusterData",value:function(r){var i=r.getSource(),o=i.cluster,c=i.clusterOptions,d=c.zoom,y=d===void 0?0:d,_=c.maxZoom,b=_===void 0?16:_,T=this.mapService.getZoom()-1,A=r.dataState.dataSourceNeedUpdate;return o&&(A||Math.abs(y-T)>1)&&b>y?(i.updateClusterData(Math.floor(T)),!0):!1}}]),e}())||Vy);function Yv(e,n){return e<n?-1:e>n?1:e>=n?0:NaN}function Gy(e){return e.length===1&&(e=f2(e)),{left:function(n,r,i,o){for(i==null&&(i=0),o==null&&(o=n.length);i<o;){var c=i+o>>>1;e(n[c],r)<0?i=c+1:o=c}return i},right:function(n,r,i,o){for(i==null&&(i=0),o==null&&(o=n.length);i<o;){var c=i+o>>>1;e(n[c],r)>0?o=c:i=c+1}return i}}}function f2(e){return function(n,r){return Yv(e(n),r)}}var Hy=Gy(Yv),p2=Hy.right,yT=Hy.left,fv=p2;function h2(e,n){var r=e.length,i=-1,o,c,d;if(n==null){for(;++i<r;)if((o=e[i])!=null&&o>=o)for(c=d=o;++i<r;)(o=e[i])!=null&&(c>o&&(c=o),d<o&&(d=o))}else for(;++i<r;)if((o=n(e[i],i,e))!=null&&o>=o)for(c=d=o;++i<r;)(o=n(e[i],i,e))!=null&&(c>o&&(c=o),d<o&&(d=o));return[c,d]}var Wy=Array.prototype,gT=Wy.slice,_T=Wy.map,qv=Math.sqrt(50),Kv=Math.sqrt(10),$v=Math.sqrt(2);function Xy(e,n,r){var i,o=-1,c,d,y;if(n=+n,e=+e,r=+r,e===n&&r>0)return[e];if((i=n<e)&&(c=e,e=n,n=c),(y=pv(e,n,r))===0||!isFinite(y))return[];if(y>0)for(e=Math.ceil(e/y),n=Math.floor(n/y),d=new Array(c=Math.ceil(n-e+1));++o<c;)d[o]=(e+o)*y;else for(e=Math.floor(e*y),n=Math.ceil(n*y),d=new Array(c=Math.ceil(e-n+1));++o<c;)d[o]=(e-o)/y;return i&&d.reverse(),d}function pv(e,n,r){var i=(n-e)/Math.max(0,r),o=Math.floor(Math.log(i)/Math.LN10),c=i/Math.pow(10,o);return o>=0?(c>=qv?10:c>=Kv?5:c>=$v?2:1)*Math.pow(10,o):-Math.pow(10,-o)/(c>=qv?10:c>=Kv?5:c>=$v?2:1)}function Jv(e,n,r){var i=Math.abs(n-e)/Math.max(0,r),o=Math.pow(10,Math.floor(Math.log(i)/Math.LN10)),c=i/o;return c>=qv?o*=10:c>=Kv?o*=5:c>=$v&&(o*=2),n<e?-o:o}function xT(){var e=identity,n=extent,r=sturges;function i(o){var c,d=o.length,y,_=new Array(d);for(c=0;c<d;++c)_[c]=e(o[c],c,o);var b=n(_),T=b[0],A=b[1],O=r(_,T,A);Array.isArray(O)||(O=tickStep(T,A,O),O=range(Math.ceil(T/O)*O,A,O));for(var F=O.length;O[0]<=T;)O.shift(),--F;for(;O[F-1]>A;)O.pop(),--F;var W=new Array(F+1),Q;for(c=0;c<=F;++c)Q=W[c]=[],Q.x0=c>0?O[c-1]:T,Q.x1=c<F?O[c]:A;for(c=0;c<d;++c)y=_[c],T<=y&&y<=A&&W[bisect(O,y,0,F)].push(o[c]);return W}return i.value=function(o){return arguments.length?(e=typeof o=="function"?o:constant(o),i):e},i.domain=function(o){return arguments.length?(n=typeof o=="function"?o:constant([o[0],o[1]]),i):n},i.thresholds=function(o){return arguments.length?(r=typeof o=="function"?o:Array.isArray(o)?constant(slice.call(o)):constant(o),i):r},i}function bT(e,n,r){return e=map.call(e,number).sort(ascending),Math.ceil((r-n)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function d2(e){return e===null?NaN:+e}function v2(e,n,r){if(r==null&&(r=d2),!!(i=e.length)){if((n=+n)<=0||i<2)return+r(e[0],0,e);if(n>=1)return+r(e[i-1],i-1,e);var i,o=(i-1)*n,c=Math.floor(o),d=+r(e[c],c,e),y=+r(e[c+1],c+1,e);return d+(y-d)*(o-c)}}var oc="$";function hv(){}hv.prototype=Yy.prototype={constructor:hv,has:function(e){return oc+e in this},get:function(e){return this[oc+e]},set:function(e,n){return this[oc+e]=n,this},remove:function(e){var n=oc+e;return n in this&&delete this[n]},clear:function(){for(var e in this)e[0]===oc&&delete this[e]},keys:function(){var e=[];for(var n in this)n[0]===oc&&e.push(n.slice(1));return e},values:function(){var e=[];for(var n in this)n[0]===oc&&e.push(this[n]);return e},entries:function(){var e=[];for(var n in this)n[0]===oc&&e.push({key:n.slice(1),value:this[n]});return e},size:function(){var e=0;for(var n in this)n[0]===oc&&++e;return e},empty:function(){for(var e in this)if(e[0]===oc)return!1;return!0},each:function(e){for(var n in this)n[0]===oc&&e(this[n],n.slice(1),this)}};function Yy(e,n){var r=new hv;if(e instanceof hv)e.each(function(y,_){r.set(_,y)});else if(Array.isArray(e)){var i=-1,o=e.length,c;if(n==null)for(;++i<o;)r.set(i,e[i]);else for(;++i<o;)r.set(n(c=e[i],i,e),c)}else if(e)for(var d in e)r.set(d,e[d]);return r}var Qv=Yy;function wT(){var e=[],n=[],r,i,o;function c(y,_,b,T){if(_>=e.length)return r!=null&&y.sort(r),i!=null?i(y):y;for(var A=-1,O=y.length,F=e[_++],W,Q,ue=map(),Oe,rt=b();++A<O;)(Oe=ue.get(W=F(Q=y[A])+""))?Oe.push(Q):ue.set(W,[Q]);return ue.each(function(lt,At){T(rt,At,c(lt,_,b,T))}),rt}function d(y,_){if(++_>e.length)return y;var b,T=n[_-1];return i!=null&&_>=e.length?b=y.entries():(b=[],y.each(function(A,O){b.push({key:O,values:d(A,_)})})),T!=null?b.sort(function(A,O){return T(A.key,O.key)}):b}return o={object:function(y){return c(y,0,m2,y2)},map:function(y){return c(y,0,qy,Ky)},entries:function(y){return d(c(y,0,qy,Ky),0)},key:function(y){return e.push(y),o},sortKeys:function(y){return n[e.length-1]=y,o},sortValues:function(y){return r=y,o},rollup:function(y){return i=y,o}}}function m2(){return{}}function y2(e,n,r){e[n]=r}function qy(){return map()}function Ky(e,n,r){e.set(n,r)}function dv(){}var Kp=Qv.prototype;dv.prototype=g2.prototype={constructor:dv,has:Kp.has,add:function(e){return e+="",this[oc+e]=e,this},remove:Kp.remove,clear:Kp.clear,values:Kp.keys,size:Kp.size,empty:Kp.empty,each:Kp.each};function g2(e,n){var r=new dv;if(e instanceof dv)e.each(function(c){r.add(c)});else if(e){var i=-1,o=e.length;if(n==null)for(;++i<o;)r.add(e[i]);else for(;++i<o;)r.add(n(e[i],i,e))}return r}var ST=null,$y=Array.prototype,vv=$y.map,$p=$y.slice;function hp(e,n){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(n).domain(e);break}return this}function ET(e,n){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(n).domain(e);break}return this}var Jy={name:"implicit"};function mv(){var e=Qv(),n=[],r=[],i=Jy;function o(c){var d=c+"",y=e.get(d);if(!y){if(i!==Jy)return i;e.set(d,y=n.push(c))}return r[(y-1)%r.length]}return o.domain=function(c){if(!arguments.length)return n.slice();n=[],e=Qv();for(var d=-1,y=c.length,_,b;++d<y;)e.has(b=(_=c[d])+"")||e.set(b,n.push(_));return o},o.range=function(c){return arguments.length?(r=$p.call(c),o):r.slice()},o.unknown=function(c){return arguments.length?(i=c,o):i},o.copy=function(){return mv(n,r).unknown(i)},hp.apply(o,arguments),o}function Qy(){var e=ordinal().unknown(void 0),n=e.domain,r=e.range,i=[0,1],o,c,d=!1,y=0,_=0,b=.5;delete e.unknown;function T(){var A=n().length,O=i[1]<i[0],F=i[O-0],W=i[1-O];o=(W-F)/Math.max(1,A-y+_*2),d&&(o=Math.floor(o)),F+=(W-F-o*(A-y))*b,c=o*(1-y),d&&(F=Math.round(F),c=Math.round(c));var Q=sequence(A).map(function(ue){return F+o*ue});return r(O?Q.reverse():Q)}return e.domain=function(A){return arguments.length?(n(A),T()):n()},e.range=function(A){return arguments.length?(i=[+A[0],+A[1]],T()):i.slice()},e.rangeRound=function(A){return i=[+A[0],+A[1]],d=!0,T()},e.bandwidth=function(){return c},e.step=function(){return o},e.round=function(A){return arguments.length?(d=!!A,T()):d},e.padding=function(A){return arguments.length?(y=Math.min(1,_=+A),T()):y},e.paddingInner=function(A){return arguments.length?(y=Math.min(1,A),T()):y},e.paddingOuter=function(A){return arguments.length?(_=+A,T()):_},e.align=function(A){return arguments.length?(b=Math.max(0,Math.min(1,A)),T()):b},e.copy=function(){return Qy(n(),i).round(d).paddingInner(y).paddingOuter(_).align(b)},initRange.apply(T(),arguments)}function eg(e){var n=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return eg(n())},e}function CT(){return eg(Qy.apply(null,arguments).paddingInner(1))}var _2=G(26257),x2=G(73626);function b2(e,n){return e=+e,n=+n,function(r){return Math.round(e*(1-r)+n*r)}}function w2(e){return function(){return e}}function em(e){return+e}var tg=[0,1];function sc(e){return e}function tm(e,n){return(n-=e=+e)?function(r){return(r-e)/n}:w2(isNaN(n)?NaN:.5)}function rg(e){var n=e[0],r=e[e.length-1],i;return n>r&&(i=n,n=r,r=i),function(o){return Math.max(n,Math.min(r,o))}}function S2(e,n,r){var i=e[0],o=e[1],c=n[0],d=n[1];return o<i?(i=tm(o,i),c=r(d,c)):(i=tm(i,o),c=r(c,d)),function(y){return c(i(y))}}function E2(e,n,r){var i=Math.min(e.length,n.length)-1,o=new Array(i),c=new Array(i),d=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),n=n.slice().reverse());++d<i;)o[d]=tm(e[d],e[d+1]),c[d]=r(n[d],n[d+1]);return function(y){var _=fv(e,y,1,i)-1;return c[_](o[_](y))}}function yv(e,n){return n.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function rm(){var e=tg,n=tg,r=_2.Z,i,o,c,d=sc,y,_,b;function T(){return y=Math.min(e.length,n.length)>2?E2:S2,_=b=null,A}function A(O){return isNaN(O=+O)?c:(_||(_=y(e.map(i),n,r)))(i(d(O)))}return A.invert=function(O){return d(o((b||(b=y(n,e.map(i),x2.Z)))(O)))},A.domain=function(O){return arguments.length?(e=vv.call(O,em),d===sc||(d=rg(e)),T()):e.slice()},A.range=function(O){return arguments.length?(n=$p.call(O),T()):n.slice()},A.rangeRound=function(O){return n=$p.call(O),r=b2,T()},A.clamp=function(O){return arguments.length?(d=O?rg(e):sc,A):d!==sc},A.interpolate=function(O){return arguments.length?(r=O,T()):r},A.unknown=function(O){return arguments.length?(c=O,A):c},function(O,F){return i=O,o=F,T()}}function ng(e,n){return rm()(e,n)}var C2=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function gv(e){if(!(n=C2.exec(e)))throw new Error("invalid format: "+e);var n;return new nm({fill:n[1],align:n[2],sign:n[3],symbol:n[4],zero:n[5],width:n[6],comma:n[7],precision:n[8]&&n[8].slice(1),trim:n[9],type:n[10]})}gv.prototype=nm.prototype;function nm(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}nm.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function T2(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function _v(e,n){if((r=(e=n?e.toExponential(n-1):e.toExponential()).indexOf("e"))<0)return null;var r,i=e.slice(0,r);return[i.length>1?i[0]+i.slice(2):i,+e.slice(r+1)]}function Uh(e){return e=_v(Math.abs(e)),e?e[1]:NaN}function A2(e,n){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Uh(n)/3)))*3-Uh(Math.abs(e)))}function M2(e,n){return function(r,i){for(var o=r.length,c=[],d=0,y=e[0],_=0;o>0&&y>0&&(_+y+1>i&&(y=Math.max(1,i-_)),c.push(r.substring(o-=y,o+y)),!((_+=y+1)>i));)y=e[d=(d+1)%e.length];return c.reverse().join(n)}}function P2(e){return function(n){return n.replace(/[0-9]/g,function(r){return e[+r]})}}function I2(e){e:for(var n=e.length,r=1,i=-1,o;r<n;++r)switch(e[r]){case".":i=o=r;break;case"0":i===0&&(i=r),o=r;break;default:if(!+e[r])break e;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(o+1):e}var ig;function O2(e,n){var r=_v(e,n);if(!r)return e+"";var i=r[0],o=r[1],c=o-(ig=Math.max(-8,Math.min(8,Math.floor(o/3)))*3)+1,d=i.length;return c===d?i:c>d?i+new Array(c-d+1).join("0"):c>0?i.slice(0,c)+"."+i.slice(c):"0."+new Array(1-c).join("0")+_v(e,Math.max(0,n+c-1))[0]}function ag(e,n){var r=_v(e,n);if(!r)return e+"";var i=r[0],o=r[1];return o<0?"0."+new Array(-o).join("0")+i:i.length>o+1?i.slice(0,o+1)+"."+i.slice(o+1):i+new Array(o-i.length+2).join("0")}var og={"%":function(e,n){return(e*100).toFixed(n)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:T2,e:function(e,n){return e.toExponential(n)},f:function(e,n){return e.toFixed(n)},g:function(e,n){return e.toPrecision(n)},o:function(e){return Math.round(e).toString(8)},p:function(e,n){return ag(e*100,n)},r:ag,s:O2,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function sg(e){return e}var ug=Array.prototype.map,lg=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function k2(e){var n=e.grouping===void 0||e.thousands===void 0?sg:M2(ug.call(e.grouping,Number),e.thousands+""),r=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",o=e.decimal===void 0?".":e.decimal+"",c=e.numerals===void 0?sg:P2(ug.call(e.numerals,String)),d=e.percent===void 0?"%":e.percent+"",y=e.minus===void 0?"-":e.minus+"",_=e.nan===void 0?"NaN":e.nan+"";function b(A){A=gv(A);var O=A.fill,F=A.align,W=A.sign,Q=A.symbol,ue=A.zero,Oe=A.width,rt=A.comma,lt=A.precision,At=A.trim,Ot=A.type;Ot==="n"?(rt=!0,Ot="g"):og[Ot]||(lt===void 0&&(lt=12),At=!0,Ot="g"),(ue||O==="0"&&F==="=")&&(ue=!0,O="0",F="=");var Ut=Q==="$"?r:Q==="#"&&/[boxX]/.test(Ot)?"0"+Ot.toLowerCase():"",Gt=Q==="$"?i:/[%p]/.test(Ot)?d:"",gr=og[Ot],Nr=/[defgprs%]/.test(Ot);lt=lt===void 0?6:/[gprs]/.test(Ot)?Math.max(1,Math.min(21,lt)):Math.max(0,Math.min(20,lt));function Xr(Er){var on=Ut,Ln=Gt,Hn,Ga,Os;if(Ot==="c")Ln=gr(Er)+Ln,Er="";else{Er=+Er;var Ys=Er<0||1/Er<0;if(Er=isNaN(Er)?_:gr(Math.abs(Er),lt),At&&(Er=I2(Er)),Ys&&+Er==0&&W!=="+"&&(Ys=!1),on=(Ys?W==="("?W:y:W==="-"||W==="("?"":W)+on,Ln=(Ot==="s"?lg[8+ig/3]:"")+Ln+(Ys&&W==="("?")":""),Nr){for(Hn=-1,Ga=Er.length;++Hn<Ga;)if(Os=Er.charCodeAt(Hn),48>Os||Os>57){Ln=(Os===46?o+Er.slice(Hn+1):Er.slice(Hn))+Ln,Er=Er.slice(0,Hn);break}}}rt&&!ue&&(Er=n(Er,Infinity));var Vf=on.length+Er.length+Ln.length,sl=Vf<Oe?new Array(Oe-Vf+1).join(O):"";switch(rt&&ue&&(Er=n(sl+Er,sl.length?Oe-Ln.length:Infinity),sl=""),F){case"<":Er=on+Er+Ln+sl;break;case"=":Er=on+sl+Er+Ln;break;case"^":Er=sl.slice(0,Vf=sl.length>>1)+on+Er+Ln+sl.slice(Vf);break;default:Er=sl+on+Er+Ln;break}return c(Er)}return Xr.toString=function(){return A+""},Xr}function T(A,O){var F=b((A=gv(A),A.type="f",A)),W=Math.max(-8,Math.min(8,Math.floor(Uh(O)/3)))*3,Q=Math.pow(10,-W),ue=lg[8+W/3];return function(Oe){return F(Q*Oe)+ue}}return{format:b,formatPrefix:T}}var xv,im,cg;L2({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function L2(e){return xv=k2(e),im=xv.format,cg=xv.formatPrefix,xv}function R2(e,n){return e=Math.abs(e),n=Math.abs(n)-e,Math.max(0,Uh(n)-Uh(e))+1}function D2(e){return Math.max(0,-Uh(Math.abs(e)))}function F2(e,n,r,i){var o=Jv(e,n,r),c;switch(i=gv(i==null?",f":i),i.type){case"s":{var d=Math.max(Math.abs(e),Math.abs(n));return i.precision==null&&!isNaN(c=A2(o,d))&&(i.precision=c),cg(i,d)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(c=R2(o,Math.max(Math.abs(e),Math.abs(n))))&&(i.precision=c-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(c=D2(o))&&(i.precision=c-(i.type==="%")*2);break}}return im(i)}function bv(e){var n=e.domain;return e.ticks=function(r){var i=n();return Xy(i[0],i[i.length-1],r==null?10:r)},e.tickFormat=function(r,i){var o=n();return F2(o[0],o[o.length-1],r==null?10:r,i)},e.nice=function(r){r==null&&(r=10);var i=n(),o=0,c=i.length-1,d=i[o],y=i[c],_;return y<d&&(_=d,d=y,y=_,_=o,o=c,c=_),_=pv(d,y,r),_>0?(d=Math.floor(d/_)*_,y=Math.ceil(y/_)*_,_=pv(d,y,r)):_<0&&(d=Math.ceil(d*_)/_,y=Math.floor(y*_)/_,_=pv(d,y,r)),_>0?(i[o]=Math.floor(d/_)*_,i[c]=Math.ceil(y/_)*_,n(i)):_<0&&(i[o]=Math.ceil(d*_)/_,i[c]=Math.floor(y*_)/_,n(i)),e},e}function fg(){var e=ng(sc,sc);return e.copy=function(){return yv(e,fg())},hp.apply(e,arguments),bv(e)}function pg(e){var n;function r(i){return isNaN(i=+i)?n:i}return r.invert=r,r.domain=r.range=function(i){return arguments.length?(e=vv.call(i,em),r):e.slice()},r.unknown=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return pg(e).unknown(n)},e=arguments.length?vv.call(e,em):[0,1],bv(r)}function hg(e,n){e=e.slice();var r=0,i=e.length-1,o=e[r],c=e[i],d;return c<o&&(d=r,r=i,i=d,d=o,o=c,c=d),e[r]=n.floor(o),e[i]=n.ceil(c),e}function dg(e){return Math.log(e)}function vg(e){return Math.exp(e)}function B2(e){return-Math.log(-e)}function N2(e){return-Math.exp(-e)}function z2(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Z2(e){return e===10?z2:e===Math.E?Math.exp:function(n){return Math.pow(e,n)}}function U2(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(n){return Math.log(n)/e})}function mg(e){return function(n){return-e(-n)}}function j2(e){var n=e(dg,vg),r=n.domain,i=10,o,c;function d(){return o=U2(i),c=Z2(i),r()[0]<0?(o=mg(o),c=mg(c),e(B2,N2)):e(dg,vg),n}return n.base=function(y){return arguments.length?(i=+y,d()):i},n.domain=function(y){return arguments.length?(r(y),d()):r()},n.ticks=function(y){var _=r(),b=_[0],T=_[_.length-1],A;(A=T<b)&&(O=b,b=T,T=O);var O=o(b),F=o(T),W,Q,ue,Oe=y==null?10:+y,rt=[];if(!(i%1)&&F-O<Oe){if(O=Math.round(O)-1,F=Math.round(F)+1,b>0){for(;O<F;++O)for(Q=1,W=c(O);Q<i;++Q)if(ue=W*Q,!(ue<b)){if(ue>T)break;rt.push(ue)}}else for(;O<F;++O)for(Q=i-1,W=c(O);Q>=1;--Q)if(ue=W*Q,!(ue<b)){if(ue>T)break;rt.push(ue)}}else rt=Xy(O,F,Math.min(F-O,Oe)).map(c);return A?rt.reverse():rt},n.tickFormat=function(y,_){if(_==null&&(_=i===10?".0e":","),typeof _!="function"&&(_=im(_)),y===Infinity)return _;y==null&&(y=10);var b=Math.max(1,i*y/n.ticks().length);return function(T){var A=T/c(Math.round(o(T)));return A*i<i-.5&&(A*=i),A<=b?_(T):""}},n.nice=function(){return r(hg(r(),{floor:function(y){return c(Math.floor(o(y)))},ceil:function(y){return c(Math.ceil(o(y)))}}))},n}function yg(){var e=j2(rm()).domain([1,10]);return e.copy=function(){return yv(e,yg()).base(e.base())},hp.apply(e,arguments),e}function gg(e){return function(n){return Math.sign(n)*Math.log1p(Math.abs(n/e))}}function _g(e){return function(n){return Math.sign(n)*Math.expm1(Math.abs(n))*e}}function V2(e){var n=1,r=e(gg(n),_g(n));return r.constant=function(i){return arguments.length?e(gg(n=+i),_g(n)):n},linearish(r)}function G2(){var e=V2(transformer());return e.copy=function(){return copy(e,G2()).constant(e.constant())},initRange.apply(e,arguments)}function xg(e){return function(n){return n<0?-Math.pow(-n,e):Math.pow(n,e)}}function H2(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function W2(e){return e<0?-e*e:e*e}function X2(e){var n=e(sc,sc),r=1;function i(){return r===1?e(sc,sc):r===.5?e(H2,W2):e(xg(r),xg(1/r))}return n.exponent=function(o){return arguments.length?(r=+o,i()):r},bv(n)}function am(){var e=X2(rm());return e.copy=function(){return yv(e,am()).exponent(e.exponent())},hp.apply(e,arguments),e}function TT(){return am.apply(null,arguments).exponent(.5)}function bg(){var e=[],n=[],r=[],i;function o(){var d=0,y=Math.max(1,n.length);for(r=new Array(y-1);++d<y;)r[d-1]=v2(e,d/y);return c}function c(d){return isNaN(d=+d)?i:n[fv(r,d)]}return c.invertExtent=function(d){var y=n.indexOf(d);return y<0?[NaN,NaN]:[y>0?r[y-1]:e[0],y<r.length?r[y]:e[e.length-1]]},c.domain=function(d){if(!arguments.length)return e.slice();e=[];for(var y=0,_=d.length,b;y<_;++y)b=d[y],b!=null&&!isNaN(b=+b)&&e.push(b);return e.sort(Yv),o()},c.range=function(d){return arguments.length?(n=$p.call(d),o()):n.slice()},c.unknown=function(d){return arguments.length?(i=d,c):i},c.quantiles=function(){return r.slice()},c.copy=function(){return bg().domain(e).range(n).unknown(i)},hp.apply(c,arguments)}function wg(){var e=0,n=1,r=1,i=[.5],o=[0,1],c;function d(_){return _<=_?o[fv(i,_,0,r)]:c}function y(){var _=-1;for(i=new Array(r);++_<r;)i[_]=((_+1)*n-(_-r)*e)/(r+1);return d}return d.domain=function(_){return arguments.length?(e=+_[0],n=+_[1],y()):[e,n]},d.range=function(_){return arguments.length?(r=(o=$p.call(_)).length-1,y()):o.slice()},d.invertExtent=function(_){var b=o.indexOf(_);return b<0?[NaN,NaN]:b<1?[e,i[0]]:b>=r?[i[r-1],n]:[i[b-1],i[b]]},d.unknown=function(_){return arguments.length&&(c=_),d},d.thresholds=function(){return i.slice()},d.copy=function(){return wg().domain([e,n]).range(o).unknown(c)},hp.apply(bv(d),arguments)}function Sg(){var e=[.5],n=[0,1],r,i=1;function o(c){return c<=c?n[fv(e,c,0,i)]:r}return o.domain=function(c){return arguments.length?(e=$p.call(c),i=Math.min(e.length,n.length-1),o):e.slice()},o.range=function(c){return arguments.length?(n=$p.call(c),i=Math.min(e.length,n.length-1),o):n.slice()},o.invertExtent=function(c){var d=n.indexOf(c);return[e[d-1],e[d]]},o.unknown=function(c){return arguments.length?(r=c,o):r},o.copy=function(){return Sg().domain(e).range(n).unknown(r)},hp.apply(o,arguments)}var om=new Date,sm=new Date;function Fu(e,n,r,i){function o(c){return e(c=arguments.length===0?new Date:new Date(+c)),c}return o.floor=function(c){return e(c=new Date(+c)),c},o.ceil=function(c){return e(c=new Date(c-1)),n(c,1),e(c),c},o.round=function(c){var d=o(c),y=o.ceil(c);return c-d<y-c?d:y},o.offset=function(c,d){return n(c=new Date(+c),d==null?1:Math.floor(d)),c},o.range=function(c,d,y){var _=[],b;if(c=o.ceil(c),y=y==null?1:Math.floor(y),!(c<d)||!(y>0))return _;do _.push(b=new Date(+c)),n(c,y),e(c);while(b<c&&c<d);return _},o.filter=function(c){return Fu(function(d){if(d>=d)for(;e(d),!c(d);)d.setTime(d-1)},function(d,y){if(d>=d)if(y<0)for(;++y<=0;)for(;n(d,-1),!c(d););else for(;--y>=0;)for(;n(d,1),!c(d););})},r&&(o.count=function(c,d){return om.setTime(+c),sm.setTime(+d),e(om),e(sm),Math.floor(r(om,sm))},o.every=function(c){return c=Math.floor(c),!isFinite(c)||!(c>0)?null:c>1?o.filter(i?function(d){return i(d)%c==0}:function(d){return o.count(0,d)%c==0}):o}),o}var um=Fu(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,n){e.setFullYear(e.getFullYear()+n)},function(e,n){return n.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});um.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Fu(function(n){n.setFullYear(Math.floor(n.getFullYear()/e)*e),n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,r){n.setFullYear(n.getFullYear()+r*e)})};var jh=um,AT=um.range,Eg=Fu(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,n){e.setMonth(e.getMonth()+n)},function(e,n){return n.getMonth()-e.getMonth()+(n.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),Y2=Eg,MT=Eg.range,wv=1e3,Cd=6e4,Cg=36e5,Tg=864e5,Ag=6048e5;function Jp(e){return Fu(function(n){n.setDate(n.getDate()-(n.getDay()+7-e)%7),n.setHours(0,0,0,0)},function(n,r){n.setDate(n.getDate()+r*7)},function(n,r){return(r-n-(r.getTimezoneOffset()-n.getTimezoneOffset())*Cd)/Ag})}var lm=Jp(0),Sv=Jp(1),q2=Jp(2),K2=Jp(3),Vh=Jp(4),$2=Jp(5),J2=Jp(6),PT=lm.range,IT=Sv.range,OT=q2.range,kT=K2.range,LT=Vh.range,RT=$2.range,DT=J2.range,Mg=Fu(function(e){e.setHours(0,0,0,0)},function(e,n){e.setDate(e.getDate()+n)},function(e,n){return(n-e-(n.getTimezoneOffset()-e.getTimezoneOffset())*Cd)/Tg},function(e){return e.getDate()-1}),cm=Mg,FT=Mg.range,Pg=Fu(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*wv-e.getMinutes()*Cd)},function(e,n){e.setTime(+e+n*Cg)},function(e,n){return(n-e)/Cg},function(e){return e.getHours()}),Q2=Pg,BT=Pg.range,Ig=Fu(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*wv)},function(e,n){e.setTime(+e+n*Cd)},function(e,n){return(n-e)/Cd},function(e){return e.getMinutes()}),ew=Ig,NT=Ig.range,Og=Fu(function(e){e.setTime(e-e.getMilliseconds())},function(e,n){e.setTime(+e+n*wv)},function(e,n){return(n-e)/wv},function(e){return e.getUTCSeconds()}),tw=Og,zT=Og.range,Ev=Fu(function(){},function(e,n){e.setTime(+e+n)},function(e,n){return n-e});Ev.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?Fu(function(n){n.setTime(Math.floor(n/e)*e)},function(n,r){n.setTime(+n+r*e)},function(n,r){return(r-n)/e}):Ev};var rw=Ev,ZT=Ev.range;function Qp(e){return Fu(function(n){n.setUTCDate(n.getUTCDate()-(n.getUTCDay()+7-e)%7),n.setUTCHours(0,0,0,0)},function(n,r){n.setUTCDate(n.getUTCDate()+r*7)},function(n,r){return(r-n)/Ag})}var kg=Qp(0),Cv=Qp(1),nw=Qp(2),iw=Qp(3),Gh=Qp(4),aw=Qp(5),ow=Qp(6),UT=kg.range,jT=Cv.range,VT=nw.range,GT=iw.range,HT=Gh.range,WT=aw.range,XT=ow.range,Lg=Fu(function(e){e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCDate(e.getUTCDate()+n)},function(e,n){return(n-e)/Tg},function(e){return e.getUTCDate()-1}),Rg=Lg,YT=Lg.range,fm=Fu(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n)},function(e,n){return n.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});fm.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:Fu(function(n){n.setUTCFullYear(Math.floor(n.getUTCFullYear()/e)*e),n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,r){n.setUTCFullYear(n.getUTCFullYear()+r*e)})};var Td=fm,qT=fm.range;function pm(e){if(0<=e.y&&e.y<100){var n=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return n.setFullYear(e.y),n}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function hm(e){if(0<=e.y&&e.y<100){var n=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return n.setUTCFullYear(e.y),n}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Ad(e,n,r){return{y:e,m:n,d:r,H:0,M:0,S:0,L:0}}function sw(e){var n=e.dateTime,r=e.date,i=e.time,o=e.periods,c=e.days,d=e.shortDays,y=e.months,_=e.shortMonths,b=Md(o),T=Pd(o),A=Md(c),O=Pd(c),F=Md(d),W=Pd(d),Q=Md(y),ue=Pd(y),Oe=Md(_),rt=Pd(_),lt={a:Ys,A:Vf,b:sl,B:FC,c:null,d:Zg,e:Zg,f:Iw,g:Zw,G:jw,H:Aw,I:Mw,j:Pw,L:Ug,m:Ow,M:kw,p:BC,q:NC,Q:Xg,s:Yg,S:Lw,u:Rw,U:Dw,V:Fw,w:Bw,W:Nw,x:null,X:null,y:zw,Y:Uw,Z:Vw,"%":Wg},At={a:zC,A:ZC,b:UC,B:jC,c:null,d:Vg,e:Vg,f:Xw,g:nS,G:aS,H:Gw,I:Hw,j:Ww,L:Gg,m:Yw,M:qw,p:VC,q:GC,Q:Xg,s:Yg,S:Kw,u:$w,U:Jw,V:Qw,w:eS,W:tS,x:null,X:null,y:rS,Y:iS,Z:oS,"%":Wg},Ot={a:Xr,A:Er,b:on,B:Ln,c:Hn,d:Ng,e:Ng,f:Sw,g:Bg,G:Fg,H:zg,I:zg,j:_w,L:ww,m:gw,M:xw,p:Nr,q:yw,Q:Cw,s:Tw,S:bw,u:pw,U:hw,V:dw,w:fw,W:vw,x:Ga,X:Os,y:Bg,Y:Fg,Z:mw,"%":Ew};lt.x=Ut(r,lt),lt.X=Ut(i,lt),lt.c=Ut(n,lt),At.x=Ut(r,At),At.X=Ut(i,At),At.c=Ut(n,At);function Ut(In,zi){return function($i){var Ur=[],ul=-1,Qa=0,Rl=In.length,Dl,th,A_;for($i instanceof Date||($i=new Date(+$i));++ul<Rl;)In.charCodeAt(ul)===37&&(Ur.push(In.slice(Qa,ul)),(th=Dg[Dl=In.charAt(++ul)])!=null?Dl=In.charAt(++ul):th=Dl==="e"?" ":"0",(A_=zi[Dl])&&(Dl=A_($i,th)),Ur.push(Dl),Qa=ul+1);return Ur.push(In.slice(Qa,ul)),Ur.join("")}}function Gt(In,zi){return function($i){var Ur=Ad(1900,void 0,1),ul=gr(Ur,In,$i+="",0),Qa,Rl;if(ul!=$i.length)return null;if("Q"in Ur)return new Date(Ur.Q);if("s"in Ur)return new Date(Ur.s*1e3+("L"in Ur?Ur.L:0));if(zi&&!("Z"in Ur)&&(Ur.Z=0),"p"in Ur&&(Ur.H=Ur.H%12+Ur.p*12),Ur.m===void 0&&(Ur.m="q"in Ur?Ur.q:0),"V"in Ur){if(Ur.V<1||Ur.V>53)return null;"w"in Ur||(Ur.w=1),"Z"in Ur?(Qa=hm(Ad(Ur.y,0,1)),Rl=Qa.getUTCDay(),Qa=Rl>4||Rl===0?Cv.ceil(Qa):Cv(Qa),Qa=Rg.offset(Qa,(Ur.V-1)*7),Ur.y=Qa.getUTCFullYear(),Ur.m=Qa.getUTCMonth(),Ur.d=Qa.getUTCDate()+(Ur.w+6)%7):(Qa=pm(Ad(Ur.y,0,1)),Rl=Qa.getDay(),Qa=Rl>4||Rl===0?Sv.ceil(Qa):Sv(Qa),Qa=cm.offset(Qa,(Ur.V-1)*7),Ur.y=Qa.getFullYear(),Ur.m=Qa.getMonth(),Ur.d=Qa.getDate()+(Ur.w+6)%7)}else("W"in Ur||"U"in Ur)&&("w"in Ur||(Ur.w="u"in Ur?Ur.u%7:"W"in Ur?1:0),Rl="Z"in Ur?hm(Ad(Ur.y,0,1)).getUTCDay():pm(Ad(Ur.y,0,1)).getDay(),Ur.m=0,Ur.d="W"in Ur?(Ur.w+6)%7+Ur.W*7-(Rl+5)%7:Ur.w+Ur.U*7-(Rl+6)%7);return"Z"in Ur?(Ur.H+=Ur.Z/100|0,Ur.M+=Ur.Z%100,hm(Ur)):pm(Ur)}}function gr(In,zi,$i,Ur){for(var ul=0,Qa=zi.length,Rl=$i.length,Dl,th;ul<Qa;){if(Ur>=Rl)return-1;if(Dl=zi.charCodeAt(ul++),Dl===37){if(Dl=zi.charAt(ul++),th=Ot[Dl in Dg?zi.charAt(ul++):Dl],!th||(Ur=th(In,$i,Ur))<0)return-1}else if(Dl!=$i.charCodeAt(Ur++))return-1}return Ur}function Nr(In,zi,$i){var Ur=b.exec(zi.slice($i));return Ur?(In.p=T[Ur[0].toLowerCase()],$i+Ur[0].length):-1}function Xr(In,zi,$i){var Ur=F.exec(zi.slice($i));return Ur?(In.w=W[Ur[0].toLowerCase()],$i+Ur[0].length):-1}function Er(In,zi,$i){var Ur=A.exec(zi.slice($i));return Ur?(In.w=O[Ur[0].toLowerCase()],$i+Ur[0].length):-1}function on(In,zi,$i){var Ur=Oe.exec(zi.slice($i));return Ur?(In.m=rt[Ur[0].toLowerCase()],$i+Ur[0].length):-1}function Ln(In,zi,$i){var Ur=Q.exec(zi.slice($i));return Ur?(In.m=ue[Ur[0].toLowerCase()],$i+Ur[0].length):-1}function Hn(In,zi,$i){return gr(In,n,zi,$i)}function Ga(In,zi,$i){return gr(In,r,zi,$i)}function Os(In,zi,$i){return gr(In,i,zi,$i)}function Ys(In){return d[In.getDay()]}function Vf(In){return c[In.getDay()]}function sl(In){return _[In.getMonth()]}function FC(In){return y[In.getMonth()]}function BC(In){return o[+(In.getHours()>=12)]}function NC(In){return 1+~~(In.getMonth()/3)}function zC(In){return d[In.getUTCDay()]}function ZC(In){return c[In.getUTCDay()]}function UC(In){return _[In.getUTCMonth()]}function jC(In){return y[In.getUTCMonth()]}function VC(In){return o[+(In.getUTCHours()>=12)]}function GC(In){return 1+~~(In.getUTCMonth()/3)}return{format:function(In){var zi=Ut(In+="",lt);return zi.toString=function(){return In},zi},parse:function(In){var zi=Gt(In+="",!1);return zi.toString=function(){return In},zi},utcFormat:function(In){var zi=Ut(In+="",At);return zi.toString=function(){return In},zi},utcParse:function(In){var zi=Gt(In+="",!0);return zi.toString=function(){return In},zi}}}var Dg={"-":"",_:" ","0":"0"},Is=/^\s*\d+/,uw=/^%/,lw=/[\\^$*+?|[\]().{}]/g;function Ki(e,n,r){var i=e<0?"-":"",o=(i?-e:e)+"",c=o.length;return i+(c<r?new Array(r-c+1).join(n)+o:o)}function cw(e){return e.replace(lw,"\\$&")}function Md(e){return new RegExp("^(?:"+e.map(cw).join("|")+")","i")}function Pd(e){for(var n={},r=-1,i=e.length;++r<i;)n[e[r].toLowerCase()]=r;return n}function fw(e,n,r){var i=Is.exec(n.slice(r,r+1));return i?(e.w=+i[0],r+i[0].length):-1}function pw(e,n,r){var i=Is.exec(n.slice(r,r+1));return i?(e.u=+i[0],r+i[0].length):-1}function hw(e,n,r){var i=Is.exec(n.slice(r,r+2));return i?(e.U=+i[0],r+i[0].length):-1}function dw(e,n,r){var i=Is.exec(n.slice(r,r+2));return i?(e.V=+i[0],r+i[0].length):-1}function vw(e,n,r){var i=Is.exec(n.slice(r,r+2));return i?(e.W=+i[0],r+i[0].length):-1}function Fg(e,n,r){var i=Is.exec(n.slice(r,r+4));return i?(e.y=+i[0],r+i[0].length):-1}function Bg(e,n,r){var i=Is.exec(n.slice(r,r+2));return i?(e.y=+i[0]+(+i[0]>68?1900:2e3),r+i[0].length):-1}function mw(e,n,r){var i=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(n.slice(r,r+6));return i?(e.Z=i[1]?0:-(i[2]+(i[3]||"00")),r+i[0].length):-1}function yw(e,n,r){var i=Is.exec(n.slice(r,r+1));return i?(e.q=i[0]*3-3,r+i[0].length):-1}function gw(e,n,r){var i=Is.exec(n.slice(r,r+2));return i?(e.m=i[0]-1,r+i[0].length):-1}function Ng(e,n,r){var i=Is.exec(n.slice(r,r+2));return i?(e.d=+i[0],r+i[0].length):-1}function _w(e,n,r){var i=Is.exec(n.slice(r,r+3));return i?(e.m=0,e.d=+i[0],r+i[0].length):-1}function zg(e,n,r){var i=Is.exec(n.slice(r,r+2));return i?(e.H=+i[0],r+i[0].length):-1}function xw(e,n,r){var i=Is.exec(n.slice(r,r+2));return i?(e.M=+i[0],r+i[0].length):-1}function bw(e,n,r){var i=Is.exec(n.slice(r,r+2));return i?(e.S=+i[0],r+i[0].length):-1}function ww(e,n,r){var i=Is.exec(n.slice(r,r+3));return i?(e.L=+i[0],r+i[0].length):-1}function Sw(e,n,r){var i=Is.exec(n.slice(r,r+6));return i?(e.L=Math.floor(i[0]/1e3),r+i[0].length):-1}function Ew(e,n,r){var i=uw.exec(n.slice(r,r+1));return i?r+i[0].length:-1}function Cw(e,n,r){var i=Is.exec(n.slice(r));return i?(e.Q=+i[0],r+i[0].length):-1}function Tw(e,n,r){var i=Is.exec(n.slice(r));return i?(e.s=+i[0],r+i[0].length):-1}function Zg(e,n){return Ki(e.getDate(),n,2)}function Aw(e,n){return Ki(e.getHours(),n,2)}function Mw(e,n){return Ki(e.getHours()%12||12,n,2)}function Pw(e,n){return Ki(1+cm.count(jh(e),e),n,3)}function Ug(e,n){return Ki(e.getMilliseconds(),n,3)}function Iw(e,n){return Ug(e,n)+"000"}function Ow(e,n){return Ki(e.getMonth()+1,n,2)}function kw(e,n){return Ki(e.getMinutes(),n,2)}function Lw(e,n){return Ki(e.getSeconds(),n,2)}function Rw(e){var n=e.getDay();return n===0?7:n}function Dw(e,n){return Ki(lm.count(jh(e)-1,e),n,2)}function jg(e){var n=e.getDay();return n>=4||n===0?Vh(e):Vh.ceil(e)}function Fw(e,n){return e=jg(e),Ki(Vh.count(jh(e),e)+(jh(e).getDay()===4),n,2)}function Bw(e){return e.getDay()}function Nw(e,n){return Ki(Sv.count(jh(e)-1,e),n,2)}function zw(e,n){return Ki(e.getFullYear()%100,n,2)}function Zw(e,n){return e=jg(e),Ki(e.getFullYear()%100,n,2)}function Uw(e,n){return Ki(e.getFullYear()%1e4,n,4)}function jw(e,n){var r=e.getDay();return e=r>=4||r===0?Vh(e):Vh.ceil(e),Ki(e.getFullYear()%1e4,n,4)}function Vw(e){var n=e.getTimezoneOffset();return(n>0?"-":(n*=-1,"+"))+Ki(n/60|0,"0",2)+Ki(n%60,"0",2)}function Vg(e,n){return Ki(e.getUTCDate(),n,2)}function Gw(e,n){return Ki(e.getUTCHours(),n,2)}function Hw(e,n){return Ki(e.getUTCHours()%12||12,n,2)}function Ww(e,n){return Ki(1+Rg.count(Td(e),e),n,3)}function Gg(e,n){return Ki(e.getUTCMilliseconds(),n,3)}function Xw(e,n){return Gg(e,n)+"000"}function Yw(e,n){return Ki(e.getUTCMonth()+1,n,2)}function qw(e,n){return Ki(e.getUTCMinutes(),n,2)}function Kw(e,n){return Ki(e.getUTCSeconds(),n,2)}function $w(e){var n=e.getUTCDay();return n===0?7:n}function Jw(e,n){return Ki(kg.count(Td(e)-1,e),n,2)}function Hg(e){var n=e.getUTCDay();return n>=4||n===0?Gh(e):Gh.ceil(e)}function Qw(e,n){return e=Hg(e),Ki(Gh.count(Td(e),e)+(Td(e).getUTCDay()===4),n,2)}function eS(e){return e.getUTCDay()}function tS(e,n){return Ki(Cv.count(Td(e)-1,e),n,2)}function rS(e,n){return Ki(e.getUTCFullYear()%100,n,2)}function nS(e,n){return e=Hg(e),Ki(e.getUTCFullYear()%100,n,2)}function iS(e,n){return Ki(e.getUTCFullYear()%1e4,n,4)}function aS(e,n){var r=e.getUTCDay();return e=r>=4||r===0?Gh(e):Gh.ceil(e),Ki(e.getUTCFullYear()%1e4,n,4)}function oS(){return"+0000"}function Wg(){return"%"}function Xg(e){return+e}function Yg(e){return Math.floor(+e/1e3)}var Hh,qg,sS,uS,lS;cS({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function cS(e){return Hh=sw(e),qg=Hh.format,sS=Hh.parse,uS=Hh.utcFormat,lS=Hh.utcParse,Hh}var Id=1e3,Od=Id*60,kd=Od*60,Ld=kd*24,fS=Ld*7,Kg=Ld*30,dm=Ld*365;function pS(e){return new Date(e)}function hS(e){return e instanceof Date?+e:+new Date(+e)}function $g(e,n,r,i,o,c,d,y,_){var b=ng(sc,sc),T=b.invert,A=b.domain,O=_(".%L"),F=_(":%S"),W=_("%I:%M"),Q=_("%I %p"),ue=_("%a %d"),Oe=_("%b %d"),rt=_("%B"),lt=_("%Y"),At=[[d,1,Id],[d,5,5*Id],[d,15,15*Id],[d,30,30*Id],[c,1,Od],[c,5,5*Od],[c,15,15*Od],[c,30,30*Od],[o,1,kd],[o,3,3*kd],[o,6,6*kd],[o,12,12*kd],[i,1,Ld],[i,2,2*Ld],[r,1,fS],[n,1,Kg],[n,3,3*Kg],[e,1,dm]];function Ot(Gt){return(d(Gt)<Gt?O:c(Gt)<Gt?F:o(Gt)<Gt?W:i(Gt)<Gt?Q:n(Gt)<Gt?r(Gt)<Gt?ue:Oe:e(Gt)<Gt?rt:lt)(Gt)}function Ut(Gt,gr,Nr,Xr){if(Gt==null&&(Gt=10),typeof Gt=="number"){var Er=Math.abs(Nr-gr)/Gt,on=Gy(function(Ln){return Ln[2]}).right(At,Er);on===At.length?(Xr=Jv(gr/dm,Nr/dm,Gt),Gt=e):on?(on=At[Er/At[on-1][2]<At[on][2]/Er?on-1:on],Xr=on[1],Gt=on[0]):(Xr=Math.max(Jv(gr,Nr,Gt),1),Gt=y)}return Xr==null?Gt:Gt.every(Xr)}return b.invert=function(Gt){return new Date(T(Gt))},b.domain=function(Gt){return arguments.length?A(vv.call(Gt,hS)):A().map(pS)},b.ticks=function(Gt,gr){var Nr=A(),Xr=Nr[0],Er=Nr[Nr.length-1],on=Er<Xr,Ln;return on&&(Ln=Xr,Xr=Er,Er=Ln),Ln=Ut(Gt,Xr,Er,gr),Ln=Ln?Ln.range(Xr,Er+1):[],on?Ln.reverse():Ln},b.tickFormat=function(Gt,gr){return gr==null?Ot:_(gr)},b.nice=function(Gt,gr){var Nr=A();return(Gt=Ut(Gt,Nr[0],Nr[Nr.length-1],gr))?A(hg(Nr,Gt)):b},b.copy=function(){return yv(b,$g(e,n,r,i,o,c,d,y,_))},b}function dS(){return hp.apply($g(jh,Y2,lm,cm,Q2,ew,tw,rw,qg).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function KT(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Tv(){var e=0,n=1,r,i,o,c,d=identity,y=!1,_;function b(T){return isNaN(T=+T)?_:d(o===0?.5:(T=(c(T)-r)*o,y?Math.max(0,Math.min(1,T)):T))}return b.domain=function(T){return arguments.length?(r=c(e=+T[0]),i=c(n=+T[1]),o=r===i?0:1/(i-r),b):[e,n]},b.clamp=function(T){return arguments.length?(y=!!T,b):y},b.interpolator=function(T){return arguments.length?(d=T,b):d},b.unknown=function(T){return arguments.length?(_=T,b):_},function(T){return c=T,r=T(e),i=T(n),o=r===i?0:1/(i-r),b}}function Av(e,n){return n.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function vS(){var e=linearish(Tv()(identity));return e.copy=function(){return Av(e,vS())},initInterpolator.apply(e,arguments)}function mS(){var e=loggish(Tv()).domain([1,10]);return e.copy=function(){return Av(e,mS()).base(e.base())},initInterpolator.apply(e,arguments)}function yS(){var e=symlogish(Tv());return e.copy=function(){return Av(e,yS()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Jg(){var e=powish(Tv());return e.copy=function(){return Av(e,Jg()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function $T(){return Jg.apply(null,arguments).exponent(.5)}function gS(){var e=[],n=identity;function r(i){if(!isNaN(i=+i))return n((bisect(e,i)-1)/(e.length-1))}return r.domain=function(i){if(!arguments.length)return e.slice();e=[];for(var o=0,c=i.length,d;o<c;++o)d=i[o],d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(ascending),r},r.interpolator=function(i){return arguments.length?(n=i,r):n},r.copy=function(){return gS(n).domain(e)},initInterpolator.apply(r,arguments)}function Mv(){var e=0,n=.5,r=1,i,o,c,d,y,_=identity,b,T=!1,A;function O(F){return isNaN(F=+F)?A:(F=.5+((F=+b(F))-o)*(F<o?d:y),_(T?Math.max(0,Math.min(1,F)):F))}return O.domain=function(F){return arguments.length?(i=b(e=+F[0]),o=b(n=+F[1]),c=b(r=+F[2]),d=i===o?0:.5/(o-i),y=o===c?0:.5/(c-o),O):[e,n,r]},O.clamp=function(F){return arguments.length?(T=!!F,O):T},O.interpolator=function(F){return arguments.length?(_=F,O):_},O.unknown=function(F){return arguments.length?(A=F,O):A},function(F){return b=F,i=F(e),o=F(n),c=F(r),d=i===o?0:.5/(o-i),y=o===c?0:.5/(c-o),O}}function _S(){var e=linearish(Mv()(identity));return e.copy=function(){return copy(e,_S())},initInterpolator.apply(e,arguments)}function xS(){var e=loggish(Mv()).domain([.1,1,10]);return e.copy=function(){return copy(e,xS()).base(e.base())},initInterpolator.apply(e,arguments)}function bS(){var e=symlogish(Mv());return e.copy=function(){return copy(e,bS()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Qg(){var e=powish(Mv());return e.copy=function(){return copy(e,Qg()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function JT(){return Qg.apply(null,arguments).exponent(.5)}var Oc,e0,t0,r0,vm,n0,wS=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,SS=(Oc={},(0,M.Z)(Oc,kt.LINEAR,fg),(0,M.Z)(Oc,kt.POWER,am),(0,M.Z)(Oc,kt.LOG,yg),(0,M.Z)(Oc,kt.IDENTITY,pg),(0,M.Z)(Oc,kt.TIME,dS),(0,M.Z)(Oc,kt.QUANTILE,bg),(0,M.Z)(Oc,kt.QUANTIZE,wg),(0,M.Z)(Oc,kt.THRESHOLD,Sg),(0,M.Z)(Oc,kt.CAT,mv),Oc),ES=(e0=(0,ie.b2)(),t0=(0,ie.f3)(J.IGlobalConfigService),e0(r0=(vm=function(){function e(){(0,be.Z)(this,e),Tn(this,"configService",n0,this),(0,M.Z)(this,"scaleCache",{}),(0,M.Z)(this,"scaleOptions",{})}return(0,Pe.Z)(e,[{key:"apply",value:function(r,i){var o=this,c=i.styleAttributeService;r.hooks.init.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var d=c.getLayerStyleAttributes(),y=r.getSource().data.dataArray;y.length!==0&&o.caculateScalesForAttributes(d||[],y)}),r.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){o.scaleOptions=r.getScaleOptions();var d=c.getLayerStyleAttributes(),y=r.getSource().data.dataArray;return o.caculateScalesForAttributes(d||[],y),r.layerModelNeedUpdate=!0,!0}),r.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!r.layerModelNeedUpdate){o.scaleOptions=r.getScaleOptions();var d=c.getLayerStyleAttributes();if(d){var y=r.getSource().data.dataArray;if(y.length===0)return;var _=d.filter(function(b){return b.needRescale});_.length&&o.caculateScalesForAttributes(_,y)}}})}},{key:"isNumber",value:function(r){return!isNaN(parseFloat(r))&&isFinite(r)}},{key:"caculateScalesForAttributes",value:function(r,i){var o=this;this.scaleCache={},r.forEach(function(c){if(c.scale){var d=c.scale,y=c.name;d.names=o.parseFields(c.scale.field||[]);var _=[];d.names.forEach(function(b){_.push(o.getOrCreateScale(b,c,i))}),_.some(function(b){return b.type===or.VARIABLE})?(d.type=or.VARIABLE,_.forEach(function(b){if(!d.callback){var T;if(d.values&&d.values!=="text"){var A;if(((A=b.option)===null||A===void 0?void 0:A.type)==="linear"&&d.values.length>2){var O=b.scale.ticks(d.values.length);y==="color"&&b.scale.domain(O)}b.scale.range(d.values)}else((T=b.option)===null||T===void 0?void 0:T.type)==="cat"&&b.scale.range(b.option.domain)}})):(d.type=or.CONSTANT,d.defaultValues=_.map(function(b,T){return b.scale(d.names[T])})),d.scalers=_.map(function(b){return{field:b.field,func:b.scale,option:b.option}}),c.needRescale=!1}})}},{key:"getOrCreateScale",value:function(r,i,o){var c,d=[r,i.name].join("_"),y=(c=i.scale)===null||c===void 0?void 0:c.values,_=this.createScale(r,i.name,y,o);return _}},{key:"parseFields",value:function(r){return Array.isArray(r)?r:ms()(r)?r.split("*"):[r]}},{key:"createScale",value:function(r,i,o,c){var d,y,_=this.scaleOptions[i]&&((d=this.scaleOptions[i])===null||d===void 0?void 0:d.field)===r?this.scaleOptions[i]:this.scaleOptions[r],b={field:r,scale:void 0,type:or.VARIABLE,option:_};if(!c||!c.length)return _&&_.type?b.scale=this.createDefaultScale(_):(b.scale=mv([r]),b.type=or.CONSTANT),b;var T=(y=c.find(function(F){return!ne()(F[r])}))===null||y===void 0?void 0:y[r];if(this.isNumber(r)||ne()(T)&&!_)b.scale=mv([r]),b.type=or.CONSTANT;else{var A=_&&_.type||this.getDefaultType(T);o==="text"&&(A=kt.CAT);var O=this.createDefaultScaleConfig(A,r,c);Object.assign(O,_),b.scale=this.createDefaultScale(O),b.option=O}return b}},{key:"getDefaultType",value:function(r){var i=kt.LINEAR;return typeof r=="string"&&(i=wS.test(r)?kt.TIME:kt.CAT),i}},{key:"createDefaultScaleConfig",value:function(r,i,o){var c={type:r},d=(o==null?void 0:o.map(function(y){return y[i]}))||[];return r!==kt.CAT&&r!==kt.QUANTILE?c.domain=h2(d):r===kt.CAT?c.domain=wc()(d):r===kt.QUANTILE&&(c.domain=d),c}},{key:"createDefaultScale",value:function(r){var i=r.type,o=r.domain,c=SS[i]();return o&&c.domain(o),c}}]),e}(),n0=Kr(vm.prototype,"configService",[t0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vm))||r0),i0,a0,o0,s0,Pv,u0,l0;function c0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function CS(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?c0(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var TS=(i0=(0,ie.b2)(),a0=(0,ie.f3)(J.ICameraService),o0=(0,ie.f3)(J.IRendererService),i0(s0=(Pv=function(){function e(){(0,be.Z)(this,e),Tn(this,"cameraService",u0,this),Tn(this,"rendererService",l0,this)}return(0,Pe.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){r.models.forEach(function(i){i.addUniforms(CS({},r.layerModel.getAnimateUniforms()))})})}}]),e}(),u0=Kr(Pv.prototype,"cameraService",[a0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),l0=Kr(Pv.prototype,"rendererService",[o0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pv))||s0),f0,p0,AS=(f0=(0,ie.b2)(),f0(p0=function(){function e(){(0,be.Z)(this,e)}return(0,Pe.Z)(e,[{key:"apply",value:function(r){r.hooks.init.tap("LayerModelPlugin",function(){r.prepareBuildModel(),r.buildModels(),r.styleNeedUpdate=!1}),r.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return r.prepareBuildModel(),r.clearModels(),r.buildModels(),r.layerModelNeedUpdate=!1,!1})}}]),e}())||p0),h0,d0,MS=(h0=(0,ie.b2)(),h0(d0=function(){function e(){(0,be.Z)(this,e)}return(0,Pe.Z)(e,[{key:"apply",value:function(r){r.hooks.afterInit.tap("LayerStylePlugin",function(){r.updateLayerConfig({});var i=r.getLayerConfig(),o=i.autoFit,c=i.fitBoundsOptions;o&&setTimeout(function(){r.fitBounds(c)},100)})}}]),e}())||d0),v0,m0,PS=["type"];function y0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Rd(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?y0(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var g0={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},IS={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},OS={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},kS={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},QT=null;function LS(e){var n={u_DirectionalLights:new Array(3).fill(Rd({},OS)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Rd({},kS)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[IS]),e.forEach(function(r,i){var o=r.type,c=o===void 0?"directional":o,d=(0,z.Z)(r,PS),y=g0[c].lights,_=g0[c].num,b=n[_];n[y][b]=Rd(Rd({},n[y][b]),d),n[_]++}),n}var RS=(v0=(0,ie.b2)(),v0(m0=function(){function e(){(0,be.Z)(this,e)}return(0,Pe.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("LightingPlugin",function(){var i=r.getLayerConfig(),o=i.enableLighting;o&&r.models.forEach(function(c){return c.addUniforms(Rd({},LS()))})})}}]),e}())||m0),_0,x0,Iv={NONE:0,ENCODE:1,HIGHLIGHT:2},DS=(_0=(0,ie.b2)(),_0(x0=function(){function e(){(0,be.Z)(this,e)}return(0,Pe.Z)(e,[{key:"apply",value:function(r,i){var o=i.rendererService,c=i.styleAttributeService;r.hooks.init.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),y=d.enablePicking;c.registerStyleAttribute({name:"pickingColor",type:Nt.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:re.FLOAT},size:3,update:function(b,T){var A=b.id;return y?Sa(A):[0,0,0]}}})}),r.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),y=d.enablePicking;y&&r.isVisible()&&r.models.forEach(function(_){return _.addUniforms({u_PickingStage:Iv.ENCODE})})}),r.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var d=r.getLayerConfig(),y=d.enablePicking;y&&r.isVisible()&&r.models.forEach(function(_){return _.addUniforms({u_PickingStage:Iv.HIGHLIGHT})})}),r.hooks.beforeHighlight.tap("PixelPickingPlugin",function(d){var y=r.getLayerConfig(),_=y.highlightColor,b=typeof _=="string"?Pn(_):_||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Vn(new Uint8Array(d))}),r.models.forEach(function(T){return T.addUniforms({u_PickingStage:Iv.HIGHLIGHT,u_PickingColor:d,u_HighlightColor:b.map(function(A){return A*255})})})}),r.hooks.beforeSelect.tap("PixelPickingPlugin",function(d){var y=r.getLayerConfig(),_=y.selectColor,b=typeof _=="string"?Pn(_):_||[1,0,0,1];r.updateLayerConfig({pickedFeatureID:Vn(new Uint8Array(d))}),r.models.forEach(function(T){return T.addUniforms({u_PickingStage:Iv.HIGHLIGHT,u_PickingColor:d,u_HighlightColor:b.map(function(A){return A*255})})})})}}]),e}())||x0),b0,w0,FS=(b0=(0,ie.b2)(),b0(w0=function(){function e(){(0,be.Z)(this,e)}return(0,Pe.Z)(e,[{key:"apply",value:function(r,i){var o=this,c=i.styleAttributeService;r.hooks.init.tap("RegisterStyleAttributePlugin",function(){o.registerBuiltinAttributes(c)})}},{key:"registerBuiltinAttributes",value:function(r){r.registerStyleAttribute({name:"position",type:Nt.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:re.FLOAT},size:3,update:function(o,c,d){return d.length===2?[d[0],d[1],0]:[d[0],d[1],d[2]]}}}),r.registerStyleAttribute({name:"filter",type:Nt.Attribute,descriptor:{name:"filter",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(o,c){var d=o.filter;return d?[1]:[0]}}}),r.registerStyleAttribute({name:"color",type:Nt.Attribute,descriptor:{name:"a_Color",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:4,update:function(o,c){var d=o.color;return!d||!d.length?[1,1,1,1]:d}}}),r.registerStyleAttribute({name:"vertexId",type:Nt.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:re.DYNAMIC_DRAW,data:[],type:re.FLOAT},size:1,update:function(o,c,d,y){return[c]}}})}}]),e}())||w0),S0,E0,C0,T0,A0,M0,Wh,P0,I0,O0,k0,BS=(S0=(0,ie.b2)(),E0=(0,ie.f3)(J.ICameraService),C0=(0,ie.f3)(J.ICoordinateSystemService),T0=(0,ie.f3)(J.IRendererService),A0=(0,ie.f3)(J.IMapService),S0(M0=(Wh=function(){function e(){(0,be.Z)(this,e),Tn(this,"cameraService",P0,this),Tn(this,"coordinateSystemService",I0,this),Tn(this,"rendererService",O0,this),Tn(this,"mapService",k0,this)}return(0,Pe.Z)(e,[{key:"apply",value:function(r){var i=this,o=this.mapService.version,c=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],d=[0,0];r.hooks.beforeRender.tap("ShaderUniformPlugin",function(){i.coordinateSystemService.refresh(),o==="GAODE2.x"&&(c=i.mapService.map.customCoords.getMVPMatrix(),d=i.mapService.getCustomCoordCenter());var y=i.rendererService.getViewportSize(),_=y.width,b=y.height;r.models.forEach(function(T){var A;T.addUniforms((A={},(0,M.Z)(A,kr.ProjectionMatrix,i.cameraService.getProjectionMatrix()),(0,M.Z)(A,kr.ViewMatrix,i.cameraService.getViewMatrix()),(0,M.Z)(A,kr.ViewProjectionMatrix,i.cameraService.getViewProjectionMatrix()),(0,M.Z)(A,kr.Zoom,i.cameraService.getZoom()),(0,M.Z)(A,kr.ZoomScale,i.cameraService.getZoomScale()),(0,M.Z)(A,kr.FocalDistance,i.cameraService.getFocalDistance()),(0,M.Z)(A,kr.CameraPosition,i.cameraService.getCameraPosition()),(0,M.Z)(A,No.CoordinateSystem,i.coordinateSystemService.getCoordinateSystem()),(0,M.Z)(A,No.ViewportCenter,i.coordinateSystemService.getViewportCenter()),(0,M.Z)(A,No.ViewportCenterProjection,i.coordinateSystemService.getViewportCenterProjection()),(0,M.Z)(A,No.PixelsPerDegree,i.coordinateSystemService.getPixelsPerDegree()),(0,M.Z)(A,No.PixelsPerDegree2,i.coordinateSystemService.getPixelsPerDegree2()),(0,M.Z)(A,No.PixelsPerMeter,i.coordinateSystemService.getPixelsPerMeter()),(0,M.Z)(A,No.Mvp,c),(0,M.Z)(A,"u_SceneCenterMKT",d),(0,M.Z)(A,"u_ViewportSize",[_,b]),(0,M.Z)(A,"u_DevicePixelRatio",window.devicePixelRatio),(0,M.Z)(A,"u_ModelMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),(0,M.Z)(A,"u_PickingBuffer",r.getLayerConfig().pickingBuffer||0),A))})})}}]),e}(),P0=Kr(Wh.prototype,"cameraService",[E0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I0=Kr(Wh.prototype,"coordinateSystemService",[C0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),O0=Kr(Wh.prototype,"rendererService",[T0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k0=Kr(Wh.prototype,"mapService",[A0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wh))||M0),L0,R0,NS=(L0=(0,ie.b2)(),L0(R0=function(){function e(){(0,be.Z)(this,e)}return(0,Pe.Z)(e,[{key:"apply",value:function(r){r.hooks.beforeRender.tap("UpdateModelPlugin",function(){r.layerModel&&r.layerModel.needUpdate()})}}]),e}())||R0),D0,F0,zS=(D0=(0,ie.b2)(),D0(F0=function(){function e(){(0,be.Z)(this,e)}return(0,Pe.Z)(e,[{key:"apply",value:function(r,i){var o=this,c=i.styleAttributeService;r.hooks.init.tap("UpdateStyleAttributePlugin",function(){o.initStyleAttribute(r,{styleAttributeService:c})}),r.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){r.layerModelNeedUpdate||o.updateStyleAtrribute(r,{styleAttributeService:c})})}},{key:"updateStyleAtrribute",value:function(r,i){var o=i.styleAttributeService,c=o.getLayerStyleAttributes()||[],d=o.getLayerStyleAttribute("filter"),y=o.getLayerStyleAttribute("shape");if(d&&d.needRegenerateVertices||y&&y.needRegenerateVertices){r.layerModelNeedUpdate=!0,c.forEach(function(_){return _.needRegenerateVertices=!1});return}c.filter(function(_){return _.needRegenerateVertices}).forEach(function(_){o.updateAttributeByFeatureRange(_.name,r.getEncodedData(),_.featureRange.startIndex,_.featureRange.endIndex),_.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(r,i){var o=i.styleAttributeService,c=o.getLayerStyleAttributes()||[];c.filter(function(d){return d.needRegenerateVertices}).forEach(function(d){o.updateAttributeByFeatureRange(d.name,r.getEncodedData(),d.featureRange.startIndex,d.featureRange.endIndex),d.needRegenerateVertices=!1})}}]),e}())||F0);es.bind(J.ILayerPlugin).to(c2).inRequestScope(),es.bind(J.ILayerPlugin).to(FS).inRequestScope(),es.bind(J.ILayerPlugin).to(ES).inRequestScope(),es.bind(J.ILayerPlugin).to(yb).inRequestScope(),es.bind(J.ILayerPlugin).to(MS).inRequestScope(),es.bind(J.ILayerPlugin).to(zS).inRequestScope(),es.bind(J.ILayerPlugin).to(NS).inRequestScope(),es.bind(J.ILayerPlugin).to(Xd).inRequestScope(),es.bind(J.ILayerPlugin).to(BS).inRequestScope(),es.bind(J.ILayerPlugin).to(TS).inRequestScope(),es.bind(J.ILayerPlugin).to(RS).inRequestScope(),es.bind(J.ILayerPlugin).to(DS).inRequestScope(),es.bind(J.ILayerPlugin).to(AS).inRequestScope();var eA="2.5.7";function B0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function tA(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?B0(Object(r),!0).forEach(function(i){ZS(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):B0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function ZS(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function rA(e,n){return GS(e)||VS(e,n)||jS(e,n)||US()}function US(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function jS(e,n){if(!!e){if(typeof e=="string")return N0(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return N0(e,n)}}function N0(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function VS(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function GS(e){if(Array.isArray(e))return e}var nA=null,iA=null,z0,mm,Z0;function U0(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function j0(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?U0(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):U0(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}var HS=(z0=rf(J.IGlobalConfigService),mm=function(){function e(n){(0,be.Z)(this,e),Tn(this,"configService",Z0,this),(0,M.Z)(this,"config",void 0),this.config=n}return(0,Pe.Z)(e,[{key:"setContainer",value:function(r,i){r.bind(J.MapConfig).toConstantValue(j0(j0({},this.config),{},{id:i})),r.bind(J.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),Z0=Kr(mm.prototype,"configService",[z0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mm),WS=G(6158),XS=G.n(WS),ym;(function(e){e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.L7MAP="L7MAP"})(ym||(ym={}));function Dd(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Ov(e,n){var r=gl([],n,e);return fa(r,r,1/r[3]),r}function aA(e,n){var r=e%n;return r<0?n+r:r}function oA(e,n,r){return r*n+(1-r)*e}function eh(e,n){if(!e)throw new Error(n||"viewport-mercator-project: assertion failed.")}var kc=Math.PI,V0=kc/4,jf=kc/180,G0=180/kc,gm=512,_m=4003e4,YS=1.5;function H0(e){return Math.pow(2,e)}function qS(e){return Math.log2(e)}function kv(e,n){var r=(0,Ft.Z)(e,2),i=r[0],o=r[1];eh(Number.isFinite(i)&&Number.isFinite(n)),eh(Number.isFinite(o)&&o>=-90&&o<=90,"invalid latitude"),n*=gm;var c=i*jf,d=o*jf,y=n*(c+kc)/(2*kc),_=n*(kc-Math.log(Math.tan(V0+d*.5)))/(2*kc);return[y,_]}function xm(e,n){var r=(0,Ft.Z)(e,2),i=r[0],o=r[1];n*=gm;var c=i/n*(2*kc)-kc,d=2*(Math.atan(Math.exp(kc-o/n*(2*kc)))-V0);return[c*G0,d*G0]}function sA(e){var n=e.latitude;assert(Number.isFinite(n));var r=Math.cos(n*jf);return qS(_m*r)-9}function W0(e){var n=e.latitude,r=e.longitude,i=e.zoom,o=e.scale,c=e.highPrecision,d=c===void 0?!1:c;o=o!==void 0?o:H0(i),eh(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(o));var y={},_=gm*o,b=Math.cos(n*jf),T=_/360,A=T/b,O=_/_m/b;if(y.pixelsPerMeter=[O,-O,O],y.metersPerPixel=[1/O,-1/O,1/O],y.pixelsPerDegree=[T,-A,O],y.degreesPerPixel=[1/T,-1/A,1/O],d){var F=jf*Math.tan(n*jf)/b,W=T*F/2,Q=_/_m*F,ue=Q/A*O;y.pixelsPerDegree2=[0,-W,Q],y.pixelsPerMeter2=[ue,0,ue]}return y}function uA(e,n){var r=_slicedToArray(e,3),i=r[0],o=r[1],c=r[2],d=_slicedToArray(n,3),y=d[0],_=d[1],b=d[2],T=1,A=W0({longitude:i,latitude:o,scale:T,highPrecision:!0}),O=A.pixelsPerMeter,F=A.pixelsPerMeter2,W=kv(e,T);W[0]+=y*(O[0]+F[0]*_),W[1]+=_*(O[1]+F[1]*_);var Q=xm(W,T),ue=(c||0)+(b||0);return Number.isFinite(c)||Number.isFinite(b)?[Q[0],Q[1],ue]:Q}function KS(e){var n=e.height,r=e.pitch,i=e.bearing,o=e.altitude,c=e.center,d=c===void 0?null:c,y=e.flipY,_=y===void 0?!1:y,b=Dd();return Ls(b,b,[0,0,-o]),Io(b,b,[1,1,1/n]),Ko(b,b,-r*jf),Oo(b,b,i*jf),_&&Io(b,b,[1,-1,1]),d&&Ls(b,b,Xs.negate([],d)),b}function $S(e){var n=e.width,r=e.height,i=e.altitude,o=i===void 0?YS:i,c=e.pitch,d=c===void 0?0:c,y=e.nearZMultiplier,_=y===void 0?1:y,b=e.farZMultiplier,T=b===void 0?1:b,A=d*jf,O=Math.atan(.5/o),F=Math.sin(O)*o/Math.sin(Math.PI/2-A-O),W=Math.cos(Math.PI/2-A)*F+o;return{fov:2*Math.atan(r/2/o),aspect:n/r,focalDistance:o,near:_,far:W*T}}function JS(e){var n=e.width,r=e.height,i=e.pitch,o=e.altitude,c=e.nearZMultiplier,d=e.farZMultiplier,y=$S({width:n,height:r,altitude:o,pitch:i,nearZMultiplier:c,farZMultiplier:d}),_=y.fov,b=y.aspect,T=y.near,A=y.far,O=Ks([],_,b,T,A);return O}function QS(e,n){var r=(0,Ft.Z)(e,3),i=r[0],o=r[1],c=r[2],d=c===void 0?0:c;return eh(Number.isFinite(i)&&Number.isFinite(o)&&Number.isFinite(d)),Ov(n,[i,o,d,1])}function X0(e,n){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,i=(0,Ft.Z)(e,3),o=i[0],c=i[1],d=i[2];if(eh(Number.isFinite(o)&&Number.isFinite(c),"invalid pixel coordinate"),Number.isFinite(d)){var y=Ov(n,[o,c,d,1]);return y}var _=Ov(n,[o,c,0,1]),b=Ov(n,[o,c,1,1]),T=_[2],A=b[2],O=T===A?0:((r||0)-T)/(A-T);return ri.lerp([],_,b,O)}var Y0=Dd(),eE=function(){function e(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=n.width,i=n.height,o=n.viewMatrix,c=o===void 0?Y0:o,d=n.projectionMatrix,y=d===void 0?Y0:d;(0,be.Z)(this,e),this.width=r||1,this.height=i||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=c,this.projectionMatrix=y;var _=Dd();La(_,_,this.projectionMatrix),La(_,_,this.viewMatrix),this.viewProjectionMatrix=_;var b=Dd();Io(b,b,[this.width/2,-this.height/2,1]),Ls(b,b,[1,-1,0]),La(b,b,this.viewProjectionMatrix);var T=qi(Dd(),b);if(!T)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=T,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,Pe.Z)(e,[{key:"equals",value:function(r){return r instanceof e?r.width===this.width&&r.height===this.height&&fl(r.projectionMatrix,this.projectionMatrix)&&fl(r.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.topLeft,c=o===void 0?!0:o,d=this.projectPosition(r),y=QS(d,this.pixelProjectionMatrix),_=(0,Ft.Z)(y,2),b=_[0],T=_[1],A=c?T:this.height-T;return r.length===2?[b,A]:[b,A,y[2]]}},{key:"unproject",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=i.topLeft,c=o===void 0?!0:o,d=i.targetZ,y=(0,Ft.Z)(r,3),_=y[0],b=y[1],T=y[2],A=c?b:this.height-b,O=d&&d*this.pixelsPerMeter,F=X0([_,A,T],this.pixelUnprojectionMatrix,O),W=this.unprojectPosition(F),Q=(0,Ft.Z)(W,3),ue=Q[0],Oe=Q[1],rt=Q[2];return Number.isFinite(T)?[ue,Oe,rt]:Number.isFinite(d)?[ue,Oe,d]:[ue,Oe]}},{key:"projectPosition",value:function(r){var i=this.projectFlat(r),o=(0,Ft.Z)(i,2),c=o[0],d=o[1],y=(r[2]||0)*this.pixelsPerMeter;return[c,d,y]}},{key:"unprojectPosition",value:function(r){var i=this.unprojectFlat(r),o=(0,Ft.Z)(i,2),c=o[0],d=o[1],y=(r[2]||0)/this.pixelsPerMeter;return[c,d,y]}},{key:"projectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}},{key:"unprojectFlat",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return r}}]),e}();function tE(e){var n=e.width,r=e.height,i=e.bounds,o=e.minExtent,c=o===void 0?0:o,d=e.maxZoom,y=d===void 0?24:d,_=e.padding,b=_===void 0?0:_,T=e.offset,A=T===void 0?[0,0]:T,O=(0,Ft.Z)(i,2),F=(0,Ft.Z)(O[0],2),W=F[0],Q=F[1],ue=(0,Ft.Z)(O[1],2),Oe=ue[0],rt=ue[1];if(Number.isFinite(b)){var lt=b;b={top:lt,bottom:lt,left:lt,right:lt}}else eh(Number.isFinite(b.top)&&Number.isFinite(b.bottom)&&Number.isFinite(b.left)&&Number.isFinite(b.right));var At=new q0({width:n,height:r,longitude:0,latitude:0,zoom:0}),Ot=At.project([W,rt]),Ut=At.project([Oe,Q]),Gt=[Math.max(Math.abs(Ut[0]-Ot[0]),c),Math.max(Math.abs(Ut[1]-Ot[1]),c)],gr=[n-b.left-b.right-Math.abs(A[0])*2,r-b.top-b.bottom-Math.abs(A[1])*2];eh(gr[0]>0&&gr[1]>0);var Nr=gr[0]/Gt[0],Xr=gr[1]/Gt[1],Er=(b.right-b.left)/2/Nr,on=(b.bottom-b.top)/2/Xr,Ln=[(Ut[0]+Ot[0])/2+Er,(Ut[1]+Ot[1])/2+on],Hn=At.unproject(Ln),Ga=At.zoom+Math.log2(Math.abs(Math.min(Nr,Xr)));return{longitude:Hn[0],latitude:Hn[1],zoom:Math.min(Ga,y)}}var q0=function(e){(0,Je.Z)(n,e);function n(){var r,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=i.width,c=i.height,d=i.latitude,y=d===void 0?0:d,_=i.longitude,b=_===void 0?0:_,T=i.zoom,A=T===void 0?0:T,O=i.pitch,F=O===void 0?0:O,W=i.bearing,Q=W===void 0?0:W,ue=i.altitude,Oe=ue===void 0?1.5:ue,rt=i.nearZMultiplier,lt=i.farZMultiplier;(0,be.Z)(this,n),o=o||1,c=c||1;var At=H0(A);Oe=Math.max(.75,Oe);var Ot=kv([b,y],At);Ot[2]=0;var Ut=JS({width:o,height:c,pitch:F,bearing:Q,altitude:Oe,nearZMultiplier:rt||1/c,farZMultiplier:lt||1.01}),Gt=KS({height:c,center:Ot,pitch:F,bearing:Q,altitude:Oe,flipY:!0});return r=(0,Et.Z)(this,(0,_t.Z)(n).call(this,{width:o,height:c,viewMatrix:Gt,projectionMatrix:Ut})),r.latitude=y,r.longitude=b,r.zoom=A,r.pitch=F,r.bearing=Q,r.altitude=Oe,r.scale=At,r.center=Ot,r.pixelsPerMeter=W0((0,H.Z)((0,H.Z)(r))).pixelsPerMeter[2],Object.freeze((0,H.Z)((0,H.Z)(r))),r}return(0,Pe.Z)(n,[{key:"projectFlat",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return kv(i,o)}},{key:"unprojectFlat",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return xm(i,o)}},{key:"getMapCenterByLngLatPosition",value:function(i){var o=i.lngLat,c=i.pos,d=X0(c,this.pixelUnprojectionMatrix),y=kv(o,this.scale),_=ri.add([],y,ri.negate([],d)),b=ri.add([],this.center,_);return xm(b,this.scale)}},{key:"getLocationAtPoint",value:function(i){var o=i.lngLat,c=i.pos;return this.getMapCenterByLngLatPosition({lngLat:o,pos:c})}},{key:"fitBounds",value:function(i){var o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=this.width,d=this.height,y=tE(Object.assign({width:c,height:d,bounds:i},o)),_=y.longitude,b=y.latitude,T=y.zoom;return new n({width:c,height:d,longitude:_,latitude:b,zoom:T})}}]),n}(eE),rE=function(){function e(){(0,be.Z)(this,e),(0,M.Z)(this,"viewport",void 0)}return(0,Pe.Z)(e,[{key:"syncWithMapCamera",value:function(r){var i=r.center,o=r.zoom,c=r.pitch,d=r.bearing,y=r.viewportHeight,_=r.viewportWidth;this.viewport=new q0({width:_,height:y,longitude:i&&i[0],latitude:i&&i[1],zoom:o,pitch:c,bearing:d})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(r,i){return this.viewport.projectFlat(r,i)}}]),e}(),K0={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},nE=["id","attributionControl","style","token","rotation","mapInstance"],$0,J0,Q0,e_,t_,r_,Xh,n_,i_,a_,o_;function s_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function iE(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?s_(Object(r),!0).forEach(function(i){(0,M.Z)(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function aE(e,n){if(n||(n=document),!!n){var r=n.head||n.getElementsByTagName("head")[0];if(!r){r=n.createElement("head");var i=n.body||n.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(r,i):n.documentElement.appendChild(r)}var o=n.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(n.createTextNode(e)),r.appendChild(o),o}}aE(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=XS();var u_={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},oE=0,sE=12,l_="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",uE=($0=(0,ie.b2)(),J0=(0,ie.f3)(J.MapConfig),Q0=(0,ie.f3)(J.IGlobalConfigService),e_=(0,ie.f3)(J.ICoordinateSystemService),t_=(0,ie.f3)(J.IEventEmitter),$0(r_=(Xh=function(){function e(){var n=this;(0,be.Z)(this,e),(0,M.Z)(this,"version",ym.MAPBOX),(0,M.Z)(this,"map",void 0),Tn(this,"config",n_,this),Tn(this,"configService",i_,this),Tn(this,"coordinateSystemService",a_,this),Tn(this,"eventEmitter",o_,this),(0,M.Z)(this,"viewport",void 0),(0,M.Z)(this,"markerContainer",void 0),(0,M.Z)(this,"cameraChangedCallback",void 0),(0,M.Z)(this,"$mapContainer",void 0),(0,M.Z)(this,"handleCameraChanged",function(){var r=n.map.getCenter().wrap(),i=r.lat,o=r.lng;n.viewport.syncWithMapCamera({bearing:n.map.getBearing(),center:[o,i],viewportHeight:n.map.transform.height,pitch:n.map.getPitch(),viewportWidth:n.map.transform.width,zoom:n.map.getZoom(),cameraHeight:0});var c=n.config.offsetZoom,d=c===void 0?sE:c;n.viewport.getZoom()>d?n.coordinateSystemService.setCoordinateSystem(Bo.LNGLAT_OFFSET):n.coordinateSystemService.setCoordinateSystem(Bo.LNGLAT),n.cameraChangedCallback(n.viewport)})}return(0,Pe.Z)(e,[{key:"addMarkerContainer",value:function(){var r=this.map.getCanvasContainer();this.markerContainer=Bt("div","l7-marker-container",r),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(r,i){un.indexOf(r)!==-1?this.eventEmitter.on(r,i):this.map.on(u_[r]||r,i)}},{key:"off",value:function(r,i){this.map.off(u_[r]||r,i)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var r=this.map.transform;return[r.width,r.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(r){return this.map.setZoom(r)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(r){this.map.setCenter(r)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(r){this.map.setBearing(r)}},{key:"zoomIn",value:function(r,i){this.map.zoomIn(r,i)}},{key:"zoomOut",value:function(r,i){this.map.zoomOut(r,i)}},{key:"setPitch",value:function(r){return this.map.setPitch(r)}},{key:"panTo",value:function(r){this.map.panTo(r)}},{key:"panBy",value:function(r){this.panTo(r)}},{key:"fitBounds",value:function(r,i){this.map.fitBounds(r,i)}},{key:"setMaxZoom",value:function(r){this.map.setMaxZoom(r)}},{key:"setMinZoom",value:function(r){this.map.setMinZoom(r)}},{key:"setMapStatus",value:function(r){r.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),r.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),r.dragEnable===!1&&this.map.dragPan.disable(),r.dragEnable===!0&&this.map.dragPan.enable(),r.rotateEnable===!1&&this.map.dragRotate.disable(),r.rotateEnable===!0&&this.map.dragRotate.enable(),r.keyboardEnable===!1&&this.map.keyboard.disable(),r.keyboardEnable===!0&&this.map.keyboard.enable(),r.zoomEnable===!1&&this.map.scrollZoom.disable(),r.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(r,i){this.map.flyTo({zoom:r,center:i})}},{key:"setMapStyle",value:function(r){this.map.setStyle(this.getMapStyle(r))}},{key:"pixelToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToPixel",value:function(r){return this.map.project(r)}},{key:"containerToLngLat",value:function(r){return this.map.unproject(r)}},{key:"lngLatToContainer",value:function(r){return this.map.project(r)}},{key:"lngLatToMercator",value:function(r,i){var o=window.mapboxgl.MercatorCoordinate.fromLngLat(r,i),c=o.x,d=c===void 0?0:c,y=o.y,_=y===void 0?0:y,b=o.z,T=b===void 0?0:b;return{x:d,y:_,z:T}}},{key:"getModelMatrix",value:function(r,i,o){var c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],d=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},y=window.mapboxgl.MercatorCoordinate.fromLngLat(r,i),_=y.meterInMercatorCoordinateUnits(),b=gu();return Ls(b,b,Xs.fromValues(y.x-d.x,y.y-d.y,y.z||0-d.z)),Io(b,b,Xs.fromValues(_*c[0],-_*c[1],_*c[2])),Ko(b,b,o[0]),xu(b,b,o[1]),Oo(b,b,o[2]),b}},{key:"init",value:function(){var n=(0,Zo.Z)(ga().mark(function i(){var o,c,d,y,_,b,T,A,O,F,W,Q,ue;return ga().wrap(function(rt){for(;;)switch(rt.prev=rt.next){case 0:o=this.config,c=o.id,d=c===void 0?"map":c,y=o.attributionControl,_=y===void 0?!1:y,b=o.style,T=b===void 0?"light":b,A=o.token,O=A===void 0?l_:A,F=o.rotation,W=F===void 0?0:F,Q=o.mapInstance,ue=(0,z.Z)(o,nE),this.viewport=new rE,!Q&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),O===l_&&T!=="blank"&&!window.mapboxgl.accessToken&&!Q&&console.warn(this.configService.getSceneWarninfo("MapToken")),!Q&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=O),Q?(this.map=Q,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(d),this.map=new window.mapboxgl.Map(iE({container:this.$mapContainer,style:this.getMapStyle(T),attributionControl:_,bearing:W},ue))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return rt.stop()}},i,this)}));function r(){return n.apply(this,arguments)}return r}()},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(r){for(var i,o=arguments.length,c=new Array(o>1?o-1:0),d=1;d<o;d++)c[d-1]=arguments[d];(i=this.eventEmitter).emit.apply(i,[r].concat(c))}},{key:"once",value:function(r){for(var i,o=arguments.length,c=new Array(o>1?o-1:0),d=1;d<o;d++)c[d-1]=arguments[d];(i=this.eventEmitter).once.apply(i,[r].concat(c))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(r){var i=this.map.getCanvas(),o=r==="jpg"?i==null?void 0:i.toDataURL("image/jpeg"):i==null?void 0:i.toDataURL("image/png");return o}},{key:"onCameraChanged",value:function(r){this.cameraChangedCallback=r}},{key:"creatAmapContainer",value:function(r){var i=r;typeof r=="string"&&(i=document.getElementById(r));var o=document.createElement("div");return o.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,o.id="l7_mapbox_div"+oE++,i.appendChild(o),o}},{key:"getMapStyle",value:function(r){return typeof r!="string"?r:K0[r]?K0[r]:r}}]),e}(),n_=Kr(Xh.prototype,"config",[J0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),i_=Kr(Xh.prototype,"configService",[Q0],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),a_=Kr(Xh.prototype,"coordinateSystemService",[e_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),o_=Kr(Xh.prototype,"eventEmitter",[t_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xh))||r_);function lE(e){var n=cE();return function(){var i=(0,_t.Z)(e),o;if(n){var c=(0,_t.Z)(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return(0,Et.Z)(this,o)}}function cE(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function fE(e,n){if(n||(n=document),!!n){var r=n.head||n.getElementsByTagName("head")[0];if(!r){r=n.createElement("head");var i=n.body||n.getElementsByTagName("body")[0];i?i.parentNode.insertBefore(r,i):n.documentElement.appendChild(r)}var o=n.createElement("style");return o.type="text/css",o.styleSheet?o.styleSheet.cssText=e:o.appendChild(n.createTextNode(e)),r.appendChild(o),o}}fE(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var pE=function(e){(0,Je.Z)(r,e);var n=lE(r);function r(){return(0,be.Z)(this,r),n.apply(this,arguments)}return(0,Pe.Z)(r,[{key:"getServiceConstructor",value:function(){return uE}}]),r}(HS);function c_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function f_(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?c_(Object(r),!0).forEach(function(i){hE(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function hE(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function dE(e,n){return gE(e)||yE(e,n)||mE(e,n)||vE()}function vE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function mE(e,n){if(!!e){if(typeof e=="string")return p_(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return p_(e,n)}}function p_(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function yE(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function gE(e){if(Array.isArray(e))return e}var _E=ve.memo(function(e){var n=e.style,r=e.className,i=e.map,o=e.option,c=e.onSceneLoaded,d=(0,ve.createRef)(),y=(0,ve.useState)(),_=dE(y,2),b=_[0],T=_[1];return(0,ve.useEffect)(function(){var A=new Eh(f_(f_({id:d.current},o),{},{map:new pE(i)}));return A.on("loaded",function(){T(A),c&&c(A)}),function(){A.destroy()}},[]),(0,ve.useEffect)(function(){b&&i.style&&b.setMapStyle(i.style)},[JSON.stringify(i.style)]),(0,ve.useEffect)(function(){b&&i.zoom&&b.setZoom(i.zoom)},[i.zoom]),(0,ve.useEffect)(function(){b&&i.center&&b.setCenter(i.center)},[JSON.stringify(i.center)]),(0,ve.useEffect)(function(){b&&i.pitch!==void 0&&b.setPitch(i.pitch||0)},[i.pitch]),(0,ve.useEffect)(function(){b&&i.rotation&&b.setRotation(i.rotation)},[i.rotation]),ve.createElement(v.Provider,{value:b},(0,ve.createElement)("div",{ref:d,style:n,className:r},b&&e.children))}),xE=_E;function h_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function lA(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?h_(Object(r),!0).forEach(function(i){bE(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):h_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function bE(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function cA(e,n){return CE(e)||EE(e,n)||SE(e,n)||wE()}function wE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function SE(e,n){if(!!e){if(typeof e=="string")return d_(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return d_(e,n)}}function d_(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function EE(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function CE(e){if(Array.isArray(e))return e}var fA=null,pA=null;function v_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function hA(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?v_(Object(r),!0).forEach(function(i){TE(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function TE(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function dA(e,n){return IE(e)||PE(e,n)||ME(e,n)||AE()}function AE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ME(e,n){if(!!e){if(typeof e=="string")return m_(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return m_(e,n)}}function m_(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function PE(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function IE(e){if(Array.isArray(e))return e}var vA=null,mA=null;function yA(e,n){return RE(e)||LE(e,n)||kE(e,n)||OE()}function OE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function kE(e,n){if(!!e){if(typeof e=="string")return y_(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return y_(e,n)}}function y_(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function LE(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function RE(e){if(Array.isArray(e))return e}var gA=null,_A=null;function g_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function xA(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?g_(Object(r),!0).forEach(function(i){DE(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):g_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function DE(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function bA(e,n){if(e==null)return{};var r=FE(e,n),i,o;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)i=c[o],!(n.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(r[i]=e[i]))}return r}function FE(e,n){if(e==null)return{};var r={},i=Object.keys(e),o,c;for(c=0;c<i.length;c++)o=i[c],!(n.indexOf(o)>=0)&&(r[o]=e[o]);return r}var wA=null,__=G(73935);function BE(e,n){return UE(e)||ZE(e,n)||zE(e,n)||NE()}function NE(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function zE(e,n){if(!!e){if(typeof e=="string")return x_(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return x_(e,n)}}function x_(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function ZE(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function UE(e){if(Array.isArray(e))return e}var jE=ve.useEffect,VE=ve.useState;function SA(e){var n=e.className,r=e.style,i=e.children,o=e.position,c=useSceneValue(),d=VE(function(){return document.createElement("div")}),y=BE(d,1),_=y[0];return jE(function(){var b=new Control({position:o});return b.onAdd=function(){if(n&&(_.className=n),r){var T=Object.keys(r).map(function(A){return"".concat(A,":").concat(r[A])}).join(";");_.style.cssText=T}return _},c.addControl(b),function(){c.removeControl(b)}},[]),createPortal(i,_)}var b_=(0,ve.createContext)({});function EA(){return useContext(b_)}var GE=ve.useEffect,HE=ve.memo(function(n){var r=n.layer,i=n.active;return GE(function(){r.active(i.option)},[JSON.stringify(i)]),null}),WE=ve.useEffect,XE=ve.memo(function(n){var r=n.layer,i=n.animate;return WE(function(){r.animate(i)},[JSON.stringify(i)]),null}),YE=ve.useEffect,qE=ve.memo(function(n){var r=n.layer,i=n.color;return YE(function(){i.field?r.color(i.field,i.values):r.color(i.values)},[i.field,i.scale,JSON.stringify(i.values),JSON.stringify(i.options)]),null}),KE=ve.useEffect,$E=ve.memo(function(n){var r=n.layer,i=n.filter;return KE(function(){i.field&&r.filter(i.field,i.values)},[i.field,i.values,JSON.stringify(i.values),JSON.stringify(i.options)]),null}),JE=ve.useEffect,QE=ve.memo(function(n){var r=n.layer,i=n.scale;return JE(function(){r.scale(i.values)},[i.values]),null}),eC=ve.useEffect,tC=ve.memo(function(n){var r=n.layer,i=n.select;return eC(function(){r.select(i.option)},[JSON.stringify(i)]),null}),rC=ve.useEffect,nC=ve.memo(function(n){var r=n.layer,i=n.shape;return rC(function(){i.field?r.shape(i.field,i.values):r.shape(i.values)},[i.field,JSON.stringify(i.values),JSON.stringify(i.options)]),null}),iC=ve.useEffect,aC=ve.memo(function(n){var r=n.layer,i=n.size;return iC(function(){i.field?r.size(i.field,i.values):r.size(i.values)},[i.field,i.scale,JSON.stringify(i.values),JSON.stringify(i.options)]),null}),oC=["data"];function sC(e,n){if(e==null)return{};var r=uC(e,n),i,o;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);for(o=0;o<c.length;o++)i=c[o],!(n.indexOf(i)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,i)||(r[i]=e[i]))}return r}function uC(e,n){if(e==null)return{};var r={},i=Object.keys(e),o,c;for(c=0;c<i.length;c++)o=i[c],!(n.indexOf(o)>=0)&&(r[o]=e[o]);return r}var lC=ve.useEffect,cC=ve.memo(function(n){var r=n.layer,i=n.source,o=i.data,c=sC(i,oC);return lC(function(){r.inited?r.setData(o,c):r.source(o,c),c.autoFit&&r.fitBounds(c&&c.fitBoundsOptions)},[o,JSON.stringify(c)]),null}),fC=ve.useEffect,pC=ve.memo(function(n){var r=n.layer,i=n.style;return fC(function(){r.style(i)},Object.keys(i).map(function(o){return i[o]})),null});function hC(e,n){return yC(e)||mC(e,n)||vC(e,n)||dC()}function dC(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vC(e,n){if(!!e){if(typeof e=="string")return w_(e,n);var r=Object.prototype.toString.call(e).slice(8,-1);if(r==="Object"&&e.constructor&&(r=e.constructor.name),r==="Map"||r==="Set")return Array.from(e);if(r==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return w_(e,n)}}function w_(e,n){(n==null||n>e.length)&&(n=e.length);for(var r=0,i=new Array(n);r<n;r++)i[r]=e[r];return i}function mC(e,n){var r=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(r!=null){var i=[],o=!0,c=!1,d,y;try{for(r=r.call(e);!(o=(d=r.next()).done)&&(i.push(d.value),!(n&&i.length===n));o=!0);}catch(_){c=!0,y=_}finally{try{!o&&r.return!=null&&r.return()}finally{if(c)throw y}}return i}}function yC(e){if(Array.isArray(e))return e}var Fd=ve.useEffect,gC=ve.useState;function S_(e,n){var r=n.source,i=n.color,o=n.shape,c=n.style,d=n.size,y=n.scale,_=n.active,b=n.select,T=n.filter,A=n.animate,O=n.options,F=n.onLayerLoaded,W=ye(),Q=gC(function(){var rt;switch(e){case"polygonLayer":rt=new ay(O);break;case"lineLayer":rt=new ix(O);break;case"pointLayer":rt=new Hx(O);break;case"heatmapLayer":rt=new x1(O);break;case"rasterLayer":rt=new db(O);break;case"imageLayer":rt=new I1(O);break;case"citybuildingLayer":rt=new H_(O);break;default:rt=new ay(O)}return rt.on("inited",function(){F&&F(rt,W)}),rt}),ue=hC(Q,1),Oe=ue[0];return Fd(function(){return W.addLayer(Oe),function(){W.removeLayer(Oe)}},[]),Fd(function(){Oe.inited&&O&&Oe.updateLayerConfig(O)},[O==null?void 0:O.minZoom,O==null?void 0:O.maxZoom,O==null?void 0:O.visible]),Fd(function(){Oe.inited&&(O==null?void 0:O.zIndex)&&Oe.setIndex(O.zIndex)},[O==null?void 0:O.zIndex]),Fd(function(){Oe.inited&&(O==null?void 0:O.blend)&&Oe.setBlend(O.blend)},[O==null?void 0:O.blend]),Fd(function(){W.render()}),ve.createElement(b_.Provider,{value:Oe},ve.createElement(cC,{layer:Oe,source:r}),y&&ve.createElement(QE,{layer:Oe,scale:y}),i&&ve.createElement(qE,{layer:Oe,color:i}),d&&ve.createElement(aC,{layer:Oe,size:d}),o&&ve.createElement(nC,{layer:Oe,shape:o}),c&&ve.createElement(pC,{layer:Oe,style:c}),_&&ve.createElement(HE,{layer:Oe,active:_}),b&&ve.createElement(tC,{layer:Oe,select:b}),T&&ve.createElement($E,{layer:Oe,filter:T}),A&&ve.createElement(XE,{layer:Oe,animate:A}),n.children)}var CA=null,TA=null,_C=ve.memo(function(n){return S_("pointLayer",n)}),xC=ve.memo(function(n){return S_("heatmapLayer",n)}),AA=null,MA=null,PA=null,IA=ve.useEffect,OA=null,kA=null;function Lv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Lv=function(r){return typeof r}:Lv=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Lv(e)}function E_(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);n&&(i=i.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),r.push.apply(r,i)}return r}function Rv(e){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?E_(Object(r),!0).forEach(function(i){bC(e,i,r[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):E_(Object(r)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(r,i))})}return e}function bC(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function wC(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function C_(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function SC(e,n,r){return n&&C_(e.prototype,n),r&&C_(e,r),e}function EC(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&bm(e,n)}function bm(e,n){return bm=Object.setPrototypeOf||function(i,o){return i.__proto__=o,i},bm(e,n)}function CC(e){var n=MC();return function(){var i=Dv(e),o;if(n){var c=Dv(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return TC(this,o)}}function TC(e,n){return n&&(Lv(n)==="object"||typeof n=="function")?n:AC(e)}function AC(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function MC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Dv(e){return Dv=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Dv(e)}var LA=function(e){EC(r,e);var n=CC(r);function r(i){var o;return wC(this,r),o=n.call(this,i),o.el=void 0,o.scene=void 0,o.popup=void 0,o.el=document.createElement("div"),o}return SC(r,[{key:"componentDidMount",value:function(){var o,c=this.props,d=c.lnglat,y=c.children,_=c.option,b=c.lngLat,T=new Iu(Rv(Rv({},_),{},{stopPropagation:(o=this.props.option)===null||o===void 0?void 0:o.stopPropagation}));d&&T.setLnglat(d),b&&T.setLnglat(b),y&&T.setDOMContent(this.el),this.popup=T,this.scene.addPopup(T)}},{key:"componentDidUpdate",value:function(o){var c,d,y,_,b,T,A=Array.isArray(o.lnglat)?o.lnglat:[o==null||(c=o.lnglat)===null||c===void 0?void 0:c.lng,o==null||(d=o.lnglat)===null||d===void 0?void 0:d.lat],O=Array.isArray(this.props.lnglat)?this.props.lnglat:[(y=this.props)===null||y===void 0||(_=y.lnglat)===null||_===void 0?void 0:_.lng,(b=this.props)===null||b===void 0||(T=b.lnglat)===null||T===void 0?void 0:T.lat],F=A.toString()!==O.toString();if(F){var W;this.popup.remove(),this.popup=new Iu(Rv(Rv({},this.props.option),{},{stopPropagation:(W=this.props.option)===null||W===void 0?void 0:W.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var o=this;return ve.createElement(v.Consumer,{},function(c){return c&&(o.scene=c),(0,__.createPortal)(o.props.children,o.el)})}}]),r}(ve.PureComponent);function Fv(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Fv=function(r){return typeof r}:Fv=function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Fv(e)}function PC(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function T_(e,n){for(var r=0;r<n.length;r++){var i=n[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function IC(e,n,r){return n&&T_(e.prototype,n),r&&T_(e,r),e}function OC(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),n&&wm(e,n)}function wm(e,n){return wm=Object.setPrototypeOf||function(i,o){return i.__proto__=o,i},wm(e,n)}function kC(e){var n=DC();return function(){var i=Bv(e),o;if(n){var c=Bv(this).constructor;o=Reflect.construct(i,arguments,c)}else o=i.apply(this,arguments);return LC(this,o)}}function LC(e,n){return n&&(Fv(n)==="object"||typeof n=="function")?n:RC(e)}function RC(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function DC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function Bv(e){return Bv=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},Bv(e)}var RA=function(e){OC(r,e);var n=kC(r);function r(i){var o;return PC(this,r),o=n.call(this,i),o.el=void 0,o.scene=void 0,o.marker=void 0,o.el=document.createElement("div"),o}return IC(r,[{key:"componentDidMount",value:function(){var o=this.props,c=o.lnglat,d=o.children,y=o.option,_=o.onMarkerLoaded,b=new _i(y);c&&b.setLnglat(c),d&&b.setElement(this.el),this.marker=b,_&&_(b),this.scene.addMarker(b)}},{key:"componentDidUpdate",value:function(o){var c,d=(o==null?void 0:o.lnglat.toString())!==((c=this.props)===null||c===void 0?void 0:c.lnglat.toString());d&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var o=this;return ve.createElement(v.Consumer,{},function(c){return c&&(o.scene=c),(0,__.createPortal)(o.props.children,o.el)})}}]),r}(ve.PureComponent),DA=ve.useEffect,FA=null,BA=null,NA=ve.useEffect,zA=null},6563:function(hr,X,G){var Me=G(31795);hr.exports=ve;function ve(ie,fe){switch(ie&&ie.type||null){case"FeatureCollection":return ie.features=ie.features.map(v(ve,fe)),ie;case"GeometryCollection":return ie.geometries=ie.geometries.map(v(ve,fe)),ie;case"Feature":return ie.geometry=ve(ie.geometry,fe),ie;case"Polygon":case"MultiPolygon":return ye(ie,fe);default:return ie}}function v(ie,fe){return function(J){return ie(J,fe)}}function ye(ie,fe){return ie.type==="Polygon"?ie.coordinates=Z(ie.coordinates,fe):ie.type==="MultiPolygon"&&(ie.coordinates=ie.coordinates.map(v(Z,fe))),ie}function Z(ie,fe){fe=!!fe,ie[0]=oe(ie[0],fe);for(var J=1;J<ie.length;J++)ie[J]=oe(ie[J],!fe);return ie}function oe(ie,fe){return me(ie)===fe?ie:ie.reverse()}function me(ie){return Me.ring(ie)>=0}},66213:function(hr,X,G){"use strict";G.d(X,{Z:function(){return v}});var Me=G(77608);function ve(ye,Z){for(;!Object.prototype.hasOwnProperty.call(ye,Z)&&(ye=(0,Me.Z)(ye),ye!==null););return ye}function v(ye,Z,oe){return typeof Reflect!="undefined"&&Reflect.get?v=Reflect.get:v=function(ie,fe,J){var be=ve(ie,fe);if(!!be){var Pe=Object.getOwnPropertyDescriptor(be,fe);return Pe.get?Pe.get.call(J):Pe.value}},v(ye,Z,oe||ye)}},31795:function(hr,X,G){var Me=G(75752);hr.exports.geometry=ve,hr.exports.ring=ye;function ve(oe){var me=0,ie;switch(oe.type){case"Polygon":return v(oe.coordinates);case"MultiPolygon":for(ie=0;ie<oe.coordinates.length;ie++)me+=v(oe.coordinates[ie]);return me;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(ie=0;ie<oe.geometries.length;ie++)me+=ve(oe.geometries[ie]);return me}}function v(oe){var me=0;if(oe&&oe.length>0){me+=Math.abs(ye(oe[0]));for(var ie=1;ie<oe.length;ie++)me-=Math.abs(ye(oe[ie]))}return me}function ye(oe){var me,ie,fe,J,be,Pe,M,Jt=0,Ht=oe.length;if(Ht>2){for(M=0;M<Ht;M++)M===Ht-2?(J=Ht-2,be=Ht-1,Pe=0):M===Ht-1?(J=Ht-1,be=0,Pe=1):(J=M,be=M+1,Pe=M+2),me=oe[J],ie=oe[be],fe=oe[Pe],Jt+=(Z(fe[0])-Z(me[0]))*Math.sin(Z(ie[1]));Jt=Jt*Me.RADIUS*Me.RADIUS/2}return Jt}function Z(oe){return oe*Math.PI/180}},49296:function(hr){"use strict";hr.exports=G,hr.exports.default=G;var X=1e20;function G(Z,oe,me,ie,fe,J){this.fontSize=Z||24,this.buffer=oe===void 0?3:oe,this.cutoff=ie||.25,this.fontFamily=fe||"sans-serif",this.fontWeight=J||"normal",this.radius=me||8;var be=this.size=this.fontSize+this.buffer*2,Pe=be+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=be,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Pe*Pe),this.gridInner=new Float64Array(Pe*Pe),this.f=new Float64Array(Pe),this.z=new Float64Array(Pe+1),this.v=new Uint16Array(Pe),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(be/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Me(Z,oe,me,ie,fe,J,be){J.fill(X,0,oe*me),be.fill(0,0,oe*me);for(var Pe=(oe-ie)/2,M=0;M<fe;M++)for(var Jt=0;Jt<ie;Jt++){var Ht=(M+Pe)*oe+Jt+Pe,Ft=Z.data[4*(M*ie+Jt)+3]/255;if(Ft===1)J[Ht]=0,be[Ht]=X;else if(Ft===0)J[Ht]=X,be[Ht]=0;else{var jt=Math.max(0,.5-Ft),ft=Math.max(0,Ft-.5);J[Ht]=jt*jt,be[Ht]=ft*ft}}}function ve(Z,oe,me,ie,fe,J,be){for(var Pe=0;Pe<oe*me;Pe++){var M=Math.sqrt(ie[Pe])-Math.sqrt(fe[Pe]);Z[Pe]=Math.round(255-255*(M/J+be))}}G.prototype._draw=function(Z,oe){var me=this.ctx.measureText(Z),ie=me.width,fe=2*this.buffer,J,be,Pe,M,Jt,Ht,Ft,jt;oe&&this.useMetrics?(Jt=Math.floor(me.actualBoundingBoxAscent),jt=this.buffer+Math.ceil(me.actualBoundingBoxAscent),Ht=this.buffer,Ft=this.buffer,be=Math.min(this.size,Math.ceil(me.actualBoundingBoxRight-me.actualBoundingBoxLeft)),M=Math.min(this.size-Ht,Math.ceil(me.actualBoundingBoxAscent+me.actualBoundingBoxDescent)),J=be+fe,Pe=M+fe,this.ctx.textBaseline="alphabetic"):(J=be=this.size,Pe=M=this.size,Jt=19*this.fontSize/24,Ht=Ft=0,jt=this.middle,this.ctx.textBaseline="middle");var ft;be&&M&&(this.ctx.clearRect(Ft,Ht,be,M),this.ctx.fillText(Z,this.buffer,jt),ft=this.ctx.getImageData(Ft,Ht,be,M));var dt=new Uint8ClampedArray(J*Pe);return Me(ft,J,Pe,be,M,this.gridOuter,this.gridInner),v(this.gridOuter,J,Pe,this.f,this.v,this.z),v(this.gridInner,J,Pe,this.f,this.v,this.z),ve(dt,J,Pe,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:dt,metrics:{width:be,height:M,sdfWidth:J,sdfHeight:Pe,top:Jt,left:0,advance:ie}}},G.prototype.draw=function(Z){return this._draw(Z,!1).data},G.prototype.drawWithMetrics=function(Z){return this._draw(Z,!0)};function v(Z,oe,me,ie,fe,J){for(var be=0;be<oe;be++)ye(Z,be,oe,me,ie,fe,J);for(var Pe=0;Pe<me;Pe++)ye(Z,Pe*oe,1,oe,ie,fe,J)}function ye(Z,oe,me,ie,fe,J,be){var Pe,M,Jt,Ht;for(J[0]=0,be[0]=-X,be[1]=X,Pe=0;Pe<ie;Pe++)fe[Pe]=Z[oe+Pe*me];for(Pe=1,M=0,Jt=0;Pe<ie;Pe++){do Ht=J[M],Jt=(fe[Pe]-fe[Ht]+Pe*Pe-Ht*Ht)/(Pe-Ht)/2;while(Jt<=be[M]&&--M>-1);M++,J[M]=Pe,be[M]=Jt,be[M+1]=X}for(Pe=0,M=0;Pe<ie;Pe++){for(;be[M+1]<Pe;)M++;Ht=J[M],Z[oe+Pe*me]=fe[Ht]+(Pe-Ht)*(Pe-Ht)}}},17781:function(hr){hr.exports={"ant-pro-grid-content":"ant-pro-grid-content",wide:"wide"}},9187:function(hr){"use strict";hr.exports=X,hr.exports.default=X;function X(Ee,Ve,ke){ke=ke||2;var vt=Ve&&Ve.length,Ke=vt?Ve[0]*ke:Ee.length,H=G(Ee,0,Ke,ke,!0),Je=[];if(!H||H.next===H.prev)return Je;var Et,_t,Yr,wi,On,An,gn;if(vt&&(H=me(Ee,Ve,H,ke)),Ee.length>80*ke){Et=Yr=Ee[0],_t=wi=Ee[1];for(var Cn=ke;Cn<Ke;Cn+=ke)On=Ee[Cn],An=Ee[Cn+1],On<Et&&(Et=On),An<_t&&(_t=An),On>Yr&&(Yr=On),An>wi&&(wi=An);gn=Math.max(Yr-Et,wi-_t),gn=gn!==0?1/gn:0}return ve(H,Je,ke,Et,_t,gn),Je}function G(Ee,Ve,ke,vt,Ke){var H,Je;if(Ke===Vr(Ee,Ve,ke,vt)>0)for(H=Ve;H<ke;H+=vt)Je=Lt(H,Ee[H],Ee[H+1],Je);else for(H=ke-vt;H>=Ve;H-=vt)Je=Lt(H,Ee[H],Ee[H+1],Je);return Je&&dt(Je,Je.next)&&(ur(Je),Je=Je.next),Je}function Me(Ee,Ve){if(!Ee)return Ee;Ve||(Ve=Ee);var ke=Ee,vt;do if(vt=!1,!ke.steiner&&(dt(ke,ke.next)||ft(ke.prev,ke,ke.next)===0)){if(ur(ke),ke=Ve=ke.prev,ke===ke.next)break;vt=!0}else ke=ke.next;while(vt||ke!==Ve);return Ve}function ve(Ee,Ve,ke,vt,Ke,H,Je){if(!!Ee){!Je&&H&&Pe(Ee,vt,Ke,H);for(var Et=Ee,_t,Yr;Ee.prev!==Ee.next;){if(_t=Ee.prev,Yr=Ee.next,H?ye(Ee,vt,Ke,H):v(Ee)){Ve.push(_t.i/ke),Ve.push(Ee.i/ke),Ve.push(Yr.i/ke),ur(Ee),Ee=Yr.next,Et=Yr.next;continue}if(Ee=Yr,Ee===Et){Je?Je===1?(Ee=Z(Me(Ee),Ve,ke),ve(Ee,Ve,ke,vt,Ke,H,2)):Je===2&&oe(Ee,Ve,ke,vt,Ke,H):ve(Me(Ee),Ve,ke,vt,Ke,H,1);break}}}}function v(Ee){var Ve=Ee.prev,ke=Ee,vt=Ee.next;if(ft(Ve,ke,vt)>=0)return!1;for(var Ke=Ee.next.next;Ke!==Ee.prev;){if(Ft(Ve.x,Ve.y,ke.x,ke.y,vt.x,vt.y,Ke.x,Ke.y)&&ft(Ke.prev,Ke,Ke.next)>=0)return!1;Ke=Ke.next}return!0}function ye(Ee,Ve,ke,vt){var Ke=Ee.prev,H=Ee,Je=Ee.next;if(ft(Ke,H,Je)>=0)return!1;for(var Et=Ke.x<H.x?Ke.x<Je.x?Ke.x:Je.x:H.x<Je.x?H.x:Je.x,_t=Ke.y<H.y?Ke.y<Je.y?Ke.y:Je.y:H.y<Je.y?H.y:Je.y,Yr=Ke.x>H.x?Ke.x>Je.x?Ke.x:Je.x:H.x>Je.x?H.x:Je.x,wi=Ke.y>H.y?Ke.y>Je.y?Ke.y:Je.y:H.y>Je.y?H.y:Je.y,On=Jt(Et,_t,Ve,ke,vt),An=Jt(Yr,wi,Ve,ke,vt),gn=Ee.prevZ,Cn=Ee.nextZ;gn&&gn.z>=On&&Cn&&Cn.z<=An;){if(gn!==Ee.prev&&gn!==Ee.next&&Ft(Ke.x,Ke.y,H.x,H.y,Je.x,Je.y,gn.x,gn.y)&&ft(gn.prev,gn,gn.next)>=0||(gn=gn.prevZ,Cn!==Ee.prev&&Cn!==Ee.next&&Ft(Ke.x,Ke.y,H.x,H.y,Je.x,Je.y,Cn.x,Cn.y)&&ft(Cn.prev,Cn,Cn.next)>=0))return!1;Cn=Cn.nextZ}for(;gn&&gn.z>=On;){if(gn!==Ee.prev&&gn!==Ee.next&&Ft(Ke.x,Ke.y,H.x,H.y,Je.x,Je.y,gn.x,gn.y)&&ft(gn.prev,gn,gn.next)>=0)return!1;gn=gn.prevZ}for(;Cn&&Cn.z<=An;){if(Cn!==Ee.prev&&Cn!==Ee.next&&Ft(Ke.x,Ke.y,H.x,H.y,Je.x,Je.y,Cn.x,Cn.y)&&ft(Cn.prev,Cn,Cn.next)>=0)return!1;Cn=Cn.nextZ}return!0}function Z(Ee,Ve,ke){var vt=Ee;do{var Ke=vt.prev,H=vt.next.next;!dt(Ke,H)&&Ar(Ke,vt,vt.next,H)&&He(Ke,H)&&He(H,Ke)&&(Ve.push(Ke.i/ke),Ve.push(vt.i/ke),Ve.push(H.i/ke),ur(vt),ur(vt.next),vt=Ee=H),vt=vt.next}while(vt!==Ee);return Me(vt)}function oe(Ee,Ve,ke,vt,Ke,H){var Je=Ee;do{for(var Et=Je.next.next;Et!==Je.prev;){if(Je.i!==Et.i&&jt(Je,Et)){var _t=Ye(Je,Et);Je=Me(Je,Je.next),_t=Me(_t,_t.next),ve(Je,Ve,ke,vt,Ke,H),ve(_t,Ve,ke,vt,Ke,H);return}Et=Et.next}Je=Je.next}while(Je!==Ee)}function me(Ee,Ve,ke,vt){var Ke=[],H,Je,Et,_t,Yr;for(H=0,Je=Ve.length;H<Je;H++)Et=Ve[H]*vt,_t=H<Je-1?Ve[H+1]*vt:Ee.length,Yr=G(Ee,Et,_t,vt,!1),Yr===Yr.next&&(Yr.steiner=!0),Ke.push(Ht(Yr));for(Ke.sort(ie),H=0;H<Ke.length;H++)ke=fe(Ke[H],ke),ke=Me(ke,ke.next);return ke}function ie(Ee,Ve){return Ee.x-Ve.x}function fe(Ee,Ve){var ke=J(Ee,Ve);if(!ke)return Ve;var vt=Ye(ke,Ee),Ke=Me(ke,ke.next);return Me(vt,vt.next),Ve===ke?Ke:Ve}function J(Ee,Ve){var ke=Ve,vt=Ee.x,Ke=Ee.y,H=-Infinity,Je;do{if(Ke<=ke.y&&Ke>=ke.next.y&&ke.next.y!==ke.y){var Et=ke.x+(Ke-ke.y)*(ke.next.x-ke.x)/(ke.next.y-ke.y);if(Et<=vt&&Et>H){if(H=Et,Et===vt){if(Ke===ke.y)return ke;if(Ke===ke.next.y)return ke.next}Je=ke.x<ke.next.x?ke:ke.next}}ke=ke.next}while(ke!==Ve);if(!Je)return null;if(vt===H)return Je;var _t=Je,Yr=Je.x,wi=Je.y,On=Infinity,An;ke=Je;do vt>=ke.x&&ke.x>=Yr&&vt!==ke.x&&Ft(Ke<wi?vt:H,Ke,Yr,wi,Ke<wi?H:vt,Ke,ke.x,ke.y)&&(An=Math.abs(Ke-ke.y)/(vt-ke.x),He(ke,Ee)&&(An<On||An===On&&(ke.x>Je.x||ke.x===Je.x&&be(Je,ke)))&&(Je=ke,On=An)),ke=ke.next;while(ke!==_t);return Je}function be(Ee,Ve){return ft(Ee.prev,Ee,Ve.prev)<0&&ft(Ve.next,Ee,Ee.next)<0}function Pe(Ee,Ve,ke,vt){var Ke=Ee;do Ke.z===null&&(Ke.z=Jt(Ke.x,Ke.y,Ve,ke,vt)),Ke.prevZ=Ke.prev,Ke.nextZ=Ke.next,Ke=Ke.next;while(Ke!==Ee);Ke.prevZ.nextZ=null,Ke.prevZ=null,M(Ke)}function M(Ee){var Ve,ke,vt,Ke,H,Je,Et,_t,Yr=1;do{for(ke=Ee,Ee=null,H=null,Je=0;ke;){for(Je++,vt=ke,Et=0,Ve=0;Ve<Yr&&(Et++,vt=vt.nextZ,!!vt);Ve++);for(_t=Yr;Et>0||_t>0&&vt;)Et!==0&&(_t===0||!vt||ke.z<=vt.z)?(Ke=ke,ke=ke.nextZ,Et--):(Ke=vt,vt=vt.nextZ,_t--),H?H.nextZ=Ke:Ee=Ke,Ke.prevZ=H,H=Ke;ke=vt}H.nextZ=null,Yr*=2}while(Je>1);return Ee}function Jt(Ee,Ve,ke,vt,Ke){return Ee=32767*(Ee-ke)*Ke,Ve=32767*(Ve-vt)*Ke,Ee=(Ee|Ee<<8)&16711935,Ee=(Ee|Ee<<4)&252645135,Ee=(Ee|Ee<<2)&858993459,Ee=(Ee|Ee<<1)&1431655765,Ve=(Ve|Ve<<8)&16711935,Ve=(Ve|Ve<<4)&252645135,Ve=(Ve|Ve<<2)&858993459,Ve=(Ve|Ve<<1)&1431655765,Ee|Ve<<1}function Ht(Ee){var Ve=Ee,ke=Ee;do(Ve.x<ke.x||Ve.x===ke.x&&Ve.y<ke.y)&&(ke=Ve),Ve=Ve.next;while(Ve!==Ee);return ke}function Ft(Ee,Ve,ke,vt,Ke,H,Je,Et){return(Ke-Je)*(Ve-Et)-(Ee-Je)*(H-Et)>=0&&(Ee-Je)*(vt-Et)-(ke-Je)*(Ve-Et)>=0&&(ke-Je)*(H-Et)-(Ke-Je)*(vt-Et)>=0}function jt(Ee,Ve){return Ee.next.i!==Ve.i&&Ee.prev.i!==Ve.i&&!ot(Ee,Ve)&&(He(Ee,Ve)&&He(Ve,Ee)&&ut(Ee,Ve)&&(ft(Ee.prev,Ee,Ve.prev)||ft(Ee,Ve.prev,Ve))||dt(Ee,Ve)&&ft(Ee.prev,Ee,Ee.next)>0&&ft(Ve.prev,Ve,Ve.next)>0)}function ft(Ee,Ve,ke){return(Ve.y-Ee.y)*(ke.x-Ve.x)-(Ve.x-Ee.x)*(ke.y-Ve.y)}function dt(Ee,Ve){return Ee.x===Ve.x&&Ee.y===Ve.y}function Ar(Ee,Ve,ke,vt){var Ke=Bt(ft(Ee,Ve,ke)),H=Bt(ft(Ee,Ve,vt)),Je=Bt(ft(ke,vt,Ee)),Et=Bt(ft(ke,vt,Ve));return!!(Ke!==H&&Je!==Et||Ke===0&&cr(Ee,ke,Ve)||H===0&&cr(Ee,vt,Ve)||Je===0&&cr(ke,Ee,vt)||Et===0&&cr(ke,Ve,vt))}function cr(Ee,Ve,ke){return Ve.x<=Math.max(Ee.x,ke.x)&&Ve.x>=Math.min(Ee.x,ke.x)&&Ve.y<=Math.max(Ee.y,ke.y)&&Ve.y>=Math.min(Ee.y,ke.y)}function Bt(Ee){return Ee>0?1:Ee<0?-1:0}function ot(Ee,Ve){var ke=Ee;do{if(ke.i!==Ee.i&&ke.next.i!==Ee.i&&ke.i!==Ve.i&&ke.next.i!==Ve.i&&Ar(ke,ke.next,Ee,Ve))return!0;ke=ke.next}while(ke!==Ee);return!1}function He(Ee,Ve){return ft(Ee.prev,Ee,Ee.next)<0?ft(Ee,Ve,Ee.next)>=0&&ft(Ee,Ee.prev,Ve)>=0:ft(Ee,Ve,Ee.prev)<0||ft(Ee,Ee.next,Ve)<0}function ut(Ee,Ve){var ke=Ee,vt=!1,Ke=(Ee.x+Ve.x)/2,H=(Ee.y+Ve.y)/2;do ke.y>H!=ke.next.y>H&&ke.next.y!==ke.y&&Ke<(ke.next.x-ke.x)*(H-ke.y)/(ke.next.y-ke.y)+ke.x&&(vt=!vt),ke=ke.next;while(ke!==Ee);return vt}function Ye(Ee,Ve){var ke=new Ir(Ee.i,Ee.x,Ee.y),vt=new Ir(Ve.i,Ve.x,Ve.y),Ke=Ee.next,H=Ve.prev;return Ee.next=Ve,Ve.prev=Ee,ke.next=Ke,Ke.prev=ke,vt.next=ke,ke.prev=vt,H.next=vt,vt.prev=H,vt}function Lt(Ee,Ve,ke,vt){var Ke=new Ir(Ee,Ve,ke);return vt?(Ke.next=vt.next,Ke.prev=vt,vt.next.prev=Ke,vt.next=Ke):(Ke.prev=Ke,Ke.next=Ke),Ke}function ur(Ee){Ee.next.prev=Ee.prev,Ee.prev.next=Ee.next,Ee.prevZ&&(Ee.prevZ.nextZ=Ee.nextZ),Ee.nextZ&&(Ee.nextZ.prevZ=Ee.prevZ)}function Ir(Ee,Ve,ke){this.i=Ee,this.x=Ve,this.y=ke,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}X.deviation=function(Ee,Ve,ke,vt){var Ke=Ve&&Ve.length,H=Ke?Ve[0]*ke:Ee.length,Je=Math.abs(Vr(Ee,0,H,ke));if(Ke)for(var Et=0,_t=Ve.length;Et<_t;Et++){var Yr=Ve[Et]*ke,wi=Et<_t-1?Ve[Et+1]*ke:Ee.length;Je-=Math.abs(Vr(Ee,Yr,wi,ke))}var On=0;for(Et=0;Et<vt.length;Et+=3){var An=vt[Et]*ke,gn=vt[Et+1]*ke,Cn=vt[Et+2]*ke;On+=Math.abs((Ee[An]-Ee[Cn])*(Ee[gn+1]-Ee[An+1])-(Ee[An]-Ee[gn])*(Ee[Cn+1]-Ee[An+1]))}return Je===0&&On===0?0:Math.abs((On-Je)/Je)};function Vr(Ee,Ve,ke,vt){for(var Ke=0,H=Ve,Je=ke-vt;H<ke;H+=vt)Ke+=(Ee[Je]-Ee[H])*(Ee[H+1]+Ee[Je+1]),Je=H;return Ke}X.flatten=function(Ee){for(var Ve=Ee[0][0].length,ke={vertices:[],holes:[],dimensions:Ve},vt=0,Ke=0;Ke<Ee.length;Ke++){for(var H=0;H<Ee[Ke].length;H++)for(var Je=0;Je<Ve;Je++)ke.vertices.push(Ee[Ke][H][Je]);Ke>0&&(vt+=Ee[Ke-1].length,ke.holes.push(vt))}return ke}},67709:function(hr){function X(Me){var ve=Me.target||Me.srcElement;ve.__resizeRAF__&&cancelAnimationFrame(ve.__resizeRAF__),ve.__resizeRAF__=requestAnimationFrame(function(){var v=ve.__resizeTrigger__,ye=v&&v.__resizeListeners__;ye&&ye.forEach(function(Z){Z.call(v,Me)})})}var G=function(ve,v){var ye=this,Z=ye.document,oe,me=Z.attachEvent;typeof navigator!="undefined"&&(oe=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function ie(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",X)}if(!ve.__resizeListeners__)if(ve.__resizeListeners__=[],me)ve.__resizeTrigger__=ve,ve.attachEvent("onresize",X);else{getComputedStyle(ve).position==="static"&&(ve.style.position="relative");var fe=ve.__resizeTrigger__=Z.createElement("object");fe.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),fe.setAttribute("class","resize-sensor"),fe.setAttribute("tabindex","-1"),fe.setAttribute("title",""),fe.__resizeElement__=ve,fe.onload=ie,fe.type="text/html",oe&&ve.appendChild(fe),fe.data="about:blank",oe||ve.appendChild(fe)}ve.__resizeListeners__.push(v)};hr.exports=typeof window=="undefined"?G:G.bind(window),hr.exports.unbind=function(Me,ve){var v=document.attachEvent,ye=Me.__resizeListeners__||[];if(ve){var Z=ye.indexOf(ve);Z!==-1&&ye.splice(Z,1)}else ye=Me.__resizeListeners__=[];if(!ye.length){if(v)Me.detachEvent("onresize",X);else if(Me.__resizeTrigger__){var oe=Me.__resizeTrigger__.contentDocument,me=oe&&oe.defaultView;me&&(me.removeEventListener("resize",X),delete me.__resizeTrigger__),Me.__resizeTrigger__=!Me.removeChild(Me.__resizeTrigger__)}delete Me.__resizeListeners__}}},26729:function(hr){"use strict";var X=Object.prototype.hasOwnProperty,G="~";function Me(){}Object.create&&(Me.prototype=Object.create(null),new Me().__proto__||(G=!1));function ve(oe,me,ie){this.fn=oe,this.context=me,this.once=ie||!1}function v(oe,me,ie,fe,J){if(typeof ie!="function")throw new TypeError("The listener must be a function");var be=new ve(ie,fe||oe,J),Pe=G?G+me:me;return oe._events[Pe]?oe._events[Pe].fn?oe._events[Pe]=[oe._events[Pe],be]:oe._events[Pe].push(be):(oe._events[Pe]=be,oe._eventsCount++),oe}function ye(oe,me){--oe._eventsCount==0?oe._events=new Me:delete oe._events[me]}function Z(){this._events=new Me,this._eventsCount=0}Z.prototype.eventNames=function(){var me=[],ie,fe;if(this._eventsCount===0)return me;for(fe in ie=this._events)X.call(ie,fe)&&me.push(G?fe.slice(1):fe);return Object.getOwnPropertySymbols?me.concat(Object.getOwnPropertySymbols(ie)):me},Z.prototype.listeners=function(me){var ie=G?G+me:me,fe=this._events[ie];if(!fe)return[];if(fe.fn)return[fe.fn];for(var J=0,be=fe.length,Pe=new Array(be);J<be;J++)Pe[J]=fe[J].fn;return Pe},Z.prototype.listenerCount=function(me){var ie=G?G+me:me,fe=this._events[ie];return fe?fe.fn?1:fe.length:0},Z.prototype.emit=function(me,ie,fe,J,be,Pe){var M=G?G+me:me;if(!this._events[M])return!1;var Jt=this._events[M],Ht=arguments.length,Ft,jt;if(Jt.fn){switch(Jt.once&&this.removeListener(me,Jt.fn,void 0,!0),Ht){case 1:return Jt.fn.call(Jt.context),!0;case 2:return Jt.fn.call(Jt.context,ie),!0;case 3:return Jt.fn.call(Jt.context,ie,fe),!0;case 4:return Jt.fn.call(Jt.context,ie,fe,J),!0;case 5:return Jt.fn.call(Jt.context,ie,fe,J,be),!0;case 6:return Jt.fn.call(Jt.context,ie,fe,J,be,Pe),!0}for(jt=1,Ft=new Array(Ht-1);jt<Ht;jt++)Ft[jt-1]=arguments[jt];Jt.fn.apply(Jt.context,Ft)}else{var ft=Jt.length,dt;for(jt=0;jt<ft;jt++)switch(Jt[jt].once&&this.removeListener(me,Jt[jt].fn,void 0,!0),Ht){case 1:Jt[jt].fn.call(Jt[jt].context);break;case 2:Jt[jt].fn.call(Jt[jt].context,ie);break;case 3:Jt[jt].fn.call(Jt[jt].context,ie,fe);break;case 4:Jt[jt].fn.call(Jt[jt].context,ie,fe,J);break;default:if(!Ft)for(dt=1,Ft=new Array(Ht-1);dt<Ht;dt++)Ft[dt-1]=arguments[dt];Jt[jt].fn.apply(Jt[jt].context,Ft)}}return!0},Z.prototype.on=function(me,ie,fe){return v(this,me,ie,fe,!1)},Z.prototype.once=function(me,ie,fe){return v(this,me,ie,fe,!0)},Z.prototype.removeListener=function(me,ie,fe,J){var be=G?G+me:me;if(!this._events[be])return this;if(!ie)return ye(this,be),this;var Pe=this._events[be];if(Pe.fn)Pe.fn===ie&&(!J||Pe.once)&&(!fe||Pe.context===fe)&&ye(this,be);else{for(var M=0,Jt=[],Ht=Pe.length;M<Ht;M++)(Pe[M].fn!==ie||J&&!Pe[M].once||fe&&Pe[M].context!==fe)&&Jt.push(Pe[M]);Jt.length?this._events[be]=Jt.length===1?Jt[0]:Jt:ye(this,be)}return this},Z.prototype.removeAllListeners=function(me){var ie;return me?(ie=G?G+me:me,this._events[ie]&&ye(this,ie)):(this._events=new Me,this._eventsCount=0),this},Z.prototype.off=Z.prototype.removeListener,Z.prototype.addListener=Z.prototype.on,Z.prefixed=G,Z.EventEmitter=Z,hr.exports=Z},50840:function(hr,X,G){var Me;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(ve,v,ye,Z){"use strict";var oe=["","webkit","Moz","MS","ms","o"],me=v.createElement("div"),ie="function",fe=Math.round,J=Math.abs,be=Date.now;function Pe(K,he,je){return setTimeout(Ar(K,je),he)}function M(K,he,je){return Array.isArray(K)?(Jt(K,je[he],je),!0):!1}function Jt(K,he,je){var It;if(!!K)if(K.forEach)K.forEach(he,je);else if(K.length!==Z)for(It=0;It<K.length;)he.call(je,K[It],It,K),It++;else for(It in K)K.hasOwnProperty(It)&&he.call(je,K[It],It,K)}function Ht(K,he,je){var It="DEPRECATED METHOD: "+he+`
`+je+` AT 
`;return function(){var _r=new Error("get-stack-trace"),rn=_r&&_r.stack?_r.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",mi=ve.console&&(ve.console.warn||ve.console.log);return mi&&mi.call(ve.console,It,rn),K.apply(this,arguments)}}var Ft;typeof Object.assign!="function"?Ft=function(he){if(he===Z||he===null)throw new TypeError("Cannot convert undefined or null to object");for(var je=Object(he),It=1;It<arguments.length;It++){var _r=arguments[It];if(_r!==Z&&_r!==null)for(var rn in _r)_r.hasOwnProperty(rn)&&(je[rn]=_r[rn])}return je}:Ft=Object.assign;var jt=Ht(function(he,je,It){for(var _r=Object.keys(je),rn=0;rn<_r.length;)(!It||It&&he[_r[rn]]===Z)&&(he[_r[rn]]=je[_r[rn]]),rn++;return he},"extend","Use `assign`."),ft=Ht(function(he,je){return jt(he,je,!0)},"merge","Use `assign`.");function dt(K,he,je){var It=he.prototype,_r;_r=K.prototype=Object.create(It),_r.constructor=K,_r._super=It,je&&Ft(_r,je)}function Ar(K,he){return function(){return K.apply(he,arguments)}}function cr(K,he){return typeof K==ie?K.apply(he&&he[0]||Z,he):K}function Bt(K,he){return K===Z?he:K}function ot(K,he,je){Jt(Lt(he),function(It){K.addEventListener(It,je,!1)})}function He(K,he,je){Jt(Lt(he),function(It){K.removeEventListener(It,je,!1)})}function ut(K,he){for(;K;){if(K==he)return!0;K=K.parentNode}return!1}function Ye(K,he){return K.indexOf(he)>-1}function Lt(K){return K.trim().split(/\s+/g)}function ur(K,he,je){if(K.indexOf&&!je)return K.indexOf(he);for(var It=0;It<K.length;){if(je&&K[It][je]==he||!je&&K[It]===he)return It;It++}return-1}function Ir(K){return Array.prototype.slice.call(K,0)}function Vr(K,he,je){for(var It=[],_r=[],rn=0;rn<K.length;){var mi=he?K[rn][he]:K[rn];ur(_r,mi)<0&&It.push(K[rn]),_r[rn]=mi,rn++}return je&&(he?It=It.sort(function(Ya,Ta){return Ya[he]>Ta[he]}):It=It.sort()),It}function Ee(K,he){for(var je,It,_r=he[0].toUpperCase()+he.slice(1),rn=0;rn<oe.length;){if(je=oe[rn],It=je?je+_r:he,It in K)return It;rn++}return Z}var Ve=1;function ke(){return Ve++}function vt(K){var he=K.ownerDocument||K;return he.defaultView||he.parentWindow||ve}var Ke=/mobile|tablet|ip(ad|hone|od)|android/i,H="ontouchstart"in ve,Je=Ee(ve,"PointerEvent")!==Z,Et=H&&Ke.test(navigator.userAgent),_t="touch",Yr="pen",wi="mouse",On="kinect",An=25,gn=1,Cn=2,sn=4,Oi=8,Si=1,da=2,sa=4,Ai=8,uo=16,Mi=da|sa,Pi=Ai|uo,To=Mi|Pi,le=["x","y"],Ha=["clientX","clientY"];function ki(K,he){var je=this;this.manager=K,this.callback=he,this.element=K.element,this.target=K.options.inputTarget,this.domHandler=function(It){cr(K.options.enable,[K])&&je.handler(It)},this.init()}ki.prototype={handler:function(){},init:function(){this.evEl&&ot(this.element,this.evEl,this.domHandler),this.evTarget&&ot(this.target,this.evTarget,this.domHandler),this.evWin&&ot(vt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&He(this.element,this.evEl,this.domHandler),this.evTarget&&He(this.target,this.evTarget,this.domHandler),this.evWin&&He(vt(this.element),this.evWin,this.domHandler)}};function Wo(K){var he,je=K.options.inputClass;return je?he=je:Je?he=U:Et?he=nt:H?he=tr:he=Ao,new he(K,hu)}function hu(K,he,je){var It=je.pointers.length,_r=je.changedPointers.length,rn=he&gn&&It-_r==0,mi=he&(sn|Oi)&&It-_r==0;je.isFirst=!!rn,je.isFinal=!!mi,rn&&(K.session={}),je.eventType=he,rs(K,je),K.emit("hammer.input",je),K.recognize(je),K.session.prevInput=je}function rs(K,he){var je=K.session,It=he.pointers,_r=It.length;je.firstInput||(je.firstInput=Yt(he)),_r>1&&!je.firstMultiple?je.firstMultiple=Yt(he):_r===1&&(je.firstMultiple=!1);var rn=je.firstInput,mi=je.firstMultiple,ma=mi?mi.center:rn.center,Ya=he.center=Cr(It);he.timeStamp=be(),he.deltaTime=he.timeStamp-rn.timeStamp,he.angle=Fn(ma,Ya),he.distance=si(ma,Ya),ns(je,he),he.offsetDirection=dn(he.deltaX,he.deltaY);var Ta=zr(he.deltaTime,he.deltaX,he.deltaY);he.overallVelocityX=Ta.x,he.overallVelocityY=Ta.y,he.overallVelocity=J(Ta.x)>J(Ta.y)?Ta.x:Ta.y,he.scale=mi?Mn(mi.pointers,It):1,he.rotation=mi?$n(mi.pointers,It):0,he.maxPointers=je.prevInput?he.pointers.length>je.prevInput.maxPointers?he.pointers.length:je.prevInput.maxPointers:he.pointers.length,bt(je,he);var qo=K.element;ut(he.srcEvent.target,qo)&&(qo=he.srcEvent.target),he.target=qo}function ns(K,he){var je=he.center,It=K.offsetDelta||{},_r=K.prevDelta||{},rn=K.prevInput||{};(he.eventType===gn||rn.eventType===sn)&&(_r=K.prevDelta={x:rn.deltaX||0,y:rn.deltaY||0},It=K.offsetDelta={x:je.x,y:je.y}),he.deltaX=_r.x+(je.x-It.x),he.deltaY=_r.y+(je.y-It.y)}function bt(K,he){var je=K.lastInterval||he,It=he.timeStamp-je.timeStamp,_r,rn,mi,ma;if(he.eventType!=Oi&&(It>An||je.velocity===Z)){var Ya=he.deltaX-je.deltaX,Ta=he.deltaY-je.deltaY,qo=zr(It,Ya,Ta);rn=qo.x,mi=qo.y,_r=J(qo.x)>J(qo.y)?qo.x:qo.y,ma=dn(Ya,Ta),K.lastInterval=he}else _r=je.velocity,rn=je.velocityX,mi=je.velocityY,ma=je.direction;he.velocity=_r,he.velocityX=rn,he.velocityY=mi,he.direction=ma}function Yt(K){for(var he=[],je=0;je<K.pointers.length;)he[je]={clientX:fe(K.pointers[je].clientX),clientY:fe(K.pointers[je].clientY)},je++;return{timeStamp:be(),pointers:he,center:Cr(he),deltaX:K.deltaX,deltaY:K.deltaY}}function Cr(K){var he=K.length;if(he===1)return{x:fe(K[0].clientX),y:fe(K[0].clientY)};for(var je=0,It=0,_r=0;_r<he;)je+=K[_r].clientX,It+=K[_r].clientY,_r++;return{x:fe(je/he),y:fe(It/he)}}function zr(K,he,je){return{x:he/K||0,y:je/K||0}}function dn(K,he){return K===he?Si:J(K)>=J(he)?K<0?da:sa:he<0?Ai:uo}function si(K,he,je){je||(je=le);var It=he[je[0]]-K[je[0]],_r=he[je[1]]-K[je[1]];return Math.sqrt(It*It+_r*_r)}function Fn(K,he,je){je||(je=le);var It=he[je[0]]-K[je[0]],_r=he[je[1]]-K[je[1]];return Math.atan2(_r,It)*180/Math.PI}function $n(K,he){return Fn(he[1],he[0],Ha)+Fn(K[1],K[0],Ha)}function Mn(K,he){return si(he[0],he[1],Ha)/si(K[0],K[1],Ha)}var hi={mousedown:gn,mousemove:Cn,mouseup:sn},ni="mousedown",eo="mousemove mouseup";function Ao(){this.evEl=ni,this.evWin=eo,this.pressed=!1,ki.apply(this,arguments)}dt(Ao,ki,{handler:function(he){var je=hi[he.type];je&gn&&he.button===0&&(this.pressed=!0),je&Cn&&he.which!==1&&(je=sn),!!this.pressed&&(je&sn&&(this.pressed=!1),this.callback(this.manager,je,{pointers:[he],changedPointers:[he],pointerType:wi,srcEvent:he}))}});var du={pointerdown:gn,pointermove:Cn,pointerup:sn,pointercancel:Oi,pointerout:Oi},ks={2:_t,3:Yr,4:wi,5:On},Ji="pointerdown",N="pointermove pointerup pointercancel";ve.MSPointerEvent&&!ve.PointerEvent&&(Ji="MSPointerDown",N="MSPointerMove MSPointerUp MSPointerCancel");function U(){this.evEl=Ji,this.evWin=N,ki.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}dt(U,ki,{handler:function(he){var je=this.store,It=!1,_r=he.type.toLowerCase().replace("ms",""),rn=du[_r],mi=ks[he.pointerType]||he.pointerType,ma=mi==_t,Ya=ur(je,he.pointerId,"pointerId");rn&gn&&(he.button===0||ma)?Ya<0&&(je.push(he),Ya=je.length-1):rn&(sn|Oi)&&(It=!0),!(Ya<0)&&(je[Ya]=he,this.callback(this.manager,rn,{pointers:je,changedPointers:[he],pointerType:mi,srcEvent:he}),It&&je.splice(Ya,1))}});var Y={touchstart:gn,touchmove:Cn,touchend:sn,touchcancel:Oi},se="touchstart",Te="touchstart touchmove touchend touchcancel";function Ze(){this.evTarget=se,this.evWin=Te,this.started=!1,ki.apply(this,arguments)}dt(Ze,ki,{handler:function(he){var je=Y[he.type];if(je===gn&&(this.started=!0),!!this.started){var It=We.call(this,he,je);je&(sn|Oi)&&It[0].length-It[1].length==0&&(this.started=!1),this.callback(this.manager,je,{pointers:It[0],changedPointers:It[1],pointerType:_t,srcEvent:he})}}});function We(K,he){var je=Ir(K.touches),It=Ir(K.changedTouches);return he&(sn|Oi)&&(je=Vr(je.concat(It),"identifier",!0)),[je,It]}var te={touchstart:gn,touchmove:Cn,touchend:sn,touchcancel:Oi},Ie="touchstart touchmove touchend touchcancel";function nt(){this.evTarget=Ie,this.targetIds={},ki.apply(this,arguments)}dt(nt,ki,{handler:function(he){var je=te[he.type],It=$t.call(this,he,je);!It||this.callback(this.manager,je,{pointers:It[0],changedPointers:It[1],pointerType:_t,srcEvent:he})}});function $t(K,he){var je=Ir(K.touches),It=this.targetIds;if(he&(gn|Cn)&&je.length===1)return It[je[0].identifier]=!0,[je,je];var _r,rn,mi=Ir(K.changedTouches),ma=[],Ya=this.target;if(rn=je.filter(function(Ta){return ut(Ta.target,Ya)}),he===gn)for(_r=0;_r<rn.length;)It[rn[_r].identifier]=!0,_r++;for(_r=0;_r<mi.length;)It[mi[_r].identifier]&&ma.push(mi[_r]),he&(sn|Oi)&&delete It[mi[_r].identifier],_r++;if(!!ma.length)return[Vr(rn.concat(ma),"identifier",!0),ma]}var lr=2500,pt=25;function tr(){ki.apply(this,arguments);var K=Ar(this.handler,this);this.touch=new nt(this.manager,K),this.mouse=new Ao(this.manager,K),this.primaryTouch=null,this.lastTouches=[]}dt(tr,ki,{handler:function(he,je,It){var _r=It.pointerType==_t,rn=It.pointerType==wi;if(!(rn&&It.sourceCapabilities&&It.sourceCapabilities.firesTouchEvents)){if(_r)Hr.call(this,je,It);else if(rn&&Dt.call(this,It))return;this.callback(he,je,It)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Hr(K,he){K&gn?(this.primaryTouch=he.changedPointers[0].identifier,Rr.call(this,he)):K&(sn|Oi)&&Rr.call(this,he)}function Rr(K){var he=K.changedPointers[0];if(he.identifier===this.primaryTouch){var je={x:he.clientX,y:he.clientY};this.lastTouches.push(je);var It=this.lastTouches,_r=function(){var rn=It.indexOf(je);rn>-1&&It.splice(rn,1)};setTimeout(_r,lr)}}function Dt(K){for(var he=K.srcEvent.clientX,je=K.srcEvent.clientY,It=0;It<this.lastTouches.length;It++){var _r=this.lastTouches[It],rn=Math.abs(he-_r.x),mi=Math.abs(je-_r.y);if(rn<=pt&&mi<=pt)return!0}return!1}var Dr=Ee(me.style,"touchAction"),Pr=Dr!==Z,Mr="compute",Nn="auto",Lr="manipulation",jn="none",ui="pan-x",zn="pan-y",Pn=vi();function Vn(K,he){this.manager=K,this.set(he)}Vn.prototype={set:function(K){K==Mr&&(K=this.compute()),Pr&&this.manager.element.style&&Pn[K]&&(this.manager.element.style[Dr]=K),this.actions=K.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var K=[];return Jt(this.manager.recognizers,function(he){cr(he.options.enable,[he])&&(K=K.concat(he.getTouchAction()))}),Sa(K.join(" "))},preventDefaults:function(K){var he=K.srcEvent,je=K.offsetDirection;if(this.manager.session.prevented){he.preventDefault();return}var It=this.actions,_r=Ye(It,jn)&&!Pn[jn],rn=Ye(It,zn)&&!Pn[zn],mi=Ye(It,ui)&&!Pn[ui];if(_r){var ma=K.pointers.length===1,Ya=K.distance<2,Ta=K.deltaTime<250;if(ma&&Ya&&Ta)return}if(!(mi&&rn)&&(_r||rn&&je&Mi||mi&&je&Pi))return this.preventSrc(he)},preventSrc:function(K){this.manager.session.prevented=!0,K.preventDefault()}};function Sa(K){if(Ye(K,jn))return jn;var he=Ye(K,ui),je=Ye(K,zn);return he&&je?jn:he||je?he?ui:zn:Ye(K,Lr)?Lr:Nn}function vi(){if(!Pr)return!1;var K={},he=ve.CSS&&ve.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(je){K[je]=he?ve.CSS.supports("touch-action",je):!0}),K}var Li=1,Wn=2,Zn=4,Jn=8,Qi=Jn,gs=16,Bi=32;function ea(K){this.options=Ft({},this.defaults,K||{}),this.id=ke(),this.manager=null,this.options.enable=Bt(this.options.enable,!0),this.state=Li,this.simultaneous={},this.requireFail=[]}ea.prototype={defaults:{},set:function(K){return Ft(this.options,K),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(K){if(M(K,"recognizeWith",this))return this;var he=this.simultaneous;return K=ji(K,this),he[K.id]||(he[K.id]=K,K.recognizeWith(this)),this},dropRecognizeWith:function(K){return M(K,"dropRecognizeWith",this)?this:(K=ji(K,this),delete this.simultaneous[K.id],this)},requireFailure:function(K){if(M(K,"requireFailure",this))return this;var he=this.requireFail;return K=ji(K,this),ur(he,K)===-1&&(he.push(K),K.requireFailure(this)),this},dropRequireFailure:function(K){if(M(K,"dropRequireFailure",this))return this;K=ji(K,this);var he=ur(this.requireFail,K);return he>-1&&this.requireFail.splice(he,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(K){return!!this.simultaneous[K.id]},emit:function(K){var he=this,je=this.state;function It(_r){he.manager.emit(_r,K)}je<Jn&&It(he.options.event+Bu(je)),It(he.options.event),K.additionalEvent&&It(K.additionalEvent),je>=Jn&&It(he.options.event+Bu(je))},tryEmit:function(K){if(this.canEmit())return this.emit(K);this.state=Bi},canEmit:function(){for(var K=0;K<this.requireFail.length;){if(!(this.requireFail[K].state&(Bi|Li)))return!1;K++}return!0},recognize:function(K){var he=Ft({},K);if(!cr(this.options.enable,[this,he])){this.reset(),this.state=Bi;return}this.state&(Qi|gs|Bi)&&(this.state=Li),this.state=this.process(he),this.state&(Wn|Zn|Jn|gs)&&this.tryEmit(he)},process:function(K){},getTouchAction:function(){},reset:function(){}};function Bu(K){return K&gs?"cancel":K&Jn?"end":K&Zn?"move":K&Wn?"start":""}function qs(K){return K==uo?"down":K==Ai?"up":K==da?"left":K==sa?"right":""}function ji(K,he){var je=he.manager;return je?je.get(K):K}function Wa(){ea.apply(this,arguments)}dt(Wa,ea,{defaults:{pointers:1},attrTest:function(K){var he=this.options.pointers;return he===0||K.pointers.length===he},process:function(K){var he=this.state,je=K.eventType,It=he&(Wn|Zn),_r=this.attrTest(K);return It&&(je&Oi||!_r)?he|gs:It||_r?je&sn?he|Jn:he&Wn?he|Zn:Wn:Bi}});function Ea(){Wa.apply(this,arguments),this.pX=null,this.pY=null}dt(Ea,Wa,{defaults:{event:"pan",threshold:10,pointers:1,direction:To},getTouchAction:function(){var K=this.options.direction,he=[];return K&Mi&&he.push(zn),K&Pi&&he.push(ui),he},directionTest:function(K){var he=this.options,je=!0,It=K.distance,_r=K.direction,rn=K.deltaX,mi=K.deltaY;return _r&he.direction||(he.direction&Mi?(_r=rn===0?Si:rn<0?da:sa,je=rn!=this.pX,It=Math.abs(K.deltaX)):(_r=mi===0?Si:mi<0?Ai:uo,je=mi!=this.pY,It=Math.abs(K.deltaY))),K.direction=_r,je&&It>he.threshold&&_r&he.direction},attrTest:function(K){return Wa.prototype.attrTest.call(this,K)&&(this.state&Wn||!(this.state&Wn)&&this.directionTest(K))},emit:function(K){this.pX=K.deltaX,this.pY=K.deltaY;var he=qs(K.direction);he&&(K.additionalEvent=this.options.event+he),this._super.emit.call(this,K)}});function ua(){Wa.apply(this,arguments)}dt(ua,Wa,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[jn]},attrTest:function(K){return this._super.attrTest.call(this,K)&&(Math.abs(K.scale-1)>this.options.threshold||this.state&Wn)},emit:function(K){if(K.scale!==1){var he=K.scale<1?"in":"out";K.additionalEvent=this.options.event+he}this._super.emit.call(this,K)}});function xo(){ea.apply(this,arguments),this._timer=null,this._input=null}dt(xo,ea,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Nn]},process:function(K){var he=this.options,je=K.pointers.length===he.pointers,It=K.distance<he.threshold,_r=K.deltaTime>he.time;if(this._input=K,!It||!je||K.eventType&(sn|Oi)&&!_r)this.reset();else if(K.eventType&gn)this.reset(),this._timer=Pe(function(){this.state=Qi,this.tryEmit()},he.time,this);else if(K.eventType&sn)return Qi;return Bi},reset:function(){clearTimeout(this._timer)},emit:function(K){this.state===Qi&&(K&&K.eventType&sn?this.manager.emit(this.options.event+"up",K):(this._input.timeStamp=be(),this.manager.emit(this.options.event,this._input)))}});function bi(){Wa.apply(this,arguments)}dt(bi,Wa,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[jn]},attrTest:function(K){return this._super.attrTest.call(this,K)&&(Math.abs(K.rotation)>this.options.threshold||this.state&Wn)}});function bo(){Wa.apply(this,arguments)}dt(bo,Wa,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Mi|Pi,pointers:1},getTouchAction:function(){return Ea.prototype.getTouchAction.call(this)},attrTest:function(K){var he=this.options.direction,je;return he&(Mi|Pi)?je=K.overallVelocity:he&Mi?je=K.overallVelocityX:he&Pi&&(je=K.overallVelocityY),this._super.attrTest.call(this,K)&&he&K.offsetDirection&&K.distance>this.options.threshold&&K.maxPointers==this.options.pointers&&J(je)>this.options.velocity&&K.eventType&sn},emit:function(K){var he=qs(K.offsetDirection);he&&this.manager.emit(this.options.event+he,K),this.manager.emit(this.options.event,K)}});function Xa(){ea.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}dt(Xa,ea,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Lr]},process:function(K){var he=this.options,je=K.pointers.length===he.pointers,It=K.distance<he.threshold,_r=K.deltaTime<he.time;if(this.reset(),K.eventType&gn&&this.count===0)return this.failTimeout();if(It&&_r&&je){if(K.eventType!=sn)return this.failTimeout();var rn=this.pTime?K.timeStamp-this.pTime<he.interval:!0,mi=!this.pCenter||si(this.pCenter,K.center)<he.posThreshold;this.pTime=K.timeStamp,this.pCenter=K.center,!mi||!rn?this.count=1:this.count+=1,this._input=K;var ma=this.count%he.taps;if(ma===0)return this.hasRequireFailures()?(this._timer=Pe(function(){this.state=Qi,this.tryEmit()},he.interval,this),Wn):Qi}return Bi},failTimeout:function(){return this._timer=Pe(function(){this.state=Bi},this.options.interval,this),Bi},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Qi&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Mo(K,he){return he=he||{},he.recognizers=Bt(he.recognizers,Mo.defaults.preset),new Yo(K,he)}Mo.VERSION="2.0.7",Mo.defaults={domEvents:!1,touchAction:Mr,enable:!0,inputTarget:null,inputClass:null,preset:[[bi,{enable:!1}],[ua,{enable:!1},["rotate"]],[bo,{direction:Mi}],[Ea,{direction:Mi},["swipe"]],[Xa],[Xa,{event:"doubletap",taps:2},["tap"]],[xo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Xo=1,Lc=2;function Yo(K,he){this.options=Ft({},Mo.defaults,he||{}),this.options.inputTarget=this.options.inputTarget||K,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=K,this.input=Wo(this),this.touchAction=new Vn(this,this.options.touchAction),Ca(this,!0),Jt(this.options.recognizers,function(je){var It=this.add(new je[0](je[1]));je[2]&&It.recognizeWith(je[2]),je[3]&&It.requireFailure(je[3])},this)}Yo.prototype={set:function(K){return Ft(this.options,K),K.touchAction&&this.touchAction.update(),K.inputTarget&&(this.input.destroy(),this.input.target=K.inputTarget,this.input.init()),this},stop:function(K){this.session.stopped=K?Lc:Xo},recognize:function(K){var he=this.session;if(!he.stopped){this.touchAction.preventDefaults(K);var je,It=this.recognizers,_r=he.curRecognizer;(!_r||_r&&_r.state&Qi)&&(_r=he.curRecognizer=null);for(var rn=0;rn<It.length;)je=It[rn],he.stopped!==Lc&&(!_r||je==_r||je.canRecognizeWith(_r))?je.recognize(K):je.reset(),!_r&&je.state&(Wn|Zn|Jn)&&(_r=he.curRecognizer=je),rn++}},get:function(K){if(K instanceof ea)return K;for(var he=this.recognizers,je=0;je<he.length;je++)if(he[je].options.event==K)return he[je];return null},add:function(K){if(M(K,"add",this))return this;var he=this.get(K.options.event);return he&&this.remove(he),this.recognizers.push(K),K.manager=this,this.touchAction.update(),K},remove:function(K){if(M(K,"remove",this))return this;if(K=this.get(K),K){var he=this.recognizers,je=ur(he,K);je!==-1&&(he.splice(je,1),this.touchAction.update())}return this},on:function(K,he){if(K!==Z&&he!==Z){var je=this.handlers;return Jt(Lt(K),function(It){je[It]=je[It]||[],je[It].push(he)}),this}},off:function(K,he){if(K!==Z){var je=this.handlers;return Jt(Lt(K),function(It){he?je[It]&&je[It].splice(ur(je[It],he),1):delete je[It]}),this}},emit:function(K,he){this.options.domEvents&&va(K,he);var je=this.handlers[K]&&this.handlers[K].slice();if(!(!je||!je.length)){he.type=K,he.preventDefault=function(){he.srcEvent.preventDefault()};for(var It=0;It<je.length;)je[It](he),It++}},destroy:function(){this.element&&Ca(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ca(K,he){var je=K.element;if(!!je.style){var It;Jt(K.options.cssProps,function(_r,rn){It=Ee(je.style,rn),he?(K.oldCssProps[It]=je.style[It],je.style[It]=_r):je.style[It]=K.oldCssProps[It]||""}),he||(K.oldCssProps={})}}function va(K,he){var je=v.createEvent("Event");je.initEvent(K,!0,!0),je.gesture=he,he.target.dispatchEvent(je)}Ft(Mo,{INPUT_START:gn,INPUT_MOVE:Cn,INPUT_END:sn,INPUT_CANCEL:Oi,STATE_POSSIBLE:Li,STATE_BEGAN:Wn,STATE_CHANGED:Zn,STATE_ENDED:Jn,STATE_RECOGNIZED:Qi,STATE_CANCELLED:gs,STATE_FAILED:Bi,DIRECTION_NONE:Si,DIRECTION_LEFT:da,DIRECTION_RIGHT:sa,DIRECTION_UP:Ai,DIRECTION_DOWN:uo,DIRECTION_HORIZONTAL:Mi,DIRECTION_VERTICAL:Pi,DIRECTION_ALL:To,Manager:Yo,Input:ki,TouchAction:Vn,TouchInput:nt,MouseInput:Ao,PointerEventInput:U,TouchMouseInput:tr,SingleTouchInput:Ze,Recognizer:ea,AttrRecognizer:Wa,Tap:Xa,Pan:Ea,Swipe:bo,Pinch:ua,Rotate:bi,Press:xo,on:ot,off:He,each:Jt,merge:ft,extend:jt,assign:Ft,inherit:dt,bindFn:Ar,prefixed:Ee});var Ri=typeof ve!="undefined"?ve:typeof self!="undefined"?self:{};Ri.Hammer=Mo,Me=function(){return Mo}.call(X,G,X,hr),Me!==Z&&(hr.exports=Me)})(window,document,"Hammer")},7375:function(hr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0});var G=Symbol.for("INJECTION");function Me(oe,me,ie,fe){function J(){return fe&&!Reflect.hasMetadata(G,this,me)&&Reflect.defineMetadata(G,ie(),this,me),Reflect.hasMetadata(G,this,me)?Reflect.getMetadata(G,this,me):ie()}function be(Pe){Reflect.defineMetadata(G,Pe,this,me)}Object.defineProperty(oe,me,{configurable:!0,enumerable:!0,get:J,set:be})}function ve(oe,me){return function(ie){return function(fe,J){var be=function(){return oe.get(ie)};Me(fe,J,be,me)}}}X.makePropertyInjectDecorator=ve;function v(oe,me){return function(ie,fe){return function(J,be){var Pe=function(){return oe.getNamed(ie,fe)};Me(J,be,Pe,me)}}}X.makePropertyInjectNamedDecorator=v;function ye(oe,me){return function(ie,fe,J){return function(be,Pe){var M=function(){return oe.getTagged(ie,fe,J)};Me(be,Pe,M,me)}}}X.makePropertyInjectTaggedDecorator=ye;function Z(oe,me){return function(ie){return function(fe,J){var be=function(){return oe.getAll(ie)};Me(fe,J,be,me)}}}X.makePropertyMultiInjectDecorator=Z},84879:function(hr,X,G){"use strict";var Me;Me={value:!0};var ve=G(7375);function v(ye,Z){Z===void 0&&(Z=!0);var oe=ve.makePropertyInjectDecorator(ye,Z),me=ve.makePropertyInjectNamedDecorator(ye,Z),ie=ve.makePropertyInjectTaggedDecorator(ye,Z),fe=ve.makePropertyMultiInjectDecorator(ye,Z);return{lazyInject:oe,lazyInjectNamed:me,lazyInjectTagged:ie,lazyMultiInject:fe}}X.Z=v},99934:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.tagProperty=X.tagParameter=X.decorate=void 0;var Me=G(16674),ve=G(6867);function v(fe,J,be,Pe){var M=ve.TAGGED;Z(M,fe,J,Pe,be)}X.tagParameter=v;function ye(fe,J,be){var Pe=ve.TAGGED_PROP;Z(Pe,fe.constructor,J,be)}X.tagProperty=ye;function Z(fe,J,be,Pe,M){var Jt={},Ht=typeof M=="number",Ft=M!==void 0&&Ht?M.toString():be;if(Ht&&be!==void 0)throw new Error(Me.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(fe,J)&&(Jt=Reflect.getMetadata(fe,J));var jt=Jt[Ft];if(!Array.isArray(jt))jt=[];else for(var ft=0,dt=jt;ft<dt.length;ft++){var Ar=dt[ft];if(Ar.key===Pe.key)throw new Error(Me.DUPLICATED_METADATA+" "+Ar.key.toString())}jt.push(Pe),Jt[Ft]=jt,Reflect.defineMetadata(fe,Jt,J)}function oe(fe,J){Reflect.decorate(fe,J)}function me(fe,J){return function(be,Pe){J(be,Pe,fe)}}function ie(fe,J,be){typeof be=="number"?oe([me(be,fe)],J):typeof be=="string"?Reflect.decorate([fe],J,be):oe([fe],J)}X.decorate=ie},5744:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.inject=X.LazyServiceIdentifer=void 0;var Me=G(16674),ve=G(6867),v=G(47738),ye=G(99934),Z=function(){function me(ie){this._cb=ie}return me.prototype.unwrap=function(){return this._cb()},me}();X.LazyServiceIdentifer=Z;function oe(me){return function(ie,fe,J){if(me===void 0)throw new Error(Me.UNDEFINED_INJECT_ANNOTATION(ie.name));var be=new v.Metadata(ve.INJECT_TAG,me);typeof J=="number"?ye.tagParameter(ie,fe,J,be):ye.tagProperty(ie,fe,be)}}X.inject=oe},64315:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.injectable=void 0;var Me=G(16674),ve=G(6867);function v(){return function(ye){if(Reflect.hasOwnMetadata(ve.PARAM_TYPES,ye))throw new Error(Me.DUPLICATED_INJECTABLE_DECORATOR);var Z=Reflect.getMetadata(ve.DESIGN_PARAM_TYPES,ye)||[];return Reflect.defineMetadata(ve.PARAM_TYPES,Z,ye),ye}}X.injectable=v},71693:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.multiInject=void 0;var Me=G(6867),ve=G(47738),v=G(99934);function ye(Z){return function(oe,me,ie){var fe=new ve.Metadata(Me.MULTI_INJECT_TAG,Z);typeof ie=="number"?v.tagParameter(oe,me,ie,fe):v.tagProperty(oe,me,fe)}}X.multiInject=ye},38085:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.named=void 0;var Me=G(6867),ve=G(47738),v=G(99934);function ye(Z){return function(oe,me,ie){var fe=new ve.Metadata(Me.NAMED_TAG,Z);typeof ie=="number"?v.tagParameter(oe,me,ie,fe):v.tagProperty(oe,me,fe)}}X.named=ye},6515:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.optional=void 0;var Me=G(6867),ve=G(47738),v=G(99934);function ye(){return function(Z,oe,me){var ie=new ve.Metadata(Me.OPTIONAL_TAG,!0);typeof me=="number"?v.tagParameter(Z,oe,me,ie):v.tagProperty(Z,oe,ie)}}X.optional=ye},7014:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.postConstruct=void 0;var Me=G(16674),ve=G(6867),v=G(47738);function ye(){return function(Z,oe,me){var ie=new v.Metadata(ve.POST_CONSTRUCT,oe);if(Reflect.hasOwnMetadata(ve.POST_CONSTRUCT,Z.constructor))throw new Error(Me.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ve.POST_CONSTRUCT,ie,Z.constructor)}}X.postConstruct=ye},32052:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.tagged=void 0;var Me=G(47738),ve=G(99934);function v(ye,Z){return function(oe,me,ie){var fe=new Me.Metadata(ye,Z);typeof ie=="number"?ve.tagParameter(oe,me,ie,fe):ve.tagProperty(oe,me,fe)}}X.tagged=v},55638:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.targetName=void 0;var Me=G(6867),ve=G(47738),v=G(99934);function ye(Z){return function(oe,me,ie){var fe=new ve.Metadata(Me.NAME_TAG,Z);v.tagParameter(oe,me,ie,fe)}}X.targetName=ye},86757:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.unmanaged=void 0;var Me=G(6867),ve=G(47738),v=G(99934);function ye(){return function(Z,oe,me){var ie=new ve.Metadata(Me.UNMANAGED_TAG,!0);v.tagParameter(Z,oe,me,ie)}}X.unmanaged=ye},44290:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Binding=void 0;var Me=G(28421),ve=G(37791),v=function(){function ye(Z,oe){this.id=ve.id(),this.activated=!1,this.serviceIdentifier=Z,this.scope=oe,this.type=Me.BindingTypeEnum.Invalid,this.constraint=function(me){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return ye.prototype.clone=function(){var Z=new ye(this.serviceIdentifier,this.scope);return Z.activated=Z.scope===Me.BindingScopeEnum.Singleton?this.activated:!1,Z.implementationType=this.implementationType,Z.dynamicValue=this.dynamicValue,Z.scope=this.scope,Z.type=this.type,Z.factory=this.factory,Z.provider=this.provider,Z.constraint=this.constraint,Z.onActivation=this.onActivation,Z.cache=this.cache,Z},ye}();X.Binding=v},23184:function(hr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingCount=void 0;var G={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};X.BindingCount=G},16674:function(hr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.STACK_OVERFLOW=X.CIRCULAR_DEPENDENCY_IN_FACTORY=X.POST_CONSTRUCT_ERROR=X.MULTIPLE_POST_CONSTRUCT_METHODS=X.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=X.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=X.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=X.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=X.ARGUMENTS_LENGTH_MISMATCH=X.INVALID_DECORATOR_OPERATION=X.INVALID_TO_SELF_VALUE=X.INVALID_FUNCTION_BINDING=X.INVALID_MIDDLEWARE_RETURN=X.NO_MORE_SNAPSHOTS_AVAILABLE=X.INVALID_BINDING_TYPE=X.NOT_IMPLEMENTED=X.CIRCULAR_DEPENDENCY=X.UNDEFINED_INJECT_ANNOTATION=X.MISSING_INJECT_ANNOTATION=X.MISSING_INJECTABLE_ANNOTATION=X.NOT_REGISTERED=X.CANNOT_UNBIND=X.AMBIGUOUS_MATCH=X.KEY_NOT_FOUND=X.NULL_ARGUMENT=X.DUPLICATED_METADATA=X.DUPLICATED_INJECTABLE_DECORATOR=void 0,X.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",X.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",X.NULL_ARGUMENT="NULL argument",X.KEY_NOT_FOUND="Key Not Found",X.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",X.CANNOT_UNBIND="Could not unbind serviceIdentifier:",X.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",X.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",X.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var G=function(ye){return"@inject called with undefined this could mean that the class "+ye+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};X.UNDEFINED_INJECT_ANNOTATION=G,X.CIRCULAR_DEPENDENCY="Circular dependency found:",X.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",X.INVALID_BINDING_TYPE="Invalid binding type:",X.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",X.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",X.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",X.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",X.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var Me=function(){for(var ye=[],Z=0;Z<arguments.length;Z++)ye[Z]=arguments[Z];return"The number of constructor arguments in the derived class "+(ye[0]+" must be >= than the number of constructor arguments of its base class.")};X.ARGUMENTS_LENGTH_MISMATCH=Me,X.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",X.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",X.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",X.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",X.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ve=function(){for(var ye=[],Z=0;Z<arguments.length;Z++)ye[Z]=arguments[Z];return"@postConstruct error in class "+ye[0]+": "+ye[1]};X.POST_CONSTRUCT_ERROR=ve;var v=function(){for(var ye=[],Z=0;Z<arguments.length;Z++)ye[Z]=arguments[Z];return"It looks like there is a circular dependency "+("in one of the '"+ye[0]+"' bindings. Please investigate bindings with")+("service identifier '"+ye[1]+"'.")};X.CIRCULAR_DEPENDENCY_IN_FACTORY=v,X.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(hr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.TargetTypeEnum=X.BindingTypeEnum=X.BindingScopeEnum=void 0;var G={Request:"Request",Singleton:"Singleton",Transient:"Transient"};X.BindingScopeEnum=G;var Me={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};X.BindingTypeEnum=Me;var ve={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};X.TargetTypeEnum=ve},6867:function(hr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.NON_CUSTOM_TAG_KEYS=X.POST_CONSTRUCT=X.DESIGN_PARAM_TYPES=X.PARAM_TYPES=X.TAGGED_PROP=X.TAGGED=X.MULTI_INJECT_TAG=X.INJECT_TAG=X.OPTIONAL_TAG=X.UNMANAGED_TAG=X.NAME_TAG=X.NAMED_TAG=void 0,X.NAMED_TAG="named",X.NAME_TAG="name",X.UNMANAGED_TAG="unmanaged",X.OPTIONAL_TAG="optional",X.INJECT_TAG="inject",X.MULTI_INJECT_TAG="multi_inject",X.TAGGED="inversify:tagged",X.TAGGED_PROP="inversify:tagged_props",X.PARAM_TYPES="inversify:paramtypes",X.DESIGN_PARAM_TYPES="design:paramtypes",X.POST_CONSTRUCT="post_construct";function G(){return[X.INJECT_TAG,X.MULTI_INJECT_TAG,X.NAME_TAG,X.UNMANAGED_TAG,X.NAMED_TAG,X.OPTIONAL_TAG]}X.NON_CUSTOM_TAG_KEYS=G()},51389:function(hr,X,G){"use strict";var Me=this&&this.__awaiter||function(jt,ft,dt,Ar){function cr(Bt){return Bt instanceof dt?Bt:new dt(function(ot){ot(Bt)})}return new(dt||(dt=Promise))(function(Bt,ot){function He(Lt){try{Ye(Ar.next(Lt))}catch(ur){ot(ur)}}function ut(Lt){try{Ye(Ar.throw(Lt))}catch(ur){ot(ur)}}function Ye(Lt){Lt.done?Bt(Lt.value):cr(Lt.value).then(He,ut)}Ye((Ar=Ar.apply(jt,ft||[])).next())})},ve=this&&this.__generator||function(jt,ft){var dt={label:0,sent:function(){if(Bt[0]&1)throw Bt[1];return Bt[1]},trys:[],ops:[]},Ar,cr,Bt,ot;return ot={next:He(0),throw:He(1),return:He(2)},typeof Symbol=="function"&&(ot[Symbol.iterator]=function(){return this}),ot;function He(Ye){return function(Lt){return ut([Ye,Lt])}}function ut(Ye){if(Ar)throw new TypeError("Generator is already executing.");for(;dt;)try{if(Ar=1,cr&&(Bt=Ye[0]&2?cr.return:Ye[0]?cr.throw||((Bt=cr.return)&&Bt.call(cr),0):cr.next)&&!(Bt=Bt.call(cr,Ye[1])).done)return Bt;switch(cr=0,Bt&&(Ye=[Ye[0]&2,Bt.value]),Ye[0]){case 0:case 1:Bt=Ye;break;case 4:return dt.label++,{value:Ye[1],done:!1};case 5:dt.label++,cr=Ye[1],Ye=[0];continue;case 7:Ye=dt.ops.pop(),dt.trys.pop();continue;default:if(Bt=dt.trys,!(Bt=Bt.length>0&&Bt[Bt.length-1])&&(Ye[0]===6||Ye[0]===2)){dt=0;continue}if(Ye[0]===3&&(!Bt||Ye[1]>Bt[0]&&Ye[1]<Bt[3])){dt.label=Ye[1];break}if(Ye[0]===6&&dt.label<Bt[1]){dt.label=Bt[1],Bt=Ye;break}if(Bt&&dt.label<Bt[2]){dt.label=Bt[2],dt.ops.push(Ye);break}Bt[2]&&dt.ops.pop(),dt.trys.pop();continue}Ye=ft.call(jt,dt)}catch(Lt){Ye=[6,Lt],cr=0}finally{Ar=Bt=0}if(Ye[0]&5)throw Ye[1];return{value:Ye[0]?Ye[1]:void 0,done:!0}}},v=this&&this.__spreadArray||function(jt,ft){for(var dt=0,Ar=ft.length,cr=jt.length;dt<Ar;dt++,cr++)jt[cr]=ft[dt];return jt};Object.defineProperty(X,"__esModule",{value:!0}),X.Container=void 0;var ye=G(44290),Z=G(16674),oe=G(28421),me=G(6867),ie=G(51377),fe=G(86311),J=G(31927),be=G(15451),Pe=G(37791),M=G(55800),Jt=G(85700),Ht=G(80175),Ft=function(){function jt(ft){this._appliedMiddleware=[];var dt=ft||{};if(typeof dt!="object")throw new Error(""+Z.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(dt.defaultScope===void 0)dt.defaultScope=oe.BindingScopeEnum.Transient;else if(dt.defaultScope!==oe.BindingScopeEnum.Singleton&&dt.defaultScope!==oe.BindingScopeEnum.Transient&&dt.defaultScope!==oe.BindingScopeEnum.Request)throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(dt.autoBindInjectable===void 0)dt.autoBindInjectable=!1;else if(typeof dt.autoBindInjectable!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(dt.skipBaseClassChecks===void 0)dt.skipBaseClassChecks=!1;else if(typeof dt.skipBaseClassChecks!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:dt.autoBindInjectable,defaultScope:dt.defaultScope,skipBaseClassChecks:dt.skipBaseClassChecks},this.id=Pe.id(),this._bindingDictionary=new Ht.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new ie.MetadataReader}return jt.merge=function(ft,dt){for(var Ar=[],cr=2;cr<arguments.length;cr++)Ar[cr-2]=arguments[cr];var Bt=new jt,ot=v([ft,dt],Ar).map(function(Ye){return fe.getBindingDictionary(Ye)}),He=fe.getBindingDictionary(Bt);function ut(Ye,Lt){Ye.traverse(function(ur,Ir){Ir.forEach(function(Vr){Lt.add(Vr.serviceIdentifier,Vr.clone())})})}return ot.forEach(function(Ye){ut(Ye,He)}),Bt},jt.prototype.load=function(){for(var ft=[],dt=0;dt<arguments.length;dt++)ft[dt]=arguments[dt];for(var Ar=this._getContainerModuleHelpersFactory(),cr=0,Bt=ft;cr<Bt.length;cr++){var ot=Bt[cr],He=Ar(ot.id);ot.registry(He.bindFunction,He.unbindFunction,He.isboundFunction,He.rebindFunction)}},jt.prototype.loadAsync=function(){for(var ft=[],dt=0;dt<arguments.length;dt++)ft[dt]=arguments[dt];return Me(this,void 0,void 0,function(){var Ar,cr,Bt,ot,He;return ve(this,function(ut){switch(ut.label){case 0:Ar=this._getContainerModuleHelpersFactory(),cr=0,Bt=ft,ut.label=1;case 1:return cr<Bt.length?(ot=Bt[cr],He=Ar(ot.id),[4,ot.registry(He.bindFunction,He.unbindFunction,He.isboundFunction,He.rebindFunction)]):[3,4];case 2:ut.sent(),ut.label=3;case 3:return cr++,[3,1];case 4:return[2]}})})},jt.prototype.unload=function(){for(var ft=this,dt=[],Ar=0;Ar<arguments.length;Ar++)dt[Ar]=arguments[Ar];var cr=function(Bt){return function(ot){return ot.moduleId===Bt}};dt.forEach(function(Bt){var ot=cr(Bt.id);ft._bindingDictionary.removeByCondition(ot)})},jt.prototype.bind=function(ft){var dt=this.options.defaultScope||oe.BindingScopeEnum.Transient,Ar=new ye.Binding(ft,dt);return this._bindingDictionary.add(ft,Ar),new be.BindingToSyntax(Ar)},jt.prototype.rebind=function(ft){return this.unbind(ft),this.bind(ft)},jt.prototype.unbind=function(ft){try{this._bindingDictionary.remove(ft)}catch(dt){throw new Error(Z.CANNOT_UNBIND+" "+M.getServiceIdentifierAsString(ft))}},jt.prototype.unbindAll=function(){this._bindingDictionary=new Ht.Lookup},jt.prototype.isBound=function(ft){var dt=this._bindingDictionary.hasKey(ft);return!dt&&this.parent&&(dt=this.parent.isBound(ft)),dt},jt.prototype.isBoundNamed=function(ft,dt){return this.isBoundTagged(ft,me.NAMED_TAG,dt)},jt.prototype.isBoundTagged=function(ft,dt,Ar){var cr=!1;if(this._bindingDictionary.hasKey(ft)){var Bt=this._bindingDictionary.get(ft),ot=fe.createMockRequest(this,ft,dt,Ar);cr=Bt.some(function(He){return He.constraint(ot)})}return!cr&&this.parent&&(cr=this.parent.isBoundTagged(ft,dt,Ar)),cr},jt.prototype.snapshot=function(){this._snapshots.push(Jt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},jt.prototype.restore=function(){var ft=this._snapshots.pop();if(ft===void 0)throw new Error(Z.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=ft.bindings,this._middleware=ft.middleware},jt.prototype.createChild=function(ft){var dt=new jt(ft||this.options);return dt.parent=this,dt},jt.prototype.applyMiddleware=function(){for(var ft=[],dt=0;dt<arguments.length;dt++)ft[dt]=arguments[dt];this._appliedMiddleware=this._appliedMiddleware.concat(ft);var Ar=this._middleware?this._middleware:this._planAndResolve();this._middleware=ft.reduce(function(cr,Bt){return Bt(cr)},Ar)},jt.prototype.applyCustomMetadataReader=function(ft){this._metadataReader=ft},jt.prototype.get=function(ft){return this._get(!1,!1,oe.TargetTypeEnum.Variable,ft)},jt.prototype.getTagged=function(ft,dt,Ar){return this._get(!1,!1,oe.TargetTypeEnum.Variable,ft,dt,Ar)},jt.prototype.getNamed=function(ft,dt){return this.getTagged(ft,me.NAMED_TAG,dt)},jt.prototype.getAll=function(ft){return this._get(!0,!0,oe.TargetTypeEnum.Variable,ft)},jt.prototype.getAllTagged=function(ft,dt,Ar){return this._get(!1,!0,oe.TargetTypeEnum.Variable,ft,dt,Ar)},jt.prototype.getAllNamed=function(ft,dt){return this.getAllTagged(ft,me.NAMED_TAG,dt)},jt.prototype.resolve=function(ft){var dt=this.createChild();return dt.bind(ft).toSelf(),this._appliedMiddleware.forEach(function(Ar){dt.applyMiddleware(Ar)}),dt.get(ft)},jt.prototype._getContainerModuleHelpersFactory=function(){var ft=this,dt=function(He,ut){He._binding.moduleId=ut},Ar=function(He){return function(ut){var Ye=ft.bind.bind(ft),Lt=Ye(ut);return dt(Lt,He),Lt}},cr=function(He){return function(ut){var Ye=ft.unbind.bind(ft);Ye(ut)}},Bt=function(He){return function(ut){var Ye=ft.isBound.bind(ft);return Ye(ut)}},ot=function(He){return function(ut){var Ye=ft.rebind.bind(ft),Lt=Ye(ut);return dt(Lt,He),Lt}};return function(He){return{bindFunction:Ar(He),isboundFunction:Bt(He),rebindFunction:ot(He),unbindFunction:cr(He)}}},jt.prototype._get=function(ft,dt,Ar,cr,Bt,ot){var He=null,ut={avoidConstraints:ft,contextInterceptor:function(Ye){return Ye},isMultiInject:dt,key:Bt,serviceIdentifier:cr,targetType:Ar,value:ot};if(this._middleware){if(He=this._middleware(ut),He==null)throw new Error(Z.INVALID_MIDDLEWARE_RETURN)}else He=this._planAndResolve()(ut);return He},jt.prototype._planAndResolve=function(){var ft=this;return function(dt){var Ar=fe.plan(ft._metadataReader,ft,dt.isMultiInject,dt.targetType,dt.serviceIdentifier,dt.key,dt.value,dt.avoidConstraints);Ar=dt.contextInterceptor(Ar);var cr=J.resolve(Ar);return cr}},jt}();X.Container=Ft},33244:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.AsyncContainerModule=X.ContainerModule=void 0;var Me=G(37791),ve=function(){function ye(Z){this.id=Me.id(),this.registry=Z}return ye}();X.ContainerModule=ve;var v=function(){function ye(Z){this.id=Me.id(),this.registry=Z}return ye}();X.AsyncContainerModule=v},85700:function(hr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.ContainerSnapshot=void 0;var G=function(){function Me(){}return Me.of=function(ve,v){var ye=new Me;return ye.bindings=ve,ye.middleware=v,ye},Me}();X.ContainerSnapshot=G},80175:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Lookup=void 0;var Me=G(16674),ve=function(){function v(){this._map=new Map}return v.prototype.getMap=function(){return this._map},v.prototype.add=function(ye,Z){if(ye==null)throw new Error(Me.NULL_ARGUMENT);if(Z==null)throw new Error(Me.NULL_ARGUMENT);var oe=this._map.get(ye);oe!==void 0?(oe.push(Z),this._map.set(ye,oe)):this._map.set(ye,[Z])},v.prototype.get=function(ye){if(ye==null)throw new Error(Me.NULL_ARGUMENT);var Z=this._map.get(ye);if(Z!==void 0)return Z;throw new Error(Me.KEY_NOT_FOUND)},v.prototype.remove=function(ye){if(ye==null)throw new Error(Me.NULL_ARGUMENT);if(!this._map.delete(ye))throw new Error(Me.KEY_NOT_FOUND)},v.prototype.removeByCondition=function(ye){var Z=this;this._map.forEach(function(oe,me){var ie=oe.filter(function(fe){return!ye(fe)});ie.length>0?Z._map.set(me,ie):Z._map.delete(me)})},v.prototype.hasKey=function(ye){if(ye==null)throw new Error(Me.NULL_ARGUMENT);return this._map.has(ye)},v.prototype.clone=function(){var ye=new v;return this._map.forEach(function(Z,oe){Z.forEach(function(me){return ye.add(oe,me.clone())})}),ye},v.prototype.traverse=function(ye){this._map.forEach(function(Z,oe){ye(oe,Z)})},v}();X.Lookup=ve},86700:function(hr,X,G){"use strict";var Me;Me={value:!0},Me=Me=Me=Me=Me=Me=X.GW=Me=Me=X.zY=Me=Me=Me=Me=Me=X.f3=Me=Me=X.b2=Me=Me=Me=Me=Me=X.W2=Me=void 0;var ve=G(6867);Me=ve;var v=G(51389);Object.defineProperty(X,"W2",{enumerable:!0,get:function(){return v.Container}});var ye=G(28421);Me={enumerable:!0,get:function(){return ye.BindingScopeEnum}},Me={enumerable:!0,get:function(){return ye.BindingTypeEnum}},Me={enumerable:!0,get:function(){return ye.TargetTypeEnum}};var Z=G(33244);Me={enumerable:!0,get:function(){return Z.AsyncContainerModule}},Me={enumerable:!0,get:function(){return Z.ContainerModule}};var oe=G(64315);Object.defineProperty(X,"b2",{enumerable:!0,get:function(){return oe.injectable}});var me=G(32052);Me={enumerable:!0,get:function(){return me.tagged}};var ie=G(38085);Me={enumerable:!0,get:function(){return ie.named}};var fe=G(5744);Object.defineProperty(X,"f3",{enumerable:!0,get:function(){return fe.inject}}),Me={enumerable:!0,get:function(){return fe.LazyServiceIdentifer}};var J=G(6515);Me={enumerable:!0,get:function(){return J.optional}};var be=G(86757);Me={enumerable:!0,get:function(){return be.unmanaged}};var Pe=G(71693);Me={enumerable:!0,get:function(){return Pe.multiInject}};var M=G(55638);Me={enumerable:!0,get:function(){return M.targetName}};var Jt=G(7014);Object.defineProperty(X,"zY",{enumerable:!0,get:function(){return Jt.postConstruct}});var Ht=G(51377);Me={enumerable:!0,get:function(){return Ht.MetadataReader}};var Ft=G(37791);Me={enumerable:!0,get:function(){return Ft.id}};var jt=G(99934);Object.defineProperty(X,"GW",{enumerable:!0,get:function(){return jt.decorate}});var ft=G(80758);Me={enumerable:!0,get:function(){return ft.traverseAncerstors}},Me={enumerable:!0,get:function(){return ft.taggedConstraint}},Me={enumerable:!0,get:function(){return ft.namedConstraint}},Me={enumerable:!0,get:function(){return ft.typeConstraint}};var dt=G(55800);Me={enumerable:!0,get:function(){return dt.getServiceIdentifierAsString}};var Ar=G(70600);Me={enumerable:!0,get:function(){return Ar.multiBindToService}}},95228:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Context=void 0;var Me=G(37791),ve=function(){function v(ye){this.id=Me.id(),this.container=ye}return v.prototype.addPlan=function(ye){this.plan=ye},v.prototype.setCurrentRequest=function(ye){this.currentRequest=ye},v}();X.Context=ve},47738:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Metadata=void 0;var Me=G(6867),ve=function(){function v(ye,Z){this.key=ye,this.value=Z}return v.prototype.toString=function(){return this.key===Me.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},v}();X.Metadata=ve},51377:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.MetadataReader=void 0;var Me=G(6867),ve=function(){function v(){}return v.prototype.getConstructorMetadata=function(ye){var Z=Reflect.getMetadata(Me.PARAM_TYPES,ye),oe=Reflect.getMetadata(Me.TAGGED,ye);return{compilerGeneratedMetadata:Z,userGeneratedMetadata:oe||{}}},v.prototype.getPropertiesMetadata=function(ye){var Z=Reflect.getMetadata(Me.TAGGED_PROP,ye)||[];return Z},v}();X.MetadataReader=ve},55314:function(hr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Plan=void 0;var G=function(){function Me(ve,v){this.parentContext=ve,this.rootRequest=v}return Me}();X.Plan=G},86311:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.getBindingDictionary=X.createMockRequest=X.plan=void 0;var Me=G(23184),ve=G(16674),v=G(28421),ye=G(6867),Z=G(85265),oe=G(55800),me=G(95228),ie=G(47738),fe=G(55314),J=G(6e3),be=G(6748),Pe=G(18924);function M(cr){return cr._bindingDictionary}X.getBindingDictionary=M;function Jt(cr,Bt,ot,He,ut,Ye){var Lt=cr?ye.MULTI_INJECT_TAG:ye.INJECT_TAG,ur=new ie.Metadata(Lt,ot),Ir=new Pe.Target(Bt,He,ot,ur);if(ut!==void 0){var Vr=new ie.Metadata(ut,Ye);Ir.metadata.push(Vr)}return Ir}function Ht(cr,Bt,ot,He,ut){var Ye=ft(ot.container,ut.serviceIdentifier),Lt=[];return Ye.length===Me.BindingCount.NoBindingsAvailable&&ot.container.options.autoBindInjectable&&typeof ut.serviceIdentifier=="function"&&cr.getConstructorMetadata(ut.serviceIdentifier).compilerGeneratedMetadata&&(ot.container.bind(ut.serviceIdentifier).toSelf(),Ye=ft(ot.container,ut.serviceIdentifier)),Bt?Lt=Ye:Lt=Ye.filter(function(ur){var Ir=new be.Request(ur.serviceIdentifier,ot,He,ur,ut);return ur.constraint(Ir)}),Ft(ut.serviceIdentifier,Lt,ut,ot.container),Lt}function Ft(cr,Bt,ot,He){switch(Bt.length){case Me.BindingCount.NoBindingsAvailable:if(ot.isOptional())return Bt;var ut=oe.getServiceIdentifierAsString(cr),Ye=ve.NOT_REGISTERED;throw Ye+=oe.listMetadataForTarget(ut,ot),Ye+=oe.listRegisteredBindingsForServiceIdentifier(He,ut,ft),new Error(Ye);case Me.BindingCount.OnlyOneBindingAvailable:if(!ot.isArray())return Bt;case Me.BindingCount.MultipleBindingsAvailable:default:if(ot.isArray())return Bt;var ut=oe.getServiceIdentifierAsString(cr),Ye=ve.AMBIGUOUS_MATCH+" "+ut;throw Ye+=oe.listRegisteredBindingsForServiceIdentifier(He,ut,ft),new Error(Ye)}}function jt(cr,Bt,ot,He,ut,Ye){var Lt,ur;if(ut===null){Lt=Ht(cr,Bt,He,null,Ye),ur=new be.Request(ot,He,null,Lt,Ye);var Ir=new fe.Plan(He,ur);He.addPlan(Ir)}else Lt=Ht(cr,Bt,He,ut,Ye),ur=ut.addChildRequest(Ye.serviceIdentifier,Lt,Ye);Lt.forEach(function(Vr){var Ee=null;if(Ye.isArray())Ee=ur.addChildRequest(Vr.serviceIdentifier,Vr,Ye);else{if(Vr.cache)return;Ee=ur}if(Vr.type===v.BindingTypeEnum.Instance&&Vr.implementationType!==null){var Ve=J.getDependencies(cr,Vr.implementationType);if(!He.container.options.skipBaseClassChecks){var ke=J.getBaseClassDependencyCount(cr,Vr.implementationType);if(Ve.length<ke){var vt=ve.ARGUMENTS_LENGTH_MISMATCH(J.getFunctionName(Vr.implementationType));throw new Error(vt)}}Ve.forEach(function(Ke){jt(cr,!1,Ke.serviceIdentifier,He,Ee,Ke)})}})}function ft(cr,Bt){var ot=[],He=M(cr);return He.hasKey(Bt)?ot=He.get(Bt):cr.parent!==null&&(ot=ft(cr.parent,Bt)),ot}function dt(cr,Bt,ot,He,ut,Ye,Lt,ur){ur===void 0&&(ur=!1);var Ir=new me.Context(Bt),Vr=Jt(ot,He,ut,"",Ye,Lt);try{return jt(cr,ur,ut,Ir,null,Vr),Ir}catch(Ee){throw Z.isStackOverflowExeption(Ee)&&Ir.plan&&oe.circularDependencyToException(Ir.plan.rootRequest),Ee}}X.plan=dt;function Ar(cr,Bt,ot,He){var ut=new Pe.Target(v.TargetTypeEnum.Variable,"",Bt,new ie.Metadata(ot,He)),Ye=new me.Context(cr),Lt=new be.Request(Bt,Ye,null,[],ut);return Lt}X.createMockRequest=Ar},88460:function(hr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.QueryableString=void 0;var G=function(){function Me(ve){this.str=ve}return Me.prototype.startsWith=function(ve){return this.str.indexOf(ve)===0},Me.prototype.endsWith=function(ve){var v="",ye=ve.split("").reverse().join("");return v=this.str.split("").reverse().join(""),this.startsWith.call({str:v},ye)},Me.prototype.contains=function(ve){return this.str.indexOf(ve)!==-1},Me.prototype.equals=function(ve){return this.str===ve},Me.prototype.value=function(){return this.str},Me}();X.QueryableString=G},6e3:function(hr,X,G){"use strict";var Me=this&&this.__spreadArray||function(Ht,Ft){for(var jt=0,ft=Ft.length,dt=Ht.length;jt<ft;jt++,dt++)Ht[dt]=Ft[jt];return Ht};Object.defineProperty(X,"__esModule",{value:!0}),X.getFunctionName=X.getBaseClassDependencyCount=X.getDependencies=void 0;var ve=G(5744),v=G(16674),ye=G(28421),Z=G(6867),oe=G(55800);Object.defineProperty(X,"getFunctionName",{enumerable:!0,get:function(){return oe.getFunctionName}});var me=G(18924);function ie(Ht,Ft){var jt=oe.getFunctionName(Ft),ft=fe(Ht,jt,Ft,!1);return ft}X.getDependencies=ie;function fe(Ht,Ft,jt,ft){var dt=Ht.getConstructorMetadata(jt),Ar=dt.compilerGeneratedMetadata;if(Ar===void 0){var cr=v.MISSING_INJECTABLE_ANNOTATION+" "+Ft+".";throw new Error(cr)}var Bt=dt.userGeneratedMetadata,ot=Object.keys(Bt),He=jt.length===0&&ot.length>0,ut=ot.length>jt.length,Ye=He||ut?ot.length:jt.length,Lt=be(ft,Ft,Ar,Bt,Ye),ur=Pe(Ht,jt),Ir=Me(Me([],Lt),ur);return Ir}function J(Ht,Ft,jt,ft,dt){var Ar=dt[Ht.toString()]||[],cr=Jt(Ar),Bt=cr.unmanaged!==!0,ot=ft[Ht],He=cr.inject||cr.multiInject;if(ot=He||ot,ot instanceof ve.LazyServiceIdentifer&&(ot=ot.unwrap()),Bt){var ut=ot===Object,Ye=ot===Function,Lt=ot===void 0,ur=ut||Ye||Lt;if(!Ft&&ur){var Ir=v.MISSING_INJECT_ANNOTATION+" argument "+Ht+" in class "+jt+".";throw new Error(Ir)}var Vr=new me.Target(ye.TargetTypeEnum.ConstructorArgument,cr.targetName,ot);return Vr.metadata=Ar,Vr}return null}function be(Ht,Ft,jt,ft,dt){for(var Ar=[],cr=0;cr<dt;cr++){var Bt=cr,ot=J(Bt,Ht,Ft,jt,ft);ot!==null&&Ar.push(ot)}return Ar}function Pe(Ht,Ft){for(var jt=Ht.getPropertiesMetadata(Ft),ft=[],dt=Object.keys(jt),Ar=0,cr=dt;Ar<cr.length;Ar++){var Bt=cr[Ar],ot=jt[Bt],He=Jt(jt[Bt]),ut=He.targetName||Bt,Ye=He.inject||He.multiInject,Lt=new me.Target(ye.TargetTypeEnum.ClassProperty,ut,Ye);Lt.metadata=ot,ft.push(Lt)}var ur=Object.getPrototypeOf(Ft.prototype).constructor;if(ur!==Object){var Ir=Pe(Ht,ur);ft=Me(Me([],ft),Ir)}return ft}function M(Ht,Ft){var jt=Object.getPrototypeOf(Ft.prototype).constructor;if(jt!==Object){var ft=oe.getFunctionName(jt),dt=fe(Ht,ft,jt,!0),Ar=dt.map(function(ot){return ot.metadata.filter(function(He){return He.key===Z.UNMANAGED_TAG})}),cr=[].concat.apply([],Ar).length,Bt=dt.length-cr;return Bt>0?Bt:M(Ht,jt)}else return 0}X.getBaseClassDependencyCount=M;function Jt(Ht){var Ft={};return Ht.forEach(function(jt){Ft[jt.key.toString()]=jt.value}),{inject:Ft[Z.INJECT_TAG],multiInject:Ft[Z.MULTI_INJECT_TAG],targetName:Ft[Z.NAME_TAG],unmanaged:Ft[Z.UNMANAGED_TAG]}}},6748:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Request=void 0;var Me=G(37791),ve=function(){function v(ye,Z,oe,me,ie){this.id=Me.id(),this.serviceIdentifier=ye,this.parentContext=Z,this.parentRequest=oe,this.target=ie,this.childRequests=[],this.bindings=Array.isArray(me)?me:[me],this.requestScope=oe===null?new Map:null}return v.prototype.addChildRequest=function(ye,Z,oe){var me=new v(ye,this.parentContext,this,Z,oe);return this.childRequests.push(me),me},v}();X.Request=ve},18924:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.Target=void 0;var Me=G(6867),ve=G(37791),v=G(47738),ye=G(88460),Z=function(){function oe(me,ie,fe,J){this.id=ve.id(),this.type=me,this.serviceIdentifier=fe,this.name=new ye.QueryableString(ie||""),this.metadata=new Array;var be=null;typeof J=="string"?be=new v.Metadata(Me.NAMED_TAG,J):J instanceof v.Metadata&&(be=J),be!==null&&this.metadata.push(be)}return oe.prototype.hasTag=function(me){for(var ie=0,fe=this.metadata;ie<fe.length;ie++){var J=fe[ie];if(J.key===me)return!0}return!1},oe.prototype.isArray=function(){return this.hasTag(Me.MULTI_INJECT_TAG)},oe.prototype.matchesArray=function(me){return this.matchesTag(Me.MULTI_INJECT_TAG)(me)},oe.prototype.isNamed=function(){return this.hasTag(Me.NAMED_TAG)},oe.prototype.isTagged=function(){return this.metadata.some(function(me){return Me.NON_CUSTOM_TAG_KEYS.every(function(ie){return me.key!==ie})})},oe.prototype.isOptional=function(){return this.matchesTag(Me.OPTIONAL_TAG)(!0)},oe.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(me){return me.key===Me.NAMED_TAG})[0]:null},oe.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(me){return Me.NON_CUSTOM_TAG_KEYS.every(function(ie){return me.key!==ie})}):null},oe.prototype.matchesNamedTag=function(me){return this.matchesTag(Me.NAMED_TAG)(me)},oe.prototype.matchesTag=function(me){var ie=this;return function(fe){for(var J=0,be=ie.metadata;J<be.length;J++){var Pe=be[J];if(Pe.key===me&&Pe.value===fe)return!0}return!1}},oe}();X.Target=Z},52279:function(hr,X,G){"use strict";var Me=this&&this.__spreadArray||function(fe,J){for(var be=0,Pe=J.length,M=fe.length;be<Pe;be++,M++)fe[M]=J[be];return fe};Object.defineProperty(X,"__esModule",{value:!0}),X.resolveInstance=void 0;var ve=G(16674),v=G(28421),ye=G(6867);function Z(fe,J,be){var Pe=J.filter(function(Jt){return Jt.target!==null&&Jt.target.type===v.TargetTypeEnum.ClassProperty}),M=Pe.map(be);return Pe.forEach(function(Jt,Ht){var Ft="";Ft=Jt.target.name.value();var jt=M[Ht];fe[Ft]=jt}),fe}function oe(fe,J){return new(fe.bind.apply(fe,Me([void 0],J)))}function me(fe,J){if(Reflect.hasMetadata(ye.POST_CONSTRUCT,fe)){var be=Reflect.getMetadata(ye.POST_CONSTRUCT,fe);try{J[be.value]()}catch(Pe){throw new Error(ve.POST_CONSTRUCT_ERROR(fe.name,Pe.message))}}}function ie(fe,J,be){var Pe=null;if(J.length>0){var M=J.filter(function(Ht){return Ht.target!==null&&Ht.target.type===v.TargetTypeEnum.ConstructorArgument}),Jt=M.map(be);Pe=oe(fe,Jt),Pe=Z(Pe,J,be)}else Pe=new fe;return me(fe,Pe),Pe}X.resolveInstance=ie},31927:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.resolve=void 0;var Me=G(16674),ve=G(28421),v=G(85265),ye=G(55800),Z=G(52279),oe=function(fe,J,be){try{return be()}catch(Pe){throw v.isStackOverflowExeption(Pe)?new Error(Me.CIRCULAR_DEPENDENCY_IN_FACTORY(fe,J.toString())):Pe}},me=function(fe){return function(J){J.parentContext.setCurrentRequest(J);var be=J.bindings,Pe=J.childRequests,M=J.target&&J.target.isArray(),Jt=!J.parentRequest||!J.parentRequest.target||!J.target||!J.parentRequest.target.matchesArray(J.target.serviceIdentifier);if(M&&Jt)return Pe.map(function(Ar){var cr=me(fe);return cr(Ar)});var Ht=null;if(J.target.isOptional()&&be.length===0)return;var Ft=be[0],jt=Ft.scope===ve.BindingScopeEnum.Singleton,ft=Ft.scope===ve.BindingScopeEnum.Request;if(jt&&Ft.activated)return Ft.cache;if(ft&&fe!==null&&fe.has(Ft.id))return fe.get(Ft.id);if(Ft.type===ve.BindingTypeEnum.ConstantValue)Ht=Ft.cache,Ft.activated=!0;else if(Ft.type===ve.BindingTypeEnum.Function)Ht=Ft.cache,Ft.activated=!0;else if(Ft.type===ve.BindingTypeEnum.Constructor)Ht=Ft.implementationType;else if(Ft.type===ve.BindingTypeEnum.DynamicValue&&Ft.dynamicValue!==null)Ht=oe("toDynamicValue",Ft.serviceIdentifier,function(){return Ft.dynamicValue(J.parentContext)});else if(Ft.type===ve.BindingTypeEnum.Factory&&Ft.factory!==null)Ht=oe("toFactory",Ft.serviceIdentifier,function(){return Ft.factory(J.parentContext)});else if(Ft.type===ve.BindingTypeEnum.Provider&&Ft.provider!==null)Ht=oe("toProvider",Ft.serviceIdentifier,function(){return Ft.provider(J.parentContext)});else if(Ft.type===ve.BindingTypeEnum.Instance&&Ft.implementationType!==null)Ht=Z.resolveInstance(Ft.implementationType,Pe,me(fe));else{var dt=ye.getServiceIdentifierAsString(J.serviceIdentifier);throw new Error(Me.INVALID_BINDING_TYPE+" "+dt)}return typeof Ft.onActivation=="function"&&(Ht=Ft.onActivation(J.parentContext,Ht)),jt&&(Ft.cache=Ht,Ft.activated=!0),ft&&fe!==null&&!fe.has(Ft.id)&&fe.set(Ft.id,Ht),Ht}};function ie(fe){var J=me(fe.plan.rootRequest.requestScope);return J(fe.plan.rootRequest)}X.resolve=ie},83366:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingInSyntax=void 0;var Me=G(28421),ve=G(71325),v=function(){function ye(Z){this._binding=Z}return ye.prototype.inRequestScope=function(){return this._binding.scope=Me.BindingScopeEnum.Request,new ve.BindingWhenOnSyntax(this._binding)},ye.prototype.inSingletonScope=function(){return this._binding.scope=Me.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},ye.prototype.inTransientScope=function(){return this._binding.scope=Me.BindingScopeEnum.Transient,new ve.BindingWhenOnSyntax(this._binding)},ye}();X.BindingInSyntax=v},74889:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingInWhenOnSyntax=void 0;var Me=G(83366),ve=G(51811),v=G(98370),ye=function(){function Z(oe){this._binding=oe,this._bindingWhenSyntax=new v.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ve.BindingOnSyntax(this._binding),this._bindingInSyntax=new Me.BindingInSyntax(oe)}return Z.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},Z.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},Z.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},Z.prototype.when=function(oe){return this._bindingWhenSyntax.when(oe)},Z.prototype.whenTargetNamed=function(oe){return this._bindingWhenSyntax.whenTargetNamed(oe)},Z.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Z.prototype.whenTargetTagged=function(oe,me){return this._bindingWhenSyntax.whenTargetTagged(oe,me)},Z.prototype.whenInjectedInto=function(oe){return this._bindingWhenSyntax.whenInjectedInto(oe)},Z.prototype.whenParentNamed=function(oe){return this._bindingWhenSyntax.whenParentNamed(oe)},Z.prototype.whenParentTagged=function(oe,me){return this._bindingWhenSyntax.whenParentTagged(oe,me)},Z.prototype.whenAnyAncestorIs=function(oe){return this._bindingWhenSyntax.whenAnyAncestorIs(oe)},Z.prototype.whenNoAncestorIs=function(oe){return this._bindingWhenSyntax.whenNoAncestorIs(oe)},Z.prototype.whenAnyAncestorNamed=function(oe){return this._bindingWhenSyntax.whenAnyAncestorNamed(oe)},Z.prototype.whenAnyAncestorTagged=function(oe,me){return this._bindingWhenSyntax.whenAnyAncestorTagged(oe,me)},Z.prototype.whenNoAncestorNamed=function(oe){return this._bindingWhenSyntax.whenNoAncestorNamed(oe)},Z.prototype.whenNoAncestorTagged=function(oe,me){return this._bindingWhenSyntax.whenNoAncestorTagged(oe,me)},Z.prototype.whenAnyAncestorMatches=function(oe){return this._bindingWhenSyntax.whenAnyAncestorMatches(oe)},Z.prototype.whenNoAncestorMatches=function(oe){return this._bindingWhenSyntax.whenNoAncestorMatches(oe)},Z.prototype.onActivation=function(oe){return this._bindingOnSyntax.onActivation(oe)},Z}();X.BindingInWhenOnSyntax=ye},51811:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingOnSyntax=void 0;var Me=G(98370),ve=function(){function v(ye){this._binding=ye}return v.prototype.onActivation=function(ye){return this._binding.onActivation=ye,new Me.BindingWhenSyntax(this._binding)},v}();X.BindingOnSyntax=ve},15451:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingToSyntax=void 0;var Me=G(16674),ve=G(28421),v=G(74889),ye=G(71325),Z=function(){function oe(me){this._binding=me}return oe.prototype.to=function(me){return this._binding.type=ve.BindingTypeEnum.Instance,this._binding.implementationType=me,new v.BindingInWhenOnSyntax(this._binding)},oe.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+Me.INVALID_TO_SELF_VALUE);var me=this._binding.serviceIdentifier;return this.to(me)},oe.prototype.toConstantValue=function(me){return this._binding.type=ve.BindingTypeEnum.ConstantValue,this._binding.cache=me,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ve.BindingScopeEnum.Singleton,new ye.BindingWhenOnSyntax(this._binding)},oe.prototype.toDynamicValue=function(me){return this._binding.type=ve.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=me,this._binding.implementationType=null,new v.BindingInWhenOnSyntax(this._binding)},oe.prototype.toConstructor=function(me){return this._binding.type=ve.BindingTypeEnum.Constructor,this._binding.implementationType=me,this._binding.scope=ve.BindingScopeEnum.Singleton,new ye.BindingWhenOnSyntax(this._binding)},oe.prototype.toFactory=function(me){return this._binding.type=ve.BindingTypeEnum.Factory,this._binding.factory=me,this._binding.scope=ve.BindingScopeEnum.Singleton,new ye.BindingWhenOnSyntax(this._binding)},oe.prototype.toFunction=function(me){if(typeof me!="function")throw new Error(Me.INVALID_FUNCTION_BINDING);var ie=this.toConstantValue(me);return this._binding.type=ve.BindingTypeEnum.Function,this._binding.scope=ve.BindingScopeEnum.Singleton,ie},oe.prototype.toAutoFactory=function(me){return this._binding.type=ve.BindingTypeEnum.Factory,this._binding.factory=function(ie){var fe=function(){return ie.container.get(me)};return fe},this._binding.scope=ve.BindingScopeEnum.Singleton,new ye.BindingWhenOnSyntax(this._binding)},oe.prototype.toProvider=function(me){return this._binding.type=ve.BindingTypeEnum.Provider,this._binding.provider=me,this._binding.scope=ve.BindingScopeEnum.Singleton,new ye.BindingWhenOnSyntax(this._binding)},oe.prototype.toService=function(me){this.toDynamicValue(function(ie){return ie.container.get(me)})},oe}();X.BindingToSyntax=Z},71325:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingWhenOnSyntax=void 0;var Me=G(51811),ve=G(98370),v=function(){function ye(Z){this._binding=Z,this._bindingWhenSyntax=new ve.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new Me.BindingOnSyntax(this._binding)}return ye.prototype.when=function(Z){return this._bindingWhenSyntax.when(Z)},ye.prototype.whenTargetNamed=function(Z){return this._bindingWhenSyntax.whenTargetNamed(Z)},ye.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},ye.prototype.whenTargetTagged=function(Z,oe){return this._bindingWhenSyntax.whenTargetTagged(Z,oe)},ye.prototype.whenInjectedInto=function(Z){return this._bindingWhenSyntax.whenInjectedInto(Z)},ye.prototype.whenParentNamed=function(Z){return this._bindingWhenSyntax.whenParentNamed(Z)},ye.prototype.whenParentTagged=function(Z,oe){return this._bindingWhenSyntax.whenParentTagged(Z,oe)},ye.prototype.whenAnyAncestorIs=function(Z){return this._bindingWhenSyntax.whenAnyAncestorIs(Z)},ye.prototype.whenNoAncestorIs=function(Z){return this._bindingWhenSyntax.whenNoAncestorIs(Z)},ye.prototype.whenAnyAncestorNamed=function(Z){return this._bindingWhenSyntax.whenAnyAncestorNamed(Z)},ye.prototype.whenAnyAncestorTagged=function(Z,oe){return this._bindingWhenSyntax.whenAnyAncestorTagged(Z,oe)},ye.prototype.whenNoAncestorNamed=function(Z){return this._bindingWhenSyntax.whenNoAncestorNamed(Z)},ye.prototype.whenNoAncestorTagged=function(Z,oe){return this._bindingWhenSyntax.whenNoAncestorTagged(Z,oe)},ye.prototype.whenAnyAncestorMatches=function(Z){return this._bindingWhenSyntax.whenAnyAncestorMatches(Z)},ye.prototype.whenNoAncestorMatches=function(Z){return this._bindingWhenSyntax.whenNoAncestorMatches(Z)},ye.prototype.onActivation=function(Z){return this._bindingOnSyntax.onActivation(Z)},ye}();X.BindingWhenOnSyntax=v},98370:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.BindingWhenSyntax=void 0;var Me=G(51811),ve=G(80758),v=function(){function ye(Z){this._binding=Z}return ye.prototype.when=function(Z){return this._binding.constraint=Z,new Me.BindingOnSyntax(this._binding)},ye.prototype.whenTargetNamed=function(Z){return this._binding.constraint=ve.namedConstraint(Z),new Me.BindingOnSyntax(this._binding)},ye.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(Z){var oe=Z.target!==null&&!Z.target.isNamed()&&!Z.target.isTagged();return oe},new Me.BindingOnSyntax(this._binding)},ye.prototype.whenTargetTagged=function(Z,oe){return this._binding.constraint=ve.taggedConstraint(Z)(oe),new Me.BindingOnSyntax(this._binding)},ye.prototype.whenInjectedInto=function(Z){return this._binding.constraint=function(oe){return ve.typeConstraint(Z)(oe.parentRequest)},new Me.BindingOnSyntax(this._binding)},ye.prototype.whenParentNamed=function(Z){return this._binding.constraint=function(oe){return ve.namedConstraint(Z)(oe.parentRequest)},new Me.BindingOnSyntax(this._binding)},ye.prototype.whenParentTagged=function(Z,oe){return this._binding.constraint=function(me){return ve.taggedConstraint(Z)(oe)(me.parentRequest)},new Me.BindingOnSyntax(this._binding)},ye.prototype.whenAnyAncestorIs=function(Z){return this._binding.constraint=function(oe){return ve.traverseAncerstors(oe,ve.typeConstraint(Z))},new Me.BindingOnSyntax(this._binding)},ye.prototype.whenNoAncestorIs=function(Z){return this._binding.constraint=function(oe){return!ve.traverseAncerstors(oe,ve.typeConstraint(Z))},new Me.BindingOnSyntax(this._binding)},ye.prototype.whenAnyAncestorNamed=function(Z){return this._binding.constraint=function(oe){return ve.traverseAncerstors(oe,ve.namedConstraint(Z))},new Me.BindingOnSyntax(this._binding)},ye.prototype.whenNoAncestorNamed=function(Z){return this._binding.constraint=function(oe){return!ve.traverseAncerstors(oe,ve.namedConstraint(Z))},new Me.BindingOnSyntax(this._binding)},ye.prototype.whenAnyAncestorTagged=function(Z,oe){return this._binding.constraint=function(me){return ve.traverseAncerstors(me,ve.taggedConstraint(Z)(oe))},new Me.BindingOnSyntax(this._binding)},ye.prototype.whenNoAncestorTagged=function(Z,oe){return this._binding.constraint=function(me){return!ve.traverseAncerstors(me,ve.taggedConstraint(Z)(oe))},new Me.BindingOnSyntax(this._binding)},ye.prototype.whenAnyAncestorMatches=function(Z){return this._binding.constraint=function(oe){return ve.traverseAncerstors(oe,Z)},new Me.BindingOnSyntax(this._binding)},ye.prototype.whenNoAncestorMatches=function(Z){return this._binding.constraint=function(oe){return!ve.traverseAncerstors(oe,Z)},new Me.BindingOnSyntax(this._binding)},ye}();X.BindingWhenSyntax=v},80758:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.typeConstraint=X.namedConstraint=X.taggedConstraint=X.traverseAncerstors=void 0;var Me=G(6867),ve=G(47738),v=function(me,ie){var fe=me.parentRequest;return fe!==null?ie(fe)?!0:v(fe,ie):!1};X.traverseAncerstors=v;var ye=function(me){return function(ie){var fe=function(J){return J!==null&&J.target!==null&&J.target.matchesTag(me)(ie)};return fe.metaData=new ve.Metadata(me,ie),fe}};X.taggedConstraint=ye;var Z=ye(Me.NAMED_TAG);X.namedConstraint=Z;var oe=function(me){return function(ie){var fe=null;if(ie!==null)if(fe=ie.bindings[0],typeof me=="string"){var J=fe.serviceIdentifier;return J===me}else{var be=ie.bindings[0].implementationType;return me===be}return!1}};X.typeConstraint=oe},70600:function(hr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.multiBindToService=void 0;var G=function(Me){return function(ve){return function(){for(var v=[],ye=0;ye<arguments.length;ye++)v[ye]=arguments[ye];return v.forEach(function(Z){return Me.bind(Z).toService(ve)})}}};X.multiBindToService=G},85265:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.isStackOverflowExeption=void 0;var Me=G(16674);function ve(v){return v instanceof RangeError||v.message===Me.STACK_OVERFLOW}X.isStackOverflowExeption=ve},37791:function(hr,X){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.id=void 0;var G=0;function Me(){return G++}X.id=Me},55800:function(hr,X,G){"use strict";Object.defineProperty(X,"__esModule",{value:!0}),X.circularDependencyToException=X.listMetadataForTarget=X.listRegisteredBindingsForServiceIdentifier=X.getServiceIdentifierAsString=X.getFunctionName=void 0;var Me=G(16674);function ve(fe){if(typeof fe=="function"){var J=fe;return J.name}else{if(typeof fe=="symbol")return fe.toString();var J=fe;return J}}X.getServiceIdentifierAsString=ve;function v(fe,J,be){var Pe="",M=be(fe,J);return M.length!==0&&(Pe=`
Registered bindings:`,M.forEach(function(Jt){var Ht="Object";Jt.implementationType!==null&&(Ht=ie(Jt.implementationType)),Pe=Pe+`
 `+Ht,Jt.constraint.metaData&&(Pe=Pe+" - "+Jt.constraint.metaData)})),Pe}X.listRegisteredBindingsForServiceIdentifier=v;function ye(fe,J){return fe.parentRequest===null?!1:fe.parentRequest.serviceIdentifier===J?!0:ye(fe.parentRequest,J)}function Z(fe){function J(Pe,M){M===void 0&&(M=[]);var Jt=ve(Pe.serviceIdentifier);return M.push(Jt),Pe.parentRequest!==null?J(Pe.parentRequest,M):M}var be=J(fe);return be.reverse().join(" --> ")}function oe(fe){fe.childRequests.forEach(function(J){if(ye(J,J.serviceIdentifier)){var be=Z(J);throw new Error(Me.CIRCULAR_DEPENDENCY+" "+be)}else oe(J)})}X.circularDependencyToException=oe;function me(fe,J){if(J.isTagged()||J.isNamed()){var be="",Pe=J.getNamedTag(),M=J.getCustomTags();return Pe!==null&&(be+=Pe.toString()+`
`),M!==null&&M.forEach(function(Jt){be+=Jt.toString()+`
`})," "+fe+`
 `+fe+" - "+be}else return" "+fe}X.listMetadataForTarget=me;function ie(fe){if(fe.name)return fe.name;var J=fe.toString(),be=J.match(/^function\s*([^\s(]+)/);return be?be[1]:"Anonymous function: "+J}X.getFunctionName=ie},49029:function(hr){var X=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function G(Me){return Me.match(X)||[]}hr.exports=G},29750:function(hr){function X(G,Me,ve){return G===G&&(ve!==void 0&&(G=G<=ve?G:ve),Me!==void 0&&(G=G>=Me?G:Me)),G}hr.exports=X},18674:function(hr){function X(G){return function(Me){return G==null?void 0:G[Me]}}hr.exports=X},98805:function(hr,X,G){var Me=G(40180),ve=G(62689),v=G(83140),ye=G(79833);function Z(oe){return function(me){me=ye(me);var ie=ve(me)?v(me):void 0,fe=ie?ie[0]:me.charAt(0),J=ie?Me(ie,1).join(""):me.slice(1);return fe[oe]()+J}}hr.exports=Z},35393:function(hr,X,G){var Me=G(62663),ve=G(53816),v=G(58748),ye="['\u2019]",Z=RegExp(ye,"g");function oe(me){return function(ie){return Me(v(ve(ie).replace(Z,"")),me,"")}}hr.exports=oe},69389:function(hr,X,G){var Me=G(18674),ve={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},v=Me(ve);hr.exports=v},93157:function(hr){var X=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function G(Me){return X.test(Me)}hr.exports=G},2757:function(hr){var X="\\ud800-\\udfff",G="\\u0300-\\u036f",Me="\\ufe20-\\ufe2f",ve="\\u20d0-\\u20ff",v=G+Me+ve,ye="\\u2700-\\u27bf",Z="a-z\\xdf-\\xf6\\xf8-\\xff",oe="\\xac\\xb1\\xd7\\xf7",me="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",ie="\\u2000-\\u206f",fe=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",J="A-Z\\xc0-\\xd6\\xd8-\\xde",be="\\ufe0e\\ufe0f",Pe=oe+me+ie+fe,M="['\u2019]",Jt="["+Pe+"]",Ht="["+v+"]",Ft="\\d+",jt="["+ye+"]",ft="["+Z+"]",dt="[^"+X+Pe+Ft+ye+Z+J+"]",Ar="\\ud83c[\\udffb-\\udfff]",cr="(?:"+Ht+"|"+Ar+")",Bt="[^"+X+"]",ot="(?:\\ud83c[\\udde6-\\uddff]){2}",He="[\\ud800-\\udbff][\\udc00-\\udfff]",ut="["+J+"]",Ye="\\u200d",Lt="(?:"+ft+"|"+dt+")",ur="(?:"+ut+"|"+dt+")",Ir="(?:"+M+"(?:d|ll|m|re|s|t|ve))?",Vr="(?:"+M+"(?:D|LL|M|RE|S|T|VE))?",Ee=cr+"?",Ve="["+be+"]?",ke="(?:"+Ye+"(?:"+[Bt,ot,He].join("|")+")"+Ve+Ee+")*",vt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Ke="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",H=Ve+Ee+ke,Je="(?:"+[jt,ot,He].join("|")+")"+H,Et=RegExp([ut+"?"+ft+"+"+Ir+"(?="+[Jt,ut,"$"].join("|")+")",ur+"+"+Vr+"(?="+[Jt,ut+Lt,"$"].join("|")+")",ut+"?"+Lt+"+"+Ir,ut+"+"+Vr,Ke,vt,Ft,Je].join("|"),"g");function _t(Yr){return Yr.match(Et)||[]}hr.exports=_t},68929:function(hr,X,G){var Me=G(48403),ve=G(35393),v=ve(function(ye,Z,oe){return Z=Z.toLowerCase(),ye+(oe?Me(Z):Z)});hr.exports=v},48403:function(hr,X,G){var Me=G(79833),ve=G(11700);function v(ye){return ve(Me(ye).toLowerCase())}hr.exports=v},74691:function(hr,X,G){var Me=G(29750),ve=G(14841);function v(ye,Z,oe){return oe===void 0&&(oe=Z,Z=void 0),oe!==void 0&&(oe=ve(oe),oe=oe===oe?oe:0),Z!==void 0&&(Z=ve(Z),Z=Z===Z?Z:0),Me(ve(ye),Z,oe)}hr.exports=v},53816:function(hr,X,G){var Me=G(69389),ve=G(79833),v=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,ye="\\u0300-\\u036f",Z="\\ufe20-\\ufe2f",oe="\\u20d0-\\u20ff",me=ye+Z+oe,ie="["+me+"]",fe=RegExp(ie,"g");function J(be){return be=ve(be),be&&be.replace(v,Me).replace(fe,"")}hr.exports=J},14293:function(hr){function X(G){return G==null}hr.exports=X},81763:function(hr,X,G){var Me=G(44239),ve=G(37005),v="[object Number]";function ye(Z){return typeof Z=="number"||ve(Z)&&Me(Z)==v}hr.exports=ye},30236:function(hr,X,G){var Me=G(42980),ve=G(21463),v=ve(function(ye,Z,oe,me){Me(ye,Z,oe,me)});hr.exports=v},44908:function(hr,X,G){var Me=G(45652);function ve(v){return v&&v.length?Me(v):[]}hr.exports=ve},11700:function(hr,X,G){var Me=G(98805),ve=Me("toUpperCase");hr.exports=ve},58748:function(hr,X,G){var Me=G(49029),ve=G(93157),v=G(79833),ye=G(2757);function Z(oe,me,ie){return oe=v(oe),me=ie?void 0:me,me===void 0?ve(oe)?ye(oe):Me(oe):oe.match(me)||[]}hr.exports=Z},6158:function(hr){(function(X,G){hr.exports=G()})(this,function(){"use strict";var X,G,Me;function ve(v,ye){if(!X)X=ye;else if(!G)G=ye;else{var Z="var sharedChunk = {}; ("+X+")(sharedChunk); ("+G+")(sharedChunk);",oe={};X(oe),Me=ye(oe),typeof window!="undefined"&&(Me.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}return ve(["exports"],function(v){"use strict";function ye(t,a){return t(a={exports:{}},a.exports),a.exports}var Z=oe;function oe(t,a,s,p){this.cx=3*t,this.bx=3*(s-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(p-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=p,this.p2x=s,this.p2y=p}oe.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},oe.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},oe.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},oe.prototype.solveCurveX=function(t,a){var s,p,m,g,w;for(a===void 0&&(a=1e-6),m=t,w=0;w<8;w++){if(g=this.sampleCurveX(m)-t,Math.abs(g)<a)return m;var C=this.sampleCurveDerivativeX(m);if(Math.abs(C)<1e-6)break;m-=g/C}if((m=t)<(s=0))return s;if(m>(p=1))return p;for(;s<p;){if(g=this.sampleCurveX(m),Math.abs(g-t)<a)return m;t>g?s=m:p=m,m=.5*(p-s)+s}return m},oe.prototype.solve=function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))};var me=ie;function ie(t,a){this.x=t,this.y=a}ie.prototype={clone:function(){return new ie(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,a){return this.clone()._rotateAround(t,a)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var a=t.x-this.x,s=t.y-this.y;return a*a+s*s},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,a){return Math.atan2(this.x*a-this.y*t,this.x*t+this.y*a)},_matMult:function(t){var a=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=a,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var a=Math.cos(t),s=Math.sin(t),p=s*this.x+a*this.y;return this.x=a*this.x-s*this.y,this.y=p,this},_rotateAround:function(t,a){var s=Math.cos(t),p=Math.sin(t),m=a.y+p*(this.x-a.x)+s*(this.y-a.y);return this.x=a.x+s*(this.x-a.x)-p*(this.y-a.y),this.y=m,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},ie.convert=function(t){return t instanceof ie?t:Array.isArray(t)?new ie(t[0],t[1]):t};var fe=typeof self!="undefined"?self:{},J=Math.pow(2,53)-1;function be(t,a,s,p){var m=new Z(t,a,s,p);return function(g){return m.solve(g)}}var Pe=be(.25,.1,.25,1);function M(t,a,s){return Math.min(s,Math.max(a,t))}function Jt(t,a,s){var p=s-a,m=((t-a)%p+p)%p+a;return m===a?s:m}function Ht(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var p=0,m=a;p<m.length;p+=1){var g=m[p];for(var w in g)t[w]=g[w]}return t}var Ft=1;function jt(){return Ft++}function ft(){return function t(a){return a?(a^16*Math.random()>>a/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function dt(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Ar(t,a){t.forEach(function(s){a[s]&&(a[s]=a[s].bind(a))})}function cr(t,a){return t.indexOf(a,t.length-a.length)!==-1}function Bt(t,a,s){var p={};for(var m in t)p[m]=a.call(s||this,t[m],m,t);return p}function ot(t,a,s){var p={};for(var m in t)a.call(s||this,t[m],m,t)&&(p[m]=t[m]);return p}function He(t){return Array.isArray(t)?t.map(He):typeof t=="object"&&t?Bt(t,He):t}var ut={};function Ye(t){ut[t]||(typeof console!="undefined"&&console.warn(t),ut[t]=!0)}function Lt(t,a,s){return(s.y-t.y)*(a.x-t.x)>(a.y-t.y)*(s.x-t.x)}function ur(t){for(var a=0,s=0,p=t.length,m=p-1,g=void 0,w=void 0;s<p;m=s++)a+=((w=t[m]).x-(g=t[s]).x)*(g.y+w.y);return a}function Ir(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Vr(t){var a={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(p,m,g,w){var C=g||w;return a[m]=!C||C.toLowerCase(),""}),a["max-age"]){var s=parseInt(a["max-age"],10);isNaN(s)?delete a["max-age"]:a["max-age"]=s}return a}var Ee=null;function Ve(t){if(Ee==null){var a=t.navigator?t.navigator.userAgent:null;Ee=!!t.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Ee}function ke(t){try{var a=fe[t];return a.setItem("_mapbox_test_",1),a.removeItem("_mapbox_test_"),!0}catch(s){return!1}}var vt,Ke,H,Je,Et=fe.performance&&fe.performance.now?fe.performance.now.bind(fe.performance):Date.now.bind(Date),_t=fe.requestAnimationFrame||fe.mozRequestAnimationFrame||fe.webkitRequestAnimationFrame||fe.msRequestAnimationFrame,Yr=fe.cancelAnimationFrame||fe.mozCancelAnimationFrame||fe.webkitCancelAnimationFrame||fe.msCancelAnimationFrame,wi={now:Et,frame:function(t){var a=_t(t);return{cancel:function(){return Yr(a)}}},getImageData:function(t,a){a===void 0&&(a=0);var s=fe.document.createElement("canvas"),p=s.getContext("2d");if(!p)throw new Error("failed to create canvas 2d context");return s.width=t.width,s.height=t.height,p.drawImage(t,0,0,t.width,t.height),p.getImageData(-a,-a,t.width+2*a,t.height+2*a)},resolveURL:function(t){return vt||(vt=fe.document.createElement("a")),vt.href=t,vt.href},hardwareConcurrency:fe.navigator&&fe.navigator.hardwareConcurrency||4,get devicePixelRatio(){return fe.devicePixelRatio},get prefersReducedMotion(){return!!fe.matchMedia&&(Ke==null&&(Ke=fe.matchMedia("(prefers-reduced-motion: reduce)")),Ke.matches)}},On={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},An={supported:!1,testSupport:function(t){!gn&&Je&&(Cn?sn(t):H=t)}},gn=!1,Cn=!1;function sn(t){var a=t.createTexture();t.bindTexture(t.TEXTURE_2D,a);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,Je),t.isContextLost())return;An.supported=!0}catch(s){}t.deleteTexture(a),gn=!0}fe.document&&((Je=fe.document.createElement("img")).onload=function(){H&&sn(H),H=null,Cn=!0},Je.onerror=function(){gn=!0,H=null},Je.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var Oi="01",Si=function(t,a){this._transformRequestFn=t,this._customAccessToken=a,this._createSkuToken()};function da(t){return t.indexOf("mapbox:")===0}Si.prototype._createSkuToken=function(){var t=function(){for(var a="",s=0;s<10;s++)a+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Oi,a].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},Si.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Si.prototype.transformRequest=function(t,a){return this._transformRequestFn&&this._transformRequestFn(t,a)||{url:t}},Si.prototype.normalizeStyleURL=function(t,a){if(!da(t))return t;var s=Mi(t);return s.path="/styles/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Si.prototype.normalizeGlyphsURL=function(t,a){if(!da(t))return t;var s=Mi(t);return s.path="/fonts/v1"+s.path,this._makeAPIURL(s,this._customAccessToken||a)},Si.prototype.normalizeSourceURL=function(t,a){if(!da(t))return t;var s=Mi(t);return s.path="/v4/"+s.authority+".json",s.params.push("secure"),this._makeAPIURL(s,this._customAccessToken||a)},Si.prototype.normalizeSpriteURL=function(t,a,s,p){var m=Mi(t);return da(t)?(m.path="/styles/v1"+m.path+"/sprite"+a+s,this._makeAPIURL(m,this._customAccessToken||p)):(m.path+=""+a+s,Pi(m))},Si.prototype.normalizeTileURL=function(t,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!da(t))return t;var s=Mi(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,(wi.devicePixelRatio>=2||a===512?"@2x":"")+(An.supported?".webp":"$1")),s.path=s.path.replace(/^.+\/v4\//,"/"),s.path="/v4"+s.path;var p=this._customAccessToken||function(m){for(var g=0,w=m;g<w.length;g+=1){var C=w[g].match(/^access_token=(.*)$/);if(C)return C[1]}return null}(s.params)||On.ACCESS_TOKEN;return On.REQUIRE_ACCESS_TOKEN&&p&&this._skuToken&&s.params.push("sku="+this._skuToken),this._makeAPIURL(s,p)},Si.prototype.canonicalizeTileURL=function(t,a){var s=Mi(t);if(!s.path.match(/(^\/v4\/)/)||!s.path.match(/\.[\w]+$/))return t;var p="mapbox://tiles/";p+=s.path.replace("/v4/","");var m=s.params;return a&&(m=m.filter(function(g){return!g.match(/^access_token=/)})),m.length&&(p+="?"+m.join("&")),p},Si.prototype.canonicalizeTileset=function(t,a){for(var s=!!a&&da(a),p=[],m=0,g=t.tiles||[];m<g.length;m+=1){var w=g[m];Ai(w)?p.push(this.canonicalizeTileURL(w,s)):p.push(w)}return p},Si.prototype._makeAPIURL=function(t,a){var s="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",p=Mi(On.API_URL);if(t.protocol=p.protocol,t.authority=p.authority,t.protocol==="http"){var m=t.params.indexOf("secure");m>=0&&t.params.splice(m,1)}if(p.path!=="/"&&(t.path=""+p.path+t.path),!On.REQUIRE_ACCESS_TOKEN)return Pi(t);if(!(a=a||On.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+s);if(a[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+s);return t.params=t.params.filter(function(g){return g.indexOf("access_token")===-1}),t.params.push("access_token="+a),Pi(t)};var sa=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Ai(t){return sa.test(t)}var uo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Mi(t){var a=t.match(uo);if(!a)throw new Error("Unable to parse URL object");return{protocol:a[1],authority:a[2],path:a[3]||"/",params:a[4]?a[4].split("&"):[]}}function Pi(t){var a=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+a}function To(t){if(!t)return null;var a=t.split(".");if(!a||a.length!==3)return null;try{return JSON.parse(decodeURIComponent(fe.atob(a[1]).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(s){return null}}var le=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};le.prototype.getStorageKey=function(t){var a,s=To(On.ACCESS_TOKEN);return a=s&&s.u?fe.btoa(encodeURIComponent(s.u).replace(/%([0-9A-F]{2})/g,function(p,m){return String.fromCharCode(Number("0x"+m))})):On.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+a:"mapbox.eventData:"+a},le.prototype.fetchEventData=function(){var t=ke("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{var p=fe.localStorage.getItem(a);p&&(this.eventData=JSON.parse(p));var m=fe.localStorage.getItem(s);m&&(this.anonId=m)}catch(g){Ye("Unable to read from LocalStorage")}},le.prototype.saveEventData=function(){var t=ke("localStorage"),a=this.getStorageKey(),s=this.getStorageKey("uuid");if(t)try{fe.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&fe.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(p){Ye("Unable to write to LocalStorage")}},le.prototype.processRequests=function(t){},le.prototype.postEvent=function(t,a,s,p){var m=this;if(On.EVENTS_URL){var g=Mi(On.EVENTS_URL);g.params.push("access_token="+(p||On.ACCESS_TOKEN||""));var w={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.1",skuId:Oi,userId:this.anonId},C=a?Ht(w,a):w,I={url:Pi(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([C])};this.pendingRequest=Ji(I,function(k){m.pendingRequest=null,s(k),m.saveEventData(),m.processRequests(p)})}},le.prototype.queueRequest=function(t,a){this.queue.push(t),this.processRequests(a)};var Ha,ki,Wo=function(t){function a(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postMapLoadEvent=function(s,p,m,g){this.skuToken=m,(On.EVENTS_URL&&g||On.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(w){return da(w)||Ai(w)}))&&this.queueRequest({id:p,timestamp:Date.now()},g)},a.prototype.processRequests=function(s){var p=this;if(!this.pendingRequest&&this.queue.length!==0){var m=this.queue.shift(),g=m.id,w=m.timestamp;g&&this.success[g]||(this.anonId||this.fetchEventData(),dt(this.anonId)||(this.anonId=ft()),this.postEvent(w,{skuToken:this.skuToken},function(C){C||g&&(p.success[g]=!0)},s))}},a}(le),hu=new(function(t){function a(s){t.call(this,"appUserTurnstile"),this._customAccessToken=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.postTurnstileEvent=function(s,p){On.EVENTS_URL&&On.ACCESS_TOKEN&&Array.isArray(s)&&s.some(function(m){return da(m)||Ai(m)})&&this.queueRequest(Date.now(),p)},a.prototype.processRequests=function(s){var p=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var m=To(On.ACCESS_TOKEN),g=m?m.u:On.ACCESS_TOKEN,w=g!==this.eventData.tokenU;dt(this.anonId)||(this.anonId=ft(),w=!0);var C=this.queue.shift();if(this.eventData.lastSuccess){var I=new Date(this.eventData.lastSuccess),k=new Date(C),D=(C-this.eventData.lastSuccess)/864e5;w=w||D>=1||D<-1||I.getDate()!==k.getDate()}else w=!0;if(!w)return this.processRequests();this.postEvent(C,{"enabled.telemetry":!1},function(B){B||(p.eventData.lastSuccess=C,p.eventData.tokenU=g)},s)}},a}(le)),rs=hu.postTurnstileEvent.bind(hu),ns=new Wo,bt=ns.postMapLoadEvent.bind(ns),Yt=500,Cr=50;function zr(){fe.caches&&!Ha&&(Ha=fe.caches.open("mapbox-tiles"))}function dn(t){var a=t.indexOf("?");return a<0?t:t.slice(0,a)}var si,Fn=1/0;function $n(){return si==null&&(si=fe.OffscreenCanvas&&new fe.OffscreenCanvas(1,1).getContext("2d")&&typeof fe.createImageBitmap=="function"),si}var Mn={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Mn);var hi=function(t){function a(s,p,m){p===401&&Ai(m)&&(s+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,s),this.status=p,this.url=m,this.name=this.constructor.name,this.message=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},a}(Error),ni=Ir()?function(){return self.worker&&self.worker.referrer}:function(){return(fe.location.protocol==="blob:"?fe.parent:fe).location.href},eo,Ao,du=function(t,a){if(!(/^file:/.test(s=t.url)||/^file:/.test(ni())&&!/^\w+:/.test(s))){if(fe.fetch&&fe.Request&&fe.AbortController&&fe.Request.prototype.hasOwnProperty("signal"))return function(p,m){var g,w=new fe.AbortController,C=new fe.Request(p.url,{method:p.method||"GET",body:p.body,credentials:p.credentials,headers:p.headers,referrer:ni(),signal:w.signal}),I=!1,k=!1,D=(g=C.url).indexOf("sku=")>0&&Ai(g);p.type==="json"&&C.headers.set("Accept","application/json");var B=function(q,we,Ce){if(!k){if(q&&q.message!=="SecurityError"&&Ye(q),we&&Ce)return V(we);var ze=Date.now();fe.fetch(C).then(function(Le){if(Le.ok){var qe=D?Le.clone():null;return V(Le,qe,ze)}return m(new hi(Le.statusText,Le.status,p.url))}).catch(function(Le){Le.code!==20&&m(new Error(Le.message))})}},V=function(q,we,Ce){(p.type==="arrayBuffer"?q.arrayBuffer():p.type==="json"?q.json():q.text()).then(function(ze){k||(we&&Ce&&function(Le,qe,st){if(zr(),Ha){var St={status:qe.status,statusText:qe.statusText,headers:new fe.Headers};qe.headers.forEach(function(kt,or){return St.headers.set(or,kt)});var xt=Vr(qe.headers.get("Cache-Control")||"");xt["no-store"]||(xt["max-age"]&&St.headers.set("Expires",new Date(st+1e3*xt["max-age"]).toUTCString()),new Date(St.headers.get("Expires")).getTime()-st<42e4||function(kt,or){if(ki===void 0)try{new Response(new ReadableStream),ki=!0}catch(Nt){ki=!1}ki?or(kt.body):kt.blob().then(or)}(qe,function(kt){var or=new fe.Response(kt,St);zr(),Ha&&Ha.then(function(Nt){return Nt.put(dn(Le.url),or)}).catch(function(Nt){return Ye(Nt.message)})}))}}(C,we,Ce),I=!0,m(null,ze,q.headers.get("Cache-Control"),q.headers.get("Expires")))}).catch(function(ze){k||m(new Error(ze.message))})};return D?function(q,we){if(zr(),!Ha)return we(null);var Ce=dn(q.url);Ha.then(function(ze){ze.match(Ce).then(function(Le){var qe=function(st){if(!st)return!1;var St=new Date(st.headers.get("Expires")||0),xt=Vr(st.headers.get("Cache-Control")||"");return St>Date.now()&&!xt["no-cache"]}(Le);ze.delete(Ce),qe&&ze.put(Ce,Le.clone()),we(null,Le,qe)}).catch(we)}).catch(we)}(C,B):B(null,null),{cancel:function(){k=!0,I||w.abort()}}}(t,a);if(Ir()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,a,void 0,!0)}var s;return function(p,m){var g=new fe.XMLHttpRequest;for(var w in g.open(p.method||"GET",p.url,!0),p.type==="arrayBuffer"&&(g.responseType="arraybuffer"),p.headers)g.setRequestHeader(w,p.headers[w]);return p.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=p.credentials==="include",g.onerror=function(){m(new Error(g.statusText))},g.onload=function(){if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){var C=g.response;if(p.type==="json")try{C=JSON.parse(g.response)}catch(I){return m(I)}m(null,C,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else m(new hi(g.statusText,g.status,p.url))},g.send(p.body),{cancel:function(){return g.abort()}}}(t,a)},ks=function(t,a){return du(Ht(t,{type:"arrayBuffer"}),a)},Ji=function(t,a){return du(Ht(t,{method:"POST"}),a)},N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";eo=[],Ao=0;var U=function(t,a){if(An.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Ao>=On.MAX_PARALLEL_IMAGE_REQUESTS){var s={requestParameters:t,callback:a,cancelled:!1,cancel:function(){this.cancelled=!0}};return eo.push(s),s}Ao++;var p=!1,m=function(){if(!p)for(p=!0,Ao--;eo.length&&Ao<On.MAX_PARALLEL_IMAGE_REQUESTS;){var w=eo.shift();w.cancelled||(w.cancel=U(w.requestParameters,w.callback).cancel)}},g=ks(t,function(w,C,I,k){m(),w?a(w):C&&($n()?function(D,B){var V=new fe.Blob([new Uint8Array(D)],{type:"image/png"});fe.createImageBitmap(V).then(function(q){B(null,q)}).catch(function(q){B(new Error("Could not load image because of "+q.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(C,a):function(D,B,V,q){var we=new fe.Image,Ce=fe.URL;we.onload=function(){B(null,we),Ce.revokeObjectURL(we.src),we.onload=null,fe.requestAnimationFrame(function(){we.src=N})},we.onerror=function(){return B(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ze=new fe.Blob([new Uint8Array(D)],{type:"image/png"});we.cacheControl=V,we.expires=q,we.src=D.byteLength?Ce.createObjectURL(ze):N}(C,a,I,k))});return{cancel:function(){g.cancel(),m()}}};function Y(t,a,s){s[t]&&s[t].indexOf(a)!==-1||(s[t]=s[t]||[],s[t].push(a))}function se(t,a,s){if(s&&s[t]){var p=s[t].indexOf(a);p!==-1&&s[t].splice(p,1)}}var Te=function(t,a){a===void 0&&(a={}),Ht(this,a),this.type=t},Ze=function(t){function a(s,p){p===void 0&&(p={}),t.call(this,"error",Ht({error:s},p))}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Te),We=function(){};We.prototype.on=function(t,a){return this._listeners=this._listeners||{},Y(t,a,this._listeners),this},We.prototype.off=function(t,a){return se(t,a,this._listeners),se(t,a,this._oneTimeListeners),this},We.prototype.once=function(t,a){return this._oneTimeListeners=this._oneTimeListeners||{},Y(t,a,this._oneTimeListeners),this},We.prototype.fire=function(t,a){typeof t=="string"&&(t=new Te(t,a||{}));var s=t.type;if(this.listens(s)){t.target=this;for(var p=0,m=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];p<m.length;p+=1)m[p].call(this,t);for(var g=0,w=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];g<w.length;g+=1){var C=w[g];se(s,C,this._oneTimeListeners),C.call(this,t)}var I=this._eventedParent;I&&(Ht(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),I.fire(t))}else t instanceof Ze&&console.error(t.error);return this},We.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},We.prototype.setEventedParent=function(t,a){return this._eventedParent=t,this._eventedParentData=a,this};var te={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ie=function(t,a,s,p){this.message=(t?t+": ":"")+s,p&&(this.identifier=p),a!=null&&a.__line__&&(this.line=a.__line__)};function nt(t){var a=t.value;return a?[new Ie(t.key,a,"constants have been deprecated as of v8")]:[]}function $t(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];for(var p=0,m=a;p<m.length;p+=1){var g=m[p];for(var w in g)t[w]=g[w]}return t}function lr(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function pt(t){if(Array.isArray(t))return t.map(pt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var a={};for(var s in t)a[s]=pt(t[s]);return a}return lr(t)}var tr=function(t){function a(s,p){t.call(this,p),this.message=p,this.key=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(Error),Hr=function(t,a){a===void 0&&(a=[]),this.parent=t,this.bindings={};for(var s=0,p=a;s<p.length;s+=1){var m=p[s];this.bindings[m[0]]=m[1]}};Hr.prototype.concat=function(t){return new Hr(this,t)},Hr.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Hr.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Rr={kind:"null"},Dt={kind:"number"},Dr={kind:"string"},Pr={kind:"boolean"},Mr={kind:"color"},Nn={kind:"object"},Lr={kind:"value"},jn={kind:"collator"},ui={kind:"formatted"},zn={kind:"resolvedImage"};function Pn(t,a){return{kind:"array",itemType:t,N:a}}function Vn(t){if(t.kind==="array"){var a=Vn(t.itemType);return typeof t.N=="number"?"array<"+a+", "+t.N+">":t.itemType.kind==="value"?"array":"array<"+a+">"}return t.kind}var Sa=[Rr,Dt,Dr,Pr,Mr,ui,Nn,Pn(Lr),zn];function vi(t,a){if(a.kind==="error")return null;if(t.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!vi(t.itemType,a.itemType))&&(typeof t.N!="number"||t.N===a.N))return null}else{if(t.kind===a.kind)return null;if(t.kind==="value"){for(var s=0,p=Sa;s<p.length;s+=1)if(!vi(p[s],a))return null}}return"Expected "+Vn(t)+" but found "+Vn(a)+" instead."}function Li(t,a){return a.some(function(s){return s.kind===t.kind})}function Wn(t,a){return a.some(function(s){return s==="null"?t===null:s==="array"?Array.isArray(t):s==="object"?t&&!Array.isArray(t)&&typeof t=="object":s===typeof t})}var Zn=ye(function(t,a){var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function p(C){return(C=Math.round(C))<0?0:C>255?255:C}function m(C){return p(C[C.length-1]==="%"?parseFloat(C)/100*255:parseInt(C))}function g(C){return(I=C[C.length-1]==="%"?parseFloat(C)/100:parseFloat(C))<0?0:I>1?1:I;var I}function w(C,I,k){return k<0?k+=1:k>1&&(k-=1),6*k<1?C+(I-C)*k*6:2*k<1?I:3*k<2?C+(I-C)*(2/3-k)*6:C}try{a.parseCSSColor=function(C){var I,k=C.replace(/ /g,"").toLowerCase();if(k in s)return s[k].slice();if(k[0]==="#")return k.length===4?(I=parseInt(k.substr(1),16))>=0&&I<=4095?[(3840&I)>>4|(3840&I)>>8,240&I|(240&I)>>4,15&I|(15&I)<<4,1]:null:k.length===7&&(I=parseInt(k.substr(1),16))>=0&&I<=16777215?[(16711680&I)>>16,(65280&I)>>8,255&I,1]:null;var D=k.indexOf("("),B=k.indexOf(")");if(D!==-1&&B+1===k.length){var V=k.substr(0,D),q=k.substr(D+1,B-(D+1)).split(","),we=1;switch(V){case"rgba":if(q.length!==4)return null;we=g(q.pop());case"rgb":return q.length!==3?null:[m(q[0]),m(q[1]),m(q[2]),we];case"hsla":if(q.length!==4)return null;we=g(q.pop());case"hsl":if(q.length!==3)return null;var Ce=(parseFloat(q[0])%360+360)%360/360,ze=g(q[1]),Le=g(q[2]),qe=Le<=.5?Le*(ze+1):Le+ze-Le*ze,st=2*Le-qe;return[p(255*w(st,qe,Ce+1/3)),p(255*w(st,qe,Ce)),p(255*w(st,qe,Ce-1/3)),we];default:return null}}return null}}catch(C){}}).parseCSSColor,Jn=function(t,a,s,p){p===void 0&&(p=1),this.r=t,this.g=a,this.b=s,this.a=p};Jn.parse=function(t){if(t){if(t instanceof Jn)return t;if(typeof t=="string"){var a=Zn(t);if(a)return new Jn(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3])}}},Jn.prototype.toString=function(){var t=this.toArray(),a=t[1],s=t[2],p=t[3];return"rgba("+Math.round(t[0])+","+Math.round(a)+","+Math.round(s)+","+p+")"},Jn.prototype.toArray=function(){var t=this.a;return t===0?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},Jn.black=new Jn(0,0,0,1),Jn.white=new Jn(1,1,1,1),Jn.transparent=new Jn(0,0,0,0),Jn.red=new Jn(1,0,0,1);var Qi=function(t,a,s){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Qi.prototype.compare=function(t,a){return this.collator.compare(t,a)},Qi.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var gs=function(t,a,s,p,m){this.text=t,this.image=a,this.scale=s,this.fontStack=p,this.textColor=m},Bi=function(t){this.sections=t};Bi.fromString=function(t){return new Bi([new gs(t,null,null,null,null)])},Bi.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(t){return t.text.length!==0||t.image&&t.image.name.length!==0})},Bi.factory=function(t){return t instanceof Bi?t:Bi.fromString(t)},Bi.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(t){return t.text}).join("")},Bi.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var p=s[a];if(p.image)t.push(["image",p.image.name]);else{t.push(p.text);var m={};p.fontStack&&(m["text-font"]=["literal",p.fontStack.split(",")]),p.scale&&(m["font-scale"]=p.scale),p.textColor&&(m["text-color"]=["rgba"].concat(p.textColor.toArray())),t.push(m)}}return t};var ea=function(t){this.name=t.name,this.available=t.available};function Bu(t,a,s,p){return typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof s=="number"&&s>=0&&s<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:"Invalid rgba value ["+[t,a,s,p].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof p=="number"?[t,a,s,p]:[t,a,s]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function qs(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Jn||t instanceof Qi||t instanceof Bi||t instanceof ea)return!0;if(Array.isArray(t)){for(var a=0,s=t;a<s.length;a+=1)if(!qs(s[a]))return!1;return!0}if(typeof t=="object"){for(var p in t)if(!qs(t[p]))return!1;return!0}return!1}function ji(t){if(t===null)return Rr;if(typeof t=="string")return Dr;if(typeof t=="boolean")return Pr;if(typeof t=="number")return Dt;if(t instanceof Jn)return Mr;if(t instanceof Qi)return jn;if(t instanceof Bi)return ui;if(t instanceof ea)return zn;if(Array.isArray(t)){for(var a,s=t.length,p=0,m=t;p<m.length;p+=1){var g=ji(m[p]);if(a){if(a===g)continue;a=Lr;break}a=g}return Pn(a||Lr,s)}return Nn}function Wa(t){var a=typeof t;return t===null?"":a==="string"||a==="number"||a==="boolean"?String(t):t instanceof Jn||t instanceof Bi||t instanceof ea?t.toString():JSON.stringify(t)}ea.prototype.toString=function(){return this.name},ea.fromString=function(t){return t?new ea({name:t,available:!1}):null},ea.prototype.serialize=function(){return["image",this.name]};var Ea=function(t,a){this.type=t,this.value=a};Ea.parse=function(t,a){if(t.length!==2)return a.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!qs(t[1]))return a.error("invalid value");var s=t[1],p=ji(s),m=a.expectedType;return p.kind!=="array"||p.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(p=m),new Ea(p,s)},Ea.prototype.evaluate=function(){return this.value},Ea.prototype.eachChild=function(){},Ea.prototype.outputDefined=function(){return!0},Ea.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Jn?["rgba"].concat(this.value.toArray()):this.value instanceof Bi?this.value.serialize():this.value};var ua=function(t){this.name="ExpressionEvaluationError",this.message=t};ua.prototype.toJSON=function(){return this.message};var xo={string:Dr,number:Dt,boolean:Pr,object:Nn},bi=function(t,a){this.type=t,this.args=a};bi.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s,p=1,m=t[0];if(m==="array"){var g,w;if(t.length>2){var C=t[1];if(typeof C!="string"||!(C in xo)||C==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);g=xo[C],p++}else g=Lr;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);w=t[2],p++}s=Pn(g,w)}else s=xo[m];for(var I=[];p<t.length;p++){var k=a.parse(t[p],p,Lr);if(!k)return null;I.push(k)}return new bi(s,I)},bi.prototype.evaluate=function(t){for(var a=0;a<this.args.length;a++){var s=this.args[a].evaluate(t);if(!vi(this.type,ji(s)))return s;if(a===this.args.length-1)throw new ua("Expected value to be of type "+Vn(this.type)+", but found "+Vn(ji(s))+" instead.")}return null},bi.prototype.eachChild=function(t){this.args.forEach(t)},bi.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},bi.prototype.serialize=function(){var t=this.type,a=[t.kind];if(t.kind==="array"){var s=t.itemType;if(s.kind==="string"||s.kind==="number"||s.kind==="boolean"){a.push(s.kind);var p=t.N;(typeof p=="number"||this.args.length>1)&&a.push(p)}}return a.concat(this.args.map(function(m){return m.serialize()}))};var bo=function(t){this.type=ui,this.sections=t};bo.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[1];if(!Array.isArray(s)&&typeof s=="object")return a.error("First argument must be an image or text section.");for(var p=[],m=!1,g=1;g<=t.length-1;++g){var w=t[g];if(m&&typeof w=="object"&&!Array.isArray(w)){m=!1;var C=null;if(w["font-scale"]&&!(C=a.parse(w["font-scale"],1,Dt)))return null;var I=null;if(w["text-font"]&&!(I=a.parse(w["text-font"],1,Pn(Dr))))return null;var k=null;if(w["text-color"]&&!(k=a.parse(w["text-color"],1,Mr)))return null;var D=p[p.length-1];D.scale=C,D.font=I,D.textColor=k}else{var B=a.parse(t[g],1,Lr);if(!B)return null;var V=B.type.kind;if(V!=="string"&&V!=="value"&&V!=="null"&&V!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,p.push({content:B,scale:null,font:null,textColor:null})}}return new bo(p)},bo.prototype.evaluate=function(t){return new Bi(this.sections.map(function(a){var s=a.content.evaluate(t);return ji(s)===zn?new gs("",s,null,null,null):new gs(Wa(s),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)}))},bo.prototype.eachChild=function(t){for(var a=0,s=this.sections;a<s.length;a+=1){var p=s[a];t(p.content),p.scale&&t(p.scale),p.font&&t(p.font),p.textColor&&t(p.textColor)}},bo.prototype.outputDefined=function(){return!1},bo.prototype.serialize=function(){for(var t=["format"],a=0,s=this.sections;a<s.length;a+=1){var p=s[a];t.push(p.content.serialize());var m={};p.scale&&(m["font-scale"]=p.scale.serialize()),p.font&&(m["text-font"]=p.font.serialize()),p.textColor&&(m["text-color"]=p.textColor.serialize()),t.push(m)}return t};var Xa=function(t){this.type=zn,this.input=t};Xa.parse=function(t,a){if(t.length!==2)return a.error("Expected two arguments.");var s=a.parse(t[1],1,Dr);return s?new Xa(s):a.error("No image name provided.")},Xa.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=ea.fromString(a);return s&&t.availableImages&&(s.available=t.availableImages.indexOf(a)>-1),s},Xa.prototype.eachChild=function(t){t(this.input)},Xa.prototype.outputDefined=function(){return!1},Xa.prototype.serialize=function(){return["image",this.input.serialize()]};var Mo={"to-boolean":Pr,"to-color":Mr,"to-number":Dt,"to-string":Dr},Xo=function(t,a){this.type=t,this.args=a};Xo.parse=function(t,a){if(t.length<2)return a.error("Expected at least one argument.");var s=t[0];if((s==="to-boolean"||s==="to-string")&&t.length!==2)return a.error("Expected one argument.");for(var p=Mo[s],m=[],g=1;g<t.length;g++){var w=a.parse(t[g],g,Lr);if(!w)return null;m.push(w)}return new Xo(p,m)},Xo.prototype.evaluate=function(t){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(t));if(this.type.kind==="color"){for(var a,s,p=0,m=this.args;p<m.length;p+=1){if(s=null,(a=m[p].evaluate(t))instanceof Jn)return a;if(typeof a=="string"){var g=t.parseColor(a);if(g)return g}else if(Array.isArray(a)&&!(s=a.length<3||a.length>4?"Invalid rbga value "+JSON.stringify(a)+": expected an array containing either three or four numeric values.":Bu(a[0],a[1],a[2],a[3])))return new Jn(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new ua(s||"Could not parse color from value '"+(typeof a=="string"?a:String(JSON.stringify(a)))+"'")}if(this.type.kind==="number"){for(var w=null,C=0,I=this.args;C<I.length;C+=1){if((w=I[C].evaluate(t))===null)return 0;var k=Number(w);if(!isNaN(k))return k}throw new ua("Could not convert "+JSON.stringify(w)+" to number.")}return this.type.kind==="formatted"?Bi.fromString(Wa(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?ea.fromString(Wa(this.args[0].evaluate(t))):Wa(this.args[0].evaluate(t))},Xo.prototype.eachChild=function(t){this.args.forEach(t)},Xo.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},Xo.prototype.serialize=function(){if(this.type.kind==="formatted")return new bo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Xa(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild(function(a){t.push(a.serialize())}),t};var Lc=["Unknown","Point","LineString","Polygon"],Yo=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Yo.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Yo.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Lc[this.feature.type]:this.feature.type:null},Yo.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Yo.prototype.canonicalID=function(){return this.canonical},Yo.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Yo.prototype.parseColor=function(t){var a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=Jn.parse(t)),a};var Ca=function(t,a,s,p){this.name=t,this.type=a,this._evaluate=s,this.args=p};Ca.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Ca.prototype.eachChild=function(t){this.args.forEach(t)},Ca.prototype.outputDefined=function(){return!1},Ca.prototype.serialize=function(){return[this.name].concat(this.args.map(function(t){return t.serialize()}))},Ca.parse=function(t,a){var s,p=t[0],m=Ca.definitions[p];if(!m)return a.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0);for(var g=Array.isArray(m)?m[0]:m.type,w=Array.isArray(m)?[[m[1],m[2]]]:m.overloads,C=w.filter(function(cn){var Br=cn[0];return!Array.isArray(Br)||Br.length===t.length-1}),I=null,k=0,D=C;k<D.length;k+=1){var B=D[k],V=B[0],q=B[1];I=new _s(a.registry,a.path,null,a.scope);for(var we=[],Ce=!1,ze=1;ze<t.length;ze++){var Le=t[ze],qe=Array.isArray(V)?V[ze-1]:V.type,st=I.parse(Le,1+we.length,qe);if(!st){Ce=!0;break}we.push(st)}if(!Ce)if(Array.isArray(V)&&V.length!==we.length)I.error("Expected "+V.length+" arguments, but found "+we.length+" instead.");else{for(var St=0;St<we.length;St++){var xt=Array.isArray(V)?V[St]:V.type,kt=we[St];I.concat(St+1).checkSubtype(xt,kt.type)}if(I.errors.length===0)return new Ca(p,g,q,we)}}if(C.length===1)(s=a.errors).push.apply(s,I.errors);else{for(var or=(C.length?C:w).map(function(cn){var Br;return Br=cn[0],Array.isArray(Br)?"("+Br.map(Vn).join(", ")+")":"("+Vn(Br.type)+"...)"}).join(" | "),Nt=[],un=1;un<t.length;un++){var kr=a.parse(t[un],1+Nt.length);if(!kr)return null;Nt.push(Vn(kr.type))}a.error("Expected arguments of type "+or+", but found ("+Nt.join(", ")+") instead.")}return null},Ca.register=function(t,a){for(var s in Ca.definitions=a,a)t[s]=Ca};var va=function(t,a,s){this.type=jn,this.locale=s,this.caseSensitive=t,this.diacriticSensitive=a};function Ri(t,a){t[0]=Math.min(t[0],a[0]),t[1]=Math.min(t[1],a[1]),t[2]=Math.max(t[2],a[0]),t[3]=Math.max(t[3],a[1])}function K(t,a){return!(t[0]<=a[0]||t[2]>=a[2]||t[1]<=a[1]||t[3]>=a[3])}function he(t,a){var s=(180+t[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,m=Math.pow(2,a.z);return[Math.round(s*m*8192),Math.round(p*m*8192)]}function je(t,a,s){return a[1]>t[1]!=s[1]>t[1]&&t[0]<(s[0]-a[0])*(t[1]-a[1])/(s[1]-a[1])+a[0]}function It(t,a){for(var s,p,m,g,w,C,I,k=!1,D=0,B=a.length;D<B;D++)for(var V=a[D],q=0,we=V.length;q<we-1;q++){if((g=(s=t)[0]-(p=V[q])[0])*(I=s[1]-(m=V[q+1])[1])-(C=s[0]-m[0])*(w=s[1]-p[1])==0&&g*C<=0&&w*I<=0)return!1;je(t,V[q],V[q+1])&&(k=!k)}return k}function _r(t,a){for(var s=0;s<a.length;s++)if(It(t,a[s]))return!0;return!1}function rn(t,a,s,p){var m=p[0]-s[0],g=p[1]-s[1],w=(t[0]-s[0])*g-m*(t[1]-s[1]),C=(a[0]-s[0])*g-m*(a[1]-s[1]);return w>0&&C<0||w<0&&C>0}function mi(t,a,s){for(var p=0,m=s;p<m.length;p+=1)for(var g=m[p],w=0;w<g.length-1;++w)if((B=[(D=g[w+1])[0]-(k=g[w])[0],D[1]-k[1]])[0]*(V=[(I=a)[0]-(C=t)[0],I[1]-C[1]])[1]-B[1]*V[0]!=0&&rn(C,I,k,D)&&rn(k,D,C,I))return!0;var C,I,k,D,B,V;return!1}function ma(t,a){for(var s=0;s<t.length;++s)if(!It(t[s],a))return!1;for(var p=0;p<t.length-1;++p)if(mi(t[p],t[p+1],a))return!1;return!0}function Ya(t,a){for(var s=0;s<a.length;s++)if(ma(t,a[s]))return!0;return!1}function Ta(t,a,s){for(var p=[],m=0;m<t.length;m++){for(var g=[],w=0;w<t[m].length;w++){var C=he(t[m][w],s);Ri(a,C),g.push(C)}p.push(g)}return p}function qo(t,a,s){for(var p=[],m=0;m<t.length;m++){var g=Ta(t[m],a,s);p.push(g)}return p}function uc(t,a,s,p){if(t[0]<s[0]||t[0]>s[2]){var m=.5*p,g=t[0]-s[0]>m?-p:s[0]-t[0]>m?p:0;g===0&&(g=t[0]-s[2]>m?-p:s[2]-t[0]>m?p:0),t[0]+=g}Ri(a,t)}function lf(t,a,s,p){for(var m=8192*Math.pow(2,p.z),g=[8192*p.x,8192*p.y],w=[],C=0,I=t;C<I.length;C+=1)for(var k=0,D=I[C];k<D.length;k+=1){var B=D[k],V=[B.x+g[0],B.y+g[1]];uc(V,a,s,m),w.push(V)}return w}function Rc(t,a,s,p){for(var m,g=8192*Math.pow(2,p.z),w=[8192*p.x,8192*p.y],C=[],I=0,k=t;I<k.length;I+=1){for(var D=[],B=0,V=k[I];B<V.length;B+=1){var q=V[B],we=[q.x+w[0],q.y+w[1]];Ri(a,we),D.push(we)}C.push(D)}if(a[2]-a[0]<=g/2){(m=a)[0]=m[1]=1/0,m[2]=m[3]=-1/0;for(var Ce=0,ze=C;Ce<ze.length;Ce+=1)for(var Le=0,qe=ze[Ce];Le<qe.length;Le+=1)uc(qe[Le],a,s,g)}return C}va.parse=function(t,a){if(t.length!==2)return a.error("Expected one argument.");var s=t[1];if(typeof s!="object"||Array.isArray(s))return a.error("Collator options argument must be an object.");var p=a.parse(s["case-sensitive"]!==void 0&&s["case-sensitive"],1,Pr);if(!p)return null;var m=a.parse(s["diacritic-sensitive"]!==void 0&&s["diacritic-sensitive"],1,Pr);if(!m)return null;var g=null;return s.locale&&!(g=a.parse(s.locale,1,Dr))?null:new va(p,m,g)},va.prototype.evaluate=function(t){return new Qi(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},va.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},va.prototype.outputDefined=function(){return!1},va.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var is=function(t,a){this.type=Pr,this.geojson=t,this.geometries=a};function Nu(t){if(t instanceof Ca&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof is)return!1;var a=!0;return t.eachChild(function(s){a&&!Nu(s)&&(a=!1)}),a}function as(t){if(t instanceof Ca&&t.name==="feature-state")return!1;var a=!0;return t.eachChild(function(s){a&&!as(s)&&(a=!1)}),a}function ll(t,a){if(t instanceof Ca&&a.indexOf(t.name)>=0)return!1;var s=!0;return t.eachChild(function(p){s&&!ll(p,a)&&(s=!1)}),s}is.parse=function(t,a){if(t.length!==2)return a.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(qs(t[1])){var s=t[1];if(s.type==="FeatureCollection")for(var p=0;p<s.features.length;++p){var m=s.features[p].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new is(s,s.features[p].geometry)}else if(s.type==="Feature"){var g=s.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new is(s,s.geometry)}else if(s.type==="Polygon"||s.type==="MultiPolygon")return new is(s,s)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")},is.prototype.evaluate=function(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(a,s){var p=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(s.type==="Polygon"){var w=Ta(s.coordinates,m,g),C=lf(a.geometry(),p,m,g);if(!K(p,m))return!1;for(var I=0,k=C;I<k.length;I+=1)if(!It(k[I],w))return!1}if(s.type==="MultiPolygon"){var D=qo(s.coordinates,m,g),B=lf(a.geometry(),p,m,g);if(!K(p,m))return!1;for(var V=0,q=B;V<q.length;V+=1)if(!_r(q[V],D))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(a,s){var p=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],g=a.canonicalID();if(s.type==="Polygon"){var w=Ta(s.coordinates,m,g),C=Rc(a.geometry(),p,m,g);if(!K(p,m))return!1;for(var I=0,k=C;I<k.length;I+=1)if(!ma(k[I],w))return!1}if(s.type==="MultiPolygon"){var D=qo(s.coordinates,m,g),B=Rc(a.geometry(),p,m,g);if(!K(p,m))return!1;for(var V=0,q=B;V<q.length;V+=1)if(!Ya(q[V],D))return!1}return!0}(t,this.geometries)}return!1},is.prototype.eachChild=function(){},is.prototype.outputDefined=function(){return!0},is.prototype.serialize=function(){return["within",this.geojson]};var vu=function(t,a){this.type=a.type,this.name=t,this.boundExpression=a};vu.parse=function(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");var s=t[1];return a.scope.has(s)?new vu(s,a.scope.get(s)):a.error('Unknown variable "'+s+'". Make sure "'+s+'" has been bound in an enclosing "let" expression before using it.',1)},vu.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},vu.prototype.eachChild=function(){},vu.prototype.outputDefined=function(){return!1},vu.prototype.serialize=function(){return["var",this.name]};var _s=function(t,a,s,p,m){a===void 0&&(a=[]),p===void 0&&(p=new Hr),m===void 0&&(m=[]),this.registry=t,this.path=a,this.key=a.map(function(g){return"["+g+"]"}).join(""),this.scope=p,this.errors=m,this.expectedType=s};function Fl(t,a){for(var s,p=t.length-1,m=0,g=p,w=0;m<=g;)if((s=t[w=Math.floor((m+g)/2)])<=a){if(w===p||a<t[w+1])return w;m=w+1}else{if(!(s>a))throw new ua("Input is not a number.");g=w-1}return 0}_s.prototype.parse=function(t,a,s,p,m){return m===void 0&&(m={}),a?this.concat(a,s,p)._parse(t,m):this._parse(t,m)},_s.prototype._parse=function(t,a){function s(k,D,B){return B==="assert"?new bi(D,[k]):B==="coerce"?new Xo(D,[k]):k}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var p=t[0];if(typeof p!="string")return this.error("Expression name must be a string, but found "+typeof p+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var m=this.registry[p];if(m){var g=m.parse(t,this);if(!g)return null;if(this.expectedType){var w=this.expectedType,C=g.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||C.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||C.kind!=="value"&&C.kind!=="string"){if(this.checkSubtype(w,C))return null}else g=s(g,w,a.typeAnnotation||"coerce");else g=s(g,w,a.typeAnnotation||"assert")}if(!(g instanceof Ea)&&g.type.kind!=="resolvedImage"&&function k(D){if(D instanceof vu)return k(D.boundExpression);if(D instanceof Ca&&D.name==="error"||D instanceof va||D instanceof is)return!1;var B=D instanceof Xo||D instanceof bi,V=!0;return D.eachChild(function(q){V=B?V&&k(q):V&&q instanceof Ea}),!!V&&Nu(D)&&ll(D,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(g)){var I=new Yo;try{g=new Ea(g.type,g.evaluate(I))}catch(k){return this.error(k.message),null}}return g}return this.error('Unknown expression "'+p+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof t+" instead.")},_s.prototype.concat=function(t,a,s){var p=typeof t=="number"?this.path.concat(t):this.path,m=s?this.scope.concat(s):this.scope;return new _s(this.registry,p,a||null,m,this.errors)},_s.prototype.error=function(t){for(var a=[],s=arguments.length-1;s-- >0;)a[s]=arguments[s+1];var p=""+this.key+a.map(function(m){return"["+m+"]"}).join("");this.errors.push(new tr(p,t))},_s.prototype.checkSubtype=function(t,a){var s=vi(t,a);return s&&this.error(s),s};var Po=function(t,a,s){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(var p=0,m=s;p<m.length;p+=1){var g=m[p],w=g[1];this.labels.push(g[0]),this.outputs.push(w)}};function la(t,a,s){return t*(1-s)+a*s}Po.parse=function(t,a){if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");var s=a.parse(t[1],1,Dt);if(!s)return null;var p=[],m=null;a.expectedType&&a.expectedType.kind!=="value"&&(m=a.expectedType);for(var g=1;g<t.length;g+=2){var w=g===1?-1/0:t[g],C=t[g+1],I=g,k=g+1;if(typeof w!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',I);if(p.length&&p[p.length-1][0]>=w)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',I);var D=a.parse(C,k,m);if(!D)return null;m=m||D.type,p.push([w,D])}return new Po(m,s,p)},Po.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var p=this.input.evaluate(t);if(p<=a[0])return s[0].evaluate(t);var m=a.length;return p>=a[m-1]?s[m-1].evaluate(t):s[Fl(a,p)].evaluate(t)},Po.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},Po.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},Po.prototype.serialize=function(){for(var t=["step",this.input.serialize()],a=0;a<this.labels.length;a++)a>0&&t.push(this.labels[a]),t.push(this.outputs[a].serialize());return t};var Bl=Object.freeze({__proto__:null,number:la,color:function(t,a,s){return new Jn(la(t.r,a.r,s),la(t.g,a.g,s),la(t.b,a.b,s),la(t.a,a.a,s))},array:function(t,a,s){return t.map(function(p,m){return la(p,a[m],s)})}}),Dc=6/29*3*(6/29),cf=Math.PI/180,mu=180/Math.PI;function yu(t){return t>.008856451679035631?Math.pow(t,1/3):t/Dc+4/29}function Fc(t){return t>6/29?t*t*t:Dc*(t-4/29)}function Ii(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function gu(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Gf(t){var a=gu(t.r),s=gu(t.g),p=gu(t.b),m=yu((.4124564*a+.3575761*s+.1804375*p)/.95047),g=yu((.2126729*a+.7151522*s+.072175*p)/1);return{l:116*g-16,a:500*(m-g),b:200*(g-yu((.0193339*a+.119192*s+.9503041*p)/1.08883)),alpha:t.a}}function Hf(t){var a=(t.l+16)/116,s=isNaN(t.a)?a:a+t.a/500,p=isNaN(t.b)?a:a-t.b/200;return a=1*Fc(a),s=.95047*Fc(s),p=1.08883*Fc(p),new Jn(Ii(3.2404542*s-1.5371385*a-.4985314*p),Ii(-.969266*s+1.8760108*a+.041556*p),Ii(.0556434*s-.2040259*a+1.0572252*p),t.alpha)}function Wf(t,a,s){var p=a-t;return t+s*(p>180||p<-180?p-360*Math.round(p/360):p)}var lc={forward:Gf,reverse:Hf,interpolate:function(t,a,s){return{l:la(t.l,a.l,s),a:la(t.a,a.a,s),b:la(t.b,a.b,s),alpha:la(t.alpha,a.alpha,s)}}},Nl={forward:function(t){var a=Gf(t),s=a.l,p=a.a,m=a.b,g=Math.atan2(m,p)*mu;return{h:g<0?g+360:g,c:Math.sqrt(p*p+m*m),l:s,alpha:t.a}},reverse:function(t){var a=t.h*cf,s=t.c;return Hf({l:t.l,a:Math.cos(a)*s,b:Math.sin(a)*s,alpha:t.alpha})},interpolate:function(t,a,s){return{h:Wf(t.h,a.h,s),c:la(t.c,a.c,s),l:la(t.l,a.l,s),alpha:la(t.alpha,a.alpha,s)}}},Xf=Object.freeze({__proto__:null,lab:lc,hcl:Nl}),qi=function(t,a,s,p,m){this.type=t,this.operator=a,this.interpolation=s,this.input=p,this.labels=[],this.outputs=[];for(var g=0,w=m;g<w.length;g+=1){var C=w[g],I=C[1];this.labels.push(C[0]),this.outputs.push(I)}};function ff(t,a,s,p){var m=p-s,g=t-s;return m===0?0:a===1?g/m:(Math.pow(a,g)-1)/(Math.pow(a,m)-1)}qi.interpolationFactor=function(t,a,s,p){var m=0;if(t.name==="exponential")m=ff(a,t.base,s,p);else if(t.name==="linear")m=ff(a,1,s,p);else if(t.name==="cubic-bezier"){var g=t.controlPoints;m=new Z(g[0],g[1],g[2],g[3]).solve(ff(a,1,s,p))}return m},qi.parse=function(t,a){var s=t[0],p=t[1],m=t[2],g=t.slice(3);if(!Array.isArray(p)||p.length===0)return a.error("Expected an interpolation type expression.",1);if(p[0]==="linear")p={name:"linear"};else if(p[0]==="exponential"){var w=p[1];if(typeof w!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);p={name:"exponential",base:w}}else{if(p[0]!=="cubic-bezier")return a.error("Unknown interpolation type "+String(p[0]),1,0);var C=p.slice(1);if(C.length!==4||C.some(function(ze){return typeof ze!="number"||ze<0||ze>1}))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);p={name:"cubic-bezier",controlPoints:C}}if(t.length-1<4)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(!(m=a.parse(m,2,Dt)))return null;var I=[],k=null;s==="interpolate-hcl"||s==="interpolate-lab"?k=Mr:a.expectedType&&a.expectedType.kind!=="value"&&(k=a.expectedType);for(var D=0;D<g.length;D+=2){var B=g[D],V=g[D+1],q=D+3,we=D+4;if(typeof B!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(I.length&&I[I.length-1][0]>=B)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);var Ce=a.parse(V,we,k);if(!Ce)return null;k=k||Ce.type,I.push([B,Ce])}return k.kind==="number"||k.kind==="color"||k.kind==="array"&&k.itemType.kind==="number"&&typeof k.N=="number"?new qi(k,s,p,m,I):a.error("Type "+Vn(k)+" is not interpolatable.")},qi.prototype.evaluate=function(t){var a=this.labels,s=this.outputs;if(a.length===1)return s[0].evaluate(t);var p=this.input.evaluate(t);if(p<=a[0])return s[0].evaluate(t);var m=a.length;if(p>=a[m-1])return s[m-1].evaluate(t);var g=Fl(a,p),w=qi.interpolationFactor(this.interpolation,p,a[g],a[g+1]),C=s[g].evaluate(t),I=s[g+1].evaluate(t);return this.operator==="interpolate"?Bl[this.type.kind.toLowerCase()](C,I,w):this.operator==="interpolate-hcl"?Nl.reverse(Nl.interpolate(Nl.forward(C),Nl.forward(I),w)):lc.reverse(lc.interpolate(lc.forward(C),lc.forward(I),w))},qi.prototype.eachChild=function(t){t(this.input);for(var a=0,s=this.outputs;a<s.length;a+=1)t(s[a])},qi.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})},qi.prototype.serialize=function(){var t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var a=[this.operator,t,this.input.serialize()],s=0;s<this.labels.length;s++)a.push(this.labels[s],this.outputs[s].serialize());return a};var zu=function(t,a){this.type=t,this.args=a};zu.parse=function(t,a){if(t.length<2)return a.error("Expectected at least one argument.");var s=null,p=a.expectedType;p&&p.kind!=="value"&&(s=p);for(var m=[],g=0,w=t.slice(1);g<w.length;g+=1){var C=a.parse(w[g],1+m.length,s,void 0,{typeAnnotation:"omit"});if(!C)return null;s=s||C.type,m.push(C)}var I=p&&m.some(function(k){return vi(p,k.type)});return new zu(I?Lr:s,m)},zu.prototype.evaluate=function(t){for(var a,s=null,p=0,m=0,g=this.args;m<g.length&&(p++,(s=g[m].evaluate(t))&&s instanceof ea&&!s.available&&(a||(a=s.name),s=null,p===this.args.length&&(s=a)),s===null);m+=1);return s},zu.prototype.eachChild=function(t){this.args.forEach(t)},zu.prototype.outputDefined=function(){return this.args.every(function(t){return t.outputDefined()})},zu.prototype.serialize=function(){var t=["coalesce"];return this.eachChild(function(a){t.push(a.serialize())}),t};var La=function(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a};La.prototype.evaluate=function(t){return this.result.evaluate(t)},La.prototype.eachChild=function(t){for(var a=0,s=this.bindings;a<s.length;a+=1)t(s[a][1]);t(this.result)},La.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var s=[],p=1;p<t.length-1;p+=2){var m=t[p];if(typeof m!="string")return a.error("Expected string, but found "+typeof m+" instead.",p);if(/[^a-zA-Z0-9_]/.test(m))return a.error("Variable names must contain only alphanumeric characters or '_'.",p);var g=a.parse(t[p+1],p+1);if(!g)return null;s.push([m,g])}var w=a.parse(t[t.length-1],t.length-1,a.expectedType,s);return w?new La(s,w):null},La.prototype.outputDefined=function(){return this.result.outputDefined()},La.prototype.serialize=function(){for(var t=["let"],a=0,s=this.bindings;a<s.length;a+=1){var p=s[a];t.push(p[0],p[1].serialize())}return t.push(this.result.serialize()),t};var Ls=function(t,a,s){this.type=t,this.index=a,this.input=s};Ls.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Dt),p=a.parse(t[2],2,Pn(a.expectedType||Lr));return s&&p?new Ls(p.type.itemType,s,p):null},Ls.prototype.evaluate=function(t){var a=this.index.evaluate(t),s=this.input.evaluate(t);if(a<0)throw new ua("Array index out of bounds: "+a+" < 0.");if(a>=s.length)throw new ua("Array index out of bounds: "+a+" > "+(s.length-1)+".");if(a!==Math.floor(a))throw new ua("Array index must be an integer, but found "+a+" instead.");return s[a]},Ls.prototype.eachChild=function(t){t(this.index),t(this.input)},Ls.prototype.outputDefined=function(){return!1},Ls.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Io=function(t,a){this.type=Pr,this.needle=t,this.haystack=a};Io.parse=function(t,a){if(t.length!==3)return a.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Lr),p=a.parse(t[2],2,Lr);return s&&p?Li(s.type,[Pr,Dr,Dt,Rr,Lr])?new Io(s,p):a.error("Expected first argument to be of type boolean, string, number or null, but found "+Vn(s.type)+" instead"):null},Io.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!s)return!1;if(!Wn(a,["boolean","string","number","null"]))throw new ua("Expected first argument to be of type boolean, string, number or null, but found "+Vn(ji(a))+" instead.");if(!Wn(s,["string","array"]))throw new ua("Expected second argument to be of type array or string, but found "+Vn(ji(s))+" instead.");return s.indexOf(a)>=0},Io.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},Io.prototype.outputDefined=function(){return!0},Io.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var _u=function(t,a,s){this.type=Dt,this.needle=t,this.haystack=a,this.fromIndex=s};_u.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Lr),p=a.parse(t[2],2,Lr);if(!s||!p)return null;if(!Li(s.type,[Pr,Dr,Dt,Rr,Lr]))return a.error("Expected first argument to be of type boolean, string, number or null, but found "+Vn(s.type)+" instead");if(t.length===4){var m=a.parse(t[3],3,Dt);return m?new _u(s,p,m):null}return new _u(s,p)},_u.prototype.evaluate=function(t){var a=this.needle.evaluate(t),s=this.haystack.evaluate(t);if(!Wn(a,["boolean","string","number","null"]))throw new ua("Expected first argument to be of type boolean, string, number or null, but found "+Vn(ji(a))+" instead.");if(!Wn(s,["string","array"]))throw new ua("Expected second argument to be of type array or string, but found "+Vn(ji(s))+" instead.");if(this.fromIndex){var p=this.fromIndex.evaluate(t);return s.indexOf(a,p)}return s.indexOf(a)},_u.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},_u.prototype.outputDefined=function(){return!1},_u.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ko=function(t,a,s,p,m,g){this.inputType=t,this.type=a,this.input=s,this.cases=p,this.outputs=m,this.otherwise=g};Ko.parse=function(t,a){if(t.length<5)return a.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return a.error("Expected an even number of arguments.");var s,p;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);for(var m={},g=[],w=2;w<t.length-1;w+=2){var C=t[w],I=t[w+1];Array.isArray(C)||(C=[C]);var k=a.concat(w);if(C.length===0)return k.error("Expected at least one branch label.");for(var D=0,B=C;D<B.length;D+=1){var V=B[D];if(typeof V!="number"&&typeof V!="string")return k.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return k.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof V=="number"&&Math.floor(V)!==V)return k.error("Numeric branch labels must be integer values.");if(s){if(k.checkSubtype(s,ji(V)))return null}else s=ji(V);if(m[String(V)]!==void 0)return k.error("Branch labels must be unique.");m[String(V)]=g.length}var q=a.parse(I,w,p);if(!q)return null;p=p||q.type,g.push(q)}var we=a.parse(t[1],1,Lr);if(!we)return null;var Ce=a.parse(t[t.length-1],t.length-1,p);return Ce?we.type.kind!=="value"&&a.concat(1).checkSubtype(s,we.type)?null:new Ko(s,p,we,m,g,Ce):null},Ko.prototype.evaluate=function(t){var a=this.input.evaluate(t);return(ji(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)},Ko.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Ko.prototype.outputDefined=function(){return this.outputs.every(function(t){return t.outputDefined()})&&this.otherwise.outputDefined()},Ko.prototype.serialize=function(){for(var t=this,a=["match",this.input.serialize()],s=[],p={},m=0,g=Object.keys(this.cases).sort();m<g.length;m+=1){var w=g[m];(B=p[this.cases[w]])===void 0?(p[this.cases[w]]=s.length,s.push([this.cases[w],[w]])):s[B][1].push(w)}for(var C=function(q){return t.inputType.kind==="number"?Number(q):q},I=0,k=s;I<k.length;I+=1){var D=k[I],B=D[0],V=D[1];a.push(V.length===1?C(V[0]):V.map(C)),a.push(this.outputs[outputIndex$1].serialize())}return a.push(this.otherwise.serialize()),a};var xu=function(t,a,s){this.type=t,this.branches=a,this.otherwise=s};xu.parse=function(t,a){if(t.length<4)return a.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return a.error("Expected an odd number of arguments.");var s;a.expectedType&&a.expectedType.kind!=="value"&&(s=a.expectedType);for(var p=[],m=1;m<t.length-1;m+=2){var g=a.parse(t[m],m,Pr);if(!g)return null;var w=a.parse(t[m+1],m+1,s);if(!w)return null;p.push([g,w]),s=s||w.type}var C=a.parse(t[t.length-1],t.length-1,s);return C?new xu(s,p,C):null},xu.prototype.evaluate=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var p=s[a],m=p[1];if(p[0].evaluate(t))return m.evaluate(t)}return this.otherwise.evaluate(t)},xu.prototype.eachChild=function(t){for(var a=0,s=this.branches;a<s.length;a+=1){var p=s[a],m=p[1];t(p[0]),t(m)}t(this.otherwise)},xu.prototype.outputDefined=function(){return this.branches.every(function(t){return t[1].outputDefined()})&&this.otherwise.outputDefined()},xu.prototype.serialize=function(){var t=["case"];return this.eachChild(function(a){t.push(a.serialize())}),t};var Oo=function(t,a,s,p){this.type=t,this.input=a,this.beginIndex=s,this.endIndex=p};function cc(t,a){return t==="=="||t==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Yf(t,a,s,p){return p.compare(a,s)===0}function Di(t,a,s){var p=t!=="=="&&t!=="!=";return function(){function m(g,w,C){this.type=Pr,this.lhs=g,this.rhs=w,this.collator=C,this.hasUntypedArgument=g.type.kind==="value"||w.type.kind==="value"}return m.parse=function(g,w){if(g.length!==3&&g.length!==4)return w.error("Expected two or three arguments.");var C=g[0],I=w.parse(g[1],1,Lr);if(!I)return null;if(!cc(C,I.type))return w.concat(1).error('"'+C+`" comparisons are not supported for type '`+Vn(I.type)+"'.");var k=w.parse(g[2],2,Lr);if(!k)return null;if(!cc(C,k.type))return w.concat(2).error('"'+C+`" comparisons are not supported for type '`+Vn(k.type)+"'.");if(I.type.kind!==k.type.kind&&I.type.kind!=="value"&&k.type.kind!=="value")return w.error("Cannot compare types '"+Vn(I.type)+"' and '"+Vn(k.type)+"'.");p&&(I.type.kind==="value"&&k.type.kind!=="value"?I=new bi(k.type,[I]):I.type.kind!=="value"&&k.type.kind==="value"&&(k=new bi(I.type,[k])));var D=null;if(g.length===4){if(I.type.kind!=="string"&&k.type.kind!=="string"&&I.type.kind!=="value"&&k.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(!(D=w.parse(g[3],3,jn)))return null}return new m(I,k,D)},m.prototype.evaluate=function(g){var w=this.lhs.evaluate(g),C=this.rhs.evaluate(g);if(p&&this.hasUntypedArgument){var I=ji(w),k=ji(C);if(I.kind!==k.kind||I.kind!=="string"&&I.kind!=="number")throw new ua('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+I.kind+", "+k.kind+") instead.")}if(this.collator&&!p&&this.hasUntypedArgument){var D=ji(w),B=ji(C);if(D.kind!=="string"||B.kind!=="string")return a(g,w,C)}return this.collator?s(g,w,C,this.collator.evaluate(g)):a(g,w,C)},m.prototype.eachChild=function(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)},m.prototype.outputDefined=function(){return!0},m.prototype.serialize=function(){var g=[t];return this.eachChild(function(w){g.push(w.serialize())}),g},m}()}Oo.parse=function(t,a){if(t.length<=2||t.length>=5)return a.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1,Lr),p=a.parse(t[2],2,Dt);if(!s||!p)return null;if(!Li(s.type,[Pn(Lr),Dr,Lr]))return a.error("Expected first argument to be of type array or string, but found "+Vn(s.type)+" instead");if(t.length===4){var m=a.parse(t[3],3,Dt);return m?new Oo(s.type,s,p,m):null}return new Oo(s.type,s,p)},Oo.prototype.evaluate=function(t){var a=this.input.evaluate(t),s=this.beginIndex.evaluate(t);if(!Wn(a,["string","array"]))throw new ua("Expected first argument to be of type array or string, but found "+Vn(ji(a))+" instead.");if(this.endIndex){var p=this.endIndex.evaluate(t);return a.slice(s,p)}return a.slice(s)},Oo.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Oo.prototype.outputDefined=function(){return!1},Oo.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var dp=Di("==",function(t,a,s){return a===s},Yf),fc=Di("!=",function(t,a,s){return a!==s},function(t,a,s,p){return!Yf(0,a,s,p)}),qf=Di("<",function(t,a,s){return a<s},function(t,a,s,p){return p.compare(a,s)<0}),pf=Di(">",function(t,a,s){return a>s},function(t,a,s,p){return p.compare(a,s)>0}),hf=Di("<=",function(t,a,s){return a<=s},function(t,a,s,p){return p.compare(a,s)<=0}),ca=Di(">=",function(t,a,s){return a>=s},function(t,a,s,p){return p.compare(a,s)>=0}),bu=function(t,a,s,p,m){this.type=Dr,this.number=t,this.locale=a,this.currency=s,this.minFractionDigits=p,this.maxFractionDigits=m};bu.parse=function(t,a){if(t.length!==3)return a.error("Expected two arguments.");var s=a.parse(t[1],1,Dt);if(!s)return null;var p=t[2];if(typeof p!="object"||Array.isArray(p))return a.error("NumberFormat options argument must be an object.");var m=null;if(p.locale&&!(m=a.parse(p.locale,1,Dr)))return null;var g=null;if(p.currency&&!(g=a.parse(p.currency,1,Dr)))return null;var w=null;if(p["min-fraction-digits"]&&!(w=a.parse(p["min-fraction-digits"],1,Dt)))return null;var C=null;return p["max-fraction-digits"]&&!(C=a.parse(p["max-fraction-digits"],1,Dt))?null:new bu(s,m,g,w,C)},bu.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},bu.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},bu.prototype.outputDefined=function(){return!1},bu.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Zu=function(t){this.type=Dt,this.input=t};Zu.parse=function(t,a){if(t.length!==2)return a.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var s=a.parse(t[1],1);return s?s.type.kind!=="array"&&s.type.kind!=="string"&&s.type.kind!=="value"?a.error("Expected argument of type string or array, but found "+Vn(s.type)+" instead."):new Zu(s):null},Zu.prototype.evaluate=function(t){var a=this.input.evaluate(t);if(typeof a=="string"||Array.isArray(a))return a.length;throw new ua("Expected value to be of type string or array, but found "+Vn(ji(a))+" instead.")},Zu.prototype.eachChild=function(t){t(this.input)},Zu.prototype.outputDefined=function(){return!1},Zu.prototype.serialize=function(){var t=["length"];return this.eachChild(function(a){t.push(a.serialize())}),t};var ko={"==":dp,"!=":fc,">":pf,"<":qf,">=":ca,"<=":hf,array:bi,at:Ls,boolean:bi,case:xu,coalesce:zu,collator:va,format:bo,image:Xa,in:Io,"index-of":_u,interpolate:qi,"interpolate-hcl":qi,"interpolate-lab":qi,length:Zu,let:La,literal:Ea,match:Ko,number:bi,"number-format":bu,object:bi,slice:Oo,step:Po,string:bi,"to-boolean":Xo,"to-color":Xo,"to-number":Xo,"to-string":Xo,var:vu,within:is};function Bc(t,a){var s=a[0],p=a[1],m=a[2],g=a[3];s=s.evaluate(t),p=p.evaluate(t),m=m.evaluate(t);var w=g?g.evaluate(t):1,C=Bu(s,p,m,w);if(C)throw new ua(C);return new Jn(s/255*w,p/255*w,m/255*w,w)}function pc(t,a){return t in a}function wu(t,a){var s=a[t];return s===void 0?null:s}function Ks(t){return{type:t}}function hc(t){return{result:"success",value:t}}function Rs(t){return{result:"error",value:t}}function $s(t){return t["property-type"]==="data-driven"||t["property-type"]==="cross-faded-data-driven"}function df(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function cl(t){return!!t.expression&&t.expression.interpolated}function Ni(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}function Nc(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function Kf(t){return t}function zl(t,a,s){return t!==void 0?t:a!==void 0?a:s!==void 0?s:void 0}function $f(t,a,s,p,m){return zl(typeof s===m?p[s]:void 0,t.default,a.default)}function vf(t,a,s){if(Ni(s)!=="number")return zl(t.default,a.default);var p=t.stops.length;if(p===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[p-1][0])return t.stops[p-1][1];var m=Fl(t.stops.map(function(g){return g[0]}),s);return t.stops[m][1]}function fl(t,a,s){var p=t.base!==void 0?t.base:1;if(Ni(s)!=="number")return zl(t.default,a.default);var m=t.stops.length;if(m===1||s<=t.stops[0][0])return t.stops[0][1];if(s>=t.stops[m-1][0])return t.stops[m-1][1];var g=Fl(t.stops.map(function(B){return B[0]}),s),w=function(B,V,q,we){var Ce=we-q,ze=B-q;return Ce===0?0:V===1?ze/Ce:(Math.pow(V,ze)-1)/(Math.pow(V,Ce)-1)}(s,p,t.stops[g][0],t.stops[g+1][0]),C=t.stops[g][1],I=t.stops[g+1][1],k=Bl[a.type]||Kf;if(t.colorSpace&&t.colorSpace!=="rgb"){var D=Xf[t.colorSpace];k=function(B,V){return D.reverse(D.interpolate(D.forward(B),D.forward(V),w))}}return typeof C.evaluate=="function"?{evaluate:function(){for(var B=[],V=arguments.length;V--;)B[V]=arguments[V];var q=C.evaluate.apply(void 0,B),we=I.evaluate.apply(void 0,B);if(q!==void 0&&we!==void 0)return k(q,we,w)}}:k(C,I,w)}function Zl(t,a,s){return a.type==="color"?s=Jn.parse(s):a.type==="formatted"?s=Bi.fromString(s.toString()):a.type==="resolvedImage"?s=ea.fromString(s.toString()):Ni(s)===a.type||a.type==="enum"&&a.values[s]||(s=void 0),zl(s,t.default,a.default)}Ca.register(ko,{error:[{kind:"error"},[Dr],function(t,a){throw new ua(a[0].evaluate(t))}],typeof:[Dr,[Lr],function(t,a){return Vn(ji(a[0].evaluate(t)))}],"to-rgba":[Pn(Dt,4),[Mr],function(t,a){return a[0].evaluate(t).toArray()}],rgb:[Mr,[Dt,Dt,Dt],Bc],rgba:[Mr,[Dt,Dt,Dt,Dt],Bc],has:{type:Pr,overloads:[[[Dr],function(t,a){return pc(a[0].evaluate(t),t.properties())}],[[Dr,Nn],function(t,a){var s=a[1];return pc(a[0].evaluate(t),s.evaluate(t))}]]},get:{type:Lr,overloads:[[[Dr],function(t,a){return wu(a[0].evaluate(t),t.properties())}],[[Dr,Nn],function(t,a){var s=a[1];return wu(a[0].evaluate(t),s.evaluate(t))}]]},"feature-state":[Lr,[Dr],function(t,a){return wu(a[0].evaluate(t),t.featureState||{})}],properties:[Nn,[],function(t){return t.properties()}],"geometry-type":[Dr,[],function(t){return t.geometryType()}],id:[Lr,[],function(t){return t.id()}],zoom:[Dt,[],function(t){return t.globals.zoom}],"heatmap-density":[Dt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Dt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Lr,[],function(t){return t.globals.accumulated===void 0?null:t.globals.accumulated}],"+":[Dt,Ks(Dt),function(t,a){for(var s=0,p=0,m=a;p<m.length;p+=1)s+=m[p].evaluate(t);return s}],"*":[Dt,Ks(Dt),function(t,a){for(var s=1,p=0,m=a;p<m.length;p+=1)s*=m[p].evaluate(t);return s}],"-":{type:Dt,overloads:[[[Dt,Dt],function(t,a){var s=a[1];return a[0].evaluate(t)-s.evaluate(t)}],[[Dt],function(t,a){return-a[0].evaluate(t)}]]},"/":[Dt,[Dt,Dt],function(t,a){var s=a[1];return a[0].evaluate(t)/s.evaluate(t)}],"%":[Dt,[Dt,Dt],function(t,a){var s=a[1];return a[0].evaluate(t)%s.evaluate(t)}],ln2:[Dt,[],function(){return Math.LN2}],pi:[Dt,[],function(){return Math.PI}],e:[Dt,[],function(){return Math.E}],"^":[Dt,[Dt,Dt],function(t,a){var s=a[1];return Math.pow(a[0].evaluate(t),s.evaluate(t))}],sqrt:[Dt,[Dt],function(t,a){return Math.sqrt(a[0].evaluate(t))}],log10:[Dt,[Dt],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN10}],ln:[Dt,[Dt],function(t,a){return Math.log(a[0].evaluate(t))}],log2:[Dt,[Dt],function(t,a){return Math.log(a[0].evaluate(t))/Math.LN2}],sin:[Dt,[Dt],function(t,a){return Math.sin(a[0].evaluate(t))}],cos:[Dt,[Dt],function(t,a){return Math.cos(a[0].evaluate(t))}],tan:[Dt,[Dt],function(t,a){return Math.tan(a[0].evaluate(t))}],asin:[Dt,[Dt],function(t,a){return Math.asin(a[0].evaluate(t))}],acos:[Dt,[Dt],function(t,a){return Math.acos(a[0].evaluate(t))}],atan:[Dt,[Dt],function(t,a){return Math.atan(a[0].evaluate(t))}],min:[Dt,Ks(Dt),function(t,a){return Math.min.apply(Math,a.map(function(s){return s.evaluate(t)}))}],max:[Dt,Ks(Dt),function(t,a){return Math.max.apply(Math,a.map(function(s){return s.evaluate(t)}))}],abs:[Dt,[Dt],function(t,a){return Math.abs(a[0].evaluate(t))}],round:[Dt,[Dt],function(t,a){var s=a[0].evaluate(t);return s<0?-Math.round(-s):Math.round(s)}],floor:[Dt,[Dt],function(t,a){return Math.floor(a[0].evaluate(t))}],ceil:[Dt,[Dt],function(t,a){return Math.ceil(a[0].evaluate(t))}],"filter-==":[Pr,[Dr,Lr],function(t,a){var s=a[0],p=a[1];return t.properties()[s.value]===p.value}],"filter-id-==":[Pr,[Lr],function(t,a){var s=a[0];return t.id()===s.value}],"filter-type-==":[Pr,[Dr],function(t,a){var s=a[0];return t.geometryType()===s.value}],"filter-<":[Pr,[Dr,Lr],function(t,a){var s=a[0],p=a[1],m=t.properties()[s.value],g=p.value;return typeof m==typeof g&&m<g}],"filter-id-<":[Pr,[Lr],function(t,a){var s=a[0],p=t.id(),m=s.value;return typeof p==typeof m&&p<m}],"filter->":[Pr,[Dr,Lr],function(t,a){var s=a[0],p=a[1],m=t.properties()[s.value],g=p.value;return typeof m==typeof g&&m>g}],"filter-id->":[Pr,[Lr],function(t,a){var s=a[0],p=t.id(),m=s.value;return typeof p==typeof m&&p>m}],"filter-<=":[Pr,[Dr,Lr],function(t,a){var s=a[0],p=a[1],m=t.properties()[s.value],g=p.value;return typeof m==typeof g&&m<=g}],"filter-id-<=":[Pr,[Lr],function(t,a){var s=a[0],p=t.id(),m=s.value;return typeof p==typeof m&&p<=m}],"filter->=":[Pr,[Dr,Lr],function(t,a){var s=a[0],p=a[1],m=t.properties()[s.value],g=p.value;return typeof m==typeof g&&m>=g}],"filter-id->=":[Pr,[Lr],function(t,a){var s=a[0],p=t.id(),m=s.value;return typeof p==typeof m&&p>=m}],"filter-has":[Pr,[Lr],function(t,a){return a[0].value in t.properties()}],"filter-has-id":[Pr,[],function(t){return t.id()!==null&&t.id()!==void 0}],"filter-type-in":[Pr,[Pn(Dr)],function(t,a){return a[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Pr,[Pn(Lr)],function(t,a){return a[0].value.indexOf(t.id())>=0}],"filter-in-small":[Pr,[Dr,Pn(Lr)],function(t,a){var s=a[0];return a[1].value.indexOf(t.properties()[s.value])>=0}],"filter-in-large":[Pr,[Dr,Pn(Lr)],function(t,a){var s=a[0],p=a[1];return function(m,g,w,C){for(;w<=C;){var I=w+C>>1;if(g[I]===m)return!0;g[I]>m?C=I-1:w=I+1}return!1}(t.properties()[s.value],p.value,0,p.value.length-1)}],all:{type:Pr,overloads:[[[Pr,Pr],function(t,a){var s=a[1];return a[0].evaluate(t)&&s.evaluate(t)}],[Ks(Pr),function(t,a){for(var s=0,p=a;s<p.length;s+=1)if(!p[s].evaluate(t))return!1;return!0}]]},any:{type:Pr,overloads:[[[Pr,Pr],function(t,a){var s=a[1];return a[0].evaluate(t)||s.evaluate(t)}],[Ks(Pr),function(t,a){for(var s=0,p=a;s<p.length;s+=1)if(p[s].evaluate(t))return!0;return!1}]]},"!":[Pr,[Pr],function(t,a){return!a[0].evaluate(t)}],"is-supported-script":[Pr,[Dr],function(t,a){var s=t.globals&&t.globals.isSupportedScript;return!s||s(a[0].evaluate(t))}],upcase:[Dr,[Dr],function(t,a){return a[0].evaluate(t).toUpperCase()}],downcase:[Dr,[Dr],function(t,a){return a[0].evaluate(t).toLowerCase()}],concat:[Dr,Ks(Lr),function(t,a){return a.map(function(s){return Wa(s.evaluate(t))}).join("")}],"resolved-locale":[Dr,[jn],function(t,a){return a[0].evaluate(t).resolvedLocale()}]});var Uu=function(t,a){this.expression=t,this._warningHistory={},this._evaluator=new Yo,this._defaultValue=a?function(s){return s.type==="color"&&Nc(s.default)?new Jn(0,0,0,0):s.type==="color"?Jn.parse(s.default)||null:s.default===void 0?null:s.default}(a):null,this._enumValues=a&&a.type==="enum"?a.values:null};function Ds(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in ko}function pl(t,a){var s=new _s(ko,[],a?function(m){var g={color:Mr,string:Dr,number:Dt,enum:Dr,boolean:Pr,formatted:ui,resolvedImage:zn};return m.type==="array"?Pn(g[m.value]||Lr,m.length):g[m.type]}(a):void 0),p=s.parse(t,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?hc(new Uu(p,a)):Rs(s.errors)}Uu.prototype.evaluateWithoutErrorHandling=function(t,a,s,p,m,g){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=s,this._evaluator.canonical=p,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)},Uu.prototype.evaluate=function(t,a,s,p,m,g){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=s||null,this._evaluator.canonical=p,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=g||null;try{var w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new ua("Expected value to be one of "+Object.keys(this._enumValues).map(function(C){return JSON.stringify(C)}).join(", ")+", but found "+JSON.stringify(w)+" instead.");return w}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console!="undefined"&&console.warn(C.message)),this._defaultValue}};var hl=function(t,a){this.kind=t,this._styleExpression=a,this.isStateDependent=t!=="constant"&&!as(a.expression)};hl.prototype.evaluateWithoutErrorHandling=function(t,a,s,p,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,p,m,g)},hl.prototype.evaluate=function(t,a,s,p,m,g){return this._styleExpression.evaluate(t,a,s,p,m,g)};var Su=function(t,a,s,p){this.kind=t,this.zoomStops=s,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!as(a.expression),this.interpolationType=p};function dc(t,a){if((t=pl(t,a)).result==="error")return t;var s=t.value.expression,p=Nu(s);if(!p&&!$s(a))return Rs([new tr("","data expressions not supported")]);var m=ll(s,["zoom"]);if(!m&&!df(a))return Rs([new tr("","zoom expressions not supported")]);var g=function w(C){var I=null;if(C instanceof La)I=w(C.result);else if(C instanceof zu)for(var k=0,D=C.args;k<D.length&&!(I=w(D[k]));k+=1);else(C instanceof Po||C instanceof qi)&&C.input instanceof Ca&&C.input.name==="zoom"&&(I=C);return I instanceof tr||C.eachChild(function(B){var V=w(B);V instanceof tr?I=V:!I&&V?I=new tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):I&&V&&I!==V&&(I=new tr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),I}(s);return g||m?g instanceof tr?Rs([g]):g instanceof qi&&!cl(a)?Rs([new tr("",'"interpolate" expressions cannot be used with this property')]):hc(g?new Su(p?"camera":"composite",t.value,g.labels,g instanceof qi?g.interpolation:void 0):new hl(p?"constant":"source",t.value)):Rs([new tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Su.prototype.evaluateWithoutErrorHandling=function(t,a,s,p,m,g){return this._styleExpression.evaluateWithoutErrorHandling(t,a,s,p,m,g)},Su.prototype.evaluate=function(t,a,s,p,m,g){return this._styleExpression.evaluate(t,a,s,p,m,g)},Su.prototype.interpolationFactor=function(t,a,s){return this.interpolationType?qi.interpolationFactor(this.interpolationType,t,a,s):0};var dl=function(t,a){this._parameters=t,this._specification=a,$t(this,function s(p,m){var g,w,C,I=m.type==="color",k=p.stops&&typeof p.stops[0][0]=="object",D=k||!(k||p.property!==void 0),B=p.type||(cl(m)?"exponential":"interval");if(I&&((p=$t({},p)).stops&&(p.stops=p.stops.map(function(kr){return[kr[0],Jn.parse(kr[1])]})),p.default=Jn.parse(p.default?p.default:m.default)),p.colorSpace&&p.colorSpace!=="rgb"&&!Xf[p.colorSpace])throw new Error("Unknown color space: "+p.colorSpace);if(B==="exponential")g=fl;else if(B==="interval")g=vf;else if(B==="categorical"){g=$f,w=Object.create(null);for(var V=0,q=p.stops;V<q.length;V+=1){var we=q[V];w[we[0]]=we[1]}C=typeof p.stops[0][0]}else{if(B!=="identity")throw new Error('Unknown function type "'+B+'"');g=Zl}if(k){for(var Ce={},ze=[],Le=0;Le<p.stops.length;Le++){var qe=p.stops[Le],st=qe[0].zoom;Ce[st]===void 0&&(Ce[st]={zoom:st,type:p.type,property:p.property,default:p.default,stops:[]},ze.push(st)),Ce[st].stops.push([qe[0].value,qe[1]])}for(var St=[],xt=0,kt=ze;xt<kt.length;xt+=1){var or=kt[xt];St.push([Ce[or].zoom,s(Ce[or],m)])}var Nt={name:"linear"};return{kind:"composite",interpolationType:Nt,interpolationFactor:qi.interpolationFactor.bind(void 0,Nt),zoomStops:St.map(function(kr){return kr[0]}),evaluate:function(kr,cn){var Br=kr.zoom;return fl({stops:St,base:p.base},m,Br).evaluate(Br,cn)}}}if(D){var un=B==="exponential"?{name:"exponential",base:p.base!==void 0?p.base:1}:null;return{kind:"camera",interpolationType:un,interpolationFactor:qi.interpolationFactor.bind(void 0,un),zoomStops:p.stops.map(function(kr){return kr[0]}),evaluate:function(kr){return g(p,m,kr.zoom,w,C)}}}return{kind:"source",evaluate:function(kr,cn){var Br=cn&&cn.properties?cn.properties[p.property]:void 0;return Br===void 0?zl(p.default,m.default):g(p,m,Br,w,C)}}}(this._parameters,this._specification))};function xs(t){var a=t.key,s=t.value,p=t.valueSpec||{},m=t.objectElementValidators||{},g=t.style,w=t.styleSpec,C=[],I=Ni(s);if(I!=="object")return[new Ie(a,s,"object expected, "+I+" found")];for(var k in s){var D=k.split(".")[0],B=p[D]||p["*"],V=void 0;if(m[D])V=m[D];else if(p[D])V=ii;else if(m["*"])V=m["*"];else{if(!p["*"]){C.push(new Ie(a,s[k],'unknown property "'+k+'"'));continue}V=ii}C=C.concat(V({key:(a&&a+".")+k,value:s[k],valueSpec:B,style:g,styleSpec:w,object:s,objectKey:k},s))}for(var q in p)m[q]||p[q].required&&p[q].default===void 0&&s[q]===void 0&&C.push(new Ie(a,s,'missing required property "'+q+'"'));return C}function zc(t){var a=t.value,s=t.valueSpec,p=t.style,m=t.styleSpec,g=t.key,w=t.arrayElementValidator||ii;if(Ni(a)!=="array")return[new Ie(g,a,"array expected, "+Ni(a)+" found")];if(s.length&&a.length!==s.length)return[new Ie(g,a,"array length "+s.length+" expected, length "+a.length+" found")];if(s["min-length"]&&a.length<s["min-length"])return[new Ie(g,a,"array length at least "+s["min-length"]+" expected, length "+a.length+" found")];var C={type:s.value,values:s.values};m.$version<7&&(C.function=s.function),Ni(s.value)==="object"&&(C=s.value);for(var I=[],k=0;k<a.length;k++)I=I.concat(w({array:a,arrayIndex:k,value:a[k],valueSpec:C,style:p,styleSpec:m,key:g+"["+k+"]"}));return I}function mf(t){var a=t.key,s=t.value,p=t.valueSpec,m=Ni(s);return m==="number"&&s!=s&&(m="NaN"),m!=="number"?[new Ie(a,s,"number expected, "+m+" found")]:"minimum"in p&&s<p.minimum?[new Ie(a,s,s+" is less than the minimum value "+p.minimum)]:"maximum"in p&&s>p.maximum?[new Ie(a,s,s+" is greater than the maximum value "+p.maximum)]:[]}function Zc(t){var a,s,p,m=t.valueSpec,g=lr(t.value.type),w={},C=g!=="categorical"&&t.value.property===void 0,I=!C,k=Ni(t.value.stops)==="array"&&Ni(t.value.stops[0])==="array"&&Ni(t.value.stops[0][0])==="object",D=xs({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(q){if(g==="identity")return[new Ie(q.key,q.value,'identity function may not have a "stops" property')];var we=[],Ce=q.value;return we=we.concat(zc({key:q.key,value:Ce,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:B})),Ni(Ce)==="array"&&Ce.length===0&&we.push(new Ie(q.key,Ce,"array must have at least one stop")),we},default:function(q){return ii({key:q.key,value:q.value,valueSpec:m,style:q.style,styleSpec:q.styleSpec})}}});return g==="identity"&&C&&D.push(new Ie(t.key,t.value,'missing required property "property"')),g==="identity"||t.value.stops||D.push(new Ie(t.key,t.value,'missing required property "stops"')),g==="exponential"&&t.valueSpec.expression&&!cl(t.valueSpec)&&D.push(new Ie(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(I&&!$s(t.valueSpec)?D.push(new Ie(t.key,t.value,"property functions not supported")):C&&!df(t.valueSpec)&&D.push(new Ie(t.key,t.value,"zoom functions not supported"))),g!=="categorical"&&!k||t.value.property!==void 0||D.push(new Ie(t.key,t.value,'"property" property is required')),D;function B(q){var we=[],Ce=q.value,ze=q.key;if(Ni(Ce)!=="array")return[new Ie(ze,Ce,"array expected, "+Ni(Ce)+" found")];if(Ce.length!==2)return[new Ie(ze,Ce,"array length 2 expected, length "+Ce.length+" found")];if(k){if(Ni(Ce[0])!=="object")return[new Ie(ze,Ce,"object expected, "+Ni(Ce[0])+" found")];if(Ce[0].zoom===void 0)return[new Ie(ze,Ce,"object stop key must have zoom")];if(Ce[0].value===void 0)return[new Ie(ze,Ce,"object stop key must have value")];if(p&&p>lr(Ce[0].zoom))return[new Ie(ze,Ce[0].zoom,"stop zoom values must appear in ascending order")];lr(Ce[0].zoom)!==p&&(p=lr(Ce[0].zoom),s=void 0,w={}),we=we.concat(xs({key:ze+"[0]",value:Ce[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:mf,value:V}}))}else we=we.concat(V({key:ze+"[0]",value:Ce[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},Ce));return Ds(pt(Ce[1]))?we.concat([new Ie(ze+"[1]",Ce[1],"expressions are not allowed in function stops.")]):we.concat(ii({key:ze+"[1]",value:Ce[1],valueSpec:m,style:q.style,styleSpec:q.styleSpec}))}function V(q,we){var Ce=Ni(q.value),ze=lr(q.value),Le=q.value!==null?q.value:we;if(a){if(Ce!==a)return[new Ie(q.key,Le,Ce+" stop domain type must match previous stop domain type "+a)]}else a=Ce;if(Ce!=="number"&&Ce!=="string"&&Ce!=="boolean")return[new Ie(q.key,Le,"stop domain value must be a number, string, or boolean")];if(Ce!=="number"&&g!=="categorical"){var qe="number expected, "+Ce+" found";return $s(m)&&g===void 0&&(qe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ie(q.key,Le,qe)]}return g!=="categorical"||Ce!=="number"||isFinite(ze)&&Math.floor(ze)===ze?g!=="categorical"&&Ce==="number"&&s!==void 0&&ze<s?[new Ie(q.key,Le,"stop domain values must appear in ascending order")]:(s=ze,g==="categorical"&&ze in w?[new Ie(q.key,Le,"stop domain values must be unique")]:(w[ze]=!0,[])):[new Ie(q.key,Le,"integer expected, found "+ze)]}}function Eu(t){var a=(t.expressionContext==="property"?dc:pl)(pt(t.value),t.valueSpec);if(a.result==="error")return a.value.map(function(p){return new Ie(""+t.key+p.key,t.value,p.message)});var s=a.value.expression||a.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!s.outputDefined())return[new Ie(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!as(s))return[new Ie(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter"&&!as(s))return[new Ie(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!ll(s,["zoom","feature-state"]))return[new Ie(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Nu(s))return[new Ie(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ul(t){var a=t.key,s=t.value,p=t.valueSpec,m=[];return Array.isArray(p.values)?p.values.indexOf(lr(s))===-1&&m.push(new Ie(a,s,"expected one of ["+p.values.join(", ")+"], "+JSON.stringify(s)+" found")):Object.keys(p.values).indexOf(lr(s))===-1&&m.push(new Ie(a,s,"expected one of ["+Object.keys(p.values).join(", ")+"], "+JSON.stringify(s)+" found")),m}function jl(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var a=0,s=t.slice(1);a<s.length;a+=1){var p=s[a];if(!jl(p)&&typeof p!="boolean")return!1}return!0;default:return!0}}dl.deserialize=function(t){return new dl(t._parameters,t._specification)},dl.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var Cu={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Vl(t){if(t==null)return{filter:function(){return!0},needGeometry:!1};jl(t)||(t=Tu(t));var a=pl(t,Cu);if(a.result==="error")throw new Error(a.value.map(function(s){return s.key+": "+s.message}).join(", "));return{filter:function(s,p,m){return a.value.evaluate(s,p,{},m)},needGeometry:function s(p){if(!Array.isArray(p))return!1;if(p[0]==="within")return!0;for(var m=1;m<p.length;m++)if(s(p[m]))return!0;return!1}(t)}}function yf(t,a){return t<a?-1:t>a?1:0}function Tu(t){if(!t)return!0;var a,s=t[0];return t.length<=1?s!=="any":s==="=="?gf(t[1],t[2],"=="):s==="!="?vl(gf(t[1],t[2],"==")):s==="<"||s===">"||s==="<="||s===">="?gf(t[1],t[2],s):s==="any"?(a=t.slice(1),["any"].concat(a.map(Tu))):s==="all"?["all"].concat(t.slice(1).map(Tu)):s==="none"?["all"].concat(t.slice(1).map(Tu).map(vl)):s==="in"?Jf(t[1],t.slice(2)):s==="!in"?vl(Jf(t[1],t.slice(2))):s==="has"?_f(t[1]):s==="!has"?vl(_f(t[1])):s!=="within"||t}function gf(t,a,s){switch(t){case"$type":return["filter-type-"+s,a];case"$id":return["filter-id-"+s,a];default:return["filter-"+s,t,a]}}function Jf(t,a){if(a.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(function(s){return typeof s!=typeof a[0]})?["filter-in-large",t,["literal",a.sort(yf)]]:["filter-in-small",t,["literal",a]]}}function _f(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function vl(t){return["!",t]}function Uc(t){return jl(pt(t.value))?Eu($t({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function a(s){var p=s.value,m=s.key;if(Ni(p)!=="array")return[new Ie(m,p,"array expected, "+Ni(p)+" found")];var g,w=s.styleSpec,C=[];if(p.length<1)return[new Ie(m,p,"filter array must have at least 1 element")];switch(C=C.concat(Ul({key:m+"[0]",value:p[0],valueSpec:w.filter_operator,style:s.style,styleSpec:s.styleSpec})),lr(p[0])){case"<":case"<=":case">":case">=":p.length>=2&&lr(p[1])==="$type"&&C.push(new Ie(m,p,'"$type" cannot be use with operator "'+p[0]+'"'));case"==":case"!=":p.length!==3&&C.push(new Ie(m,p,'filter array for operator "'+p[0]+'" must have 3 elements'));case"in":case"!in":p.length>=2&&(g=Ni(p[1]))!=="string"&&C.push(new Ie(m+"[1]",p[1],"string expected, "+g+" found"));for(var I=2;I<p.length;I++)g=Ni(p[I]),lr(p[1])==="$type"?C=C.concat(Ul({key:m+"["+I+"]",value:p[I],valueSpec:w.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&C.push(new Ie(m+"["+I+"]",p[I],"string, number, or boolean expected, "+g+" found"));break;case"any":case"all":case"none":for(var k=1;k<p.length;k++)C=C.concat(a({key:m+"["+k+"]",value:p[k],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=Ni(p[1]),p.length!==2?C.push(new Ie(m,p,'filter array for "'+p[0]+'" operator must have 2 elements')):g!=="string"&&C.push(new Ie(m+"[1]",p[1],"string expected, "+g+" found"));break;case"within":g=Ni(p[1]),p.length!==2?C.push(new Ie(m,p,'filter array for "'+p[0]+'" operator must have 2 elements')):g!=="object"&&C.push(new Ie(m+"[1]",p[1],"object expected, "+g+" found"))}return C}(t)}function vc(t,a){var s=t.key,p=t.style,m=t.styleSpec,g=t.value,w=t.objectKey,C=m[a+"_"+t.layerType];if(!C)return[];var I=w.match(/^(.*)-transition$/);if(a==="paint"&&I&&C[I[1]]&&C[I[1]].transition)return ii({key:s,value:g,valueSpec:m.transition,style:p,styleSpec:m});var k,D=t.valueSpec||C[w];if(!D)return[new Ie(s,g,'unknown property "'+w+'"')];if(Ni(g)==="string"&&$s(D)&&!D.tokens&&(k=/^{([^}]+)}$/.exec(g)))return[new Ie(s,g,'"'+w+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(k[1])+" }`.")];var B=[];return t.layerType==="symbol"&&(w==="text-field"&&p&&!p.glyphs&&B.push(new Ie(s,g,'use of "text-field" requires a style "glyphs" property')),w==="text-font"&&Nc(pt(g))&&lr(g.type)==="identity"&&B.push(new Ie(s,g,'"text-font" does not support identity functions'))),B.concat(ii({key:t.key,value:g,valueSpec:D,style:p,styleSpec:m,expressionContext:"property",propertyType:a,propertyKey:w}))}function xf(t){return vc(t,"paint")}function ml(t){return vc(t,"layout")}function Qf(t){var a=[],s=t.value,p=t.key,m=t.style,g=t.styleSpec;s.type||s.ref||a.push(new Ie(p,s,'either "type" or "ref" is required'));var w,C=lr(s.type),I=lr(s.ref);if(s.id)for(var k=lr(s.id),D=0;D<t.arrayIndex;D++){var B=m.layers[D];lr(B.id)===k&&a.push(new Ie(p,s.id,'duplicate layer id "'+s.id+'", previously used at line '+B.id.__line__))}if("ref"in s)["type","source","source-layer","filter","layout"].forEach(function(we){we in s&&a.push(new Ie(p,s[we],'"'+we+'" is prohibited for ref layers'))}),m.layers.forEach(function(we){lr(we.id)===I&&(w=we)}),w?w.ref?a.push(new Ie(p,s.ref,"ref cannot reference another ref layer")):C=lr(w.type):a.push(new Ie(p,s.ref,'ref layer "'+I+'" not found'));else if(C!=="background")if(s.source){var V=m.sources&&m.sources[s.source],q=V&&lr(V.type);V?q==="vector"&&C==="raster"?a.push(new Ie(p,s.source,'layer "'+s.id+'" requires a raster source')):q==="raster"&&C!=="raster"?a.push(new Ie(p,s.source,'layer "'+s.id+'" requires a vector source')):q!=="vector"||s["source-layer"]?q==="raster-dem"&&C!=="hillshade"?a.push(new Ie(p,s.source,"raster-dem source can only be used with layer type 'hillshade'.")):C!=="line"||!s.paint||!s.paint["line-gradient"]||q==="geojson"&&V.lineMetrics||a.push(new Ie(p,s,'layer "'+s.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):a.push(new Ie(p,s,'layer "'+s.id+'" must specify a "source-layer"')):a.push(new Ie(p,s.source,'source "'+s.source+'" not found'))}else a.push(new Ie(p,s,'missing required property "source"'));return a=a.concat(xs({key:p,value:s,valueSpec:g.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ii({key:p+".type",value:s.type,valueSpec:g.layer.type,style:t.style,styleSpec:t.styleSpec,object:s,objectKey:"type"})},filter:Uc,layout:function(we){return xs({layer:s,key:we.key,value:we.value,style:we.style,styleSpec:we.styleSpec,objectElementValidators:{"*":function(Ce){return ml($t({layerType:C},Ce))}}})},paint:function(we){return xs({layer:s,key:we.key,value:we.value,style:we.style,styleSpec:we.styleSpec,objectElementValidators:{"*":function(Ce){return xf($t({layerType:C},Ce))}}})}}}))}function Tn(t){var a=t.value,s=t.key,p=Ni(a);return p!=="string"?[new Ie(s,a,"string expected, "+p+" found")]:[]}var Kr={promoteId:function(t){var a=t.key,s=t.value;if(Ni(s)==="string")return Tn({key:a,value:s});var p=[];for(var m in s)p.push.apply(p,Tn({key:a+"."+m,value:s[m]}));return p}};function Gl(t){var a=t.value,s=t.key,p=t.styleSpec,m=t.style;if(!a.type)return[new Ie(s,a,'"type" is required')];var g,w=lr(a.type);switch(w){case"vector":case"raster":case"raster-dem":return xs({key:s,value:a,valueSpec:p["source_"+w.replace("-","_")],style:t.style,styleSpec:p,objectElementValidators:Kr});case"geojson":if(g=xs({key:s,value:a,valueSpec:p.source_geojson,style:m,styleSpec:p,objectElementValidators:Kr}),a.cluster)for(var C in a.clusterProperties){var I=a.clusterProperties[C],k=I[0],D=typeof k=="string"?[k,["accumulated"],["get",C]]:k;g.push.apply(g,Eu({key:s+"."+C+".map",value:I[1],expressionContext:"cluster-map"})),g.push.apply(g,Eu({key:s+"."+C+".reduce",value:D,expressionContext:"cluster-reduce"}))}return g;case"video":return xs({key:s,value:a,valueSpec:p.source_video,style:m,styleSpec:p});case"image":return xs({key:s,value:a,valueSpec:p.source_image,style:m,styleSpec:p});case"canvas":return[new Ie(s,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ul({key:s+".type",value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:m,styleSpec:p})}}function ju(t){var a=t.value,s=t.styleSpec,p=s.light,m=t.style,g=[],w=Ni(a);if(a===void 0)return g;if(w!=="object")return g.concat([new Ie("light",a,"object expected, "+w+" found")]);for(var C in a){var I=C.match(/^(.*)-transition$/);g=g.concat(I&&p[I[1]]&&p[I[1]].transition?ii({key:C,value:a[C],valueSpec:s.transition,style:m,styleSpec:s}):p[C]?ii({key:C,value:a[C],valueSpec:p[C],style:m,styleSpec:s}):[new Ie(C,a[C],'unknown property "'+C+'"')])}return g}var Vu={"*":function(){return[]},array:zc,boolean:function(t){var a=t.value,s=t.key,p=Ni(a);return p!=="boolean"?[new Ie(s,a,"boolean expected, "+p+" found")]:[]},number:mf,color:function(t){var a=t.key,s=t.value,p=Ni(s);return p!=="string"?[new Ie(a,s,"color expected, "+p+" found")]:Zn(s)===null?[new Ie(a,s,'color expected, "'+s+'" found')]:[]},constants:nt,enum:Ul,filter:Uc,function:Zc,layer:Qf,object:xs,source:Gl,light:ju,string:Tn,formatted:function(t){return Tn(t).length===0?[]:Eu(t)},resolvedImage:function(t){return Tn(t).length===0?[]:Eu(t)}};function ii(t){var a=t.value,s=t.valueSpec,p=t.styleSpec;return s.expression&&Nc(lr(a))?Zc(t):s.expression&&Ds(pt(a))?Eu(t):s.type&&Vu[s.type]?Vu[s.type](t):xs($t({},t,{valueSpec:s.type?p[s.type]:s}))}function Vi(t){var a=t.value,s=t.key,p=Tn(t);return p.length||(a.indexOf("{fontstack}")===-1&&p.push(new Ie(s,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&p.push(new Ie(s,a,'"glyphs" url must include a "{range}" token'))),p}function bs(t,a){a===void 0&&(a=te);var s=[];return s=s.concat(ii({key:"",value:t,valueSpec:a.$root,styleSpec:a,style:t,objectElementValidators:{glyphs:Vi,"*":function(){return[]}}})),t.constants&&(s=s.concat(nt({key:"constants",value:t.constants,style:t,styleSpec:a}))),jc(s)}function jc(t){return[].concat(t).sort(function(a,s){return a.line-s.line})}function mc(t){return function(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];return jc(t.apply(this,a))}}bs.source=mc(Gl),bs.light=mc(ju),bs.layer=mc(Qf),bs.filter=mc(Uc),bs.paintProperty=mc(xf),bs.layoutProperty=mc(ml);var Vc=bs,rh=Vc.light,nh=Vc.paintProperty,yc=Vc.layoutProperty;function Gu(t,a){var s=!1;if(a&&a.length)for(var p=0,m=a;p<m.length;p+=1)t.fire(new Ze(new Error(m[p].message))),s=!0;return s}var Hu=fa;function fa(t,a,s){var p=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var m=new Int32Array(this.arrayBuffer);t=m[0],this.d=(a=m[1])+2*(s=m[2]);for(var g=0;g<this.d*this.d;g++){var w=m[3+g],C=m[3+g+1];p.push(w===C?null:m.subarray(w,C))}var I=m[3+p.length+1];this.keys=m.subarray(m[3+p.length],I),this.bboxes=m.subarray(I),this.insert=this._insertReadonly}else{this.d=a+2*s;for(var k=0;k<this.d*this.d;k++)p.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=t,this.padding=s,this.scale=a/t,this.uid=0;var D=s/a*t;this.min=-D,this.max=t+D}fa.prototype.insert=function(t,a,s,p,m){this._forEachCell(a,s,p,m,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(a),this.bboxes.push(s),this.bboxes.push(p),this.bboxes.push(m)},fa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},fa.prototype._insertCell=function(t,a,s,p,m,g){this.cells[m].push(g)},fa.prototype.query=function(t,a,s,p,m){var g=this.min,w=this.max;if(t<=g&&a<=g&&w<=s&&w<=p&&!m)return Array.prototype.slice.call(this.keys);var C=[];return this._forEachCell(t,a,s,p,this._queryCell,C,{},m),C},fa.prototype._queryCell=function(t,a,s,p,m,g,w,C){var I=this.cells[m];if(I!==null)for(var k=this.keys,D=this.bboxes,B=0;B<I.length;B++){var V=I[B];if(w[V]===void 0){var q=4*V;(C?C(D[q+0],D[q+1],D[q+2],D[q+3]):t<=D[q+2]&&a<=D[q+3]&&s>=D[q+0]&&p>=D[q+1])?(w[V]=!0,g.push(k[V])):w[V]=!1}}},fa.prototype._forEachCell=function(t,a,s,p,m,g,w,C){for(var I=this._convertToCellCoord(t),k=this._convertToCellCoord(a),D=this._convertToCellCoord(s),B=this._convertToCellCoord(p),V=I;V<=D;V++)for(var q=k;q<=B;q++){var we=this.d*q+V;if((!C||C(this._convertFromCellCoord(V),this._convertFromCellCoord(q),this._convertFromCellCoord(V+1),this._convertFromCellCoord(q+1)))&&m.call(this,t,a,s,p,we,g,w,C))return}},fa.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},fa.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},fa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,a=3+this.cells.length+1+1,s=0,p=0;p<this.cells.length;p++)s+=this.cells[p].length;var m=new Int32Array(a+s+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var g=a,w=0;w<t.length;w++){var C=t[w];m[3+w]=g,m.set(C,g),g+=C.length}return m[3+t.length]=g,m.set(this.keys,g),m[3+t.length+1]=g+=this.keys.length,m.set(this.bboxes,g),g+=this.bboxes.length,m.buffer};var Fo=fe.ImageData,Hl=fe.ImageBitmap,Aa={};function Gr(t,a,s){s===void 0&&(s={}),Object.defineProperty(a,"_classRegistryKey",{value:t,writeable:!1}),Aa[t]={klass:a,omit:s.omit||[],shallow:s.shallow||[]}}for(var os in Gr("Object",Object),Hu.serialize=function(t,a){var s=t.toArrayBuffer();return a&&a.push(s),{buffer:s}},Hu.deserialize=function(t){return new Hu(t.buffer)},Gr("Grid",Hu),Gr("Color",Jn),Gr("Error",Error),Gr("ResolvedImage",ea),Gr("StylePropertyFunction",dl),Gr("StyleExpression",Uu,{omit:["_evaluator"]}),Gr("ZoomDependentExpression",Su),Gr("ZoomConstantExpression",hl),Gr("CompoundExpression",Ca,{omit:["_evaluate"]}),ko)ko[os]._classRegistryKey||Gr("Expression_"+os,ko[os]);function Gc(t){return t&&typeof ArrayBuffer!="undefined"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function Wl(t){return Hl&&t instanceof Hl}function Fs(t,a){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Gc(t)||Wl(t))return a&&a.push(t),t;if(ArrayBuffer.isView(t)){var s=t;return a&&a.push(s.buffer),s}if(t instanceof Fo)return a&&a.push(t.data.buffer),t;if(Array.isArray(t)){for(var p=[],m=0,g=t;m<g.length;m+=1)p.push(Fs(g[m],a));return p}if(typeof t=="object"){var w=t.constructor,C=w._classRegistryKey;if(!C)throw new Error("can't serialize object of unregistered class");var I=w.serialize?w.serialize(t,a):{};if(!w.serialize){for(var k in t)if(t.hasOwnProperty(k)&&!(Aa[C].omit.indexOf(k)>=0)){var D=t[k];I[k]=Aa[C].shallow.indexOf(k)>=0?D:Fs(D,a)}t instanceof Error&&(I.message=t.message)}if(I.$name)throw new Error("$name property is reserved for worker serialization logic.");return C!=="Object"&&(I.$name=C),I}throw new Error("can't serialize object of type "+typeof t)}function ss(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Gc(t)||Wl(t)||ArrayBuffer.isView(t)||t instanceof Fo)return t;if(Array.isArray(t))return t.map(ss);if(typeof t=="object"){var a=t.$name||"Object",s=Aa[a].klass;if(!s)throw new Error("can't deserialize unregistered class "+a);if(s.deserialize)return s.deserialize(t);for(var p=Object.create(s.prototype),m=0,g=Object.keys(t);m<g.length;m+=1){var w=g[m];if(w!=="$name"){var C=t[w];p[w]=Aa[a].shallow.indexOf(w)>=0?C:ss(C)}}return p}throw new Error("can't deserialize object of type "+typeof t)}var yl=function(){this.first=!0};yl.prototype.update=function(t,a){var s=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=s,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=s,!0):(this.lastFloorZoom>s?(this.lastIntegerZoom=s+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<s&&(this.lastIntegerZoom=s,this.lastIntegerZoomTime=a),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=s,!0))};var dr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function bf(t){for(var a=0,s=t;a<s.length;a+=1)if(gl(s[a].charCodeAt(0)))return!0;return!1}function gl(t){return!(t!==746&&t!==747&&(t<4352||!(dr["Bopomofo Extended"](t)||dr.Bopomofo(t)||dr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||dr["CJK Compatibility Ideographs"](t)||dr["CJK Compatibility"](t)||dr["CJK Radicals Supplement"](t)||dr["CJK Strokes"](t)||!(!dr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||dr["CJK Unified Ideographs Extension A"](t)||dr["CJK Unified Ideographs"](t)||dr["Enclosed CJK Letters and Months"](t)||dr["Hangul Compatibility Jamo"](t)||dr["Hangul Jamo Extended-A"](t)||dr["Hangul Jamo Extended-B"](t)||dr["Hangul Jamo"](t)||dr["Hangul Syllables"](t)||dr.Hiragana(t)||dr["Ideographic Description Characters"](t)||dr.Kanbun(t)||dr["Kangxi Radicals"](t)||dr["Katakana Phonetic Extensions"](t)||dr.Katakana(t)&&t!==12540||!(!dr["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!dr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||dr["Unified Canadian Aboriginal Syllabics"](t)||dr["Unified Canadian Aboriginal Syllabics Extended"](t)||dr["Vertical Forms"](t)||dr["Yijing Hexagram Symbols"](t)||dr["Yi Syllables"](t)||dr["Yi Radicals"](t))))}function Wu(t){return!(gl(t)||function(a){return!!(dr["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||dr["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||dr["Letterlike Symbols"](a)||dr["Number Forms"](a)||dr["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||dr["Control Pictures"](a)&&a!==9251||dr["Optical Character Recognition"](a)||dr["Enclosed Alphanumerics"](a)||dr["Geometric Shapes"](a)||dr["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||dr["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||dr["CJK Symbols and Punctuation"](a)||dr.Katakana(a)||dr["Private Use Area"](a)||dr["CJK Compatibility Forms"](a)||dr["Small Form Variants"](a)||dr["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(t))}function ws(t){return t>=1424&&t<=2303||dr["Arabic Presentation Forms-A"](t)||dr["Arabic Presentation Forms-B"](t)}function $o(t,a){return!(!a&&ws(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||dr.Khmer(t))}function wf(t){for(var a=0,s=t;a<s.length;a+=1)if(ws(s[a].charCodeAt(0)))return!0;return!1}var Sf=null,us="unavailable",Xu=null,Ef=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(us="error"),Sf&&Sf(t)};function gc(){ep.fire(new Te("pluginStateChange",{pluginStatus:us,pluginURL:Xu}))}var ep=new We,Cf=function(){return us},Js=function(){if(us!=="deferred"||!Xu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");us="loading",gc(),Xu&&ks({url:Xu},function(t){t?Ef(t):(us="loaded",gc())})},Ss={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return us==="loaded"||Ss.applyArabicShaping!=null},isLoading:function(){return us==="loading"},setState:function(t){us=t.pluginStatus,Xu=t.pluginURL},isParsed:function(){return Ss.applyArabicShaping!=null&&Ss.processBidirectionalText!=null&&Ss.processStyledBidirectionalText!=null},getPluginURL:function(){return Xu}},Xn=function(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new yl,this.transition={})};Xn.prototype.isSupportedScript=function(t){return function(a,s){for(var p=0,m=a;p<m.length;p+=1)if(!$o(m[p].charCodeAt(0),s))return!1;return!0}(t,Ss.isLoaded())},Xn.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Xn.prototype.getCrossfadeParameters=function(){var t=this.zoom,a=t-Math.floor(t),s=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*s}:{fromScale:.5,toScale:1,t:1-(1-s)*a}};var Qs=function(t,a){this.property=t,this.value=a,this.expression=function(s,p){if(Nc(s))return new dl(s,p);if(Ds(s)){var m=dc(s,p);if(m.result==="error")throw new Error(m.value.map(function(w){return w.key+": "+w.message}).join(", "));return m.value}var g=s;return typeof s=="string"&&p.type==="color"&&(g=Jn.parse(s)),{kind:"constant",evaluate:function(){return g}}}(a===void 0?t.specification.default:a,t.specification)};Qs.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Qs.prototype.possiblyEvaluate=function(t,a,s){return this.property.possiblyEvaluate(this,t,a,s)};var to=function(t){this.property=t,this.value=new Qs(t,void 0)};to.prototype.transitioned=function(t,a){return new Bo(this.property,this.value,a,Ht({},t.transition,this.transition),t.now)},to.prototype.untransitioned=function(){return new Bo(this.property,this.value,null,{},0)};var Ma=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};Ma.prototype.getValue=function(t){return He(this._values[t].value.value)},Ma.prototype.setValue=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new to(this._values[t].property)),this._values[t].value=new Qs(this._values[t].property,a===null?void 0:He(a))},Ma.prototype.getTransition=function(t){return He(this._values[t].transition)},Ma.prototype.setTransition=function(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new to(this._values[t].property)),this._values[t].transition=He(a)||void 0},Ma.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var p=s[a],m=this.getValue(p);m!==void 0&&(t[p]=m);var g=this.getTransition(p);g!==void 0&&(t[p+"-transition"]=g)}return t},Ma.prototype.transitioned=function(t,a){for(var s=new No(this._properties),p=0,m=Object.keys(this._values);p<m.length;p+=1){var g=m[p];s._values[g]=this._values[g].transitioned(t,a._values[g])}return s},Ma.prototype.untransitioned=function(){for(var t=new No(this._properties),a=0,s=Object.keys(this._values);a<s.length;a+=1){var p=s[a];t._values[p]=this._values[p].untransitioned()}return t};var Bo=function(t,a,s,p,m){this.property=t,this.value=a,this.begin=m+p.delay||0,this.end=this.begin+p.duration||0,t.specification.transition&&(p.delay||p.duration)&&(this.prior=s)};Bo.prototype.possiblyEvaluate=function(t,a,s){var p=t.now||0,m=this.value.possiblyEvaluate(t,a,s),g=this.prior;if(g){if(p>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(p<this.begin)return g.possiblyEvaluate(t,a,s);var w=(p-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(t,a,s),m,function(C){if(C<=0)return 0;if(C>=1)return 1;var I=C*C,k=I*C;return 4*(C<.5?k:3*(C-I)+k-.75)}(w))}return m};var No=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};No.prototype.possiblyEvaluate=function(t,a,s){for(var p=new _l(this._properties),m=0,g=Object.keys(this._values);m<g.length;m+=1){var w=g[m];p._values[w]=this._values[w].possiblyEvaluate(t,a,s)}return p},No.prototype.hasTransition=function(){for(var t=0,a=Object.keys(this._values);t<a.length;t+=1)if(this._values[a[t]].prior)return!0;return!1};var ls=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};ls.prototype.getValue=function(t){return He(this._values[t].value)},ls.prototype.setValue=function(t,a){this._values[t]=new Qs(this._values[t].property,a===null?void 0:He(a))},ls.prototype.serialize=function(){for(var t={},a=0,s=Object.keys(this._values);a<s.length;a+=1){var p=s[a],m=this.getValue(p);m!==void 0&&(t[p]=m)}return t},ls.prototype.possiblyEvaluate=function(t,a,s){for(var p=new _l(this._properties),m=0,g=Object.keys(this._values);m<g.length;m+=1){var w=g[m];p._values[w]=this._values[w].possiblyEvaluate(t,a,s)}return p};var lo=function(t,a,s){this.property=t,this.value=a,this.parameters=s};lo.prototype.isConstant=function(){return this.value.kind==="constant"},lo.prototype.constantOr=function(t){return this.value.kind==="constant"?this.value.value:t},lo.prototype.evaluate=function(t,a,s,p){return this.property.evaluate(this.value,this.parameters,t,a,s,p)};var _l=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};_l.prototype.get=function(t){return this._values[t]};var nn=function(t){this.specification=t};nn.prototype.possiblyEvaluate=function(t,a){return t.expression.evaluate(a)},nn.prototype.interpolate=function(t,a,s){var p=Bl[this.specification.type];return p?p(t,a,s):t};var Wr=function(t,a){this.specification=t,this.overrides=a};Wr.prototype.possiblyEvaluate=function(t,a,s,p){return new lo(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(a,null,{},s,p)}:t.expression,a)},Wr.prototype.interpolate=function(t,a,s){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new lo(this,{kind:"constant",value:void 0},t.parameters);var p=Bl[this.specification.type];return p?new lo(this,{kind:"constant",value:p(t.value.value,a.value.value,s)},t.parameters):t},Wr.prototype.evaluate=function(t,a,s,p,m,g){return t.kind==="constant"?t.value:t.evaluate(a,s,p,m,g)};var _c=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,p,m,g){if(s.value===void 0)return new lo(this,{kind:"constant",value:void 0},p);if(s.expression.kind==="constant"){var w=s.expression.evaluate(p,null,{},m,g),C=s.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,I=this._calculate(C,C,C,p);return new lo(this,{kind:"constant",value:I},p)}if(s.expression.kind==="camera"){var k=this._calculate(s.expression.evaluate({zoom:p.zoom-1}),s.expression.evaluate({zoom:p.zoom}),s.expression.evaluate({zoom:p.zoom+1}),p);return new lo(this,{kind:"constant",value:k},p)}return new lo(this,s.expression,p)},a.prototype.evaluate=function(s,p,m,g,w,C){if(s.kind==="source"){var I=s.evaluate(p,m,g,w,C);return this._calculate(I,I,I,p)}return s.kind==="composite"?this._calculate(s.evaluate({zoom:Math.floor(p.zoom)-1},m,g),s.evaluate({zoom:Math.floor(p.zoom)},m,g),s.evaluate({zoom:Math.floor(p.zoom)+1},m,g),p):s.value},a.prototype._calculate=function(s,p,m,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:s,to:p}:{from:m,to:p}},a.prototype.interpolate=function(s){return s},a}(Wr),wo=function(t){this.specification=t};wo.prototype.possiblyEvaluate=function(t,a,s,p){if(t.value!==void 0){if(t.expression.kind==="constant"){var m=t.expression.evaluate(a,null,{},s,p);return this._calculate(m,m,m,a)}return this._calculate(t.expression.evaluate(new Xn(Math.floor(a.zoom-1),a)),t.expression.evaluate(new Xn(Math.floor(a.zoom),a)),t.expression.evaluate(new Xn(Math.floor(a.zoom+1),a)),a)}},wo.prototype._calculate=function(t,a,s,p){return p.zoom>p.zoomHistory.lastIntegerZoom?{from:t,to:a}:{from:s,to:a}},wo.prototype.interpolate=function(t){return t};var Ra=function(t){this.specification=t};Ra.prototype.possiblyEvaluate=function(t,a,s,p){return!!t.expression.evaluate(a,null,{},s,p)},Ra.prototype.interpolate=function(){return!1};var ya=function(t){for(var a in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var s=t[a];s.specification.overridable&&this.overridableProperties.push(a);var p=this.defaultPropertyValues[a]=new Qs(s,void 0),m=this.defaultTransitionablePropertyValues[a]=new to(s);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=p.possiblyEvaluate({})}};Gr("DataDrivenProperty",Wr),Gr("DataConstantProperty",nn),Gr("CrossFadedDataDrivenProperty",_c),Gr("CrossFadedProperty",wo),Gr("ColorRampProperty",Ra);var ta=function(t){function a(s,p){if(t.call(this),this.id=s.id,this.type=s.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},s.type!=="custom"&&(this.metadata=(s=s).metadata,this.minzoom=s.minzoom,this.maxzoom=s.maxzoom,s.type!=="background"&&(this.source=s.source,this.sourceLayer=s["source-layer"],this.filter=s.filter),p.layout&&(this._unevaluatedLayout=new ls(p.layout)),p.paint)){for(var m in this._transitionablePaint=new Ma(p.paint),s.paint)this.setPaintProperty(m,s.paint[m],{validate:!1});for(var g in s.layout)this.setLayoutProperty(g,s.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _l(p.paint)}}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},a.prototype.getLayoutProperty=function(s){return s==="visibility"?this.visibility:this._unevaluatedLayout.getValue(s)},a.prototype.setLayoutProperty=function(s,p,m){m===void 0&&(m={}),p!=null&&this._validate(yc,"layers."+this.id+".layout."+s,s,p,m)||(s!=="visibility"?this._unevaluatedLayout.setValue(s,p):this.visibility=p)},a.prototype.getPaintProperty=function(s){return cr(s,"-transition")?this._transitionablePaint.getTransition(s.slice(0,-"-transition".length)):this._transitionablePaint.getValue(s)},a.prototype.setPaintProperty=function(s,p,m){if(m===void 0&&(m={}),p!=null&&this._validate(nh,"layers."+this.id+".paint."+s,s,p,m))return!1;if(cr(s,"-transition"))return this._transitionablePaint.setTransition(s.slice(0,-"-transition".length),p||void 0),!1;var g=this._transitionablePaint._values[s],w=g.property.specification["property-type"]==="cross-faded-data-driven",C=g.value.isDataDriven(),I=g.value;this._transitionablePaint.setValue(s,p),this._handleSpecialPaintPropertyUpdate(s);var k=this._transitionablePaint._values[s].value;return k.isDataDriven()||C||w||this._handleOverridablePaintPropertyUpdate(s,I,k)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){},a.prototype._handleOverridablePaintPropertyUpdate=function(s,p,m){return!1},a.prototype.isHidden=function(s){return!!(this.minzoom&&s<this.minzoom)||!!(this.maxzoom&&s>=this.maxzoom)||this.visibility==="none"},a.prototype.updateTransitions=function(s){this._transitioningPaint=this._transitionablePaint.transitioned(s,this._transitioningPaint)},a.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},a.prototype.recalculate=function(s,p){s.getCrossfadeParameters&&(this._crossfadeParameters=s.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(s,void 0,p)),this.paint=this._transitioningPaint.possiblyEvaluate(s,void 0,p)},a.prototype.serialize=function(){var s={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(s.layout=s.layout||{},s.layout.visibility=this.visibility),ot(s,function(p,m){return!(p===void 0||m==="layout"&&!Object.keys(p).length||m==="paint"&&!Object.keys(p).length)})},a.prototype._validate=function(s,p,m,g,w){return w===void 0&&(w={}),(!w||w.validate!==!1)&&Gu(this,s.call(Vc,{key:p,layerType:this.type,objectKey:m,value:g,styleSpec:te,style:{glyphs:!0,sprite:!0}}))},a.prototype.is3D=function(){return!1},a.prototype.isTileClipped=function(){return!1},a.prototype.hasOffscreenPass=function(){return!1},a.prototype.resize=function(){},a.prototype.isStateDependent=function(){for(var s in this.paint._values){var p=this.paint.get(s);if(p instanceof lo&&$s(p.property.specification)&&(p.value.kind==="source"||p.value.kind==="composite")&&p.value.isStateDependent)return!0}return!1},a}(We),Es={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},xl=function(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},fi=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function pa(t,a){a===void 0&&(a=1);var s=0,p=0;return{members:t.map(function(m){var g=Es[m.type].BYTES_PER_ELEMENT,w=s=Hc(s,Math.max(a,g)),C=m.components||1;return p=Math.max(p,g),s+=g*C,{name:m.name,type:m.type,components:C,offset:w}}),size:Hc(s,Math.max(p,a)),alignment:a}}function Hc(t,a){return Math.ceil(t/a)*a}fi.serialize=function(t,a){return t._trim(),a&&(t.isTransferred=!0,a.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},fi.deserialize=function(t){var a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a},fi.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},fi.prototype.clear=function(){this.length=0},fi.prototype.resize=function(t){this.reserve(t),this.length=t},fi.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}},fi.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Yu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p){var m=this.length;return this.resize(m+1),this.emplace(m,s,p)},a.prototype.emplace=function(s,p,m){var g=2*s;return this.int16[g+0]=p,this.int16[g+1]=m,s},a}(fi);Yu.prototype.bytesPerElement=4,Gr("StructArrayLayout2i4",Yu);var Wc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g){var w=this.length;return this.resize(w+1),this.emplace(w,s,p,m,g)},a.prototype.emplace=function(s,p,m,g,w){var C=4*s;return this.int16[C+0]=p,this.int16[C+1]=m,this.int16[C+2]=g,this.int16[C+3]=w,s},a}(fi);Wc.prototype.bytesPerElement=8,Gr("StructArrayLayout4i8",Wc);var eu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C){var I=this.length;return this.resize(I+1),this.emplace(I,s,p,m,g,w,C)},a.prototype.emplace=function(s,p,m,g,w,C,I){var k=6*s;return this.int16[k+0]=p,this.int16[k+1]=m,this.int16[k+2]=g,this.int16[k+3]=w,this.int16[k+4]=C,this.int16[k+5]=I,s},a}(fi);eu.prototype.bytesPerElement=12,Gr("StructArrayLayout2i4i12",eu);var zo=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C){var I=this.length;return this.resize(I+1),this.emplace(I,s,p,m,g,w,C)},a.prototype.emplace=function(s,p,m,g,w,C,I){var k=4*s,D=8*s;return this.int16[k+0]=p,this.int16[k+1]=m,this.uint8[D+4]=g,this.uint8[D+5]=w,this.uint8[D+6]=C,this.uint8[D+7]=I,s},a}(fi);zo.prototype.bytesPerElement=8,Gr("StructArrayLayout2i4ub8",zo);var Zo=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p){var m=this.length;return this.resize(m+1),this.emplace(m,s,p)},a.prototype.emplace=function(s,p,m){var g=2*s;return this.float32[g+0]=p,this.float32[g+1]=m,s},a}(fi);Zo.prototype.bytesPerElement=8,Gr("StructArrayLayout2f8",Zo);var tu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C,I,k,D,B){var V=this.length;return this.resize(V+1),this.emplace(V,s,p,m,g,w,C,I,k,D,B)},a.prototype.emplace=function(s,p,m,g,w,C,I,k,D,B,V){var q=10*s;return this.uint16[q+0]=p,this.uint16[q+1]=m,this.uint16[q+2]=g,this.uint16[q+3]=w,this.uint16[q+4]=C,this.uint16[q+5]=I,this.uint16[q+6]=k,this.uint16[q+7]=D,this.uint16[q+8]=B,this.uint16[q+9]=V,s},a}(fi);tu.prototype.bytesPerElement=20,Gr("StructArrayLayout10ui20",tu);var ga=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C,I,k,D,B,V,q){var we=this.length;return this.resize(we+1),this.emplace(we,s,p,m,g,w,C,I,k,D,B,V,q)},a.prototype.emplace=function(s,p,m,g,w,C,I,k,D,B,V,q,we){var Ce=12*s;return this.int16[Ce+0]=p,this.int16[Ce+1]=m,this.int16[Ce+2]=g,this.int16[Ce+3]=w,this.uint16[Ce+4]=C,this.uint16[Ce+5]=I,this.uint16[Ce+6]=k,this.uint16[Ce+7]=D,this.int16[Ce+8]=B,this.int16[Ce+9]=V,this.int16[Ce+10]=q,this.int16[Ce+11]=we,s},a}(fi);ga.prototype.bytesPerElement=24,Gr("StructArrayLayout4i4ui4i24",ga);var re=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m){var g=this.length;return this.resize(g+1),this.emplace(g,s,p,m)},a.prototype.emplace=function(s,p,m,g){var w=3*s;return this.float32[w+0]=p,this.float32[w+1]=m,this.float32[w+2]=g,s},a}(fi);re.prototype.bytesPerElement=12,Gr("StructArrayLayout3f12",re);var Xl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var p=this.length;return this.resize(p+1),this.emplace(p,s)},a.prototype.emplace=function(s,p){return this.uint32[1*s+0]=p,s},a}(fi);Xl.prototype.bytesPerElement=4,Gr("StructArrayLayout1ul4",Xl);var Xc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C,I,k,D){var B=this.length;return this.resize(B+1),this.emplace(B,s,p,m,g,w,C,I,k,D)},a.prototype.emplace=function(s,p,m,g,w,C,I,k,D,B){var V=10*s,q=5*s;return this.int16[V+0]=p,this.int16[V+1]=m,this.int16[V+2]=g,this.int16[V+3]=w,this.int16[V+4]=C,this.int16[V+5]=I,this.uint32[q+3]=k,this.uint16[V+8]=D,this.uint16[V+9]=B,s},a}(fi);Xc.prototype.bytesPerElement=20,Gr("StructArrayLayout6i1ul2ui20",Xc);var bl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C){var I=this.length;return this.resize(I+1),this.emplace(I,s,p,m,g,w,C)},a.prototype.emplace=function(s,p,m,g,w,C,I){var k=6*s;return this.int16[k+0]=p,this.int16[k+1]=m,this.int16[k+2]=g,this.int16[k+3]=w,this.int16[k+4]=C,this.int16[k+5]=I,s},a}(fi);bl.prototype.bytesPerElement=12,Gr("StructArrayLayout2i2i2i12",bl);var Au=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w){var C=this.length;return this.resize(C+1),this.emplace(C,s,p,m,g,w)},a.prototype.emplace=function(s,p,m,g,w,C){var I=4*s,k=8*s;return this.float32[I+0]=p,this.float32[I+1]=m,this.float32[I+2]=g,this.int16[k+6]=w,this.int16[k+7]=C,s},a}(fi);Au.prototype.bytesPerElement=16,Gr("StructArrayLayout2f1f2i16",Au);var xc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g){var w=this.length;return this.resize(w+1),this.emplace(w,s,p,m,g)},a.prototype.emplace=function(s,p,m,g,w){var C=12*s,I=3*s;return this.uint8[C+0]=p,this.uint8[C+1]=m,this.float32[I+1]=g,this.float32[I+2]=w,s},a}(fi);xc.prototype.bytesPerElement=12,Gr("StructArrayLayout2ub2f12",xc);var Mu=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m){var g=this.length;return this.resize(g+1),this.emplace(g,s,p,m)},a.prototype.emplace=function(s,p,m,g){var w=3*s;return this.uint16[w+0]=p,this.uint16[w+1]=m,this.uint16[w+2]=g,s},a}(fi);Mu.prototype.bytesPerElement=6,Gr("StructArrayLayout3ui6",Mu);var cs=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C,I,k,D,B,V,q,we,Ce,ze,Le,qe){var st=this.length;return this.resize(st+1),this.emplace(st,s,p,m,g,w,C,I,k,D,B,V,q,we,Ce,ze,Le,qe)},a.prototype.emplace=function(s,p,m,g,w,C,I,k,D,B,V,q,we,Ce,ze,Le,qe,st){var St=24*s,xt=12*s,kt=48*s;return this.int16[St+0]=p,this.int16[St+1]=m,this.uint16[St+2]=g,this.uint16[St+3]=w,this.uint32[xt+2]=C,this.uint32[xt+3]=I,this.uint32[xt+4]=k,this.uint16[St+10]=D,this.uint16[St+11]=B,this.uint16[St+12]=V,this.float32[xt+7]=q,this.float32[xt+8]=we,this.uint8[kt+36]=Ce,this.uint8[kt+37]=ze,this.uint8[kt+38]=Le,this.uint32[xt+10]=qe,this.int16[St+22]=st,s},a}(fi);cs.prototype.bytesPerElement=48,Gr("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",cs);var wl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g,w,C,I,k,D,B,V,q,we,Ce,ze,Le,qe,st,St,xt,kt,or,Nt,un,kr,cn,Br,Kn){var En=this.length;return this.resize(En+1),this.emplace(En,s,p,m,g,w,C,I,k,D,B,V,q,we,Ce,ze,Le,qe,st,St,xt,kt,or,Nt,un,kr,cn,Br,Kn)},a.prototype.emplace=function(s,p,m,g,w,C,I,k,D,B,V,q,we,Ce,ze,Le,qe,st,St,xt,kt,or,Nt,un,kr,cn,Br,Kn,En){var Qr=34*s,oi=17*s;return this.int16[Qr+0]=p,this.int16[Qr+1]=m,this.int16[Qr+2]=g,this.int16[Qr+3]=w,this.int16[Qr+4]=C,this.int16[Qr+5]=I,this.int16[Qr+6]=k,this.int16[Qr+7]=D,this.uint16[Qr+8]=B,this.uint16[Qr+9]=V,this.uint16[Qr+10]=q,this.uint16[Qr+11]=we,this.uint16[Qr+12]=Ce,this.uint16[Qr+13]=ze,this.uint16[Qr+14]=Le,this.uint16[Qr+15]=qe,this.uint16[Qr+16]=st,this.uint16[Qr+17]=St,this.uint16[Qr+18]=xt,this.uint16[Qr+19]=kt,this.uint16[Qr+20]=or,this.uint16[Qr+21]=Nt,this.uint16[Qr+22]=un,this.uint32[oi+12]=kr,this.float32[oi+13]=cn,this.float32[oi+14]=Br,this.float32[oi+15]=Kn,this.float32[oi+16]=En,s},a}(fi);wl.prototype.bytesPerElement=68,Gr("StructArrayLayout8i15ui1ul4f68",wl);var Cs=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var p=this.length;return this.resize(p+1),this.emplace(p,s)},a.prototype.emplace=function(s,p){return this.float32[1*s+0]=p,s},a}(fi);Cs.prototype.bytesPerElement=4,Gr("StructArrayLayout1f4",Cs);var fs=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m){var g=this.length;return this.resize(g+1),this.emplace(g,s,p,m)},a.prototype.emplace=function(s,p,m,g){var w=3*s;return this.int16[w+0]=p,this.int16[w+1]=m,this.int16[w+2]=g,s},a}(fi);fs.prototype.bytesPerElement=6,Gr("StructArrayLayout3i6",fs);var Yc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m){var g=this.length;return this.resize(g+1),this.emplace(g,s,p,m)},a.prototype.emplace=function(s,p,m,g){var w=4*s;return this.uint32[2*s+0]=p,this.uint16[w+2]=m,this.uint16[w+3]=g,s},a}(fi);Yc.prototype.bytesPerElement=8,Gr("StructArrayLayout1ul2ui8",Yc);var Yl=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p){var m=this.length;return this.resize(m+1),this.emplace(m,s,p)},a.prototype.emplace=function(s,p,m){var g=2*s;return this.uint16[g+0]=p,this.uint16[g+1]=m,s},a}(fi);Yl.prototype.bytesPerElement=4,Gr("StructArrayLayout2ui4",Yl);var qc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s){var p=this.length;return this.resize(p+1),this.emplace(p,s)},a.prototype.emplace=function(s,p){return this.uint16[1*s+0]=p,s},a}(fi);qc.prototype.bytesPerElement=2,Gr("StructArrayLayout1ui2",qc);var Kc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},a.prototype.emplaceBack=function(s,p,m,g){var w=this.length;return this.resize(w+1),this.emplace(w,s,p,m,g)},a.prototype.emplace=function(s,p,m,g,w){var C=4*s;return this.float32[C+0]=p,this.float32[C+1]=m,this.float32[C+2]=g,this.float32[C+3]=w,s},a}(fi);Kc.prototype.bytesPerElement=16,Gr("StructArrayLayout4f16",Kc);var u=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return s.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},s.x1.get=function(){return this._structArray.int16[this._pos2+2]},s.y1.get=function(){return this._structArray.int16[this._pos2+3]},s.x2.get=function(){return this._structArray.int16[this._pos2+4]},s.y2.get=function(){return this._structArray.int16[this._pos2+5]},s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.anchorPoint.get=function(){return new me(this.anchorPointX,this.anchorPointY)},Object.defineProperties(a.prototype,s),a}(xl);u.prototype.size=20;var f=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new u(this,s)},a}(Xc);Gr("CollisionBoxArray",f);var l=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},s.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},s.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},s.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},s.segment.get=function(){return this._structArray.uint16[this._pos2+10]},s.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},s.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},s.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},s.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},s.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},s.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},s.placedOrientation.set=function(p){this._structArray.uint8[this._pos1+37]=p},s.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},s.hidden.set=function(p){this._structArray.uint8[this._pos1+38]=p},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},s.crossTileID.set=function(p){this._structArray.uint32[this._pos4+10]=p},s.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(a.prototype,s),a}(xl);l.prototype.size=48;var h=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new l(this,s)},a}(cs);Gr("PlacedSymbolArray",h);var x=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return s.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},s.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},s.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},s.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},s.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},s.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},s.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},s.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},s.key.get=function(){return this._structArray.uint16[this._pos2+8]},s.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},s.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},s.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},s.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},s.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},s.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},s.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},s.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},s.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},s.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},s.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},s.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},s.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},s.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},s.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},s.crossTileID.set=function(p){this._structArray.uint32[this._pos4+12]=p},s.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},s.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},s.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},s.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(a.prototype,s),a}(xl);x.prototype.size=68;var S=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new x(this,s)},a}(wl);Gr("SymbolInstanceArray",S);var E=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getoffsetX=function(s){return this.float32[1*s+0]},a}(Cs);Gr("GlyphOffsetArray",E);var P=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.getx=function(s){return this.int16[3*s+0]},a.prototype.gety=function(s){return this.int16[3*s+1]},a.prototype.gettileUnitDistanceFromAnchor=function(s){return this.int16[3*s+2]},a}(fs);Gr("SymbolLineVertexArray",P);var R=function(t){function a(){t.apply(this,arguments)}t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a;var s={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return s.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},s.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},s.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(a.prototype,s),a}(xl);R.prototype.size=8;var z=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.get=function(s){return new R(this,s)},a}(Yc);Gr("FeatureIndexArray",z);var j=pa([{name:"a_pos",components:2,type:"Int16"}],4).members,ee=function(t){t===void 0&&(t=[]),this.segments=t};function ne(t,a){return 256*(t=M(Math.floor(t),0,255))+M(Math.floor(a),0,255)}ee.prototype.prepareSegment=function(t,a,s,p){var m=this.segments[this.segments.length-1];return t>ee.MAX_VERTEX_ARRAY_LENGTH&&Ye("Max vertices per segment is "+ee.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!m||m.vertexLength+t>ee.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==p)&&(m={vertexOffset:a.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},p!==void 0&&(m.sortKey=p),this.segments.push(m)),m},ee.prototype.get=function(){return this.segments},ee.prototype.destroy=function(){for(var t=0,a=this.segments;t<a.length;t+=1){var s=a[t];for(var p in s.vaos)s.vaos[p].destroy()}},ee.simpleSegment=function(t,a,s,p){return new ee([{vertexOffset:t,primitiveOffset:a,vertexLength:s,primitiveLength:p,vaos:{},sortKey:0}])},ee.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Gr("SegmentVector",ee);var Ae=pa([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Se=ye(function(t){t.exports=function(a,s){var p,m,g,w,C,I,k,D;for(m=a.length-(p=3&a.length),g=s,C=3432918353,I=461845907,D=0;D<m;)k=255&a.charCodeAt(D)|(255&a.charCodeAt(++D))<<8|(255&a.charCodeAt(++D))<<16|(255&a.charCodeAt(++D))<<24,++D,g=27492+(65535&(w=5*(65535&(g=(g^=k=(65535&(k=(k=(65535&k)*C+(((k>>>16)*C&65535)<<16)&4294967295)<<15|k>>>17))*I+(((k>>>16)*I&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(k=0,p){case 3:k^=(255&a.charCodeAt(D+2))<<16;case 2:k^=(255&a.charCodeAt(D+1))<<8;case 1:g^=k=(65535&(k=(k=(65535&(k^=255&a.charCodeAt(D)))*C+(((k>>>16)*C&65535)<<16)&4294967295)<<15|k>>>17))*I+(((k>>>16)*I&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),De=ye(function(t){t.exports=function(a,s){for(var p,m=a.length,g=s^m,w=0;m>=4;)p=1540483477*(65535&(p=255&a.charCodeAt(w)|(255&a.charCodeAt(++w))<<8|(255&a.charCodeAt(++w))<<16|(255&a.charCodeAt(++w))<<24))+((1540483477*(p>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(p=1540483477*(65535&(p^=p>>>24))+((1540483477*(p>>>16)&65535)<<16)),m-=4,++w;switch(m){case 3:g^=(255&a.charCodeAt(w+2))<<16;case 2:g^=(255&a.charCodeAt(w+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(w)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),_e=Se,Fe=De;_e.murmur3=Se,_e.murmur2=Fe;var Ge=function(){this.ids=[],this.positions=[],this.indexed=!1};Ge.prototype.add=function(t,a,s,p){this.ids.push(Ct(t)),this.positions.push(a,s,p)},Ge.prototype.getPositions=function(t){for(var a=Ct(t),s=0,p=this.ids.length-1;s<p;){var m=s+p>>1;this.ids[m]>=a?p=m:s=m+1}for(var g=[];this.ids[s]===a;)g.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return g},Ge.serialize=function(t,a){var s=new Float64Array(t.ids),p=new Uint32Array(t.positions);return function m(g,w,C,I){for(;C<I;){for(var k=g[C+I>>1],D=C-1,B=I+1;;){do D++;while(g[D]<k);do B--;while(g[B]>k);if(D>=B)break;wt(g,D,B),wt(w,3*D,3*B),wt(w,3*D+1,3*B+1),wt(w,3*D+2,3*B+2)}B-C<I-B?(m(g,w,C,B),C=B+1):(m(g,w,B+1,I),I=B)}}(s,p,0,s.length-1),a&&a.push(s.buffer,p.buffer),{ids:s,positions:p}},Ge.deserialize=function(t){var a=new Ge;return a.ids=t.ids,a.positions=t.positions,a.indexed=!0,a};var at=Math.pow(2,53)-1;function Ct(t){var a=+t;return!isNaN(a)&&a<=at?a:_e(String(t))}function wt(t,a,s){var p=t[a];t[a]=t[s],t[s]=p}Gr("FeaturePositionMap",Ge);var Mt=function(t,a){this.gl=t.gl,this.location=a},qt=function(t){function a(s,p){t.call(this,s,p),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))},a}(Mt),xr=function(t){function a(s,p){t.call(this,s,p),this.current=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))},a}(Mt),pr=function(t){function a(s,p){t.call(this,s,p),this.current=[0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))},a}(Mt),Fr=function(t){function a(s,p){t.call(this,s,p),this.current=[0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))},a}(Mt),tn=function(t){function a(s,p){t.call(this,s,p),this.current=[0,0,0,0]}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3]))},a}(Mt),pn=function(t){function a(s,p){t.call(this,s,p),this.current=Jn.transparent}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a))},a}(Mt),ln=new Float32Array(16),pi=function(t){function a(s,p){t.call(this,s,p),this.current=ln}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.set=function(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(var p=1;p<16;p++)if(s[p]!==this.current[p]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}},a}(Mt);function yr(t){return[ne(255*t.r,255*t.g),ne(255*t.b,255*t.a)]}var $r=function(t,a,s){this.value=t,this.uniformNames=a.map(function(p){return"u_"+p}),this.type=s};$r.prototype.setUniform=function(t,a,s){t.set(s.constantOr(this.value))},$r.prototype.getBinding=function(t,a,s){return this.type==="color"?new pn(t,a):new xr(t,a)};var kn=function(t,a){this.uniformNames=a.map(function(s){return"u_"+s}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};kn.prototype.setConstantPatternPositions=function(t,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=t.tlbr},kn.prototype.setUniform=function(t,a,s,p){var m=p==="u_pattern_to"?this.patternTo:p==="u_pattern_from"?this.patternFrom:p==="u_pixel_ratio_to"?this.pixelRatioTo:p==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&t.set(m)},kn.prototype.getBinding=function(t,a,s){return s.substr(0,9)==="u_pattern"?new tn(t,a):new xr(t,a)};var wn=function(t,a,s,p){this.expression=t,this.type=s,this.maxValue=0,this.paintVertexAttributes=a.map(function(m){return{name:"a_"+m,type:"Float32",components:s==="color"?2:1,offset:0}}),this.paintVertexArray=new p};wn.prototype.populatePaintArray=function(t,a,s,p,m){var g=this.paintVertexArray.length,w=this.expression.evaluate(new Xn(0),a,{},p,[],m);this.paintVertexArray.resize(t),this._setPaintValue(g,t,w)},wn.prototype.updatePaintArray=function(t,a,s,p){var m=this.expression.evaluate({zoom:0},s,p);this._setPaintValue(t,a,m)},wn.prototype._setPaintValue=function(t,a,s){if(this.type==="color")for(var p=yr(s),m=t;m<a;m++)this.paintVertexArray.emplace(m,p[0],p[1]);else{for(var g=t;g<a;g++)this.paintVertexArray.emplace(g,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}},wn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},wn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var vn=function(t,a,s,p,m,g){this.expression=t,this.uniformNames=a.map(function(w){return"u_"+w+"_t"}),this.type=s,this.useIntegerZoom=p,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=a.map(function(w){return{name:"a_"+w,type:"Float32",components:s==="color"?4:2,offset:0}}),this.paintVertexArray=new g};vn.prototype.populatePaintArray=function(t,a,s,p,m){var g=this.expression.evaluate(new Xn(this.zoom),a,{},p,[],m),w=this.expression.evaluate(new Xn(this.zoom+1),a,{},p,[],m),C=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(C,t,g,w)},vn.prototype.updatePaintArray=function(t,a,s,p){var m=this.expression.evaluate({zoom:this.zoom},s,p),g=this.expression.evaluate({zoom:this.zoom+1},s,p);this._setPaintValue(t,a,m,g)},vn.prototype._setPaintValue=function(t,a,s,p){if(this.type==="color")for(var m=yr(s),g=yr(p),w=t;w<a;w++)this.paintVertexArray.emplace(w,m[0],m[1],g[0],g[1]);else{for(var C=t;C<a;C++)this.paintVertexArray.emplace(C,s,p);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(p))}},vn.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},vn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},vn.prototype.setUniform=function(t,a){var s=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,p=M(this.expression.interpolationFactor(s,this.zoom,this.zoom+1),0,1);t.set(p)},vn.prototype.getBinding=function(t,a,s){return new xr(t,a)};var Un=function(t,a,s,p,m,g){this.expression=t,this.type=a,this.useIntegerZoom=s,this.zoom=p,this.layerId=g,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m};Un.prototype.populatePaintArray=function(t,a,s){var p=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(p,t,a.patterns&&a.patterns[this.layerId],s)},Un.prototype.updatePaintArray=function(t,a,s,p,m){this._setPaintValues(t,a,s.patterns&&s.patterns[this.layerId],m)},Un.prototype._setPaintValues=function(t,a,s,p){if(p&&s){var m=p[s.min],g=p[s.mid],w=p[s.max];if(m&&g&&w)for(var C=t;C<a;C++)this.zoomInPaintVertexArray.emplace(C,g.tl[0],g.tl[1],g.br[0],g.br[1],m.tl[0],m.tl[1],m.br[0],m.br[1],g.pixelRatio,m.pixelRatio),this.zoomOutPaintVertexArray.emplace(C,g.tl[0],g.tl[1],g.br[0],g.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],g.pixelRatio,w.pixelRatio)}},Un.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Ae.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Ae.members,this.expression.isStateDependent))},Un.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Sn=function(t,a,s){this.binders={},this._buffers=[];var p=[];for(var m in t.paint._values)if(s(m)){var g=t.paint.get(m);if(g instanceof lo&&$s(g.property.specification)){var w=Da(m,t.type),C=g.value,I=g.property.specification.type,k=g.property.useIntegerZoom,D=g.property.specification["property-type"],B=D==="cross-faded"||D==="cross-faded-data-driven";if(C.kind==="constant")this.binders[m]=B?new kn(C.value,w):new $r(C.value,w,I),p.push("/u_"+m);else if(C.kind==="source"||B){var V=Wi(m,I,"source");this.binders[m]=B?new Un(C,I,k,a,V,t.id):new wn(C,w,I,V),p.push("/a_"+m)}else{var q=Wi(m,I,"composite");this.binders[m]=new vn(C,w,I,k,a,q),p.push("/z_"+m)}}}this.cacheKey=p.sort().join("")};Sn.prototype.getMaxValue=function(t){var a=this.binders[t];return a instanceof wn||a instanceof vn?a.maxValue:0},Sn.prototype.populatePaintArrays=function(t,a,s,p,m){for(var g in this.binders){var w=this.binders[g];(w instanceof wn||w instanceof vn||w instanceof Un)&&w.populatePaintArray(t,a,s,p,m)}},Sn.prototype.setConstantPatternPositions=function(t,a){for(var s in this.binders){var p=this.binders[s];p instanceof kn&&p.setConstantPatternPositions(t,a)}},Sn.prototype.updatePaintArrays=function(t,a,s,p,m){var g=!1;for(var w in t)for(var C=0,I=a.getPositions(w);C<I.length;C+=1){var k=I[C],D=s.feature(k.index);for(var B in this.binders){var V=this.binders[B];if((V instanceof wn||V instanceof vn||V instanceof Un)&&V.expression.isStateDependent===!0){var q=p.paint.get(B);V.expression=q.value,V.updatePaintArray(k.start,k.end,D,t[w],m),g=!0}}}return g},Sn.prototype.defines=function(){var t=[];for(var a in this.binders){var s=this.binders[a];(s instanceof $r||s instanceof kn)&&t.push.apply(t,s.uniformNames.map(function(p){return"#define HAS_UNIFORM_"+p}))}return t},Sn.prototype.getBinderAttributes=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof wn||s instanceof vn)for(var p=0;p<s.paintVertexAttributes.length;p++)t.push(s.paintVertexAttributes[p].name);else if(s instanceof Un)for(var m=0;m<Ae.members.length;m++)t.push(Ae.members[m].name)}return t},Sn.prototype.getBinderUniforms=function(){var t=[];for(var a in this.binders){var s=this.binders[a];if(s instanceof $r||s instanceof kn||s instanceof vn)for(var p=0,m=s.uniformNames;p<m.length;p+=1)t.push(m[p])}return t},Sn.prototype.getPaintVertexBuffers=function(){return this._buffers},Sn.prototype.getUniforms=function(t,a){var s=[];for(var p in this.binders){var m=this.binders[p];if(m instanceof $r||m instanceof kn||m instanceof vn)for(var g=0,w=m.uniformNames;g<w.length;g+=1){var C=w[g];if(a[C]){var I=m.getBinding(t,a[C],C);s.push({name:C,property:p,binding:I})}}}return s},Sn.prototype.setUniforms=function(t,a,s,p){for(var m=0,g=a;m<g.length;m+=1){var w=g[m],C=w.name,I=w.property;this.binders[I].setUniform(w.binding,p,s.get(I),C)}},Sn.prototype.updatePaintBuffers=function(t){for(var a in this._buffers=[],this.binders){var s=this.binders[a];if(t&&s instanceof Un){var p=t.fromScale===2?s.zoomInPaintVertexBuffer:s.zoomOutPaintVertexBuffer;p&&this._buffers.push(p)}else(s instanceof wn||s instanceof vn)&&s.paintVertexBuffer&&this._buffers.push(s.paintVertexBuffer)}},Sn.prototype.upload=function(t){for(var a in this.binders){var s=this.binders[a];(s instanceof wn||s instanceof vn||s instanceof Un)&&s.upload(t)}this.updatePaintBuffers()},Sn.prototype.destroy=function(){for(var t in this.binders){var a=this.binders[t];(a instanceof wn||a instanceof vn||a instanceof Un)&&a.destroy()}};var _n=function(t,a,s){s===void 0&&(s=function(){return!0}),this.programConfigurations={};for(var p=0,m=t;p<m.length;p+=1){var g=m[p];this.programConfigurations[g.id]=new Sn(g,a,s)}this.needsUpload=!1,this._featureMap=new Ge,this._bufferOffset=0};function Da(t,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(a+"-","").replace(/-/g,"_")]}function Wi(t,a,s){var p={color:{source:Zo,composite:Kc},number:{source:Cs,composite:Zo}},m=function(g){return{"line-pattern":{source:tu,composite:tu},"fill-pattern":{source:tu,composite:tu},"fill-extrusion-pattern":{source:tu,composite:tu}}[g]}(t);return m&&m[s]||p[a][s]}_n.prototype.populatePaintArrays=function(t,a,s,p,m,g){for(var w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(t,a,p,m,g);a.id!==void 0&&this._featureMap.add(a.id,s,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},_n.prototype.updatePaintArrays=function(t,a,s,p){for(var m=0,g=s;m<g.length;m+=1){var w=g[m];this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(t,this._featureMap,a,w,p)||this.needsUpload}},_n.prototype.get=function(t){return this.programConfigurations[t]},_n.prototype.upload=function(t){if(this.needsUpload){for(var a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}},_n.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},Gr("ConstantBinder",$r),Gr("CrossFadedConstantBinder",kn),Gr("SourceExpressionBinder",wn),Gr("CrossFadedCompositeBinder",Un),Gr("CompositeExpressionBinder",vn),Gr("ProgramConfiguration",Sn,{omit:["_buffers"]}),Gr("ProgramConfigurationSet",_n);var Gi=Math.pow(2,14)-1,ro=-Gi-1;function ra(t){for(var a=8192/t.extent,s=t.loadGeometry(),p=0;p<s.length;p++)for(var m=s[p],g=0;g<m.length;g++){var w=m[g],C=Math.round(w.x*a),I=Math.round(w.y*a);w.x=M(C,ro,Gi),w.y=M(I,ro,Gi),(C<w.x||C>w.x+1||I<w.y||I>w.y+1)&&Ye("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return s}function _a(t,a){return{type:t.type,id:t.id,properties:t.properties,geometry:a?ra(t):[]}}function Fa(t,a,s,p,m){t.emplaceBack(2*a+(p+1)/2,2*s+(m+1)/2)}var no=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Yu,this.indexArray=new Mu,this.segments=new ee,this.programConfigurations=new _n(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Ts(t,a){for(var s=0;s<t.length;s++)if(Bs(a,t[s]))return!0;for(var p=0;p<a.length;p++)if(Bs(t,a[p]))return!0;return!!ru(t,a)}function co(t,a,s){return!!Bs(t,a)||!!nu(a,t,s)}function Jo(t,a){if(t.length===1)return Sl(a,t[0]);for(var s=0;s<a.length;s++)for(var p=a[s],m=0;m<p.length;m++)if(Bs(t,p[m]))return!0;for(var g=0;g<t.length;g++)if(Sl(a,t[g]))return!0;for(var w=0;w<a.length;w++)if(ru(t,a[w]))return!0;return!1}function Lo(t,a,s){if(t.length>1){if(ru(t,a))return!0;for(var p=0;p<a.length;p++)if(nu(a[p],t,s))return!0}for(var m=0;m<t.length;m++)if(nu(t[m],a,s))return!0;return!1}function ru(t,a){if(t.length===0||a.length===0)return!1;for(var s=0;s<t.length-1;s++)for(var p=t[s],m=t[s+1],g=0;g<a.length-1;g++)if(qu(p,m,a[g],a[g+1]))return!0;return!1}function qu(t,a,s,p){return Lt(t,s,p)!==Lt(a,s,p)&&Lt(t,a,s)!==Lt(t,a,p)}function nu(t,a,s){var p=s*s;if(a.length===1)return t.distSqr(a[0])<p;for(var m=1;m<a.length;m++)if(iu(t,a[m-1],a[m])<p)return!0;return!1}function iu(t,a,s){var p=a.distSqr(s);if(p===0)return t.distSqr(a);var m=((t.x-a.x)*(s.x-a.x)+(t.y-a.y)*(s.y-a.y))/p;return t.distSqr(m<0?a:m>1?s:s.sub(a)._mult(m)._add(a))}function Sl(t,a){for(var s,p,m,g=!1,w=0;w<t.length;w++)for(var C=0,I=(s=t[w]).length-1;C<s.length;I=C++)(p=s[C]).y>a.y!=(m=s[I]).y>a.y&&a.x<(m.x-p.x)*(a.y-p.y)/(m.y-p.y)+p.x&&(g=!g);return g}function Bs(t,a){for(var s=!1,p=0,m=t.length-1;p<t.length;m=p++){var g=t[p],w=t[m];g.y>a.y!=w.y>a.y&&a.x<(w.x-g.x)*(a.y-g.y)/(w.y-g.y)+g.x&&(s=!s)}return s}function Ku(t,a,s){var p=s[0],m=s[2];if(t.x<p.x&&a.x<p.x||t.x>m.x&&a.x>m.x||t.y<p.y&&a.y<p.y||t.y>m.y&&a.y>m.y)return!1;var g=Lt(t,a,s[0]);return g!==Lt(t,a,s[1])||g!==Lt(t,a,s[2])||g!==Lt(t,a,s[3])}function Ba(t,a,s){var p=a.paint.get(t).value;return p.kind==="constant"?p.value:s.programConfigurations.get(a.id).getMaxValue(t)}function na(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function au(t,a,s,p,m){if(!a[0]&&!a[1])return t;var g=me.convert(a)._mult(m);s==="viewport"&&g._rotate(-p);for(var w=[],C=0;C<t.length;C++)w.push(t[C].sub(g));return w}no.prototype.populate=function(t,a,s){var p=this.layers[0],m=[],g=null;p.type==="circle"&&(g=p.layout.get("circle-sort-key"));for(var w=0,C=t;w<C.length;w+=1){var I=C[w],k=I.feature,D=I.id,B=I.index,V=I.sourceLayerIndex,q=this.layers[0]._featureFilter.needGeometry,we=_a(k,q);if(this.layers[0]._featureFilter.filter(new Xn(this.zoom),we,s)){var Ce=g?g.evaluate(we,{},s):void 0,ze={id:D,properties:k.properties,type:k.type,sourceLayerIndex:V,index:B,geometry:q?we.geometry:ra(k),patterns:{},sortKey:Ce};m.push(ze)}}g&&m.sort(function(Nt,un){return Nt.sortKey-un.sortKey});for(var Le=0,qe=m;Le<qe.length;Le+=1){var st=qe[Le],St=st.geometry,xt=st.index,kt=st.sourceLayerIndex,or=t[xt].feature;this.addFeature(st,St,xt,s),a.featureIndex.insert(or,St,xt,kt,this.index)}},no.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},no.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},no.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},no.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,j),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},no.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},no.prototype.addFeature=function(t,a,s,p){for(var m=0,g=a;m<g.length;m+=1)for(var w=0,C=g[m];w<C.length;w+=1){var I=C[w],k=I.x,D=I.y;if(!(k<0||k>=8192||D<0||D>=8192)){var B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),V=B.vertexLength;Fa(this.layoutVertexArray,k,D,-1,-1),Fa(this.layoutVertexArray,k,D,1,-1),Fa(this.layoutVertexArray,k,D,1,1),Fa(this.layoutVertexArray,k,D,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+3,V+2),B.vertexLength+=4,B.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,{},p)},Gr("CircleBucket",no,{omit:["layers"]});var Ns=new ya({"circle-sort-key":new Wr(te.layout_circle["circle-sort-key"])}),Uo={paint:new ya({"circle-radius":new Wr(te.paint_circle["circle-radius"]),"circle-color":new Wr(te.paint_circle["circle-color"]),"circle-blur":new Wr(te.paint_circle["circle-blur"]),"circle-opacity":new Wr(te.paint_circle["circle-opacity"]),"circle-translate":new nn(te.paint_circle["circle-translate"]),"circle-translate-anchor":new nn(te.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new nn(te.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new nn(te.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Wr(te.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Wr(te.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Wr(te.paint_circle["circle-stroke-opacity"])}),layout:Ns},di=typeof Float32Array!="undefined"?Float32Array:Array;function io(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ao(t,a,s){var p=a[0],m=a[1],g=a[2],w=a[3],C=a[4],I=a[5],k=a[6],D=a[7],B=a[8],V=a[9],q=a[10],we=a[11],Ce=a[12],ze=a[13],Le=a[14],qe=a[15],st=s[0],St=s[1],xt=s[2],kt=s[3];return t[0]=st*p+St*C+xt*B+kt*Ce,t[1]=st*m+St*I+xt*V+kt*ze,t[2]=st*g+St*k+xt*q+kt*Le,t[3]=st*w+St*D+xt*we+kt*qe,t[4]=(st=s[4])*p+(St=s[5])*C+(xt=s[6])*B+(kt=s[7])*Ce,t[5]=st*m+St*I+xt*V+kt*ze,t[6]=st*g+St*k+xt*q+kt*Le,t[7]=st*w+St*D+xt*we+kt*qe,t[8]=(st=s[8])*p+(St=s[9])*C+(xt=s[10])*B+(kt=s[11])*Ce,t[9]=st*m+St*I+xt*V+kt*ze,t[10]=st*g+St*k+xt*q+kt*Le,t[11]=st*w+St*D+xt*we+kt*qe,t[12]=(st=s[12])*p+(St=s[13])*C+(xt=s[14])*B+(kt=s[15])*Ce,t[13]=st*m+St*I+xt*V+kt*ze,t[14]=st*g+St*k+xt*q+kt*Le,t[15]=st*w+St*D+xt*we+kt*qe,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,a=0,s=arguments.length;s--;)a+=t[s]*t[s];return Math.sqrt(a)});var ps,$u=ao;function ou(t,a,s){var p=a[0],m=a[1],g=a[2],w=a[3];return t[0]=s[0]*p+s[4]*m+s[8]*g+s[12]*w,t[1]=s[1]*p+s[5]*m+s[9]*g+s[13]*w,t[2]=s[2]*p+s[6]*m+s[10]*g+s[14]*w,t[3]=s[3]*p+s[7]*m+s[11]*g+s[15]*w,t}ps=new di(3),di!=Float32Array&&(ps[0]=0,ps[1]=0,ps[2]=0),function(){var t=new di(4);di!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var ql=(function(){var t=new di(2);di!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function a(s){t.call(this,s,Uo)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new no(s)},a.prototype.queryRadius=function(s){var p=s;return Ba("circle-radius",this,p)+Ba("circle-stroke-width",this,p)+na(this.paint.get("circle-translate"))},a.prototype.queryIntersectsFeature=function(s,p,m,g,w,C,I,k){for(var D=au(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),C.angle,I),B=this.paint.get("circle-radius").evaluate(p,m)+this.paint.get("circle-stroke-width").evaluate(p,m),V=this.paint.get("circle-pitch-alignment")==="map",q=V?D:function(or,Nt){return or.map(function(un){return Ju(un,Nt)})}(D,k),we=V?B*I:B,Ce=0,ze=g;Ce<ze.length;Ce+=1)for(var Le=0,qe=ze[Ce];Le<qe.length;Le+=1){var st=qe[Le],St=V?st:Ju(st,k),xt=we,kt=ou([],[st.x,st.y,0,1],k);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?xt*=kt[3]/C.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(xt*=C.cameraToCenterDistance/kt[3]),co(q,St,xt))return!0}return!1},a}(ta));function Ju(t,a){var s=ou([],[t.x,t.y,0,1],a);return new me(s[0]/s[3],s[1]/s[3])}var bc=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(no);function zs(t,a,s,p){var m=a.width,g=a.height;if(p){if(p instanceof Uint8ClampedArray)p=new Uint8Array(p.buffer);else if(p.length!==m*g*s)throw new RangeError("mismatched image size")}else p=new Uint8Array(m*g*s);return t.width=m,t.height=g,t.data=p,t}function El(t,a,s){var p=a.width,m=a.height;if(p!==t.width||m!==t.height){var g=zs({},{width:p,height:m},s);$c(t,g,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,p),height:Math.min(t.height,m)},s),t.width=p,t.height=m,t.data=g.data}}function $c(t,a,s,p,m,g){if(m.width===0||m.height===0)return a;if(m.width>t.width||m.height>t.height||s.x>t.width-m.width||s.y>t.height-m.height)throw new RangeError("out of range source coordinates for image copy");if(m.width>a.width||m.height>a.height||p.x>a.width-m.width||p.y>a.height-m.height)throw new RangeError("out of range destination coordinates for image copy");for(var w=t.data,C=a.data,I=0;I<m.height;I++)for(var k=((s.y+I)*t.width+s.x)*g,D=((p.y+I)*a.width+p.x)*g,B=0;B<m.width*g;B++)C[D+B]=w[k+B];return a}Gr("HeatmapBucket",bc,{omit:["layers"]});var Zs=function(t,a){zs(this,t,1,a)};Zs.prototype.resize=function(t){El(this,t,1)},Zs.prototype.clone=function(){return new Zs({width:this.width,height:this.height},new Uint8Array(this.data))},Zs.copy=function(t,a,s,p,m){$c(t,a,s,p,m,1)};var qa=function(t,a){zs(this,t,4,a)};qa.prototype.resize=function(t){El(this,t,4)},qa.prototype.replace=function(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},qa.prototype.clone=function(){return new qa({width:this.width,height:this.height},new Uint8Array(this.data))},qa.copy=function(t,a,s,p,m){$c(t,a,s,p,m,4)},Gr("AlphaImage",Zs),Gr("RGBAImage",qa);var ih={paint:new ya({"heatmap-radius":new Wr(te.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Wr(te.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new nn(te.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ra(te.paint_heatmap["heatmap-color"]),"heatmap-opacity":new nn(te.paint_heatmap["heatmap-opacity"])})};function vp(t){var a={},s=t.resolution||256,p=t.clips?t.clips.length:1,m=t.image||new qa({width:s,height:p}),g=function(we,Ce,ze){a[t.evaluationKey]=ze;var Le=t.expression.evaluate(a);m.data[we+Ce+0]=Math.floor(255*Le.r/Le.a),m.data[we+Ce+1]=Math.floor(255*Le.g/Le.a),m.data[we+Ce+2]=Math.floor(255*Le.b/Le.a),m.data[we+Ce+3]=Math.floor(255*Le.a)};if(t.clips)for(var w=0,C=0;w<p;++w,C+=4*s)for(var I=0,k=0;I<s;I++,k+=4){var D=I/(s-1),B=t.clips[w];g(C,k,B.start*(1-D)+B.end*D)}else for(var V=0,q=0;V<s;V++,q+=4)g(0,q,V/(s-1));return m}var mp=function(t){function a(s){t.call(this,s,ih),this._updateColorRamp()}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new bc(s)},a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="heatmap-color"&&this._updateColorRamp()},a.prototype._updateColorRamp=function(){this.colorRamp=vp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},a.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},a}(ta),yp={paint:new ya({"hillshade-illumination-direction":new nn(te.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new nn(te.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new nn(te.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new nn(te.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new nn(te.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new nn(te.paint_hillshade["hillshade-accent-color"])})},gp=function(t){function a(s){t.call(this,s,yp)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},a}(ta),ah=pa([{name:"a_pos",components:2,type:"Int16"}],4).members,Cl=Tf,oh=Tf;function Tf(t,a,s){s=s||2;var p,m,g,w,C,I,k,D=a&&a.length,B=D?a[0]*s:t.length,V=_p(t,0,B,s,!0),q=[];if(!V||V.next===V.prev)return q;if(D&&(V=function(Ce,ze,Le,qe){var st,St,xt,kt=[];for(st=0,St=ze.length;st<St;st++)(xt=_p(Ce,ze[st]*qe,st<St-1?ze[st+1]*qe:Ce.length,qe,!1))===xt.next&&(xt.steiner=!0),kt.push(hh(xt));for(kt.sort(ch),st=0;st<kt.length;st++)fh(kt[st],Le),Le=Qu(Le,Le.next);return Le}(t,a,V,s)),t.length>80*s){p=g=t[0],m=w=t[1];for(var we=s;we<B;we+=s)(C=t[we])<p&&(p=C),(I=t[we+1])<m&&(m=I),C>g&&(g=C),I>w&&(w=I);k=(k=Math.max(g-p,w-m))!==0?1/k:0}return Jc(V,q,s,p,m,k),q}function _p(t,a,s,p,m){var g,w;if(m===Sc(t,a,s,p)>0)for(g=a;g<s;g+=p)w=Pf(g,t[g],t[g+1],w);else for(g=s-p;g>=a;g-=p)w=Pf(g,t[g],t[g+1],w);return w&&Kl(w,w.next)&&(ec(w),w=w.next),w}function Qu(t,a){if(!t)return t;a||(a=t);var s,p=t;do if(s=!1,p.steiner||!Kl(p,p.next)&&ia(p.prev,p,p.next)!==0)p=p.next;else{if(ec(p),(p=a=p.prev)===p.next)break;s=!0}while(s||p!==a);return a}function Jc(t,a,s,p,m,g,w){if(t){!w&&g&&function(D,B,V,q){var we=D;do we.z===null&&(we.z=tp(we.x,we.y,B,V,q)),we.prevZ=we.prev,we.nextZ=we.next,we=we.next;while(we!==D);we.prevZ.nextZ=null,we.prevZ=null,function(Ce){var ze,Le,qe,st,St,xt,kt,or,Nt=1;do{for(Le=Ce,Ce=null,St=null,xt=0;Le;){for(xt++,qe=Le,kt=0,ze=0;ze<Nt&&(kt++,qe=qe.nextZ);ze++);for(or=Nt;kt>0||or>0&&qe;)kt!==0&&(or===0||!qe||Le.z<=qe.z)?(st=Le,Le=Le.nextZ,kt--):(st=qe,qe=qe.nextZ,or--),St?St.nextZ=st:Ce=st,st.prevZ=St,St=st;Le=qe}St.nextZ=null,Nt*=2}while(xt>1)}(we)}(t,p,m,g);for(var C,I,k=t;t.prev!==t.next;)if(C=t.prev,I=t.next,g?sh(t,p,m,g):jo(t))a.push(C.i/s),a.push(t.i/s),a.push(I.i/s),ec(t),t=I.next,k=I.next;else if((t=I)===k){w?w===1?Jc(t=uh(Qu(t),a,s),a,s,p,m,g,2):w===2&&lh(t,a,s,p,m,g):Jc(Qu(t),a,s,p,m,g,1);break}}}function jo(t){var a=t.prev,s=t,p=t.next;if(ia(a,s,p)>=0)return!1;for(var m=t.next.next;m!==t.prev;){if(Tl(a.x,a.y,s.x,s.y,p.x,p.y,m.x,m.y)&&ia(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function sh(t,a,s,p){var m=t.prev,g=t,w=t.next;if(ia(m,g,w)>=0)return!1;for(var C=m.x>g.x?m.x>w.x?m.x:w.x:g.x>w.x?g.x:w.x,I=m.y>g.y?m.y>w.y?m.y:w.y:g.y>w.y?g.y:w.y,k=tp(m.x<g.x?m.x<w.x?m.x:w.x:g.x<w.x?g.x:w.x,m.y<g.y?m.y<w.y?m.y:w.y:g.y<w.y?g.y:w.y,a,s,p),D=tp(C,I,a,s,p),B=t.prevZ,V=t.nextZ;B&&B.z>=k&&V&&V.z<=D;){if(B!==t.prev&&B!==t.next&&Tl(m.x,m.y,g.x,g.y,w.x,w.y,B.x,B.y)&&ia(B.prev,B,B.next)>=0||(B=B.prevZ,V!==t.prev&&V!==t.next&&Tl(m.x,m.y,g.x,g.y,w.x,w.y,V.x,V.y)&&ia(V.prev,V,V.next)>=0))return!1;V=V.nextZ}for(;B&&B.z>=k;){if(B!==t.prev&&B!==t.next&&Tl(m.x,m.y,g.x,g.y,w.x,w.y,B.x,B.y)&&ia(B.prev,B,B.next)>=0)return!1;B=B.prevZ}for(;V&&V.z<=D;){if(V!==t.prev&&V!==t.next&&Tl(m.x,m.y,g.x,g.y,w.x,w.y,V.x,V.y)&&ia(V.prev,V,V.next)>=0)return!1;V=V.nextZ}return!0}function uh(t,a,s){var p=t;do{var m=p.prev,g=p.next.next;!Kl(m,g)&&Mf(m,p,p.next,g)&&Ql(m,g)&&Ql(g,m)&&(a.push(m.i/s),a.push(p.i/s),a.push(g.i/s),ec(p),ec(p.next),p=t=g),p=p.next}while(p!==t);return Qu(p)}function lh(t,a,s,p,m,g){var w=t;do{for(var C=w.next.next;C!==w.prev;){if(w.i!==C.i&&Af(w,C)){var I=rp(w,C);return w=Qu(w,w.next),I=Qu(I,I.next),Jc(w,a,s,p,m,g),void Jc(I,a,s,p,m,g)}C=C.next}w=w.next}while(w!==t)}function ch(t,a){return t.x-a.x}function fh(t,a){if(a=function(p,m){var g,w=m,C=p.x,I=p.y,k=-1/0;do{if(I<=w.y&&I>=w.next.y&&w.next.y!==w.y){var D=w.x+(I-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(D<=C&&D>k){if(k=D,D===C){if(I===w.y)return w;if(I===w.next.y)return w.next}g=w.x<w.next.x?w:w.next}}w=w.next}while(w!==m);if(!g)return null;if(C===k)return g;var B,V=g,q=g.x,we=g.y,Ce=1/0;w=g;do C>=w.x&&w.x>=q&&C!==w.x&&Tl(I<we?C:k,I,q,we,I<we?k:C,I,w.x,w.y)&&(B=Math.abs(I-w.y)/(C-w.x),Ql(w,p)&&(B<Ce||B===Ce&&(w.x>g.x||w.x===g.x&&ph(g,w)))&&(g=w,Ce=B)),w=w.next;while(w!==V);return g}(t,a)){var s=rp(a,t);Qu(a,a.next),Qu(s,s.next)}}function ph(t,a){return ia(t.prev,t,a.prev)<0&&ia(a.next,t,t.next)<0}function tp(t,a,s,p,m){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-s)*m)|t<<8))|t<<4))|t<<2))|t<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=32767*(a-p)*m)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function hh(t){var a=t,s=t;do(a.x<s.x||a.x===s.x&&a.y<s.y)&&(s=a),a=a.next;while(a!==t);return s}function Tl(t,a,s,p,m,g,w,C){return(m-w)*(a-C)-(t-w)*(g-C)>=0&&(t-w)*(p-C)-(s-w)*(a-C)>=0&&(s-w)*(g-C)-(m-w)*(p-C)>=0}function Af(t,a){return t.next.i!==a.i&&t.prev.i!==a.i&&!function(s,p){var m=s;do{if(m.i!==s.i&&m.next.i!==s.i&&m.i!==p.i&&m.next.i!==p.i&&Mf(m,m.next,s,p))return!0;m=m.next}while(m!==s);return!1}(t,a)&&(Ql(t,a)&&Ql(a,t)&&function(s,p){var m=s,g=!1,w=(s.x+p.x)/2,C=(s.y+p.y)/2;do m.y>C!=m.next.y>C&&m.next.y!==m.y&&w<(m.next.x-m.x)*(C-m.y)/(m.next.y-m.y)+m.x&&(g=!g),m=m.next;while(m!==s);return g}(t,a)&&(ia(t.prev,t,a.prev)||ia(t,a.prev,a))||Kl(t,a)&&ia(t.prev,t,t.next)>0&&ia(a.prev,a,a.next)>0)}function ia(t,a,s){return(a.y-t.y)*(s.x-a.x)-(a.x-t.x)*(s.y-a.y)}function Kl(t,a){return t.x===a.x&&t.y===a.y}function Mf(t,a,s,p){var m=Jl(ia(t,a,s)),g=Jl(ia(t,a,p)),w=Jl(ia(s,p,t)),C=Jl(ia(s,p,a));return m!==g&&w!==C||!(m!==0||!$l(t,s,a))||!(g!==0||!$l(t,p,a))||!(w!==0||!$l(s,t,p))||!(C!==0||!$l(s,a,p))}function $l(t,a,s){return a.x<=Math.max(t.x,s.x)&&a.x>=Math.min(t.x,s.x)&&a.y<=Math.max(t.y,s.y)&&a.y>=Math.min(t.y,s.y)}function Jl(t){return t>0?1:t<0?-1:0}function Ql(t,a){return ia(t.prev,t,t.next)<0?ia(t,a,t.next)>=0&&ia(t,t.prev,a)>=0:ia(t,a,t.prev)<0||ia(t,t.next,a)<0}function rp(t,a){var s=new wc(t.i,t.x,t.y),p=new wc(a.i,a.x,a.y),m=t.next,g=a.prev;return t.next=a,a.prev=t,s.next=m,m.prev=s,p.next=s,s.prev=p,g.next=p,p.prev=g,p}function Pf(t,a,s,p){var m=new wc(t,a,s);return p?(m.next=p.next,m.prev=p,p.next.prev=m,p.next=m):(m.prev=m,m.next=m),m}function ec(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function wc(t,a,s){this.i=t,this.x=a,this.y=s,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Sc(t,a,s,p){for(var m=0,g=a,w=s-p;g<s;g+=p)m+=(t[w]-t[g])*(t[g+1]+t[w+1]),w=g;return m}function If(t,a,s,p,m){(function g(w,C,I,k,D){for(;k>I;){if(k-I>600){var B=k-I+1,V=C-I+1,q=Math.log(B),we=.5*Math.exp(2*q/3),Ce=.5*Math.sqrt(q*we*(B-we)/B)*(V-B/2<0?-1:1);g(w,C,Math.max(I,Math.floor(C-V*we/B+Ce)),Math.min(k,Math.floor(C+(B-V)*we/B+Ce)),D)}var ze=w[C],Le=I,qe=k;for(el(w,I,C),D(w[k],ze)>0&&el(w,I,k);Le<qe;){for(el(w,Le,qe),Le++,qe--;D(w[Le],ze)<0;)Le++;for(;D(w[qe],ze)>0;)qe--}D(w[I],ze)===0?el(w,I,qe):el(w,++qe,k),qe<=C&&(I=qe+1),C<=qe&&(k=qe-1)}})(t,a,s||0,p||t.length-1,m||Qc)}function el(t,a,s){var p=t[a];t[a]=t[s],t[s]=p}function Qc(t,a){return t<a?-1:t>a?1:0}function tc(t,a){var s=t.length;if(s<=1)return[t];for(var p,m,g=[],w=0;w<s;w++){var C=ur(t[w]);C!==0&&(t[w].area=Math.abs(C),m===void 0&&(m=C<0),m===C<0?(p&&g.push(p),p=[t[w]]):p.push(t[w]))}if(p&&g.push(p),a>1)for(var I=0;I<g.length;I++)g[I].length<=a||(If(g[I],a,1,g[I].length-1,xp),g[I]=g[I].slice(0,a));return g}function xp(t,a){return a.area-t.area}function Pu(t,a,s){for(var p=s.patternDependencies,m=!1,g=0,w=a;g<w.length;g+=1){var C=w[g].paint.get(t+"-pattern");C.isConstant()||(m=!0);var I=C.constantOr(null);I&&(m=!0,p[I.to]=!0,p[I.from]=!0)}return m}function tl(t,a,s,p,m){for(var g=m.patternDependencies,w=0,C=a;w<C.length;w+=1){var I=C[w],k=I.paint.get(t+"-pattern").value;if(k.kind!=="constant"){var D=k.evaluate({zoom:p-1},s,{},m.availableImages),B=k.evaluate({zoom:p},s,{},m.availableImages),V=k.evaluate({zoom:p+1},s,{},m.availableImages);B=B&&B.name?B.name:B,V=V&&V.name?V.name:V,g[D=D&&D.name?D.name:D]=!0,g[B]=!0,g[V]=!0,s.patterns[I.id]={min:D,mid:B,max:V}}}return s}Tf.deviation=function(t,a,s,p){var m=a&&a.length,g=Math.abs(Sc(t,0,m?a[0]*s:t.length,s));if(m)for(var w=0,C=a.length;w<C;w++)g-=Math.abs(Sc(t,a[w]*s,w<C-1?a[w+1]*s:t.length,s));var I=0;for(w=0;w<p.length;w+=3){var k=p[w]*s,D=p[w+1]*s,B=p[w+2]*s;I+=Math.abs((t[k]-t[B])*(t[D+1]-t[k+1])-(t[k]-t[D])*(t[B+1]-t[k+1]))}return g===0&&I===0?0:Math.abs((I-g)/g)},Tf.flatten=function(t){for(var a=t[0][0].length,s={vertices:[],holes:[],dimensions:a},p=0,m=0;m<t.length;m++){for(var g=0;g<t[m].length;g++)for(var w=0;w<a;w++)s.vertices.push(t[m][g][w]);m>0&&s.holes.push(p+=t[m-1].length)}return s},Cl.default=oh;var su=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Yu,this.indexArray=new Mu,this.indexArray2=new Yl,this.programConfigurations=new _n(t.layers,t.zoom),this.segments=new ee,this.segments2=new ee,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};su.prototype.populate=function(t,a,s){this.hasPattern=Pu("fill",this.layers,a);for(var p=this.layers[0].layout.get("fill-sort-key"),m=[],g=0,w=t;g<w.length;g+=1){var C=w[g],I=C.feature,k=C.id,D=C.index,B=C.sourceLayerIndex,V=this.layers[0]._featureFilter.needGeometry,q=_a(I,V);if(this.layers[0]._featureFilter.filter(new Xn(this.zoom),q,s)){var we=p?p.evaluate(q,{},s,a.availableImages):void 0,Ce={id:k,properties:I.properties,type:I.type,sourceLayerIndex:B,index:D,geometry:V?q.geometry:ra(I),patterns:{},sortKey:we};m.push(Ce)}}p&&m.sort(function(or,Nt){return or.sortKey-Nt.sortKey});for(var ze=0,Le=m;ze<Le.length;ze+=1){var qe=Le[ze],st=qe.geometry,St=qe.index,xt=qe.sourceLayerIndex;if(this.hasPattern){var kt=tl("fill",this.layers,qe,this.zoom,a);this.patternFeatures.push(kt)}else this.addFeature(qe,st,St,s,{});a.featureIndex.insert(t[St].feature,st,St,xt,this.index)}},su.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},su.prototype.addFeatures=function(t,a,s){for(var p=0,m=this.patternFeatures;p<m.length;p+=1){var g=m[p];this.addFeature(g,g.geometry,g.index,a,s)}},su.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},su.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},su.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ah),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},su.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},su.prototype.addFeature=function(t,a,s,p,m){for(var g=0,w=tc(a,500);g<w.length;g+=1){for(var C=w[g],I=0,k=0,D=C;k<D.length;k+=1)I+=D[k].length;for(var B=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray),V=B.vertexLength,q=[],we=[],Ce=0,ze=C;Ce<ze.length;Ce+=1){var Le=ze[Ce];if(Le.length!==0){Le!==C[0]&&we.push(q.length/2);var qe=this.segments2.prepareSegment(Le.length,this.layoutVertexArray,this.indexArray2),st=qe.vertexLength;this.layoutVertexArray.emplaceBack(Le[0].x,Le[0].y),this.indexArray2.emplaceBack(st+Le.length-1,st),q.push(Le[0].x),q.push(Le[0].y);for(var St=1;St<Le.length;St++)this.layoutVertexArray.emplaceBack(Le[St].x,Le[St].y),this.indexArray2.emplaceBack(st+St-1,st+St),q.push(Le[St].x),q.push(Le[St].y);qe.vertexLength+=Le.length,qe.primitiveLength+=Le.length}}for(var xt=Cl(q,we),kt=0;kt<xt.length;kt+=3)this.indexArray.emplaceBack(V+xt[kt],V+xt[kt+1],V+xt[kt+2]);B.vertexLength+=I,B.primitiveLength+=xt.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,m,p)},Gr("FillBucket",su,{omit:["layers","patternFeatures"]});var bp=new ya({"fill-sort-key":new Wr(te.layout_fill["fill-sort-key"])}),Yh={paint:new ya({"fill-antialias":new nn(te.paint_fill["fill-antialias"]),"fill-opacity":new Wr(te.paint_fill["fill-opacity"]),"fill-color":new Wr(te.paint_fill["fill-color"]),"fill-outline-color":new Wr(te.paint_fill["fill-outline-color"]),"fill-translate":new nn(te.paint_fill["fill-translate"]),"fill-translate-anchor":new nn(te.paint_fill["fill-translate-anchor"]),"fill-pattern":new _c(te.paint_fill["fill-pattern"])}),layout:bp},qh=function(t){function a(s){t.call(this,s,Yh)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,p){t.prototype.recalculate.call(this,s,p);var m=this.paint._values["fill-outline-color"];m.value.kind==="constant"&&m.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},a.prototype.createBucket=function(s){return new su(s)},a.prototype.queryRadius=function(){return na(this.paint.get("fill-translate"))},a.prototype.queryIntersectsFeature=function(s,p,m,g,w,C,I){return Jo(au(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),C.angle,I),g)},a.prototype.isTileClipped=function(){return!0},a}(ta),Kh=pa([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Al=Ec;function Ec(t,a,s,p,m){this.properties={},this.extent=s,this.type=0,this._pbf=t,this._geometry=-1,this._keys=p,this._values=m,t.readFields(dh,this,a)}function dh(t,a,s){t==1?a.id=s.readVarint():t==2?function(p,m){for(var g=p.readVarint()+p.pos;p.pos<g;){var w=m._keys[p.readVarint()],C=m._values[p.readVarint()];m.properties[w]=C}}(s,a):t==3?a.type=s.readVarint():t==4&&(a._geometry=s.pos)}function vh(t){for(var a,s,p=0,m=0,g=t.length,w=g-1;m<g;w=m++)p+=((s=t[w]).x-(a=t[m]).x)*(a.y+s.y);return p}Ec.types=["Unknown","Point","LineString","Polygon"],Ec.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var a,s=t.readVarint()+t.pos,p=1,m=0,g=0,w=0,C=[];t.pos<s;){if(m<=0){var I=t.readVarint();p=7&I,m=I>>3}if(m--,p===1||p===2)g+=t.readSVarint(),w+=t.readSVarint(),p===1&&(a&&C.push(a),a=[]),a.push(new me(g,w));else{if(p!==7)throw new Error("unknown command "+p);a&&a.push(a[0].clone())}}return a&&C.push(a),C},Ec.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var a=t.readVarint()+t.pos,s=1,p=0,m=0,g=0,w=1/0,C=-1/0,I=1/0,k=-1/0;t.pos<a;){if(p<=0){var D=t.readVarint();s=7&D,p=D>>3}if(p--,s===1||s===2)(m+=t.readSVarint())<w&&(w=m),m>C&&(C=m),(g+=t.readSVarint())<I&&(I=g),g>k&&(k=g);else if(s!==7)throw new Error("unknown command "+s)}return[w,I,C,k]},Ec.prototype.toGeoJSON=function(t,a,s){var p,m,g=this.extent*Math.pow(2,s),w=this.extent*t,C=this.extent*a,I=this.loadGeometry(),k=Ec.types[this.type];function D(q){for(var we=0;we<q.length;we++){var Ce=q[we];q[we]=[360*(Ce.x+w)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(Ce.y+C)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var B=[];for(p=0;p<I.length;p++)B[p]=I[p][0];D(I=B);break;case 2:for(p=0;p<I.length;p++)D(I[p]);break;case 3:for(I=function(q){var we=q.length;if(we<=1)return[q];for(var Ce,ze,Le=[],qe=0;qe<we;qe++){var st=vh(q[qe]);st!==0&&(ze===void 0&&(ze=st<0),ze===st<0?(Ce&&Le.push(Ce),Ce=[q[qe]]):Ce.push(q[qe]))}return Ce&&Le.push(Ce),Le}(I),p=0;p<I.length;p++)for(m=0;m<I[p].length;m++)D(I[p][m])}I.length===1?I=I[0]:k="Multi"+k;var V={type:"Feature",geometry:{type:k,coordinates:I},properties:this.properties};return"id"in this&&(V.id=this.id),V};var mh=wp;function wp(t,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields($h,this,a),this.length=this._features.length}function $h(t,a,s){t===15?a.version=s.readVarint():t===1?a.name=s.readString():t===5?a.extent=s.readVarint():t===2?a._features.push(s.pos):t===3?a._keys.push(s.readString()):t===4&&a._values.push(function(p){for(var m=null,g=p.readVarint()+p.pos;p.pos<g;){var w=p.readVarint()>>3;m=w===1?p.readString():w===2?p.readFloat():w===3?p.readDouble():w===4?p.readVarint64():w===5?p.readVarint():w===6?p.readSVarint():w===7?p.readBoolean():null}return m}(s))}function rl(t,a,s){if(t===3){var p=new mh(s,s.readVarint()+s.pos);p.length&&(a[p.name]=p)}}wp.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var a=this._pbf.readVarint()+this._pbf.pos;return new Al(this._pbf,a,this.extent,this._keys,this._values)};var Cc={VectorTile:function(t,a){this.layers=t.readFields(rl,{},a)},VectorTileFeature:Al,VectorTileLayer:mh},ef=Cc.VectorTileFeature.types,nl=Math.pow(2,13);function Ml(t,a,s,p,m,g,w,C){t.emplaceBack(a,s,2*Math.floor(p*nl)+w,m*nl*2,g*nl*2,Math.round(C))}var fo=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(a){return a.id}),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new eu,this.indexArray=new Mu,this.programConfigurations=new _n(t.layers,t.zoom),this.segments=new ee,this.stateDependentLayerIds=this.layers.filter(function(a){return a.isStateDependent()}).map(function(a){return a.id})};function Of(t,a){return t.x===a.x&&(t.x<0||t.x>8192)||t.y===a.y&&(t.y<0||t.y>8192)}fo.prototype.populate=function(t,a,s){this.features=[],this.hasPattern=Pu("fill-extrusion",this.layers,a);for(var p=0,m=t;p<m.length;p+=1){var g=m[p],w=g.feature,C=g.id,I=g.index,k=g.sourceLayerIndex,D=this.layers[0]._featureFilter.needGeometry,B=_a(w,D);if(this.layers[0]._featureFilter.filter(new Xn(this.zoom),B,s)){var V={id:C,sourceLayerIndex:k,index:I,geometry:D?B.geometry:ra(w),properties:w.properties,type:w.type,patterns:{}};this.hasPattern?this.features.push(tl("fill-extrusion",this.layers,V,this.zoom,a)):this.addFeature(V,V.geometry,I,s,{}),a.featureIndex.insert(w,V.geometry,I,k,this.index,!0)}}},fo.prototype.addFeatures=function(t,a,s){for(var p=0,m=this.features;p<m.length;p+=1){var g=m[p];this.addFeature(g,g.geometry,g.index,a,s)}},fo.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},fo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},fo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},fo.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Kh),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},fo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},fo.prototype.addFeature=function(t,a,s,p,m){for(var g=0,w=tc(a,500);g<w.length;g+=1){for(var C=w[g],I=0,k=0,D=C;k<D.length;k+=1)I+=D[k].length;for(var B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),V=0,q=C;V<q.length;V+=1){var we=q[V];if(we.length!==0&&!((oi=we).every(function(Rn){return Rn.x<0})||oi.every(function(Rn){return Rn.x>8192})||oi.every(function(Rn){return Rn.y<0})||oi.every(function(Rn){return Rn.y>8192})))for(var Ce=0,ze=0;ze<we.length;ze++){var Le=we[ze];if(ze>=1){var qe=we[ze-1];if(!Of(Le,qe)){B.vertexLength+4>ee.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var st=Le.sub(qe)._perp()._unit(),St=qe.dist(Le);Ce+St>32768&&(Ce=0),Ml(this.layoutVertexArray,Le.x,Le.y,st.x,st.y,0,0,Ce),Ml(this.layoutVertexArray,Le.x,Le.y,st.x,st.y,0,1,Ce),Ml(this.layoutVertexArray,qe.x,qe.y,st.x,st.y,0,0,Ce+=St),Ml(this.layoutVertexArray,qe.x,qe.y,st.x,st.y,0,1,Ce);var xt=B.vertexLength;this.indexArray.emplaceBack(xt,xt+2,xt+1),this.indexArray.emplaceBack(xt+1,xt+2,xt+3),B.vertexLength+=4,B.primitiveLength+=2}}}}if(B.vertexLength+I>ee.MAX_VERTEX_ARRAY_LENGTH&&(B=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),ef[t.type]==="Polygon"){for(var kt=[],or=[],Nt=B.vertexLength,un=0,kr=C;un<kr.length;un+=1){var cn=kr[un];if(cn.length!==0){cn!==C[0]&&or.push(kt.length/2);for(var Br=0;Br<cn.length;Br++){var Kn=cn[Br];Ml(this.layoutVertexArray,Kn.x,Kn.y,0,0,1,1,0),kt.push(Kn.x),kt.push(Kn.y)}}}for(var En=Cl(kt,or),Qr=0;Qr<En.length;Qr+=3)this.indexArray.emplaceBack(Nt+En[Qr],Nt+En[Qr+2],Nt+En[Qr+1]);B.primitiveLength+=En.length/3,B.vertexLength+=I}}var oi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,m,p)},Gr("FillExtrusionBucket",fo,{omit:["layers","features"]});var Sp={paint:new ya({"fill-extrusion-opacity":new nn(te["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Wr(te["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new nn(te["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new nn(te["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _c(te["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Wr(te["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Wr(te["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new nn(te["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Qo=function(t){function a(s){t.call(this,s,Sp)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.createBucket=function(s){return new fo(s)},a.prototype.queryRadius=function(){return na(this.paint.get("fill-extrusion-translate"))},a.prototype.is3D=function(){return!0},a.prototype.queryIntersectsFeature=function(s,p,m,g,w,C,I,k){var D=au(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),C.angle,I),B=this.paint.get("fill-extrusion-height").evaluate(p,m),V=this.paint.get("fill-extrusion-base").evaluate(p,m),q=function(Ce,ze,Le,qe){for(var st=[],St=0,xt=Ce;St<xt.length;St+=1){var kt=xt[St],or=[kt.x,kt.y,0,1];ou(or,or,ze),st.push(new me(or[0]/or[3],or[1]/or[3]))}return st}(D,k),we=function(Ce,ze,Le,qe){for(var st=[],St=[],xt=qe[8]*ze,kt=qe[9]*ze,or=qe[10]*ze,Nt=qe[11]*ze,un=qe[8]*Le,kr=qe[9]*Le,cn=qe[10]*Le,Br=qe[11]*Le,Kn=0,En=Ce;Kn<En.length;Kn+=1){for(var Qr=[],oi=[],Rn=0,gi=En[Kn];Rn<gi.length;Rn+=1){var fn=gi[Rn],Ci=fn.x,aa=fn.y,Za=qe[0]*Ci+qe[4]*aa+qe[12],wa=qe[1]*Ci+qe[5]*aa+qe[13],oa=qe[2]*Ci+qe[6]*aa+qe[14],ka=qe[3]*Ci+qe[7]*aa+qe[15],mo=oa+or,yo=ka+Nt,hs=Za+un,Co=wa+kr,ts=oa+cn,Ja=ka+Br,go=new me((Za+xt)/yo,(wa+kt)/yo);go.z=mo/yo,Qr.push(go);var ci=new me(hs/Ja,Co/Ja);ci.z=ts/Ja,oi.push(ci)}st.push(Qr),St.push(oi)}return[st,St]}(g,V,B,k);return function(Ce,ze,Le){var qe=1/0;Jo(Le,ze)&&(qe=Pa(Le,ze[0]));for(var st=0;st<ze.length;st++)for(var St=ze[st],xt=Ce[st],kt=0;kt<St.length-1;kt++){var or=St[kt],Nt=[or,St[kt+1],xt[kt+1],xt[kt],or];Ts(Le,Nt)&&(qe=Math.min(qe,Pa(Le,Nt)))}return qe!==1/0&&qe}(we[0],we[1],q)},a}(ta);function As(t,a){return t.x*a.x+t.y*a.y}function Pa(t,a){if(t.length===1){for(var s,p=0,m=a[p++];!s||m.equals(s);)if(!(s=a[p++]))return 1/0;for(;p<a.length;p++){var g=a[p],w=t[0],C=s.sub(m),I=g.sub(m),k=w.sub(m),D=As(C,C),B=As(C,I),V=As(I,I),q=As(k,C),we=As(k,I),Ce=D*V-B*B,ze=(V*q-B*we)/Ce,Le=(D*we-B*q)/Ce,qe=m.z*(1-ze-Le)+s.z*ze+g.z*Le;if(isFinite(qe))return qe}return 1/0}for(var st=1/0,St=0,xt=a;St<xt.length;St+=1)st=Math.min(st,xt[St].z);return st}var Vo=pa([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Ep=pa([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,yh=Cc.VectorTileFeature.types,Jh=Math.cos(Math.PI/180*37.5),gh=Math.pow(2,14)/.5,Go=function(t){var a=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(s){return s.id}),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(s){a.gradients[s.id]={}}),this.layoutVertexArray=new zo,this.layoutVertexArray2=new Zo,this.indexArray=new Mu,this.programConfigurations=new _n(t.layers,t.zoom),this.segments=new ee,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(s){return s.isStateDependent()}).map(function(s){return s.id})};Go.prototype.populate=function(t,a,s){this.hasPattern=Pu("line",this.layers,a);for(var p=this.layers[0].layout.get("line-sort-key"),m=[],g=0,w=t;g<w.length;g+=1){var C=w[g],I=C.feature,k=C.id,D=C.index,B=C.sourceLayerIndex,V=this.layers[0]._featureFilter.needGeometry,q=_a(I,V);if(this.layers[0]._featureFilter.filter(new Xn(this.zoom),q,s)){var we=p?p.evaluate(q,{},s):void 0,Ce={id:k,properties:I.properties,type:I.type,sourceLayerIndex:B,index:D,geometry:V?q.geometry:ra(I),patterns:{},sortKey:we};m.push(Ce)}}p&&m.sort(function(or,Nt){return or.sortKey-Nt.sortKey});for(var ze=0,Le=m;ze<Le.length;ze+=1){var qe=Le[ze],st=qe.geometry,St=qe.index,xt=qe.sourceLayerIndex;if(this.hasPattern){var kt=tl("line",this.layers,qe,this.zoom,a);this.patternFeatures.push(kt)}else this.addFeature(qe,st,St,s,{});a.featureIndex.insert(t[St].feature,st,St,xt,this.index)}},Go.prototype.update=function(t,a,s){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,a,this.stateDependentLayers,s)},Go.prototype.addFeatures=function(t,a,s){for(var p=0,m=this.patternFeatures;p<m.length;p+=1){var g=m[p];this.addFeature(g,g.geometry,g.index,a,s)}},Go.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Go.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Go.prototype.upload=function(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Ep)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Vo),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Go.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Go.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Go.prototype.addFeature=function(t,a,s,p,m){var g=this.layers[0].layout,w=g.get("line-join").evaluate(t,{}),C=g.get("line-cap"),I=g.get("line-miter-limit"),k=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var D=0,B=a;D<B.length;D+=1)this.addLine(B[D],t,w,C,I,k);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,s,m,p)},Go.prototype.addLine=function(t,a,s,p,m,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var w=0;w<t.length-1;w++)this.totalDistance+=t[w].dist(t[w+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var C=yh[a.type]==="Polygon",I=t.length;I>=2&&t[I-1].equals(t[I-2]);)I--;for(var k=0;k<I-1&&t[k].equals(t[k+1]);)k++;if(!(I<(C?3:2))){s==="bevel"&&(m=1.05);var D,B=this.overscaling<=16?122880/(512*this.overscaling):0,V=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray),q=void 0,we=void 0,Ce=void 0,ze=void 0;this.e1=this.e2=-1,C&&(ze=t[k].sub(D=t[I-2])._unit()._perp());for(var Le=k;Le<I;Le++)if(!(we=Le===I-1?C?t[k+1]:void 0:t[Le+1])||!t[Le].equals(we)){ze&&(Ce=ze),D&&(q=D),D=t[Le],ze=we?we.sub(D)._unit()._perp():Ce;var qe=(Ce=Ce||ze).add(ze);qe.x===0&&qe.y===0||qe._unit();var st=Ce.x*ze.x+Ce.y*ze.y,St=qe.x*ze.x+qe.y*ze.y,xt=St!==0?1/St:1/0,kt=2*Math.sqrt(2-2*St),or=St<Jh&&q&&we,Nt=Ce.x*ze.y-Ce.y*ze.x>0;if(or&&Le>k){var un=D.dist(q);if(un>2*B){var kr=D.sub(D.sub(q)._mult(B/un)._round());this.updateDistance(q,kr),this.addCurrentVertex(kr,Ce,0,0,V),q=kr}}var cn=q&&we,Br=cn?s:C?"butt":p;if(cn&&Br==="round"&&(xt<g?Br="miter":xt<=2&&(Br="fakeround")),Br==="miter"&&xt>m&&(Br="bevel"),Br==="bevel"&&(xt>2&&(Br="flipbevel"),xt<m&&(Br="miter")),q&&this.updateDistance(q,D),Br==="miter")qe._mult(xt),this.addCurrentVertex(D,qe,0,0,V);else if(Br==="flipbevel"){if(xt>100)qe=ze.mult(-1);else{var Kn=xt*Ce.add(ze).mag()/Ce.sub(ze).mag();qe._perp()._mult(Kn*(Nt?-1:1))}this.addCurrentVertex(D,qe,0,0,V),this.addCurrentVertex(D,qe.mult(-1),0,0,V)}else if(Br==="bevel"||Br==="fakeround"){var En=-Math.sqrt(xt*xt-1),Qr=Nt?En:0,oi=Nt?0:En;if(q&&this.addCurrentVertex(D,Ce,Qr,oi,V),Br==="fakeround")for(var Rn=Math.round(180*kt/Math.PI/20),gi=1;gi<Rn;gi++){var fn=gi/Rn;if(fn!==.5){var Ci=fn-.5;fn+=fn*Ci*(fn-1)*((1.0904+st*(st*(3.55645-1.43519*st)-3.2452))*Ci*Ci+(.848013+st*(.215638*st-1.06021)))}var aa=ze.sub(Ce)._mult(fn)._add(Ce)._unit()._mult(Nt?-1:1);this.addHalfVertex(D,aa.x,aa.y,!1,Nt,0,V)}we&&this.addCurrentVertex(D,ze,-Qr,-oi,V)}else if(Br==="butt")this.addCurrentVertex(D,qe,0,0,V);else if(Br==="square"){var Za=q?1:-1;this.addCurrentVertex(D,qe,Za,Za,V)}else Br==="round"&&(q&&(this.addCurrentVertex(D,Ce,0,0,V),this.addCurrentVertex(D,Ce,1,1,V,!0)),we&&(this.addCurrentVertex(D,ze,-1,-1,V,!0),this.addCurrentVertex(D,ze,0,0,V)));if(or&&Le<I-1){var wa=D.dist(we);if(wa>2*B){var oa=D.add(we.sub(D)._mult(B/wa)._round());this.updateDistance(D,oa),this.addCurrentVertex(oa,ze,0,0,V),D=oa}}}}},Go.prototype.addCurrentVertex=function(t,a,s,p,m,g){g===void 0&&(g=!1);var w=a.y*p-a.x,C=-a.y-a.x*p;this.addHalfVertex(t,a.x+a.y*s,a.y-a.x*s,g,!1,s,m),this.addHalfVertex(t,w,C,g,!0,-p,m),this.distance>gh/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(t,a,s,p,m,g))},Go.prototype.addHalfVertex=function(t,a,s,p,m,g,w){var C=.5*(this.lineClips?this.scaledDistance*(gh-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(p?1:0),(t.y<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*s)+128,1+(g===0?0:g<0?-1:1)|(63&C)<<2,C>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var I=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),w.primitiveLength++),m?this.e2=I:this.e1=I},Go.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Go.prototype.updateDistance=function(t,a){this.distance+=t.dist(a),this.updateScaledDistance()},Gr("LineBucket",Go,{omit:["layers","patternFeatures"]});var Cp=new ya({"line-cap":new nn(te.layout_line["line-cap"]),"line-join":new Wr(te.layout_line["line-join"]),"line-miter-limit":new nn(te.layout_line["line-miter-limit"]),"line-round-limit":new nn(te.layout_line["line-round-limit"]),"line-sort-key":new Wr(te.layout_line["line-sort-key"])}),Tp={paint:new ya({"line-opacity":new Wr(te.paint_line["line-opacity"]),"line-color":new Wr(te.paint_line["line-color"]),"line-translate":new nn(te.paint_line["line-translate"]),"line-translate-anchor":new nn(te.paint_line["line-translate-anchor"]),"line-width":new Wr(te.paint_line["line-width"]),"line-gap-width":new Wr(te.paint_line["line-gap-width"]),"line-offset":new Wr(te.paint_line["line-offset"]),"line-blur":new Wr(te.paint_line["line-blur"]),"line-dasharray":new wo(te.paint_line["line-dasharray"]),"line-pattern":new _c(te.paint_line["line-pattern"]),"line-gradient":new Ra(te.paint_line["line-gradient"])}),layout:Cp},Ap=new(function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.possiblyEvaluate=function(s,p){return p=new Xn(Math.floor(p.zoom),{now:p.now,fadeDuration:p.fadeDuration,zoomHistory:p.zoomHistory,transition:p.transition}),t.prototype.possiblyEvaluate.call(this,s,p)},a.prototype.evaluate=function(s,p,m,g){return p=Ht({},p,{zoom:Math.floor(p.zoom)}),t.prototype.evaluate.call(this,s,p,m,g)},a}(Wr))(Tp.paint.properties["line-width"].specification);Ap.useIntegerZoom=!0;var Mp=function(t){function a(s){t.call(this,s,Tp),this.gradientVersion=0}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype._handleSpecialPaintPropertyUpdate=function(s){s==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Po,this.gradientVersion=(this.gradientVersion+1)%J)},a.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},a.prototype.recalculate=function(s,p){t.prototype.recalculate.call(this,s,p),this.paint._values["line-floorwidth"]=Ap.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)},a.prototype.createBucket=function(s){return new Go(s)},a.prototype.queryRadius=function(s){var p=s,m=Pp(Ba("line-width",this,p),Ba("line-gap-width",this,p)),g=Ba("line-offset",this,p);return m/2+Math.abs(g)+na(this.paint.get("line-translate"))},a.prototype.queryIntersectsFeature=function(s,p,m,g,w,C,I){var k=au(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),C.angle,I),D=I/2*Pp(this.paint.get("line-width").evaluate(p,m),this.paint.get("line-gap-width").evaluate(p,m)),B=this.paint.get("line-offset").evaluate(p,m);return B&&(g=function(V,q){for(var we=[],Ce=new me(0,0),ze=0;ze<V.length;ze++){for(var Le=V[ze],qe=[],st=0;st<Le.length;st++){var St=Le[st],xt=Le[st+1],kt=st===0?Ce:St.sub(Le[st-1])._unit()._perp(),or=st===Le.length-1?Ce:xt.sub(St)._unit()._perp(),Nt=kt._add(or)._unit();Nt._mult(1/(Nt.x*or.x+Nt.y*or.y)),qe.push(Nt._mult(q)._add(St))}we.push(qe)}return we}(g,B*I)),function(V,q,we){for(var Ce=0;Ce<q.length;Ce++){var ze=q[Ce];if(V.length>=3){for(var Le=0;Le<ze.length;Le++)if(Bs(V,ze[Le]))return!0}if(Lo(V,ze,we))return!0}return!1}(k,g,D)},a.prototype.isTileClipped=function(){return!0},a}(ta);function Pp(t,a){return a>0?a+2*t:t}var Qh=pa([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_h=pa([{name:"a_projected_pos",components:3,type:"Float32"}],4),Ip=(pa([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),pa([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Op=(pa([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),pa([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),xh=pa([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function bh(t,a,s){return t.sections.forEach(function(p){p.text=function(m,g,w){var C=g.layout.get("text-transform").evaluate(w,{});return C==="uppercase"?m=m.toLocaleUpperCase():C==="lowercase"&&(m=m.toLocaleLowerCase()),Ss.applyArabicShaping&&(m=Ss.applyArabicShaping(m)),m}(p.text,a,s)}),t}pa([{name:"triangle",components:3,type:"Uint16"}]),pa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),pa([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),pa([{type:"Float32",name:"offsetX"}]),pa([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Tc={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},kp=function(t,a,s,p,m){var g,w,C=8*m-p-1,I=(1<<C)-1,k=I>>1,D=-7,B=s?m-1:0,V=s?-1:1,q=t[a+B];for(B+=V,g=q&(1<<-D)-1,q>>=-D,D+=C;D>0;g=256*g+t[a+B],B+=V,D-=8);for(w=g&(1<<-D)-1,g>>=-D,D+=p;D>0;w=256*w+t[a+B],B+=V,D-=8);if(g===0)g=1-k;else{if(g===I)return w?NaN:1/0*(q?-1:1);w+=Math.pow(2,p),g-=k}return(q?-1:1)*w*Math.pow(2,g-p)},L=function(t,a,s,p,m,g){var w,C,I,k=8*g-m-1,D=(1<<k)-1,B=D>>1,V=m===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=p?0:g-1,we=p?1:-1,Ce=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(C=isNaN(a)?1:0,w=D):(w=Math.floor(Math.log(a)/Math.LN2),a*(I=Math.pow(2,-w))<1&&(w--,I*=2),(a+=w+B>=1?V/I:V*Math.pow(2,1-B))*I>=2&&(w++,I/=2),w+B>=D?(C=0,w=D):w+B>=1?(C=(a*I-1)*Math.pow(2,m),w+=B):(C=a*Math.pow(2,B-1)*Math.pow(2,m),w=0));m>=8;t[s+q]=255&C,q+=we,C/=256,m-=8);for(w=w<<m|C,k+=m;k>0;t[s+q]=255&w,q+=we,w/=256,k-=8);t[s+q-we]|=128*Ce},ae=ge;function ge(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}ge.Varint=0,ge.Fixed64=1,ge.Bytes=2,ge.Fixed32=5;var gt=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Zt(t){return t.type===ge.Bytes?t.readVarint()+t.pos:t.pos+1}function ht(t,a,s){return s?4294967296*a+(t>>>0):4294967296*(a>>>0)+(t>>>0)}function Pt(t,a,s){var p=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));s.realloc(p);for(var m=s.pos-1;m>=t;m--)s.buf[m+p]=s.buf[m]}function rr(t,a){for(var s=0;s<t.length;s++)a.writeVarint(t[s])}function ar(t,a){for(var s=0;s<t.length;s++)a.writeSVarint(t[s])}function fr(t,a){for(var s=0;s<t.length;s++)a.writeFloat(t[s])}function ir(t,a){for(var s=0;s<t.length;s++)a.writeDouble(t[s])}function vr(t,a){for(var s=0;s<t.length;s++)a.writeBoolean(t[s])}function Tr(t,a){for(var s=0;s<t.length;s++)a.writeFixed32(t[s])}function er(t,a){for(var s=0;s<t.length;s++)a.writeSFixed32(t[s])}function br(t,a){for(var s=0;s<t.length;s++)a.writeFixed64(t[s])}function et(t,a){for(var s=0;s<t.length;s++)a.writeSFixed64(t[s])}function Tt(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+16777216*t[a+3]}function nr(t,a,s){t[s]=a,t[s+1]=a>>>8,t[s+2]=a>>>16,t[s+3]=a>>>24}function Or(t,a){return(t[a]|t[a+1]<<8|t[a+2]<<16)+(t[a+3]<<24)}function Wt(t,a,s){t===1&&s.readMessage(Zr,a)}function Zr(t,a,s){if(t===3){var p=s.readMessage(Qt,{}),m=p.width,g=p.height,w=p.left,C=p.top,I=p.advance;a.push({id:p.id,bitmap:new Zs({width:m+6,height:g+6},p.bitmap),metrics:{width:m,height:g,left:w,top:C,advance:I}})}}function Qt(t,a,s){t===1?a.id=s.readVarint():t===2?a.bitmap=s.readBytes():t===3?a.width=s.readVarint():t===4?a.height=s.readVarint():t===5?a.left=s.readSVarint():t===6?a.top=s.readSVarint():t===7&&(a.advance=s.readVarint())}function Sr(t){for(var a=0,s=0,p=0,m=t;p<m.length;p+=1){var g=m[p];a+=g.w*g.h,s=Math.max(s,g.w)}t.sort(function(Ce,ze){return ze.h-Ce.h});for(var w=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),s),h:1/0}],C=0,I=0,k=0,D=t;k<D.length;k+=1)for(var B=D[k],V=w.length-1;V>=0;V--){var q=w[V];if(!(B.w>q.w||B.h>q.h)){if(B.x=q.x,B.y=q.y,I=Math.max(I,B.y+B.h),C=Math.max(C,B.x+B.w),B.w===q.w&&B.h===q.h){var we=w.pop();V<w.length&&(w[V]=we)}else B.h===q.h?(q.x+=B.w,q.w-=B.w):B.w===q.w?(q.y+=B.h,q.h-=B.h):(w.push({x:q.x+B.w,y:q.y,w:q.w-B.w,h:B.h}),q.y+=B.h,q.h-=B.h);break}}return{w:C,h:I,fill:a/(C*I)||0}}ge.prototype={destroy:function(){this.buf=null},readFields:function(t,a,s){for(s=s||this.length;this.pos<s;){var p=this.readVarint(),m=p>>3,g=this.pos;this.type=7&p,t(m,a,this),this.pos===g&&this.skip(p)}return a},readMessage:function(t,a){return this.readFields(t,a,this.readVarint()+this.pos)},readFixed32:function(){var t=Tt(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Or(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Tt(this.buf,this.pos)+4294967296*Tt(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=Tt(this.buf,this.pos)+4294967296*Or(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=kp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=kp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var a,s,p=this.buf;return a=127&(s=p[this.pos++]),s<128?a:(a|=(127&(s=p[this.pos++]))<<7,s<128?a:(a|=(127&(s=p[this.pos++]))<<14,s<128?a:(a|=(127&(s=p[this.pos++]))<<21,s<128?a:function(m,g,w){var C,I,k=w.buf;if(C=(112&(I=k[w.pos++]))>>4,I<128||(C|=(127&(I=k[w.pos++]))<<3,I<128)||(C|=(127&(I=k[w.pos++]))<<10,I<128)||(C|=(127&(I=k[w.pos++]))<<17,I<128)||(C|=(127&(I=k[w.pos++]))<<24,I<128)||(C|=(1&(I=k[w.pos++]))<<31,I<128))return ht(m,C,g);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(s=p[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,a=this.pos;return this.pos=t,t-a>=12&&gt?function(s,p,m){return gt.decode(s.subarray(p,m))}(this.buf,a,t):function(s,p,m){for(var g="",w=p;w<m;){var C,I,k,D=s[w],B=null,V=D>239?4:D>223?3:D>191?2:1;if(w+V>m)break;V===1?D<128&&(B=D):V===2?(192&(C=s[w+1]))==128&&(B=(31&D)<<6|63&C)<=127&&(B=null):V===3?(I=s[w+2],(192&(C=s[w+1]))==128&&(192&I)==128&&((B=(15&D)<<12|(63&C)<<6|63&I)<=2047||B>=55296&&B<=57343)&&(B=null)):V===4&&(I=s[w+2],k=s[w+3],(192&(C=s[w+1]))==128&&(192&I)==128&&(192&k)==128&&((B=(15&D)<<18|(63&C)<<12|(63&I)<<6|63&k)<=65535||B>=1114112)&&(B=null)),B===null?(B=65533,V=1):B>65535&&(B-=65536,g+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),g+=String.fromCharCode(B),w+=V}return g}(this.buf,a,t)},readBytes:function(){var t=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,t);return this.pos=t,a},readPackedVarint:function(t,a){if(this.type!==ge.Bytes)return t.push(this.readVarint(a));var s=Zt(this);for(t=t||[];this.pos<s;)t.push(this.readVarint(a));return t},readPackedSVarint:function(t){if(this.type!==ge.Bytes)return t.push(this.readSVarint());var a=Zt(this);for(t=t||[];this.pos<a;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==ge.Bytes)return t.push(this.readBoolean());var a=Zt(this);for(t=t||[];this.pos<a;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==ge.Bytes)return t.push(this.readFloat());var a=Zt(this);for(t=t||[];this.pos<a;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==ge.Bytes)return t.push(this.readDouble());var a=Zt(this);for(t=t||[];this.pos<a;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==ge.Bytes)return t.push(this.readFixed32());var a=Zt(this);for(t=t||[];this.pos<a;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==ge.Bytes)return t.push(this.readSFixed32());var a=Zt(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==ge.Bytes)return t.push(this.readFixed64());var a=Zt(this);for(t=t||[];this.pos<a;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==ge.Bytes)return t.push(this.readSFixed64());var a=Zt(this);for(t=t||[];this.pos<a;)t.push(this.readSFixed64());return t},skip:function(t){var a=7&t;if(a===ge.Varint)for(;this.buf[this.pos++]>127;);else if(a===ge.Bytes)this.pos=this.readVarint()+this.pos;else if(a===ge.Fixed32)this.pos+=4;else{if(a!==ge.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(t,a){this.writeVarint(t<<3|a)},realloc:function(t){for(var a=this.length||16;a<this.pos+t;)a*=2;if(a!==this.length){var s=new Uint8Array(a);s.set(this.buf),this.buf=s,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),nr(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),nr(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),nr(this.buf,-1&t,this.pos),nr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),nr(this.buf,-1&t,this.pos),nr(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(a,s){var p,m;if(a>=0?(p=a%4294967296|0,m=a/4294967296|0):(m=~(-a/4294967296),4294967295^(p=~(-a%4294967296))?p=p+1|0:(p=0,m=m+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");s.realloc(10),function(g,w,C){C.buf[C.pos++]=127&g|128,g>>>=7,C.buf[C.pos++]=127&g|128,g>>>=7,C.buf[C.pos++]=127&g|128,g>>>=7,C.buf[C.pos++]=127&g|128,C.buf[C.pos]=127&(g>>>=7)}(p,0,s),function(g,w){var C=(7&g)<<4;w.buf[w.pos++]|=C|((g>>>=3)?128:0),g&&(w.buf[w.pos++]=127&g|((g>>>=7)?128:0),g&&(w.buf[w.pos++]=127&g|((g>>>=7)?128:0),g&&(w.buf[w.pos++]=127&g|((g>>>=7)?128:0),g&&(w.buf[w.pos++]=127&g|((g>>>=7)?128:0),g&&(w.buf[w.pos++]=127&g)))))}(m,s)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var a=this.pos;this.pos=function(p,m,g){for(var w,C,I=0;I<m.length;I++){if((w=m.charCodeAt(I))>55295&&w<57344){if(!C){w>56319||I+1===m.length?(p[g++]=239,p[g++]=191,p[g++]=189):C=w;continue}if(w<56320){p[g++]=239,p[g++]=191,p[g++]=189,C=w;continue}w=C-55296<<10|w-56320|65536,C=null}else C&&(p[g++]=239,p[g++]=191,p[g++]=189,C=null);w<128?p[g++]=w:(w<2048?p[g++]=w>>6|192:(w<65536?p[g++]=w>>12|224:(p[g++]=w>>18|240,p[g++]=w>>12&63|128),p[g++]=w>>6&63|128),p[g++]=63&w|128)}return g}(this.buf,t,this.pos);var s=this.pos-a;s>=128&&Pt(a,s,this),this.pos=a-1,this.writeVarint(s),this.pos+=s},writeFloat:function(t){this.realloc(4),L(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),L(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var a=t.length;this.writeVarint(a),this.realloc(a);for(var s=0;s<a;s++)this.buf[this.pos++]=t[s]},writeRawMessage:function(t,a){this.pos++;var s=this.pos;t(a,this);var p=this.pos-s;p>=128&&Pt(s,p,this),this.pos=s-1,this.writeVarint(p),this.pos+=p},writeMessage:function(t,a,s){this.writeTag(t,ge.Bytes),this.writeRawMessage(a,s)},writePackedVarint:function(t,a){a.length&&this.writeMessage(t,rr,a)},writePackedSVarint:function(t,a){a.length&&this.writeMessage(t,ar,a)},writePackedBoolean:function(t,a){a.length&&this.writeMessage(t,vr,a)},writePackedFloat:function(t,a){a.length&&this.writeMessage(t,fr,a)},writePackedDouble:function(t,a){a.length&&this.writeMessage(t,ir,a)},writePackedFixed32:function(t,a){a.length&&this.writeMessage(t,Tr,a)},writePackedSFixed32:function(t,a){a.length&&this.writeMessage(t,er,a)},writePackedFixed64:function(t,a){a.length&&this.writeMessage(t,br,a)},writePackedSFixed64:function(t,a){a.length&&this.writeMessage(t,et,a)},writeBytesField:function(t,a){this.writeTag(t,ge.Bytes),this.writeBytes(a)},writeFixed32Field:function(t,a){this.writeTag(t,ge.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(t,a){this.writeTag(t,ge.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(t,a){this.writeTag(t,ge.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(t,a){this.writeTag(t,ge.Fixed64),this.writeSFixed64(a)},writeVarintField:function(t,a){this.writeTag(t,ge.Varint),this.writeVarint(a)},writeSVarintField:function(t,a){this.writeTag(t,ge.Varint),this.writeSVarint(a)},writeStringField:function(t,a){this.writeTag(t,ge.Bytes),this.writeString(a)},writeFloatField:function(t,a){this.writeTag(t,ge.Fixed32),this.writeFloat(a)},writeDoubleField:function(t,a){this.writeTag(t,ge.Fixed64),this.writeDouble(a)},writeBooleanField:function(t,a){this.writeVarintField(t,Boolean(a))}};var Xt=function(t,a){var s=a.pixelRatio,p=a.version,m=a.stretchX,g=a.stretchY,w=a.content;this.paddedRect=t,this.pixelRatio=s,this.stretchX=m,this.stretchY=g,this.content=w,this.version=p},mr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};mr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},mr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},mr.tlbr.get=function(){return this.tl.concat(this.br)},mr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(Xt.prototype,mr);var an=function(t,a){var s={},p={};this.haveRenderCallbacks=[];var m=[];this.addImages(t,s,m),this.addImages(a,p,m);var g=Sr(m),w=new qa({width:g.w||1,height:g.h||1});for(var C in t){var I=t[C],k=s[C].paddedRect;qa.copy(I.data,w,{x:0,y:0},{x:k.x+1,y:k.y+1},I.data)}for(var D in a){var B=a[D],V=p[D].paddedRect,q=V.x+1,we=V.y+1,Ce=B.data.width,ze=B.data.height;qa.copy(B.data,w,{x:0,y:0},{x:q,y:we},B.data),qa.copy(B.data,w,{x:0,y:ze-1},{x:q,y:we-1},{width:Ce,height:1}),qa.copy(B.data,w,{x:0,y:0},{x:q,y:we+ze},{width:Ce,height:1}),qa.copy(B.data,w,{x:Ce-1,y:0},{x:q-1,y:we},{width:1,height:ze}),qa.copy(B.data,w,{x:0,y:0},{x:q+Ce,y:we},{width:1,height:ze})}this.image=w,this.iconPositions=s,this.patternPositions=p};an.prototype.addImages=function(t,a,s){for(var p in t){var m=t[p],g={x:0,y:0,w:m.data.width+2,h:m.data.height+2};s.push(g),a[p]=new Xt(g,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(p)}},an.prototype.patchUpdatedImages=function(t,a){for(var s in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[s],t.getImage(s),a),this.patchUpdatedImage(this.patternPositions[s],t.getImage(s),a)},an.prototype.patchUpdatedImage=function(t,a,s){if(t&&a&&t.version!==a.version){t.version=a.version;var p=t.tl;s.update(a.data,void 0,{x:p[0],y:p[1]})}},Gr("ImagePosition",Xt),Gr("ImageAtlas",an);var hn={horizontal:1,vertical:2,horizontalOnly:3},wr=function(){this.scale=1,this.fontStack="",this.imageName=null};wr.forText=function(t,a){var s=new wr;return s.scale=t||1,s.fontStack=a,s},wr.forImage=function(t){var a=new wr;return a.imageName=t,a};var Kt=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Vt(t,a,s,p,m,g,w,C,I,k,D,B,V,q,we,Ce){var ze,Le=Kt.fromFeature(t,m);B===hn.vertical&&Le.verticalizePunctuation();var qe=Ss.processBidirectionalText,st=Ss.processStyledBidirectionalText;if(qe&&Le.sections.length===1){ze=[];for(var St=0,xt=qe(Le.toString(),yi(Le,k,g,a,p,q,we));St<xt.length;St+=1){var kt=xt[St],or=new Kt;or.text=kt,or.sections=Le.sections;for(var Nt=0;Nt<kt.length;Nt++)or.sectionIndex.push(0);ze.push(or)}}else if(st){ze=[];for(var un=0,kr=st(Le.text,Le.sectionIndex,yi(Le,k,g,a,p,q,we));un<kr.length;un+=1){var cn=kr[un],Br=new Kt;Br.text=cn[0],Br.sectionIndex=cn[1],Br.sections=Le.sections,ze.push(Br)}}else ze=function(Qr,oi){for(var Rn=[],gi=Qr.text,fn=0,Ci=0,aa=oi;Ci<aa.length;Ci+=1){var Za=aa[Ci];Rn.push(Qr.substring(fn,Za)),fn=Za}return fn<gi.length&&Rn.push(Qr.substring(fn,gi.length)),Rn}(Le,yi(Le,k,g,a,p,q,we));var Kn=[],En={positionedLines:Kn,text:Le.toString(),top:D[1],bottom:D[1],left:D[0],right:D[0],writingMode:B,iconsInText:!1,verticalizable:!1};return function(Qr,oi,Rn,gi,fn,Ci,aa,Za,wa,oa,ka,mo){for(var yo=0,hs=-17,Co=0,ts=0,Ja=Za==="right"?1:Za==="left"?0:.5,go=0,ci=0,Zi=fn;ci<Zi.length;ci+=1){var Fi=Zi[ci];Fi.trim();var _i=Fi.getMaxScale(),ds=24*(_i-1),Do={positionedGlyphs:[],lineOffset:0};Qr.positionedLines[go]=Do;var Yi=Do.positionedGlyphs,Ua=0;if(Fi.length()){for(var Ho=0;Ho<Fi.length();Ho++){var Ti=Fi.getSection(Ho),Mc=Fi.getSectionIndex(Ho),Gs=Fi.getCharCode(Ho),Pl=0,ja=null,rc=null,Iu=null,ip=24,Nf=!(wa===hn.horizontal||!ka&&!gl(Gs)||ka&&(bn[Gs]||(Ou=Gs,dr.Arabic(Ou)||dr["Arabic Supplement"](Ou)||dr["Arabic Extended-A"](Ou)||dr["Arabic Presentation Forms-A"](Ou)||dr["Arabic Presentation Forms-B"](Ou))));if(Ti.imageName){var ap=gi[Ti.imageName];if(!ap)continue;Iu=Ti.imageName,Qr.iconsInText=Qr.iconsInText||!0,rc=ap.paddedRect;var Pc=ap.displaySize;Ti.scale=24*Ti.scale/mo,Pl=ds+(24-Pc[1]*Ti.scale),ip=(ja={width:Pc[0],height:Pc[1],left:1,top:-3,advance:Nf?Pc[1]:Pc[0]}).advance;var lu=Nf?Pc[0]*Ti.scale-24*_i:Pc[1]*Ti.scale-24*_i;lu>0&&lu>Ua&&(Ua=lu)}else{var nf=Rn[Ti.fontStack],cu=nf&&nf[Gs];if(cu&&cu.rect)rc=cu.rect,ja=cu.metrics;else{var Ms=oi[Ti.fontStack],af=Ms&&Ms[Gs];if(!af)continue;ja=af.metrics}Pl=24*(_i-Ti.scale)}Nf?(Qr.verticalizable=!0,Yi.push({glyph:Gs,imageName:Iu,x:yo,y:hs+Pl,vertical:Nf,scale:Ti.scale,fontStack:Ti.fontStack,sectionIndex:Mc,metrics:ja,rect:rc}),yo+=ip*Ti.scale+oa):(Yi.push({glyph:Gs,imageName:Iu,x:yo,y:hs+Pl,vertical:Nf,scale:Ti.scale,fontStack:Ti.fontStack,sectionIndex:Mc,metrics:ja,rect:rc}),yo+=ja.advance*Ti.scale+oa)}Yi.length!==0&&(Co=Math.max(yo-oa,Co),po(Yi,0,Yi.length-1,Ja,Ua)),yo=0;var Il=Ci*_i+Ua;Do.lineOffset=Math.max(Ua,ds),hs+=Il,ts=Math.max(Il,ts),++go}else hs+=Ci,++go}var Ou,of=hs- -17,Hs=xa(aa),fu=Hs.horizontalAlign,_o=Hs.verticalAlign;(function(ku,Lu,sf,Dp,Fp,zf,Bp,Np,zp){var Zf,wh=(Lu-sf)*Fp;Zf=zf!==Bp?-Np*Dp- -17:(-Dp*zp+.5)*Bp;for(var op=0,sp=ku;op<sp.length;op+=1)for(var nc=0,Zp=sp[op].positionedGlyphs;nc<Zp.length;nc+=1){var Ol=Zp[nc];Ol.x+=wh,Ol.y+=Zf}})(Qr.positionedLines,Ja,fu,_o,Co,ts,Ci,of,fn.length),Qr.top+=-_o*of,Qr.bottom=Qr.top+of,Qr.left+=-fu*Co,Qr.right=Qr.left+Co}(En,a,s,p,ze,w,C,I,B,k,V,Ce),!function(Qr){for(var oi=0,Rn=Qr;oi<Rn.length;oi+=1)if(Rn[oi].positionedGlyphs.length!==0)return!1;return!0}(Kn)&&En}Kt.fromFeature=function(t,a){for(var s=new Kt,p=0;p<t.sections.length;p++){var m=t.sections[p];m.image?s.addImageSection(m):s.addTextSection(m,a)}return s},Kt.prototype.length=function(){return this.text.length},Kt.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Kt.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Kt.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Kt.prototype.verticalizePunctuation=function(){this.text=function(t){for(var a="",s=0;s<t.length;s++){var p=t.charCodeAt(s+1)||null,m=t.charCodeAt(s-1)||null;a+=p&&Wu(p)&&!Tc[t[s+1]]||m&&Wu(m)&&!Tc[t[s-1]]||!Tc[t[s]]?t[s]:Tc[t[s]]}return a}(this.text)},Kt.prototype.trim=function(){for(var t=0,a=0;a<this.text.length&&bn[this.text.charCodeAt(a)];a++)t++;for(var s=this.text.length,p=this.text.length-1;p>=0&&p>=t&&bn[this.text.charCodeAt(p)];p--)s--;this.text=this.text.substring(t,s),this.sectionIndex=this.sectionIndex.slice(t,s)},Kt.prototype.substring=function(t,a){var s=new Kt;return s.text=this.text.substring(t,a),s.sectionIndex=this.sectionIndex.slice(t,a),s.sections=this.sections,s},Kt.prototype.toString=function(){return this.text},Kt.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce(function(a,s){return Math.max(a,t.sections[s].scale)},0)},Kt.prototype.addTextSection=function(t,a){this.text+=t.text,this.sections.push(wr.forText(t.scale,t.fontStack||a));for(var s=this.sections.length-1,p=0;p<t.text.length;++p)this.sectionIndex.push(s)},Kt.prototype.addImageSection=function(t){var a=t.image?t.image.name:"";if(a.length!==0){var s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(wr.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Ye("Reached maximum number of images 6401")}else Ye("Can't add FormattedSection with an empty image.")},Kt.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var bn={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},yn={};function qr(t,a,s,p,m,g){if(a.imageName){var w=p[a.imageName];return w?w.displaySize[0]*a.scale*24/g+m:0}var C=s[a.fontStack],I=C&&C[t];return I?I.metrics.advance*a.scale+m:0}function Qn(t,a,s,p){var m=Math.pow(t-a,2);return p?t<a?m/2:2*m:m+Math.abs(s)*s}function Dn(t,a,s){var p=0;return t===10&&(p-=1e4),s&&(p+=150),t!==40&&t!==65288||(p+=50),a!==41&&a!==65289||(p+=50),p}function Yn(t,a,s,p,m,g){for(var w=null,C=Qn(a,s,m,g),I=0,k=p;I<k.length;I+=1){var D=k[I],B=Qn(a-D.x,s,m,g)+D.badness;B<=C&&(w=D,C=B)}return{index:t,x:a,priorBreak:w,badness:C}}function yi(t,a,s,p,m,g,w){if(g!=="point")return[];if(!t)return[];for(var C,I=[],k=function(ze,Le,qe,st,St,xt){for(var kt=0,or=0;or<ze.length();or++){var Nt=ze.getSection(or);kt+=qr(ze.getCharCode(or),Nt,st,St,Le,xt)}return kt/Math.max(1,Math.ceil(kt/qe))}(t,a,s,p,m,w),D=t.text.indexOf("\u200B")>=0,B=0,V=0;V<t.length();V++){var q=t.getSection(V),we=t.getCharCode(V);if(bn[we]||(B+=qr(we,q,p,m,a,w)),V<t.length()-1){var Ce=!((C=we)<11904||!(dr["Bopomofo Extended"](C)||dr.Bopomofo(C)||dr["CJK Compatibility Forms"](C)||dr["CJK Compatibility Ideographs"](C)||dr["CJK Compatibility"](C)||dr["CJK Radicals Supplement"](C)||dr["CJK Strokes"](C)||dr["CJK Symbols and Punctuation"](C)||dr["CJK Unified Ideographs Extension A"](C)||dr["CJK Unified Ideographs"](C)||dr["Enclosed CJK Letters and Months"](C)||dr["Halfwidth and Fullwidth Forms"](C)||dr.Hiragana(C)||dr["Ideographic Description Characters"](C)||dr["Kangxi Radicals"](C)||dr["Katakana Phonetic Extensions"](C)||dr.Katakana(C)||dr["Vertical Forms"](C)||dr["Yi Radicals"](C)||dr["Yi Syllables"](C)));(yn[we]||Ce||q.imageName)&&I.push(Yn(V+1,B,k,I,Dn(we,t.getCharCode(V+1),Ce&&D),!1))}}return function ze(Le){return Le?ze(Le.priorBreak).concat(Le.index):[]}(Yn(t.length(),B,k,I,0,!0))}function xa(t){var a=.5,s=.5;switch(t){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":s=1;break;case"top":case"top-right":case"top-left":s=0}return{horizontalAlign:a,verticalAlign:s}}function po(t,a,s,p,m){if(p||m)for(var g=t[s],w=(t[s].x+g.metrics.advance*g.scale)*p,C=a;C<=s;C++)t[C].x-=w,t[C].y+=m}function ai(t,a,s,p,m,g){var w,C=t.image;if(C.content){var I=C.content,k=C.pixelRatio||1;w=[I[0]/k,I[1]/k,C.displaySize[0]-I[2]/k,C.displaySize[1]-I[3]/k]}var D,B,V,q,we=a.left*g,Ce=a.right*g;s==="width"||s==="both"?(q=m[0]+we-p[3],B=m[0]+Ce+p[1]):B=(q=m[0]+(we+Ce-C.displaySize[0])/2)+C.displaySize[0];var ze=a.top*g,Le=a.bottom*g;return s==="height"||s==="both"?(D=m[1]+ze-p[0],V=m[1]+Le+p[2]):V=(D=m[1]+(ze+Le-C.displaySize[1])/2)+C.displaySize[1],{image:C,top:D,right:B,bottom:V,left:q,collisionPadding:w}}yn[10]=!0,yn[32]=!0,yn[38]=!0,yn[40]=!0,yn[41]=!0,yn[43]=!0,yn[45]=!0,yn[47]=!0,yn[173]=!0,yn[183]=!0,yn[8203]=!0,yn[8208]=!0,yn[8211]=!0,yn[8231]=!0;var ha=function(t){function a(s,p,m,g){t.call(this,s,p),this.angle=m,g!==void 0&&(this.segment=g)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.clone=function(){return new a(this.x,this.y,this.angle,this.segment)},a}(me);function Hi(t,a){var s=a.expression;if(s.kind==="constant")return{kind:"constant",layoutSize:s.evaluate(new Xn(t+1))};if(s.kind==="source")return{kind:"source"};for(var p=s.zoomStops,m=s.interpolationType,g=0;g<p.length&&p[g]<=t;)g++;for(var w=g=Math.max(0,g-1);w<p.length&&p[w]<t+1;)w++;w=Math.min(p.length-1,w);var C=p[g],I=p[w];return s.kind==="composite"?{kind:"composite",minZoom:C,maxZoom:I,interpolationType:m}:{kind:"camera",minZoom:C,maxZoom:I,minSize:s.evaluate(new Xn(C)),maxSize:s.evaluate(new Xn(I)),interpolationType:m}}function Na(t,a,s){var p=a.uSize,m=s.lowerSize;return t.kind==="source"?m/128:t.kind==="composite"?la(m/128,s.upperSize/128,a.uSizeT):p}function za(t,a){var s=0,p=0;if(t.kind==="constant")p=t.layoutSize;else if(t.kind!=="source"){var m=t.interpolationType,g=m?M(qi.interpolationFactor(m,a,t.minZoom,t.maxZoom),0,1):0;t.kind==="camera"?p=la(t.minSize,t.maxSize,g):s=g}return{uSizeT:s,uSize:p}}Gr("Anchor",ha);var Ka=Object.freeze({__proto__:null,getSizeData:Hi,evaluateSizeForFeature:Na,evaluateSizeForZoom:za,SIZE_PACK_FACTOR:128});function ho(t,a,s,p,m){if(a.segment===void 0)return!0;for(var g=a,w=a.segment+1,C=0;C>-s/2;){if(--w<0)return!1;C-=t[w].dist(g),g=t[w]}C+=t[w].dist(t[w+1]),w++;for(var I=[],k=0;C<s/2;){var D=t[w],B=t[w+1];if(!B)return!1;var V=t[w-1].angleTo(D)-D.angleTo(B);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:C,angleDelta:V}),k+=V;C-I[0].distance>p;)k-=I.shift().angleDelta;if(k>m)return!1;w++,C+=D.dist(B)}return!0}function So(t){for(var a=0,s=0;s<t.length-1;s++)a+=t[s].dist(t[s+1]);return a}function Ia(t,a,s){return t?.6*a*s:0}function Gn(t,a){return Math.max(t?t.right-t.left:0,a?a.right-a.left:0)}function Ro(t,a,s,p,m,g){for(var w=Ia(s,m,g),C=Gn(s,p)*g,I=0,k=So(t)/2,D=0;D<t.length-1;D++){var B=t[D],V=t[D+1],q=B.dist(V);if(I+q>k){var we=(k-I)/q,Ce=la(B.x,V.x,we),ze=la(B.y,V.y,we),Le=new ha(Ce,ze,V.angleTo(B),D);return Le._round(),!w||ho(t,Le,C,w,a)?Le:void 0}I+=q}}function Ei(t,a,s,p,m,g,w,C,I){var k=Ia(p,g,w),D=Gn(p,m),B=D*w,V=t[0].x===0||t[0].x===I||t[0].y===0||t[0].y===I;return a-B<a/4&&(a=B+a/4),function q(we,Ce,ze,Le,qe,st,St,xt,kt){for(var or=st/2,Nt=So(we),un=0,kr=Ce-ze,cn=[],Br=0;Br<we.length-1;Br++){for(var Kn=we[Br],En=we[Br+1],Qr=Kn.dist(En),oi=En.angleTo(Kn);kr+ze<un+Qr;){var Rn=((kr+=ze)-un)/Qr,gi=la(Kn.x,En.x,Rn),fn=la(Kn.y,En.y,Rn);if(gi>=0&&gi<kt&&fn>=0&&fn<kt&&kr-or>=0&&kr+or<=Nt){var Ci=new ha(gi,fn,oi,Br);Ci._round(),Le&&!ho(we,Ci,st,Le,qe)||cn.push(Ci)}}un+=Qr}return xt||cn.length||St||(cn=q(we,un/2,ze,Le,qe,st,St,!0,kt)),cn}(t,V?a/2*C%a:(D/2+2*g)*w*C%a,a,k,s,B,V,!1,I)}function mn(t,a,s,p,m){for(var g=[],w=0;w<t.length;w++)for(var C=t[w],I=void 0,k=0;k<C.length-1;k++){var D=C[k],B=C[k+1];D.x<a&&B.x<a||(D.x<a?D=new me(a,D.y+(a-D.x)/(B.x-D.x)*(B.y-D.y))._round():B.x<a&&(B=new me(a,D.y+(a-D.x)/(B.x-D.x)*(B.y-D.y))._round()),D.y<s&&B.y<s||(D.y<s?D=new me(D.x+(s-D.y)/(B.y-D.y)*(B.x-D.x),s)._round():B.y<s&&(B=new me(D.x+(s-D.y)/(B.y-D.y)*(B.x-D.x),s)._round()),D.x>=p&&B.x>=p||(D.x>=p?D=new me(p,D.y+(p-D.x)/(B.x-D.x)*(B.y-D.y))._round():B.x>=p&&(B=new me(p,D.y+(p-D.x)/(B.x-D.x)*(B.y-D.y))._round()),D.y>=m&&B.y>=m||(D.y>=m?D=new me(D.x+(m-D.y)/(B.y-D.y)*(B.x-D.x),m)._round():B.y>=m&&(B=new me(D.x+(m-D.y)/(B.y-D.y)*(B.x-D.x),m)._round()),I&&D.equals(I[I.length-1])||g.push(I=[D]),I.push(B)))))}return g}function ei(t,a,s,p){var m=[],g=t.image,w=g.pixelRatio,C=g.paddedRect.w-2,I=g.paddedRect.h-2,k=t.right-t.left,D=t.bottom-t.top,B=g.stretchX||[[0,C]],V=g.stretchY||[[0,I]],q=function(gi,fn){return gi+fn[1]-fn[0]},we=B.reduce(q,0),Ce=V.reduce(q,0),ze=C-we,Le=I-Ce,qe=0,st=we,St=0,xt=Ce,kt=0,or=ze,Nt=0,un=Le;if(g.content&&p){var kr=g.content;qe=li(B,0,kr[0]),St=li(V,0,kr[1]),st=li(B,kr[0],kr[2]),xt=li(V,kr[1],kr[3]),kt=kr[0]-qe,Nt=kr[1]-St,or=kr[2]-kr[0]-st,un=kr[3]-kr[1]-xt}var cn=function(gi,fn,Ci,aa){var Za=Us(gi.stretch-qe,st,k,t.left),wa=il(gi.fixed-kt,or,gi.stretch,we),oa=Us(fn.stretch-St,xt,D,t.top),ka=il(fn.fixed-Nt,un,fn.stretch,Ce),mo=Us(Ci.stretch-qe,st,k,t.left),yo=il(Ci.fixed-kt,or,Ci.stretch,we),hs=Us(aa.stretch-St,xt,D,t.top),Co=il(aa.fixed-Nt,un,aa.stretch,Ce),ts=new me(Za,oa),Ja=new me(mo,oa),go=new me(mo,hs),ci=new me(Za,hs),Zi=new me(wa/w,ka/w),Fi=new me(yo/w,Co/w),_i=a*Math.PI/180;if(_i){var ds=Math.sin(_i),Do=Math.cos(_i),Yi=[Do,-ds,ds,Do];ts._matMult(Yi),Ja._matMult(Yi),ci._matMult(Yi),go._matMult(Yi)}var Ua=gi.stretch+gi.fixed,Ho=fn.stretch+fn.fixed;return{tl:ts,tr:Ja,bl:ci,br:go,tex:{x:g.paddedRect.x+1+Ua,y:g.paddedRect.y+1+Ho,w:Ci.stretch+Ci.fixed-Ua,h:aa.stretch+aa.fixed-Ho},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zi,pixelOffsetBR:Fi,minFontScaleX:or/w/k,minFontScaleY:un/w/D,isSDF:s}};if(p&&(g.stretchX||g.stretchY))for(var Br=Oa(B,ze,we),Kn=Oa(V,Le,Ce),En=0;En<Br.length-1;En++)for(var Qr=Br[En],oi=Br[En+1],Rn=0;Rn<Kn.length-1;Rn++)m.push(cn(Qr,Kn[Rn],oi,Kn[Rn+1]));else m.push(cn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:C+1},{fixed:0,stretch:I+1}));return m}function li(t,a,s){for(var p=0,m=0,g=t;m<g.length;m+=1){var w=g[m];p+=Math.max(a,Math.min(s,w[1]))-Math.max(a,Math.min(s,w[0]))}return p}function Oa(t,a,s){for(var p=[{fixed:-1,stretch:0}],m=0,g=t;m<g.length;m+=1){var w=g[m],C=w[0],I=w[1],k=p[p.length-1];p.push({fixed:C-k.stretch,stretch:k.stretch}),p.push({fixed:C-k.stretch,stretch:k.stretch+(I-C)})}return p.push({fixed:a+1,stretch:s}),p}function Us(t,a,s,p){return t/a*s+p}function il(t,a,s,p){return t-a*s/p}var xe=function(t,a,s,p,m,g,w,C,I,k){if(this.boxStartIndex=t.length,I){var D=g.top,B=g.bottom,V=g.collisionPadding;V&&(D-=V[1],B+=V[3]);var q=B-D;q>0&&(q=Math.max(10,q),this.circleDiameter=q)}else{var we=g.top*w-C,Ce=g.bottom*w+C,ze=g.left*w-C,Le=g.right*w+C,qe=g.collisionPadding;if(qe&&(ze-=qe[0]*w,we-=qe[1]*w,Le+=qe[2]*w,Ce+=qe[3]*w),k){var st=new me(ze,we),St=new me(Le,we),xt=new me(ze,Ce),kt=new me(Le,Ce),or=k*Math.PI/180;st._rotate(or),St._rotate(or),xt._rotate(or),kt._rotate(or),ze=Math.min(st.x,St.x,xt.x,kt.x),Le=Math.max(st.x,St.x,xt.x,kt.x),we=Math.min(st.y,St.y,xt.y,kt.y),Ce=Math.max(st.y,St.y,xt.y,kt.y)}t.emplaceBack(a.x,a.y,ze,we,Le,Ce,s,p,m)}this.boxEndIndex=t.length},yt=function(t,a){if(t===void 0&&(t=[]),a===void 0&&(a=ct),this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(var s=(this.length>>1)-1;s>=0;s--)this._down(s)};function ct(t,a){return t<a?-1:t>a?1:0}function jr(t,a,s){a===void 0&&(a=1),s===void 0&&(s=!1);for(var p=1/0,m=1/0,g=-1/0,w=-1/0,C=t[0],I=0;I<C.length;I++){var k=C[I];(!I||k.x<p)&&(p=k.x),(!I||k.y<m)&&(m=k.y),(!I||k.x>g)&&(g=k.x),(!I||k.y>w)&&(w=k.y)}var D=Math.min(g-p,w-m),B=D/2,V=new yt([],ti);if(D===0)return new me(p,m);for(var q=p;q<g;q+=D)for(var we=m;we<w;we+=D)V.push(new pe(q+B,we+B,B,t));for(var Ce=function(qe){for(var st=0,St=0,xt=0,kt=qe[0],or=0,Nt=kt.length,un=Nt-1;or<Nt;un=or++){var kr=kt[or],cn=kt[un],Br=kr.x*cn.y-cn.x*kr.y;St+=(kr.x+cn.x)*Br,xt+=(kr.y+cn.y)*Br,st+=3*Br}return new pe(St/st,xt/st,0,qe)}(t),ze=V.length;V.length;){var Le=V.pop();(Le.d>Ce.d||!Ce.d)&&(Ce=Le,s&&console.log("found best %d after %d probes",Math.round(1e4*Le.d)/1e4,ze)),Le.max-Ce.d<=a||(V.push(new pe(Le.p.x-(B=Le.h/2),Le.p.y-B,B,t)),V.push(new pe(Le.p.x+B,Le.p.y-B,B,t)),V.push(new pe(Le.p.x-B,Le.p.y+B,B,t)),V.push(new pe(Le.p.x+B,Le.p.y+B,B,t)),ze+=4)}return s&&(console.log("num probes: "+ze),console.log("best distance: "+Ce.d)),Ce.p}function ti(t,a){return a.max-t.max}function pe(t,a,s,p){this.p=new me(t,a),this.h=s,this.d=function(m,g){for(var w=!1,C=1/0,I=0;I<g.length;I++)for(var k=g[I],D=0,B=k.length,V=B-1;D<B;V=D++){var q=k[D],we=k[V];q.y>m.y!=we.y>m.y&&m.x<(we.x-q.x)*(m.y-q.y)/(we.y-q.y)+q.x&&(w=!w),C=Math.min(C,iu(m,q,we))}return(w?1:-1)*Math.sqrt(C)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}yt.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},yt.prototype.pop=function(){if(this.length!==0){var t=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),t}},yt.prototype.peek=function(){return this.data[0]},yt.prototype._up=function(t){for(var a=this.data,s=this.compare,p=a[t];t>0;){var m=t-1>>1,g=a[m];if(s(p,g)>=0)break;a[t]=g,t=m}a[t]=p},yt.prototype._down=function(t){for(var a=this.data,s=this.compare,p=this.length>>1,m=a[t];t<p;){var g=1+(t<<1),w=a[g],C=g+1;if(C<this.length&&s(a[C],w)<0&&(g=C,w=a[C]),s(w,m)>=0)break;a[t]=w,t=g}a[t]=m};var $=Number.POSITIVE_INFINITY;function Be(t,a){return a[1]!==$?function(s,p,m){var g=0,w=0;switch(p=Math.abs(p),m=Math.abs(m),s){case"top-right":case"top-left":case"top":w=m-7;break;case"bottom-right":case"bottom-left":case"bottom":w=7-m}switch(s){case"top-right":case"bottom-right":case"right":g=-p;break;case"top-left":case"bottom-left":case"left":g=p}return[g,w]}(t,a[0],a[1]):function(s,p){var m=0,g=0;p<0&&(p=0);var w=p/Math.sqrt(2);switch(s){case"top-right":case"top-left":g=w-7;break;case"bottom-right":case"bottom-left":g=7-w;break;case"bottom":g=7-p;break;case"top":g=p-7}switch(s){case"top-right":case"bottom-right":m=-w;break;case"top-left":case"bottom-left":m=w;break;case"left":m=p;break;case"right":m=-p}return[m,g]}(t,a[0])}function Qe(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function tt(t,a,s,p,m,g,w,C,I,k,D,B,V,q,we){var Ce=function(St,xt,kt,or,Nt,un,kr,cn){for(var Br=or.layout.get("text-rotate").evaluate(un,{})*Math.PI/180,Kn=[],En=0,Qr=xt.positionedLines;En<Qr.length;En+=1)for(var oi=Qr[En],Rn=0,gi=oi.positionedGlyphs;Rn<gi.length;Rn+=1){var fn=gi[Rn];if(fn.rect){var Ci=fn.rect||{},aa=4,Za=!0,wa=1,oa=0,ka=(Nt||cn)&&fn.vertical,mo=fn.metrics.advance*fn.scale/2;if(cn&&xt.verticalizable&&(oa=oi.lineOffset/2-(fn.imageName?-(24-fn.metrics.width*fn.scale)/2:24*(fn.scale-1))),fn.imageName){var yo=kr[fn.imageName];Za=yo.sdf,aa=1/(wa=yo.pixelRatio)}var hs=Nt?[fn.x+mo,fn.y]:[0,0],Co=Nt?[0,0]:[fn.x+mo+kt[0],fn.y+kt[1]-oa],ts=[0,0];ka&&(ts=Co,Co=[0,0]);var Ja=(fn.metrics.left-aa)*fn.scale-mo+Co[0],go=(-fn.metrics.top-aa)*fn.scale+Co[1],ci=Ja+Ci.w*fn.scale/wa,Zi=go+Ci.h*fn.scale/wa,Fi=new me(Ja,go),_i=new me(ci,go),ds=new me(Ja,Zi),Do=new me(ci,Zi);if(ka){var Yi=new me(-mo,mo- -17),Ua=-Math.PI/2,Ho=12-mo,Ti=new me(22-Ho,-(fn.imageName?Ho:0)),Mc=new(Function.prototype.bind.apply(me,[null].concat(ts)));Fi._rotateAround(Ua,Yi)._add(Ti)._add(Mc),_i._rotateAround(Ua,Yi)._add(Ti)._add(Mc),ds._rotateAround(Ua,Yi)._add(Ti)._add(Mc),Do._rotateAround(Ua,Yi)._add(Ti)._add(Mc)}if(Br){var Gs=Math.sin(Br),Pl=Math.cos(Br),ja=[Pl,-Gs,Gs,Pl];Fi._matMult(ja),_i._matMult(ja),ds._matMult(ja),Do._matMult(ja)}var rc=new me(0,0),Iu=new me(0,0);Kn.push({tl:Fi,tr:_i,bl:ds,br:Do,tex:Ci,writingMode:xt.writingMode,glyphOffset:hs,sectionIndex:fn.sectionIndex,isSDF:Za,pixelOffsetTL:rc,pixelOffsetBR:Iu,minFontScaleX:0,minFontScaleY:0})}}return Kn}(0,s,C,m,g,w,p,t.allowVerticalPlacement),ze=t.textSizeData,Le=null;ze.kind==="source"?(Le=[128*m.layout.get("text-size").evaluate(w,{})])[0]>32640&&Ye(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):ze.kind==="composite"&&((Le=[128*q.compositeTextSizes[0].evaluate(w,{},we),128*q.compositeTextSizes[1].evaluate(w,{},we)])[0]>32640||Le[1]>32640)&&Ye(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,Ce,Le,C,g,w,k,a,I.lineStartIndex,I.lineLength,V,we);for(var qe=0,st=D;qe<st.length;qe+=1)B[st[qe]]=t.text.placedSymbolArray.length-1;return 4*Ce.length}function Ue(t){for(var a in t)return t[a];return null}function Ne(t,a,s,p){var m=t.compareText;if(a in m){for(var g=m[a],w=g.length-1;w>=0;w--)if(p.dist(g[w])<s)return!0}else m[a]=[];return m[a].push(p),!1}var Xe=Cc.VectorTileFeature.types,de=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Re(t,a,s,p,m,g,w,C,I,k,D,B,V){var q=C?Math.min(32640,Math.round(C[0])):0,we=C?Math.min(32640,Math.round(C[1])):0;t.emplaceBack(a,s,Math.round(32*p),Math.round(32*m),g,w,(q<<1)+(I?1:0),we,16*k,16*D,256*B,256*V)}function ce(t,a,s){t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s),t.emplaceBack(a.x,a.y,s)}function $e(t){for(var a=0,s=t.sections;a<s.length;a+=1)if(wf(s[a].text))return!0;return!1}var it=function(t){this.layoutVertexArray=new ga,this.indexArray=new Mu,this.programConfigurations=t,this.segments=new ee,this.dynamicLayoutVertexArray=new re,this.opacityVertexArray=new Xl,this.placedSymbolArray=new h};it.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},it.prototype.upload=function(t,a,s,p){this.isEmpty()||(s&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Qh.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,_h.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,de,!0),this.opacityVertexBuffer.itemSize=1),(s||p)&&this.programConfigurations.upload(t))},it.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Gr("SymbolBuffers",it);var zt=function(t,a,s){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new s,this.segments=new ee,this.collisionVertexArray=new xc};zt.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Ip.members,!0)},zt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Gr("CollisionBuffers",zt);var mt=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(function(g){return g.id}),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=io([]),this.placementViewportMatrix=io([]);var a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Hi(this.zoom,a["text-size"]),this.iconSizeData=Hi(this.zoom,a["icon-size"]);var s=this.layers[0].layout,p=s.get("symbol-sort-key"),m=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&p.constantOr(1)!==void 0,this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,s.get("symbol-placement")==="point"&&(this.writingModes=s.get("text-writing-mode").map(function(g){return hn[g]})),this.stateDependentLayerIds=this.layers.filter(function(g){return g.isStateDependent()}).map(function(g){return g.id}),this.sourceID=t.sourceID};mt.prototype.createArrays=function(){this.text=new it(new _n(this.layers,this.zoom,function(t){return/^text/.test(t)})),this.icon=new it(new _n(this.layers,this.zoom,function(t){return/^icon/.test(t)})),this.glyphOffsetArray=new E,this.lineVertexArray=new P,this.symbolInstances=new S},mt.prototype.calculateGlyphDependencies=function(t,a,s,p,m){for(var g=0;g<t.length;g++)if(a[t.charCodeAt(g)]=!0,(s||p)&&m){var w=Tc[t.charAt(g)];w&&(a[w.charCodeAt(0)]=!0)}},mt.prototype.populate=function(t,a,s){var p=this.layers[0],m=p.layout,g=m.get("text-font"),w=m.get("text-field"),C=m.get("icon-image"),I=(w.value.kind!=="constant"||w.value.value instanceof Bi&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),k=C.value.kind!=="constant"||!!C.value.value||Object.keys(C.parameters).length>0,D=m.get("symbol-sort-key");if(this.features=[],I||k){for(var B=a.iconDependencies,V=a.glyphDependencies,q=a.availableImages,we=new Xn(this.zoom),Ce=0,ze=t;Ce<ze.length;Ce+=1){var Le=ze[Ce],qe=Le.feature,st=Le.id,St=Le.index,xt=Le.sourceLayerIndex,kt=p._featureFilter.needGeometry,or=_a(qe,kt);if(p._featureFilter.filter(we,or,s)){kt||(or.geometry=ra(qe));var Nt=void 0;if(I){var un=p.getValueAndResolveTokens("text-field",or,s,q),kr=Bi.factory(un);$e(kr)&&(this.hasRTLText=!0),(!this.hasRTLText||Cf()==="unavailable"||this.hasRTLText&&Ss.isParsed())&&(Nt=bh(kr,p,or))}var cn=void 0;if(k){var Br=p.getValueAndResolveTokens("icon-image",or,s,q);cn=Br instanceof ea?Br:ea.fromString(Br)}if(Nt||cn){var Kn=this.sortFeaturesByKey?D.evaluate(or,{},s):void 0;if(this.features.push({id:st,text:Nt,icon:cn,index:St,sourceLayerIndex:xt,geometry:or.geometry,properties:qe.properties,type:Xe[qe.type],sortKey:Kn}),cn&&(B[cn.name]=!0),Nt){var En=g.evaluate(or,{},s).join(","),Qr=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(hn.vertical)>=0;for(var oi=0,Rn=Nt.sections;oi<Rn.length;oi+=1){var gi=Rn[oi];if(gi.image)B[gi.image.name]=!0;else{var fn=bf(Nt.toString()),Ci=gi.fontStack||En,aa=V[Ci]=V[Ci]||{};this.calculateGlyphDependencies(gi.text,aa,Qr,this.allowVerticalPlacement,fn)}}}}}}m.get("symbol-placement")==="line"&&(this.features=function(Za){var wa={},oa={},ka=[],mo=0;function yo(Yi){ka.push(Za[Yi]),mo++}function hs(Yi,Ua,Ho){var Ti=oa[Yi];return delete oa[Yi],oa[Ua]=Ti,ka[Ti].geometry[0].pop(),ka[Ti].geometry[0]=ka[Ti].geometry[0].concat(Ho[0]),Ti}function Co(Yi,Ua,Ho){var Ti=wa[Ua];return delete wa[Ua],wa[Yi]=Ti,ka[Ti].geometry[0].shift(),ka[Ti].geometry[0]=Ho[0].concat(ka[Ti].geometry[0]),Ti}function ts(Yi,Ua,Ho){var Ti=Ho?Ua[0][Ua[0].length-1]:Ua[0][0];return Yi+":"+Ti.x+":"+Ti.y}for(var Ja=0;Ja<Za.length;Ja++){var go=Za[Ja],ci=go.geometry,Zi=go.text?go.text.toString():null;if(Zi){var Fi=ts(Zi,ci),_i=ts(Zi,ci,!0);if(Fi in oa&&_i in wa&&oa[Fi]!==wa[_i]){var ds=Co(Fi,_i,ci),Do=hs(Fi,_i,ka[ds].geometry);delete wa[Fi],delete oa[_i],oa[ts(Zi,ka[Do].geometry,!0)]=Do,ka[ds].geometry=null}else Fi in oa?hs(Fi,_i,ci):_i in wa?Co(Fi,_i,ci):(yo(Ja),wa[Fi]=mo-1,oa[_i]=mo-1)}else yo(Ja)}return ka.filter(function(Yi){return Yi.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(Za,wa){return Za.sortKey-wa.sortKey})}},mt.prototype.update=function(t,a,s){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,a,this.layers,s),this.icon.programConfigurations.updatePaintArrays(t,a,this.layers,s))},mt.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},mt.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},mt.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},mt.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},mt.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},mt.prototype.addToLineVertexArray=function(t,a){var s=this.lineVertexArray.length;if(t.segment!==void 0){for(var p=t.dist(a[t.segment+1]),m=t.dist(a[t.segment]),g={},w=t.segment+1;w<a.length;w++)g[w]={x:a[w].x,y:a[w].y,tileUnitDistanceFromAnchor:p},w<a.length-1&&(p+=a[w+1].dist(a[w]));for(var C=t.segment||0;C>=0;C--)g[C]={x:a[C].x,y:a[C].y,tileUnitDistanceFromAnchor:m},C>0&&(m+=a[C-1].dist(a[C]));for(var I=0;I<a.length;I++){var k=g[I];this.lineVertexArray.emplaceBack(k.x,k.y,k.tileUnitDistanceFromAnchor)}}return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}},mt.prototype.addSymbols=function(t,a,s,p,m,g,w,C,I,k,D,B){for(var V=t.indexArray,q=t.layoutVertexArray,we=t.segments.prepareSegment(4*a.length,q,V,this.canOverlap?g.sortKey:void 0),Ce=this.glyphOffsetArray.length,ze=we.vertexLength,Le=this.allowVerticalPlacement&&w===hn.vertical?Math.PI/2:0,qe=g.text&&g.text.sections,st=0;st<a.length;st++){var St=a[st],xt=St.tl,kt=St.tr,or=St.bl,Nt=St.br,un=St.tex,kr=St.pixelOffsetTL,cn=St.pixelOffsetBR,Br=St.minFontScaleX,Kn=St.minFontScaleY,En=St.glyphOffset,Qr=St.isSDF,oi=St.sectionIndex,Rn=we.vertexLength,gi=En[1];Re(q,C.x,C.y,xt.x,gi+xt.y,un.x,un.y,s,Qr,kr.x,kr.y,Br,Kn),Re(q,C.x,C.y,kt.x,gi+kt.y,un.x+un.w,un.y,s,Qr,cn.x,kr.y,Br,Kn),Re(q,C.x,C.y,or.x,gi+or.y,un.x,un.y+un.h,s,Qr,kr.x,cn.y,Br,Kn),Re(q,C.x,C.y,Nt.x,gi+Nt.y,un.x+un.w,un.y+un.h,s,Qr,cn.x,cn.y,Br,Kn),ce(t.dynamicLayoutVertexArray,C,Le),V.emplaceBack(Rn,Rn+1,Rn+2),V.emplaceBack(Rn+1,Rn+2,Rn+3),we.vertexLength+=4,we.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(En[0]),st!==a.length-1&&oi===a[st+1].sectionIndex||t.programConfigurations.populatePaintArrays(q.length,g,g.index,{},B,qe&&qe[oi])}t.placedSymbolArray.emplaceBack(C.x,C.y,Ce,this.glyphOffsetArray.length-Ce,ze,I,k,C.segment,s?s[0]:0,s?s[1]:0,p[0],p[1],w,0,!1,0,D)},mt.prototype._addCollisionDebugVertex=function(t,a,s,p,m,g){return a.emplaceBack(0,0),t.emplaceBack(s.x,s.y,p,m,Math.round(g.x),Math.round(g.y))},mt.prototype.addCollisionDebugVertices=function(t,a,s,p,m,g,w){var C=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),I=C.vertexLength,k=m.layoutVertexArray,D=m.collisionVertexArray,B=w.anchorX,V=w.anchorY;this._addCollisionDebugVertex(k,D,g,B,V,new me(t,a)),this._addCollisionDebugVertex(k,D,g,B,V,new me(s,a)),this._addCollisionDebugVertex(k,D,g,B,V,new me(s,p)),this._addCollisionDebugVertex(k,D,g,B,V,new me(t,p)),C.vertexLength+=4;var q=m.indexArray;q.emplaceBack(I,I+1),q.emplaceBack(I+1,I+2),q.emplaceBack(I+2,I+3),q.emplaceBack(I+3,I),C.primitiveLength+=4},mt.prototype.addDebugCollisionBoxes=function(t,a,s,p){for(var m=t;m<a;m++){var g=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,p?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,s)}},mt.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new zt(bl,Op.members,Yl),this.iconCollisionBox=new zt(bl,Op.members,Yl);for(var t=0;t<this.symbolInstances.length;t++){var a=this.symbolInstances.get(t);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}},mt.prototype._deserializeCollisionBoxesForSymbol=function(t,a,s,p,m,g,w,C,I){for(var k={},D=a;D<s;D++){var B=t.get(D);k.textBox={x1:B.x1,y1:B.y1,x2:B.x2,y2:B.y2,anchorPointX:B.anchorPointX,anchorPointY:B.anchorPointY},k.textFeatureIndex=B.featureIndex;break}for(var V=p;V<m;V++){var q=t.get(V);k.verticalTextBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},k.verticalTextFeatureIndex=q.featureIndex;break}for(var we=g;we<w;we++){var Ce=t.get(we);k.iconBox={x1:Ce.x1,y1:Ce.y1,x2:Ce.x2,y2:Ce.y2,anchorPointX:Ce.anchorPointX,anchorPointY:Ce.anchorPointY},k.iconFeatureIndex=Ce.featureIndex;break}for(var ze=C;ze<I;ze++){var Le=t.get(ze);k.verticalIconBox={x1:Le.x1,y1:Le.y1,x2:Le.x2,y2:Le.y2,anchorPointX:Le.anchorPointX,anchorPointY:Le.anchorPointY},k.verticalIconFeatureIndex=Le.featureIndex;break}return k},mt.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var a=0;a<this.symbolInstances.length;a++){var s=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}},mt.prototype.hasTextData=function(){return this.text.segments.get().length>0},mt.prototype.hasIconData=function(){return this.icon.segments.get().length>0},mt.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},mt.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},mt.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},mt.prototype.addIndicesForPlacedSymbol=function(t,a){for(var s=t.placedSymbolArray.get(a),p=s.vertexStartIndex+4*s.numGlyphs,m=s.vertexStartIndex;m<p;m+=4)t.indexArray.emplaceBack(m,m+1,m+2),t.indexArray.emplaceBack(m+1,m+2,m+3)},mt.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var a=Math.sin(t),s=Math.cos(t),p=[],m=[],g=[],w=0;w<this.symbolInstances.length;++w){g.push(w);var C=this.symbolInstances.get(w);p.push(0|Math.round(a*C.anchorX+s*C.anchorY)),m.push(C.featureIndex)}return g.sort(function(I,k){return p[I]-p[k]||m[k]-m[I]}),g},mt.prototype.addToSortKeyRanges=function(t,a){var s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===a?s.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})},mt.prototype.sortFeatures=function(t){var a=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var s=0,p=this.symbolInstanceIndexes;s<p.length;s+=1){var m=this.symbolInstances.get(p[s]);this.featureSortOrder.push(m.featureIndex),[m.rightJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.leftJustifiedTextSymbolIndex].forEach(function(g,w,C){g>=0&&C.indexOf(g)===w&&a.addIndicesForPlacedSymbol(a.text,g)}),m.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,m.verticalPlacedTextSymbolIndex),m.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.placedIconSymbolIndex),m.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,m.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Gr("SymbolBucket",mt,{omit:["layers","collisionBoxArray","features","compareText"]}),mt.MAX_GLYPHS=65535,mt.addDynamicAttributes=ce;var Rt=new ya({"symbol-placement":new nn(te.layout_symbol["symbol-placement"]),"symbol-spacing":new nn(te.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new nn(te.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Wr(te.layout_symbol["symbol-sort-key"]),"symbol-z-order":new nn(te.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new nn(te.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new nn(te.layout_symbol["icon-ignore-placement"]),"icon-optional":new nn(te.layout_symbol["icon-optional"]),"icon-rotation-alignment":new nn(te.layout_symbol["icon-rotation-alignment"]),"icon-size":new Wr(te.layout_symbol["icon-size"]),"icon-text-fit":new nn(te.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new nn(te.layout_symbol["icon-text-fit-padding"]),"icon-image":new Wr(te.layout_symbol["icon-image"]),"icon-rotate":new Wr(te.layout_symbol["icon-rotate"]),"icon-padding":new nn(te.layout_symbol["icon-padding"]),"icon-keep-upright":new nn(te.layout_symbol["icon-keep-upright"]),"icon-offset":new Wr(te.layout_symbol["icon-offset"]),"icon-anchor":new Wr(te.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new nn(te.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new nn(te.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new nn(te.layout_symbol["text-rotation-alignment"]),"text-field":new Wr(te.layout_symbol["text-field"]),"text-font":new Wr(te.layout_symbol["text-font"]),"text-size":new Wr(te.layout_symbol["text-size"]),"text-max-width":new Wr(te.layout_symbol["text-max-width"]),"text-line-height":new nn(te.layout_symbol["text-line-height"]),"text-letter-spacing":new Wr(te.layout_symbol["text-letter-spacing"]),"text-justify":new Wr(te.layout_symbol["text-justify"]),"text-radial-offset":new Wr(te.layout_symbol["text-radial-offset"]),"text-variable-anchor":new nn(te.layout_symbol["text-variable-anchor"]),"text-anchor":new Wr(te.layout_symbol["text-anchor"]),"text-max-angle":new nn(te.layout_symbol["text-max-angle"]),"text-writing-mode":new nn(te.layout_symbol["text-writing-mode"]),"text-rotate":new Wr(te.layout_symbol["text-rotate"]),"text-padding":new nn(te.layout_symbol["text-padding"]),"text-keep-upright":new nn(te.layout_symbol["text-keep-upright"]),"text-transform":new Wr(te.layout_symbol["text-transform"]),"text-offset":new Wr(te.layout_symbol["text-offset"]),"text-allow-overlap":new nn(te.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new nn(te.layout_symbol["text-ignore-placement"]),"text-optional":new nn(te.layout_symbol["text-optional"])}),sr={paint:new ya({"icon-opacity":new Wr(te.paint_symbol["icon-opacity"]),"icon-color":new Wr(te.paint_symbol["icon-color"]),"icon-halo-color":new Wr(te.paint_symbol["icon-halo-color"]),"icon-halo-width":new Wr(te.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Wr(te.paint_symbol["icon-halo-blur"]),"icon-translate":new nn(te.paint_symbol["icon-translate"]),"icon-translate-anchor":new nn(te.paint_symbol["icon-translate-anchor"]),"text-opacity":new Wr(te.paint_symbol["text-opacity"]),"text-color":new Wr(te.paint_symbol["text-color"],{runtimeType:Mr,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new Wr(te.paint_symbol["text-halo-color"]),"text-halo-width":new Wr(te.paint_symbol["text-halo-width"]),"text-halo-blur":new Wr(te.paint_symbol["text-halo-blur"]),"text-translate":new nn(te.paint_symbol["text-translate"]),"text-translate-anchor":new nn(te.paint_symbol["text-translate-anchor"])}),layout:Rt},en=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Rr,this.defaultValue=t};en.prototype.evaluate=function(t){if(t.formattedSection){var a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},en.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},en.prototype.outputDefined=function(){return!1},en.prototype.serialize=function(){return null},Gr("FormatSectionOverride",en,{omit:["defaultValue"]});var qn=function(t){function a(s){t.call(this,s,sr)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.recalculate=function(s,p){if(t.prototype.recalculate.call(this,s,p),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var m=this.layout.get("text-writing-mode");if(m){for(var g=[],w=0,C=m;w<C.length;w+=1){var I=C[w];g.indexOf(I)<0&&g.push(I)}this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},a.prototype.getValueAndResolveTokens=function(s,p,m,g){var w=this.layout.get(s).evaluate(p,{},m,g),C=this._unevaluatedLayout._values[s];return C.isDataDriven()||Ds(C.value)||!w?w:function(I,k){return k.replace(/{([^{}]+)}/g,function(D,B){return B in I?String(I[B]):""})}(p.properties,w)},a.prototype.createBucket=function(s){return new mt(s)},a.prototype.queryRadius=function(){return 0},a.prototype.queryIntersectsFeature=function(){return!1},a.prototype._setPaintOverrides=function(){for(var s=0,p=sr.paint.overridableProperties;s<p.length;s+=1){var m=p[s];if(a.hasPaintOverride(this.layout,m)){var g,w=this.paint.get(m),C=new en(w),I=new Uu(C,w.property.specification);g=w.value.kind==="constant"||w.value.kind==="source"?new hl("source",I):new Su("composite",I,w.value.zoomStops,w.value._interpolationType),this.paint._values[m]=new lo(w.property,g,w.parameters)}}},a.prototype._handleOverridablePaintPropertyUpdate=function(s,p,m){return!(!this.layout||p.isDataDriven()||m.isDataDriven())&&a.hasPaintOverride(this.layout,s)},a.hasPaintOverride=function(s,p){var m=s.get("text-field"),g=sr.paint.properties[p],w=!1,C=function(D){for(var B=0,V=D;B<V.length;B+=1)if(g.overrides&&g.overrides.hasOverride(V[B]))return void(w=!0)};if(m.value.kind==="constant"&&m.value.value instanceof Bi)C(m.value.value.sections);else if(m.value.kind==="source"){var I=function(D){w||(D instanceof Ea&&ji(D.value)===ui?C(D.value.sections):D instanceof bo?C(D.sections):D.eachChild(I))},k=m.value;k._styleExpression&&I(k._styleExpression.expression)}return w},a}(ta),Jr={paint:new ya({"background-color":new nn(te.paint_background["background-color"]),"background-pattern":new wo(te.paint_background["background-pattern"]),"background-opacity":new nn(te.paint_background["background-opacity"])})},xn=function(t){function a(s){t.call(this,s,Jr)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(ta),Bn={paint:new ya({"raster-opacity":new nn(te.paint_raster["raster-opacity"]),"raster-hue-rotate":new nn(te.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new nn(te.paint_raster["raster-brightness-min"]),"raster-brightness-max":new nn(te.paint_raster["raster-brightness-max"]),"raster-saturation":new nn(te.paint_raster["raster-saturation"]),"raster-contrast":new nn(te.paint_raster["raster-contrast"]),"raster-resampling":new nn(te.paint_raster["raster-resampling"]),"raster-fade-duration":new nn(te.paint_raster["raster-fade-duration"])})},xi=function(t){function a(s){t.call(this,s,Bn)}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a}(ta),ba=function(t){function a(s){t.call(this,s,{}),this.implementation=s}return t&&(a.__proto__=t),(a.prototype=Object.create(t&&t.prototype)).constructor=a,a.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},a.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},a.prototype.recalculate=function(){},a.prototype.updateTransitions=function(){},a.prototype.hasTransition=function(){},a.prototype.serialize=function(){},a.prototype.onAdd=function(s){this.implementation.onAdd&&this.implementation.onAdd(s,s.painter.context.gl)},a.prototype.onRemove=function(s){this.implementation.onRemove&&this.implementation.onRemove(s,s.painter.context.gl)},a}(ta),vo={circle:ql,heatmap:mp,hillshade:gp,fill:qh,"fill-extrusion":Qo,line:Mp,symbol:qn,background:xn,raster:xi},kf=fe.HTMLImageElement,js=fe.HTMLCanvasElement,np=fe.HTMLVideoElement,Vs=fe.ImageData,Lf=fe.ImageBitmap,Rf=function(t,a,s,p){this.context=t,this.format=s,this.texture=t.gl.createTexture(),this.update(a,p)};Rf.prototype.update=function(t,a,s){var p=t.width,m=t.height,g=!(this.size&&this.size[0]===p&&this.size[1]===m||s),w=this.context,C=w.gl;if(this.useMipmap=Boolean(a&&a.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),w.pixelStoreUnpackFlipY.set(!1),w.pixelStoreUnpack.set(1),w.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!a||a.premultiply!==!1)),g)this.size=[p,m],t instanceof kf||t instanceof js||t instanceof np||t instanceof Vs||Lf&&t instanceof Lf?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,t):C.texImage2D(C.TEXTURE_2D,0,this.format,p,m,0,this.format,C.UNSIGNED_BYTE,t.data);else{var I=s||{x:0,y:0},k=I.x,D=I.y;t instanceof kf||t instanceof js||t instanceof np||t instanceof Vs||Lf&&t instanceof Lf?C.texSubImage2D(C.TEXTURE_2D,0,k,D,C.RGBA,C.UNSIGNED_BYTE,t):C.texSubImage2D(C.TEXTURE_2D,0,k,D,p,m,C.RGBA,C.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)},Rf.prototype.bind=function(t,a,s){var p=this.context.gl;p.bindTexture(p.TEXTURE_2D,this.texture),s!==p.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(s=p.LINEAR),t!==this.filter&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MAG_FILTER,t),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_MIN_FILTER,s||t),this.filter=t),a!==this.wrap&&(p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_S,a),p.texParameteri(p.TEXTURE_2D,p.TEXTURE_WRAP_T,a),this.wrap=a)},Rf.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Rf.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var ed=function(t){var a=this;this._callback=t,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){a._triggered=!1,a._callback()})};ed.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){t._triggered=!1,t._callback()},0))},ed.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Df=function(t,a,s){this.target=t,this.parent=a,this.mapId=s,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Ar(["receive","process"],this),this.invoker=new ed(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ir()?t:fe};function td(t,a,s){var p=2*Math.PI*6378137/256/Math.pow(2,s);return[t*p-2*Math.PI*6378137/2,a*p-2*Math.PI*6378137/2]}Df.prototype.send=function(t,a,s,p,m){var g=this;m===void 0&&(m=!1);var w=Math.round(1e18*Math.random()).toString(36).substring(0,10);s&&(this.callbacks[w]=s);var C=Ve(this.globalScope)?void 0:[];return this.target.postMessage({id:w,type:t,hasCallback:!!s,targetMapId:p,mustQueue:m,sourceMapId:this.mapId,data:Fs(a,C)},C),{cancel:function(){s&&delete g.callbacks[w],g.target.postMessage({id:w,type:"<cancel>",targetMapId:p,sourceMapId:g.mapId})}}},Df.prototype.receive=function(t){var a=t.data,s=a.id;if(s&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){delete this.tasks[s];var p=this.cancelCallbacks[s];delete this.cancelCallbacks[s],p&&p()}else Ir()||a.mustQueue?(this.tasks[s]=a,this.taskQueue.push(s),this.invoker.trigger()):this.processTask(s,a)},Df.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),a=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),a&&this.processTask(t,a)}},Df.prototype.processTask=function(t,a){var s=this;if(a.type==="<response>"){var p=this.callbacks[t];delete this.callbacks[t],p&&(a.error?p(ss(a.error)):p(null,ss(a.data)))}else{var m=!1,g=Ve(this.globalScope)?void 0:[],w=a.hasCallback?function(D,B){m=!0,delete s.cancelCallbacks[t],s.target.postMessage({id:t,type:"<response>",sourceMapId:s.mapId,error:D?Fs(D):null,data:Fs(B,g)},g)}:function(D){m=!0},C=null,I=ss(a.data);if(this.parent[a.type])C=this.parent[a.type](a.sourceMapId,I,w);else if(this.parent.getWorkerSource){var k=a.type.split(".");C=this.parent.getWorkerSource(a.sourceMapId,k[0],I.source)[k[1]](I,w)}else w(new Error("Could not find function "+a.type));!m&&C&&C.cancel&&(this.cancelCallbacks[t]=C.cancel)}},Df.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var $a=function(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};$a.prototype.setNorthEast=function(t){return this._ne=t instanceof Xi?new Xi(t.lng,t.lat):Xi.convert(t),this},$a.prototype.setSouthWest=function(t){return this._sw=t instanceof Xi?new Xi(t.lng,t.lat):Xi.convert(t),this},$a.prototype.extend=function(t){var a,s,p=this._sw,m=this._ne;if(t instanceof Xi)a=t,s=t;else{if(!(t instanceof $a))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend($a.convert(t)):this.extend(Xi.convert(t)):this;if(s=t._ne,!(a=t._sw)||!s)return this}return p||m?(p.lng=Math.min(a.lng,p.lng),p.lat=Math.min(a.lat,p.lat),m.lng=Math.max(s.lng,m.lng),m.lat=Math.max(s.lat,m.lat)):(this._sw=new Xi(a.lng,a.lat),this._ne=new Xi(s.lng,s.lat)),this},$a.prototype.getCenter=function(){return new Xi((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},$a.prototype.getSouthWest=function(){return this._sw},$a.prototype.getNorthEast=function(){return this._ne},$a.prototype.getNorthWest=function(){return new Xi(this.getWest(),this.getNorth())},$a.prototype.getSouthEast=function(){return new Xi(this.getEast(),this.getSouth())},$a.prototype.getWest=function(){return this._sw.lng},$a.prototype.getSouth=function(){return this._sw.lat},$a.prototype.getEast=function(){return this._ne.lng},$a.prototype.getNorth=function(){return this._ne.lat},$a.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},$a.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},$a.prototype.isEmpty=function(){return!(this._sw&&this._ne)},$a.prototype.contains=function(t){var a=Xi.convert(t),s=a.lng,p=a.lat,m=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m},$a.convert=function(t){return!t||t instanceof $a?t:new $a(t)};var Xi=function(t,a){if(isNaN(t)||isNaN(a))throw new Error("Invalid LngLat object: ("+t+", "+a+")");if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Xi.prototype.wrap=function(){return new Xi(Jt(this.lng,-180,180),this.lat)},Xi.prototype.toArray=function(){return[this.lng,this.lat]},Xi.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Xi.prototype.distanceTo=function(t){var a=Math.PI/180,s=this.lat*a,p=t.lat*a,m=Math.sin(s)*Math.sin(p)+Math.cos(s)*Math.cos(p)*Math.cos((t.lng-this.lng)*a);return 63710088e-1*Math.acos(Math.min(m,1))},Xi.prototype.toBounds=function(t){t===void 0&&(t=0);var a=360*t/40075017,s=a/Math.cos(Math.PI/180*this.lat);return new $a(new Xi(this.lng-s,this.lat-a),new Xi(this.lng+s,this.lat+a))},Xi.convert=function(t){if(t instanceof Xi)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new Xi(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new Xi(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var rd=2*Math.PI*63710088e-1;function nd(t){return rd*Math.cos(t*Math.PI/180)}function id(t){return(180+t)/360}function Bd(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Nd(t,a){return t/nd(a)}function ad(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var tf=function(t,a,s){s===void 0&&(s=0),this.x=+t,this.y=+a,this.z=+s};tf.fromLngLat=function(t,a){a===void 0&&(a=0);var s=Xi.convert(t);return new tf(id(s.lng),Bd(s.lat),Nd(a,s.lat))},tf.prototype.toLngLat=function(){return new Xi(360*this.x-180,ad(this.y))},tf.prototype.toAltitude=function(){return this.z*nd(ad(this.y))},tf.prototype.meterInMercatorCoordinateUnits=function(){return 1/rd*(t=ad(this.y),1/Math.cos(t*Math.PI/180));var t};var Ff=function(t,a,s){this.z=t,this.x=a,this.y=s,this.key=Lp(0,t,t,a,s)};Ff.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},Ff.prototype.url=function(t,a){var s,p,m,g,w,C=(p=this.y,m=this.z,g=td(256*(s=this.x),256*(p=Math.pow(2,m)-p-1),m),w=td(256*(s+1),256*(p+1),m),g[0]+","+g[1]+","+w[0]+","+w[1]),I=function(k,D,B){for(var V,q="",we=k;we>0;we--)q+=(D&(V=1<<we-1)?1:0)+(B&V?2:0);return q}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",I).replace("{bbox-epsg-3857}",C)},Ff.prototype.getTilePoint=function(t){var a=Math.pow(2,this.z);return new me(8192*(t.x*a-this.x),8192*(t.y*a-this.y))},Ff.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var od=function(t,a){this.wrap=t,this.canonical=a,this.key=Lp(t,a.z,a.z,a.x,a.y)},oo=function(t,a,s,p,m){this.overscaledZ=t,this.wrap=a,this.canonical=new Ff(s,+p,+m),this.key=Lp(a,t,s,p,m)};function Lp(t,a,s,p,m){(t*=2)<0&&(t=-1*t-1);var g=1<<s;return(g*g*t+g*m+p).toString(36)+s.toString(36)+a.toString(36)}oo.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},oo.prototype.scaledTo=function(t){var a=this.canonical.z-t;return t>this.canonical.z?new oo(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new oo(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)},oo.prototype.calculateScaledKey=function(t,a){var s=this.canonical.z-t;return t>this.canonical.z?Lp(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y):Lp(this.wrap*+a,t,t,this.canonical.x>>s,this.canonical.y>>s)},oo.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a},oo.prototype.children=function(t){if(this.overscaledZ>=t)return[new oo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var a=this.canonical.z+1,s=2*this.canonical.x,p=2*this.canonical.y;return[new oo(a,this.wrap,a,s,p),new oo(a,this.wrap,a,s+1,p),new oo(a,this.wrap,a,s,p+1),new oo(a,this.wrap,a,s+1,p+1)]},oo.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},oo.prototype.wrapped=function(){return new oo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},oo.prototype.unwrapTo=function(t){return new oo(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},oo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},oo.prototype.toUnwrapped=function(){return new od(this.wrap,this.canonical)},oo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},oo.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new tf(t.x-this.wrap,t.y))},Gr("CanonicalTileID",Ff),Gr("OverscaledTileID",oo,{omit:["posMatrix"]});var uu=function(t,a,s){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(s&&s!=="mapbox"&&s!=="terrarium")return Ye('"'+s+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=a.height;var p=this.dim=a.height-2;this.data=new Uint32Array(a.data.buffer),this.encoding=s||"mapbox";for(var m=0;m<p;m++)this.data[this._idx(-1,m)]=this.data[this._idx(0,m)],this.data[this._idx(p,m)]=this.data[this._idx(p-1,m)],this.data[this._idx(m,-1)]=this.data[this._idx(m,0)],this.data[this._idx(m,p)]=this.data[this._idx(m,p-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(p,-1)]=this.data[this._idx(p-1,0)],this.data[this._idx(-1,p)]=this.data[this._idx(0,p-1)],this.data[this._idx(p,p)]=this.data[this._idx(p-1,p-1)]};uu.prototype.get=function(t,a){var s=new Uint8Array(this.data.buffer),p=4*this._idx(t,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(s[p],s[p+1],s[p+2])},uu.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},uu.prototype._idx=function(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)},uu.prototype._unpackMapbox=function(t,a,s){return(256*t*256+256*a+s)/10-1e4},uu.prototype._unpackTerrarium=function(t,a,s){return 256*t+a+s/256-32768},uu.prototype.getPixels=function(){return new qa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},uu.prototype.backfillBorder=function(t,a,s){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var p=a*this.dim,m=a*this.dim+this.dim,g=s*this.dim,w=s*this.dim+this.dim;switch(a){case-1:p=m-1;break;case 1:m=p+1}switch(s){case-1:g=w-1;break;case 1:w=g+1}for(var C=-a*this.dim,I=-s*this.dim,k=g;k<w;k++)for(var D=p;D<m;D++)this.data[this._idx(D,k)]=t.data[this._idx(D+C,k+I)]},Gr("DEMData",uu);var Rp=function(t){this._stringToNumber={},this._numberToString=[];for(var a=0;a<t.length;a++){var s=t[a];this._stringToNumber[s]=a,this._numberToString[a]=s}};Rp.prototype.encode=function(t){return this._stringToNumber[t]},Rp.prototype.decode=function(t){return this._numberToString[t]};var rf=function(t,a,s,p,m){this.type="Feature",this._vectorTileFeature=t,t._z=a,t._x=s,t._y=p,this.properties=t.properties,this.id=m},zd={geometry:{configurable:!0}};zd.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},zd.geometry.set=function(t){this._geometry=t},rf.prototype.toJSON=function(){var t={geometry:this.geometry};for(var a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(t[a]=this[a]);return t},Object.defineProperties(rf.prototype,zd);var es=function(){this.state={},this.stateChanges={},this.deletedStates={}};es.prototype.updateState=function(t,a,s){var p=String(a);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},Ht(this.stateChanges[t][p],s),this.deletedStates[t]===null)for(var m in this.deletedStates[t]={},this.state[t])m!==p&&(this.deletedStates[t][m]=null);else if(this.deletedStates[t]&&this.deletedStates[t][p]===null)for(var g in this.deletedStates[t][p]={},this.state[t][p])s[g]||(this.deletedStates[t][p][g]=null);else for(var w in s)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][w]===null&&delete this.deletedStates[t][p][w]},es.prototype.removeFeatureState=function(t,a,s){if(this.deletedStates[t]!==null){var p=String(a);if(this.deletedStates[t]=this.deletedStates[t]||{},s&&a!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][s]=null);else if(a!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(s in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][s]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}},es.prototype.getState=function(t,a){var s=String(a),p=Ht({},(this.state[t]||{})[s],(this.stateChanges[t]||{})[s]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){var m=this.deletedStates[t][a];if(m===null)return{};for(var g in m)delete p[g]}return p},es.prototype.initializeTileState=function(t,a){t.setFeatureState(this.state,a)},es.prototype.coalesceChanges=function(t,a){var s={};for(var p in this.stateChanges){this.state[p]=this.state[p]||{};var m={};for(var g in this.stateChanges[p])this.state[p][g]||(this.state[p][g]={}),Ht(this.state[p][g],this.stateChanges[p][g]),m[g]=this.state[p][g];s[p]=m}for(var w in this.deletedStates){this.state[w]=this.state[w]||{};var C={};if(this.deletedStates[w]===null)for(var I in this.state[w])C[I]={},this.state[w][I]={};else for(var k in this.deletedStates[w]){if(this.deletedStates[w][k]===null)this.state[w][k]={};else for(var D=0,B=Object.keys(this.deletedStates[w][k]);D<B.length;D+=1)delete this.state[w][k][B[D]];C[k]=this.state[w][k]}s[w]=s[w]||{},Ht(s[w],C)}if(this.stateChanges={},this.deletedStates={},Object.keys(s).length!==0)for(var V in t)t[V].setFeatureState(s,a)};var Ac=function(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Hu(8192,16,0),this.grid3D=new Hu(8192,16,0),this.featureIndexArray=new z,this.promoteId=a};function Zd(t,a,s,p,m){return Bt(t,function(g,w){var C=a instanceof _l?a.get(w):null;return C&&C.evaluate?C.evaluate(s,p,m):C})}function Ud(t){for(var a=1/0,s=1/0,p=-1/0,m=-1/0,g=0,w=t;g<w.length;g+=1){var C=w[g];a=Math.min(a,C.x),s=Math.min(s,C.y),p=Math.max(p,C.x),m=Math.max(m,C.y)}return{minX:a,minY:s,maxX:p,maxY:m}}function Sm(t,a){return a-t}Ac.prototype.insert=function(t,a,s,p,m,g){var w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,p,m);for(var C=g?this.grid3D:this.grid,I=0;I<a.length;I++){for(var k=a[I],D=[1/0,1/0,-1/0,-1/0],B=0;B<k.length;B++){var V=k[B];D[0]=Math.min(D[0],V.x),D[1]=Math.min(D[1],V.y),D[2]=Math.max(D[2],V.x),D[3]=Math.max(D[3],V.y)}D[0]<8192&&D[1]<8192&&D[2]>=0&&D[3]>=0&&C.insert(w,D[0],D[1],D[2],D[3])}},Ac.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new Cc.VectorTile(new ae(this.rawTileData)).layers,this.sourceLayerCoder=new Rp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Ac.prototype.query=function(t,a,s,p){var m=this;this.loadVTLayers();for(var g=t.params||{},w=8192/t.tileSize/t.scale,C=Vl(g.filter),I=t.queryGeometry,k=t.queryPadding*w,D=Ud(I),B=this.grid.query(D.minX-k,D.minY-k,D.maxX+k,D.maxY+k),V=Ud(t.cameraQueryGeometry),q=this.grid3D.query(V.minX-k,V.minY-k,V.maxX+k,V.maxY+k,function(St,xt,kt,or){return function(Nt,un,kr,cn,Br){for(var Kn=0,En=Nt;Kn<En.length;Kn+=1){var Qr=En[Kn];if(un<=Qr.x&&kr<=Qr.y&&cn>=Qr.x&&Br>=Qr.y)return!0}var oi=[new me(un,kr),new me(un,Br),new me(cn,Br),new me(cn,kr)];if(Nt.length>2){for(var Rn=0,gi=oi;Rn<gi.length;Rn+=1)if(Bs(Nt,gi[Rn]))return!0}for(var fn=0;fn<Nt.length-1;fn++)if(Ku(Nt[fn],Nt[fn+1],oi))return!0;return!1}(t.cameraQueryGeometry,St-k,xt-k,kt+k,or+k)}),we=0,Ce=q;we<Ce.length;we+=1)B.push(Ce[we]);B.sort(Sm);for(var ze,Le={},qe=function(St){var xt=B[St];if(xt!==ze){ze=xt;var kt=m.featureIndexArray.get(xt),or=null;m.loadMatchingFeature(Le,kt.bucketIndex,kt.sourceLayerIndex,kt.featureIndex,C,g.layers,g.availableImages,a,s,p,function(Nt,un,kr){return or||(or=ra(Nt)),un.queryIntersectsFeature(I,Nt,kr,or,m.z,t.transform,w,t.pixelPosMatrix)})}},st=0;st<B.length;st++)qe(st);return Le},Ac.prototype.loadMatchingFeature=function(t,a,s,p,m,g,w,C,I,k,D){var B=this.bucketLayerIDs[a];if(!g||function(Nt,un){for(var kr=0;kr<Nt.length;kr++)if(un.indexOf(Nt[kr])>=0)return!0;return!1}(g,B)){var V=this.sourceLayerCoder.decode(s),q=this.vtLayers[V].feature(p);if(m.needGeometry){var we=_a(q,!0);if(!m.filter(new Xn(this.tileID.overscaledZ),we,this.tileID.canonical))return}else if(!m.filter(new Xn(this.tileID.overscaledZ),q))return;for(var Ce=this.getId(q,V),ze=0;ze<B.length;ze++){var Le=B[ze];if(!(g&&g.indexOf(Le)<0)){var qe=C[Le];if(qe){var st={};Ce!==void 0&&k&&(st=k.getState(qe.sourceLayer||"_geojsonTileLayer",Ce));var St=Ht({},I[Le]);St.paint=Zd(St.paint,qe.paint,q,st,w),St.layout=Zd(St.layout,qe.layout,q,st,w);var xt=!D||D(q,qe,st);if(xt){var kt=new rf(q,this.z,this.x,this.y,Ce);kt.layer=St;var or=t[Le];or===void 0&&(or=t[Le]=[]),or.push({featureIndex:p,feature:kt,intersectionZ:xt})}}}}}},Ac.prototype.lookupSymbolFeatures=function(t,a,s,p,m,g,w,C){var I={};this.loadVTLayers();for(var k=Vl(m),D=0,B=t;D<B.length;D+=1)this.loadMatchingFeature(I,s,p,B[D],k,g,w,C,a);return I},Ac.prototype.hasLayer=function(t){for(var a=0,s=this.bucketLayerIDs;a<s.length;a+=1)for(var p=0,m=s[a];p<m.length;p+=1)if(t===m[p])return!0;return!1},Ac.prototype.getId=function(t,a){var s=t.id;return this.promoteId&&typeof(s=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]])=="boolean"&&(s=Number(s)),s},Gr("FeatureIndex",Ac,{omit:["rawTileData","sourceLayerCoder"]});var Eo=function(t,a){this.tileID=t,this.uid=jt(),this.uses=0,this.tileSize=a,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};Eo.prototype.registerFadeDuration=function(t){var a=t+this.timeAdded;a<wi.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)},Eo.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},Eo.prototype.loadVectorData=function(t,a,s){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var p in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(k,D){var B={};if(!D)return B;for(var V=function(){var Ce=we[q],ze=Ce.layerIds.map(function(st){return D.getLayer(st)}).filter(Boolean);if(ze.length!==0){Ce.layers=ze,Ce.stateDependentLayerIds&&(Ce.stateDependentLayers=Ce.stateDependentLayerIds.map(function(st){return ze.filter(function(St){return St.id===st})[0]}));for(var Le=0,qe=ze;Le<qe.length;Le+=1)B[qe[Le].id]=Ce}},q=0,we=k;q<we.length;q+=1)V();return B}(t.buckets,a.style),this.hasSymbolBuckets=!1,this.buckets){var m=this.buckets[p];if(m instanceof mt){if(this.hasSymbolBuckets=!0,!s)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var g in this.buckets){var w=this.buckets[g];if(w instanceof mt&&w.hasRTLText){this.hasRTLText=!0,Ss.isLoading()||Ss.isLoaded()||Cf()!=="deferred"||Js();break}}for(var C in this.queryPadding=0,this.buckets){var I=this.buckets[C];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(C).queryRadius(I))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new f},Eo.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},Eo.prototype.getBucket=function(t){return this.buckets[t.id]},Eo.prototype.upload=function(t){for(var a in this.buckets){var s=this.buckets[a];s.uploadPending()&&s.upload(t)}var p=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Rf(t,this.imageAtlas.image,p.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Rf(t,this.glyphAtlasImage,p.ALPHA),this.glyphAtlasImage=null)},Eo.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},Eo.prototype.queryRenderedFeatures=function(t,a,s,p,m,g,w,C,I,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:m,scale:g,tileSize:this.tileSize,pixelPosMatrix:k,transform:C,params:w,queryPadding:this.queryPadding*I},t,a,s):{}},Eo.prototype.querySourceFeatures=function(t,a){var s=this.latestFeatureIndex;if(s&&s.rawTileData){var p=s.loadVTLayers(),m=a?a.sourceLayer:"",g=p._geojsonTileLayer||p[m];if(g)for(var w=Vl(a&&a.filter),C=this.tileID.canonical,I=C.z,k=C.x,D=C.y,B={z:I,x:k,y:D},V=0;V<g.length;V++){var q=g.feature(V);if(w.needGeometry){var we=_a(q,!0);if(!w.filter(new Xn(this.tileID.overscaledZ),we,this.tileID.canonical))continue}else if(!w.filter(new Xn(this.tileID.overscaledZ),q))continue;var Ce=s.getId(q,m),ze=new rf(q,I,k,D,Ce);ze.tile=B,t.push(ze)}}},Eo.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},Eo.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},Eo.prototype.setExpiryData=function(t){var a=this.expirationTime;if(t.cacheControl){var s=Vr(t.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var p=Date.now(),m=!1;if(this.expirationTime>p)m=!1;else if(a)if(this.expirationTime<a)m=!0;else{var g=this.expirationTime-a;g?this.expirationTime=p+Math.max(g,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},Eo.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},Eo.prototype.setFeatureState=function(t,a){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(t).length!==0){var s=this.latestFeatureIndex.loadVTLayers();for(var p in this.buckets)if(a.style.hasLayer(p)){var m=this.buckets[p],g=m.layers[0].sourceLayer||"_geojsonTileLayer",w=s[g],C=t[g];if(w&&C&&Object.keys(C).length!==0){m.update(C,w,this.imageAtlas&&this.imageAtlas.patternPositions||{});var I=a&&a.style&&a.style.getLayer(p);I&&(this.queryPadding=Math.max(this.queryPadding,I.queryRadius(m)))}}}},Eo.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},Eo.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<wi.now()},Eo.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},Eo.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=wi.now()+t},Eo.prototype.setDependencies=function(t,a){for(var s={},p=0,m=a;p<m.length;p+=1)s[m[p]]=!0;this.dependencies[t]=s},Eo.prototype.hasDependency=function(t,a){for(var s=0,p=t;s<p.length;s+=1){var m=this.dependencies[p[s]];if(m){for(var g=0,w=a;g<w.length;g+=1)if(m[w[g]])return!0}}return!1};var Bf=fe.performance,jd=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},Bf.mark(this._marks.start)};jd.prototype.finish=function(){Bf.mark(this._marks.end);var t=Bf.getEntriesByName(this._marks.measure);return t.length===0&&(Bf.measure(this._marks.measure,this._marks.start,this._marks.end),t=Bf.getEntriesByName(this._marks.measure),Bf.clearMarks(this._marks.start),Bf.clearMarks(this._marks.end),Bf.clearMeasures(this._marks.measure)),t},v.Actor=Df,v.AlphaImage=Zs,v.CanonicalTileID=Ff,v.CollisionBoxArray=f,v.Color=Jn,v.DEMData=uu,v.DataConstantProperty=nn,v.DictionaryCoder=Rp,v.EXTENT=8192,v.ErrorEvent=Ze,v.EvaluationParameters=Xn,v.Event=Te,v.Evented=We,v.FeatureIndex=Ac,v.FillBucket=su,v.FillExtrusionBucket=fo,v.ImageAtlas=an,v.ImagePosition=Xt,v.LineBucket=Go,v.LngLat=Xi,v.LngLatBounds=$a,v.MercatorCoordinate=tf,v.ONE_EM=24,v.OverscaledTileID=oo,v.Point=me,v.Point$1=me,v.Properties=ya,v.Protobuf=ae,v.RGBAImage=qa,v.RequestManager=Si,v.RequestPerformance=jd,v.ResourceType=Mn,v.SegmentVector=ee,v.SourceFeatureState=es,v.StructArrayLayout1ui2=qc,v.StructArrayLayout2f1f2i16=Au,v.StructArrayLayout2i4=Yu,v.StructArrayLayout3ui6=Mu,v.StructArrayLayout4i8=Wc,v.SymbolBucket=mt,v.Texture=Rf,v.Tile=Eo,v.Transitionable=Ma,v.Uniform1f=xr,v.Uniform1i=qt,v.Uniform2f=pr,v.Uniform3f=Fr,v.Uniform4f=tn,v.UniformColor=pn,v.UniformMatrix4f=pi,v.UnwrappedTileID=od,v.ValidationError=Ie,v.WritingMode=hn,v.ZoomHistory=yl,v.add=function(t,a,s){return t[0]=a[0]+s[0],t[1]=a[1]+s[1],t[2]=a[2]+s[2],t},v.addDynamicAttributes=ce,v.asyncAll=function(t,a,s){if(!t.length)return s(null,[]);var p=t.length,m=new Array(t.length),g=null;t.forEach(function(w,C){a(w,function(I,k){I&&(g=I),m[C]=k,--p==0&&s(g,m)})})},v.bezier=be,v.bindAll=Ar,v.browser=wi,v.cacheEntryPossiblyAdded=function(t){++Fn>Cr&&(t.getActor().send("enforceCacheSizeLimit",Yt),Fn=0)},v.clamp=M,v.clearTileCache=function(t){var a=fe.caches.delete("mapbox-tiles");t&&a.catch(t).then(function(){return t()})},v.clipLine=mn,v.clone=function(t){var a=new di(16);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a},v.clone$1=He,v.clone$2=function(t){var a=new di(3);return a[0]=t[0],a[1]=t[1],a[2]=t[2],a},v.collisionCircleLayout=xh,v.config=On,v.create=function(){var t=new di(16);return di!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},v.create$1=function(){var t=new di(9);return di!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},v.create$2=function(){var t=new di(4);return di!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},v.createCommonjsModule=ye,v.createExpression=pl,v.createLayout=pa,v.createStyleLayer=function(t){return t.type==="custom"?new ba(t):new vo[t.type](t)},v.cross=function(t,a,s){var p=a[0],m=a[1],g=a[2],w=s[0],C=s[1],I=s[2];return t[0]=m*I-g*C,t[1]=g*w-p*I,t[2]=p*C-m*w,t},v.deepEqual=function t(a,s){if(Array.isArray(a)){if(!Array.isArray(s)||a.length!==s.length)return!1;for(var p=0;p<a.length;p++)if(!t(a[p],s[p]))return!1;return!0}if(typeof a=="object"&&a!==null&&s!==null){if(typeof s!="object"||Object.keys(a).length!==Object.keys(s).length)return!1;for(var m in a)if(!t(a[m],s[m]))return!1;return!0}return a===s},v.dot=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]},v.dot$1=function(t,a){return t[0]*a[0]+t[1]*a[1]+t[2]*a[2]+t[3]*a[3]},v.ease=Pe,v.emitValidationErrors=Gu,v.endsWith=cr,v.enforceCacheSizeLimit=function(t){zr(),Ha&&Ha.then(function(a){a.keys().then(function(s){for(var p=0;p<s.length-t;p++)a.delete(s[p])})})},v.evaluateSizeForFeature=Na,v.evaluateSizeForZoom=za,v.evaluateVariableOffset=Be,v.evented=ep,v.extend=Ht,v.featureFilter=Vl,v.filterObject=ot,v.fromRotation=function(t,a){var s=Math.sin(a),p=Math.cos(a);return t[0]=p,t[1]=s,t[2]=0,t[3]=-s,t[4]=p,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},v.getAnchorAlignment=xa,v.getAnchorJustification=Qe,v.getArrayBuffer=ks,v.getImage=U,v.getJSON=function(t,a){return du(Ht(t,{type:"json"}),a)},v.getRTLTextPluginStatus=Cf,v.getReferrer=ni,v.getVideo=function(t,a){var s,p,m=fe.document.createElement("video");m.muted=!0,m.onloadstart=function(){a(null,m)};for(var g=0;g<t.length;g++){var w=fe.document.createElement("source");s=t[g],p=void 0,(p=fe.document.createElement("a")).href=s,(p.protocol!==fe.document.location.protocol||p.host!==fe.document.location.host)&&(m.crossOrigin="Anonymous"),w.src=t[g],m.appendChild(w)}return{cancel:function(){}}},v.identity=io,v.invert=function(t,a){var s=a[0],p=a[1],m=a[2],g=a[3],w=a[4],C=a[5],I=a[6],k=a[7],D=a[8],B=a[9],V=a[10],q=a[11],we=a[12],Ce=a[13],ze=a[14],Le=a[15],qe=s*C-p*w,st=s*I-m*w,St=s*k-g*w,xt=p*I-m*C,kt=p*k-g*C,or=m*k-g*I,Nt=D*Ce-B*we,un=D*ze-V*we,kr=D*Le-q*we,cn=B*ze-V*Ce,Br=B*Le-q*Ce,Kn=V*Le-q*ze,En=qe*Kn-st*Br+St*cn+xt*kr-kt*un+or*Nt;return En?(t[0]=(C*Kn-I*Br+k*cn)*(En=1/En),t[1]=(m*Br-p*Kn-g*cn)*En,t[2]=(Ce*or-ze*kt+Le*xt)*En,t[3]=(V*kt-B*or-q*xt)*En,t[4]=(I*kr-w*Kn-k*un)*En,t[5]=(s*Kn-m*kr+g*un)*En,t[6]=(ze*St-we*or-Le*st)*En,t[7]=(D*or-V*St+q*st)*En,t[8]=(w*Br-C*kr+k*Nt)*En,t[9]=(p*kr-s*Br-g*Nt)*En,t[10]=(we*kt-Ce*St+Le*qe)*En,t[11]=(B*St-D*kt-q*qe)*En,t[12]=(C*un-w*cn-I*Nt)*En,t[13]=(s*cn-p*un+m*Nt)*En,t[14]=(Ce*st-we*xt-ze*qe)*En,t[15]=(D*xt-B*st+V*qe)*En,t):null},v.isChar=dr,v.isMapboxURL=da,v.keysDifference=function(t,a){var s=[];for(var p in t)p in a||s.push(p);return s},v.makeRequest=du,v.mapObject=Bt,v.mercatorXfromLng=id,v.mercatorYfromLat=Bd,v.mercatorZfromAltitude=Nd,v.mul=$u,v.multiply=ao,v.mvt=Cc,v.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},v.normalize=function(t,a){var s=a[0],p=a[1],m=a[2],g=s*s+p*p+m*m;return g>0&&(g=1/Math.sqrt(g)),t[0]=a[0]*g,t[1]=a[1]*g,t[2]=a[2]*g,t},v.number=la,v.offscreenCanvasSupported=$n,v.ortho=function(t,a,s,p,m,g,w){var C=1/(a-s),I=1/(p-m),k=1/(g-w);return t[0]=-2*C,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*I,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*k,t[11]=0,t[12]=(a+s)*C,t[13]=(m+p)*I,t[14]=(w+g)*k,t[15]=1,t},v.parseGlyphPBF=function(t){return new ae(t).readFields(Wt,[])},v.pbf=ae,v.performSymbolLayout=function(t,a,s,p,m,g,w){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var C=t.layers[0].layout,I=t.layers[0]._unevaluatedLayout._values,k={};if(t.textSizeData.kind==="composite"){var D=t.textSizeData,B=D.maxZoom;k.compositeTextSizes=[I["text-size"].possiblyEvaluate(new Xn(D.minZoom),w),I["text-size"].possiblyEvaluate(new Xn(B),w)]}if(t.iconSizeData.kind==="composite"){var V=t.iconSizeData,q=V.maxZoom;k.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new Xn(V.minZoom),w),I["icon-size"].possiblyEvaluate(new Xn(q),w)]}k.layoutTextSize=I["text-size"].possiblyEvaluate(new Xn(t.zoom+1),w),k.layoutIconSize=I["icon-size"].possiblyEvaluate(new Xn(t.zoom+1),w),k.textMaxSize=I["text-size"].possiblyEvaluate(new Xn(18));for(var we=24*C.get("text-line-height"),Ce=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",ze=C.get("text-keep-upright"),Le=C.get("text-size"),qe=function(){var xt=St[st],kt=C.get("text-font").evaluate(xt,{},w).join(","),or=Le.evaluate(xt,{},w),Nt=k.layoutTextSize.evaluate(xt,{},w),un=k.layoutIconSize.evaluate(xt,{},w),kr={horizontal:{},vertical:void 0},cn=xt.text,Br=[0,0];if(cn){var Kn=cn.toString(),En=24*C.get("text-letter-spacing").evaluate(xt,{},w),Qr=function(ci){for(var Zi=0,Fi=ci;Zi<Fi.length;Zi+=1)if(_i=Fi[Zi].charCodeAt(0),dr.Arabic(_i)||dr["Arabic Supplement"](_i)||dr["Arabic Extended-A"](_i)||dr["Arabic Presentation Forms-A"](_i)||dr["Arabic Presentation Forms-B"](_i))return!1;var _i;return!0}(Kn)?En:0,oi=C.get("text-anchor").evaluate(xt,{},w),Rn=C.get("text-variable-anchor");if(!Rn){var gi=C.get("text-radial-offset").evaluate(xt,{},w);Br=gi?Be(oi,[24*gi,$]):C.get("text-offset").evaluate(xt,{},w).map(function(ci){return 24*ci})}var fn=Ce?"center":C.get("text-justify").evaluate(xt,{},w),Ci=C.get("symbol-placement"),aa=Ci==="point"?24*C.get("text-max-width").evaluate(xt,{},w):0,Za=function(){t.allowVerticalPlacement&&bf(Kn)&&(kr.vertical=Vt(cn,a,s,m,kt,aa,we,oi,"left",Qr,Br,hn.vertical,!0,Ci,Nt,or))};if(!Ce&&Rn){for(var wa=fn==="auto"?Rn.map(function(ci){return Qe(ci)}):[fn],oa=!1,ka=0;ka<wa.length;ka++){var mo=wa[ka];if(!kr.horizontal[mo])if(oa)kr.horizontal[mo]=kr.horizontal[0];else{var yo=Vt(cn,a,s,m,kt,aa,we,"center",mo,Qr,Br,hn.horizontal,!1,Ci,Nt,or);yo&&(kr.horizontal[mo]=yo,oa=yo.positionedLines.length===1)}}Za()}else{fn==="auto"&&(fn=Qe(oi));var hs=Vt(cn,a,s,m,kt,aa,we,oi,fn,Qr,Br,hn.horizontal,!1,Ci,Nt,or);hs&&(kr.horizontal[fn]=hs),Za(),bf(Kn)&&Ce&&ze&&(kr.vertical=Vt(cn,a,s,m,kt,aa,we,oi,fn,Qr,Br,hn.vertical,!1,Ci,Nt,or))}}var Co=void 0,ts=!1;if(xt.icon&&xt.icon.name){var Ja=p[xt.icon.name];Ja&&(Co=function(ci,Zi,Fi){var _i=xa(Fi),ds=Zi[0]-ci.displaySize[0]*_i.horizontalAlign,Do=Zi[1]-ci.displaySize[1]*_i.verticalAlign;return{image:ci,top:Do,bottom:Do+ci.displaySize[1],left:ds,right:ds+ci.displaySize[0]}}(m[xt.icon.name],C.get("icon-offset").evaluate(xt,{},w),C.get("icon-anchor").evaluate(xt,{},w)),ts=Ja.sdf,t.sdfIcons===void 0?t.sdfIcons=Ja.sdf:t.sdfIcons!==Ja.sdf&&Ye("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ja.pixelRatio!==t.pixelRatio||C.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}var go=Ue(kr.horizontal)||kr.vertical;t.iconsInText=!!go&&go.iconsInText,(go||Co)&&function(ci,Zi,Fi,_i,ds,Do,Yi,Ua,Ho,Ti,Mc){var Gs=Do.textMaxSize.evaluate(Zi,{});Gs===void 0&&(Gs=Yi);var Pl,ja=ci.layers[0].layout,rc=ja.get("icon-offset").evaluate(Zi,{},Mc),Iu=Ue(Fi.horizontal),ip=Yi/24,Nf=ci.tilePixelRatio*ip,ap=ci.tilePixelRatio*Gs/24,Pc=ci.tilePixelRatio*Ua,lu=ci.tilePixelRatio*ja.get("symbol-spacing"),nf=ja.get("text-padding")*ci.tilePixelRatio,cu=ja.get("icon-padding")*ci.tilePixelRatio,Ms=ja.get("text-max-angle")/180*Math.PI,af=ja.get("text-rotation-alignment")==="map"&&ja.get("symbol-placement")!=="point",Il=ja.get("icon-rotation-alignment")==="map"&&ja.get("symbol-placement")!=="point",Ou=ja.get("symbol-placement"),of=lu/2,Hs=ja.get("icon-text-fit");_i&&Hs!=="none"&&(ci.allowVerticalPlacement&&Fi.vertical&&(Pl=ai(_i,Fi.vertical,Hs,ja.get("icon-text-fit-padding"),rc,ip)),Iu&&(_i=ai(_i,Iu,Hs,ja.get("icon-text-fit-padding"),rc,ip)));var fu=function(Nv,Up){Up.x<0||Up.x>=8192||Up.y<0||Up.y>=8192||function(Va,kl,Hd,Ru,cd,Wd,jp,Ll,Sh,up,Vp,Eh,fd,Du,Gp,uf,pd,hd,dd,Ch,Ws,Th,Xd,vs,Yd){var qd,ms,lp,Ui,cp,al=Va.addToLineVertexArray(kl,Hd),zv=0,Ps=0,Kd=0,Ah=0,Mh=-1,vd=-1,Ic={},$d=_e(""),Ph=0,Ih=0;if(Ll._unevaluatedLayout.getValue("text-radial-offset")===void 0?(Ph=(qd=Ll.layout.get("text-offset").evaluate(Ws,{},vs).map(function(so){return 24*so}))[0],Ih=qd[1]):(Ph=24*Ll.layout.get("text-radial-offset").evaluate(Ws,{},vs),Ih=$),Va.allowVerticalPlacement&&Ru.vertical){var Hp=Ll.layout.get("text-rotate").evaluate(Ws,{},vs)+90;Ui=new xe(Sh,kl,up,Vp,Eh,Ru.vertical,fd,Du,Gp,Hp),jp&&(cp=new xe(Sh,kl,up,Vp,Eh,jp,pd,hd,Gp,Hp))}if(cd){var Oh=Ll.layout.get("icon-rotate").evaluate(Ws,{}),md=Ll.layout.get("icon-text-fit")!=="none",Jd=ei(cd,Oh,Xd,md),yd=jp?ei(jp,Oh,Xd,md):void 0;lp=new xe(Sh,kl,up,Vp,Eh,cd,pd,hd,!1,Oh),zv=4*Jd.length;var gd=Va.iconSizeData,fp=null;gd.kind==="source"?(fp=[128*Ll.layout.get("icon-size").evaluate(Ws,{})])[0]>32640&&Ye(Va.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):gd.kind==="composite"&&((fp=[128*Th.compositeIconSizes[0].evaluate(Ws,{},vs),128*Th.compositeIconSizes[1].evaluate(Ws,{},vs)])[0]>32640||fp[1]>32640)&&Ye(Va.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),Va.addSymbols(Va.icon,Jd,fp,Ch,dd,Ws,!1,kl,al.lineStartIndex,al.lineLength,-1,vs),Mh=Va.icon.placedSymbolArray.length-1,yd&&(Ps=4*yd.length,Va.addSymbols(Va.icon,yd,fp,Ch,dd,Ws,hn.vertical,kl,al.lineStartIndex,al.lineLength,-1,vs),vd=Va.icon.placedSymbolArray.length-1)}for(var ys in Ru.horizontal){var kh=Ru.horizontal[ys];if(!ms){$d=_e(kh.text);var Zv=Ll.layout.get("text-rotate").evaluate(Ws,{},vs);ms=new xe(Sh,kl,up,Vp,Eh,kh,fd,Du,Gp,Zv)}var _d=kh.positionedLines.length===1;if(Kd+=tt(Va,kl,kh,Wd,Ll,Gp,Ws,uf,al,Ru.vertical?hn.horizontal:hn.horizontalOnly,_d?Object.keys(Ru.horizontal):[ys],Ic,Mh,Th,vs),_d)break}Ru.vertical&&(Ah+=tt(Va,kl,Ru.vertical,Wd,Ll,Gp,Ws,uf,al,hn.vertical,["vertical"],Ic,vd,Th,vs));var Uf=ms?ms.boxStartIndex:Va.collisionBoxArray.length,Uv=ms?ms.boxEndIndex:Va.collisionBoxArray.length,Wp=Ui?Ui.boxStartIndex:Va.collisionBoxArray.length,Qd=Ui?Ui.boxEndIndex:Va.collisionBoxArray.length,ev=lp?lp.boxStartIndex:Va.collisionBoxArray.length,Lh=lp?lp.boxEndIndex:Va.collisionBoxArray.length,tv=cp?cp.boxStartIndex:Va.collisionBoxArray.length,rv=cp?cp.boxEndIndex:Va.collisionBoxArray.length,ic=-1,Rh=function(so,nv){return so&&so.circleDiameter?Math.max(so.circleDiameter,nv):nv};ic=Rh(ms,ic),ic=Rh(Ui,ic),ic=Rh(lp,ic);var xd=(ic=Rh(cp,ic))>-1?1:0;xd&&(ic*=Yd/24),Va.glyphOffsetArray.length>=mt.MAX_GLYPHS&&Ye("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ws.sortKey!==void 0&&Va.addToSortKeyRanges(Va.symbolInstances.length,Ws.sortKey),Va.symbolInstances.emplaceBack(kl.x,kl.y,Ic.right>=0?Ic.right:-1,Ic.center>=0?Ic.center:-1,Ic.left>=0?Ic.left:-1,Ic.vertical||-1,Mh,vd,$d,Uf,Uv,Wp,Qd,ev,Lh,tv,rv,up,Kd,Ah,zv,Ps,xd,0,fd,Ph,Ih,ic)}(ci,Up,Nv,Fi,_i,ds,Pl,ci.layers[0],ci.collisionBoxArray,Zi.index,Zi.sourceLayerIndex,ci.index,Nf,nf,af,Ho,Pc,cu,Il,rc,Zi,Do,Ti,Mc,Yi)};if(Ou==="line")for(var _o=0,ku=mn(Zi.geometry,0,0,8192,8192);_o<ku.length;_o+=1)for(var Lu=ku[_o],sf=0,Dp=Ei(Lu,lu,Ms,Fi.vertical||Iu,_i,24,ap,ci.overscaling,8192);sf<Dp.length;sf+=1){var Fp=Dp[sf];Iu&&Ne(ci,Iu.text,of,Fp)||fu(Lu,Fp)}else if(Ou==="line-center")for(var zf=0,Bp=Zi.geometry;zf<Bp.length;zf+=1){var Np=Bp[zf];if(Np.length>1){var zp=Ro(Np,Ms,Fi.vertical||Iu,_i,24,ap);zp&&fu(Np,zp)}}else if(Zi.type==="Polygon")for(var Zf=0,wh=tc(Zi.geometry,0);Zf<wh.length;Zf+=1){var op=wh[Zf],sp=jr(op,16);fu(op[0],new ha(sp.x,sp.y,0))}else if(Zi.type==="LineString")for(var nc=0,Zp=Zi.geometry;nc<Zp.length;nc+=1){var Ol=Zp[nc];fu(Ol,new ha(Ol[0].x,Ol[0].y,0))}else if(Zi.type==="Point")for(var sd=0,Vd=Zi.geometry;sd<Vd.length;sd+=1)for(var ud=0,Gd=Vd[sd];ud<Gd.length;ud+=1){var ld=Gd[ud];fu([ld],new ha(ld.x,ld.y,0))}}(t,xt,kr,Co,p,k,Nt,un,Br,ts,w)},st=0,St=t.features;st<St.length;st+=1)qe();g&&t.generateCollisionDebugBuffers()},v.perspective=function(t,a,s,p,m){var g,w=1/Math.tan(a/2);return t[0]=w/s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=w,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,m!=null&&m!==1/0?(t[10]=(m+p)*(g=1/(p-m)),t[14]=2*m*p*g):(t[10]=-1,t[14]=-2*p),t},v.pick=function(t,a){for(var s={},p=0;p<a.length;p++){var m=a[p];m in t&&(s[m]=t[m])}return s},v.plugin=Ss,v.polygonIntersectsPolygon=Ts,v.postMapLoadEvent=bt,v.postTurnstileEvent=rs,v.potpack=Sr,v.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],v.register=Gr,v.registerForPluginStateChange=function(t){return t({pluginStatus:us,pluginURL:Xu}),ep.on("pluginStateChange",t),t},v.renderColorRamp=vp,v.rotate=function(t,a,s){var p=a[0],m=a[1],g=a[2],w=a[3],C=Math.sin(s),I=Math.cos(s);return t[0]=p*I+g*C,t[1]=m*I+w*C,t[2]=p*-C+g*I,t[3]=m*-C+w*I,t},v.rotateX=function(t,a,s){var p=Math.sin(s),m=Math.cos(s),g=a[4],w=a[5],C=a[6],I=a[7],k=a[8],D=a[9],B=a[10],V=a[11];return a!==t&&(t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[4]=g*m+k*p,t[5]=w*m+D*p,t[6]=C*m+B*p,t[7]=I*m+V*p,t[8]=k*m-g*p,t[9]=D*m-w*p,t[10]=B*m-C*p,t[11]=V*m-I*p,t},v.rotateZ=function(t,a,s){var p=Math.sin(s),m=Math.cos(s),g=a[0],w=a[1],C=a[2],I=a[3],k=a[4],D=a[5],B=a[6],V=a[7];return a!==t&&(t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15]),t[0]=g*m+k*p,t[1]=w*m+D*p,t[2]=C*m+B*p,t[3]=I*m+V*p,t[4]=k*m-g*p,t[5]=D*m-w*p,t[6]=B*m-C*p,t[7]=V*m-I*p,t},v.scale=function(t,a,s){var p=s[0],m=s[1],g=s[2];return t[0]=a[0]*p,t[1]=a[1]*p,t[2]=a[2]*p,t[3]=a[3]*p,t[4]=a[4]*m,t[5]=a[5]*m,t[6]=a[6]*m,t[7]=a[7]*m,t[8]=a[8]*g,t[9]=a[9]*g,t[10]=a[10]*g,t[11]=a[11]*g,t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},v.scale$1=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t[3]=a[3]*s,t},v.scale$2=function(t,a,s){return t[0]=a[0]*s,t[1]=a[1]*s,t[2]=a[2]*s,t},v.setCacheLimits=function(t,a){Yt=t,Cr=a},v.setRTLTextPlugin=function(t,a,s){if(s===void 0&&(s=!1),us==="deferred"||us==="loading"||us==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Xu=wi.resolveURL(t),us="deferred",Sf=a,gc(),s||Js()},v.sphericalToCartesian=function(t){var a=t[0],s=t[1],p=t[2];return s+=90,s*=Math.PI/180,p*=Math.PI/180,{x:a*Math.cos(s)*Math.sin(p),y:a*Math.sin(s)*Math.sin(p),z:a*Math.cos(p)}},v.sqrLen=function(t){var a=t[0],s=t[1];return a*a+s*s},v.styleSpec=te,v.sub=function(t,a,s){return t[0]=a[0]-s[0],t[1]=a[1]-s[1],t[2]=a[2]-s[2],t},v.symbolSize=Ka,v.transformMat3=function(t,a,s){var p=a[0],m=a[1],g=a[2];return t[0]=p*s[0]+m*s[3]+g*s[6],t[1]=p*s[1]+m*s[4]+g*s[7],t[2]=p*s[2]+m*s[5]+g*s[8],t},v.transformMat4=ou,v.translate=function(t,a,s){var p,m,g,w,C,I,k,D,B,V,q,we,Ce=s[0],ze=s[1],Le=s[2];return a===t?(t[12]=a[0]*Ce+a[4]*ze+a[8]*Le+a[12],t[13]=a[1]*Ce+a[5]*ze+a[9]*Le+a[13],t[14]=a[2]*Ce+a[6]*ze+a[10]*Le+a[14],t[15]=a[3]*Ce+a[7]*ze+a[11]*Le+a[15]):(m=a[1],g=a[2],w=a[3],C=a[4],I=a[5],k=a[6],D=a[7],B=a[8],V=a[9],q=a[10],we=a[11],t[0]=p=a[0],t[1]=m,t[2]=g,t[3]=w,t[4]=C,t[5]=I,t[6]=k,t[7]=D,t[8]=B,t[9]=V,t[10]=q,t[11]=we,t[12]=p*Ce+C*ze+B*Le+a[12],t[13]=m*Ce+I*ze+V*Le+a[13],t[14]=g*Ce+k*ze+q*Le+a[14],t[15]=w*Ce+D*ze+we*Le+a[15]),t},v.triggerPluginCompletionEvent=Ef,v.uniqueId=jt,v.validateCustomStyleLayer=function(t){var a=[],s=t.id;return s===void 0&&a.push({message:"layers."+s+': missing required property "id"'}),t.render===void 0&&a.push({message:"layers."+s+': missing required method "render"'}),t.renderingMode&&t.renderingMode!=="2d"&&t.renderingMode!=="3d"&&a.push({message:"layers."+s+': property "renderingMode" must be either "2d" or "3d"'}),a},v.validateLight=rh,v.validateStyle=Vc,v.values=function(t){var a=[];for(var s in t)a.push(t[s]);return a},v.vectorTile=Cc,v.version="1.13.1",v.warnOnce=Ye,v.webpSupported=An,v.window=fe,v.wrap=Jt}),ve(["./shared"],function(v){"use strict";function ye(N){var U=typeof N;if(U==="number"||U==="boolean"||U==="string"||N==null)return JSON.stringify(N);if(Array.isArray(N)){for(var Y="[",se=0,Te=N;se<Te.length;se+=1)Y+=ye(Te[se])+",";return Y+"]"}for(var Ze=Object.keys(N).sort(),We="{",te=0;te<Ze.length;te++)We+=JSON.stringify(Ze[te])+":"+ye(N[Ze[te]])+",";return We+"}"}function Z(N){for(var U="",Y=0,se=v.refProperties;Y<se.length;Y+=1)U+="/"+ye(N[se[Y]]);return U}var oe=function(N){this.keyCache={},N&&this.replace(N)};oe.prototype.replace=function(N){this._layerConfigs={},this._layers={},this.update(N,[])},oe.prototype.update=function(N,U){for(var Y=this,se=0,Te=N;se<Te.length;se+=1){var Ze=Te[se];this._layerConfigs[Ze.id]=Ze;var We=this._layers[Ze.id]=v.createStyleLayer(Ze);We._featureFilter=v.featureFilter(We.filter),this.keyCache[Ze.id]&&delete this.keyCache[Ze.id]}for(var te=0,Ie=U;te<Ie.length;te+=1){var nt=Ie[te];delete this.keyCache[nt],delete this._layerConfigs[nt],delete this._layers[nt]}this.familiesBySource={};for(var $t=0,lr=function(Pr,Mr){for(var Nn={},Lr=0;Lr<Pr.length;Lr++){var jn=Mr&&Mr[Pr[Lr].id]||Z(Pr[Lr]);Mr&&(Mr[Pr[Lr].id]=jn);var ui=Nn[jn];ui||(ui=Nn[jn]=[]),ui.push(Pr[Lr])}var zn=[];for(var Pn in Nn)zn.push(Nn[Pn]);return zn}(v.values(this._layerConfigs),this.keyCache);$t<lr.length;$t+=1){var pt=lr[$t].map(function(Pr){return Y._layers[Pr.id]}),tr=pt[0];if(tr.visibility!=="none"){var Hr=tr.source||"",Rr=this.familiesBySource[Hr];Rr||(Rr=this.familiesBySource[Hr]={});var Dt=tr.sourceLayer||"_geojsonTileLayer",Dr=Rr[Dt];Dr||(Dr=Rr[Dt]=[]),Dr.push(pt)}}};var me=function(N){var U={},Y=[];for(var se in N){var Te=N[se],Ze=U[se]={};for(var We in Te){var te=Te[+We];if(te&&te.bitmap.width!==0&&te.bitmap.height!==0){var Ie={x:0,y:0,w:te.bitmap.width+2,h:te.bitmap.height+2};Y.push(Ie),Ze[We]={rect:Ie,metrics:te.metrics}}}}var nt=v.potpack(Y),$t=new v.AlphaImage({width:nt.w||1,height:nt.h||1});for(var lr in N){var pt=N[lr];for(var tr in pt){var Hr=pt[+tr];if(Hr&&Hr.bitmap.width!==0&&Hr.bitmap.height!==0){var Rr=U[lr][tr].rect;v.AlphaImage.copy(Hr.bitmap,$t,{x:0,y:0},{x:Rr.x+1,y:Rr.y+1},Hr.bitmap)}}}this.image=$t,this.positions=U};v.register("GlyphAtlas",me);var ie=function(N){this.tileID=new v.OverscaledTileID(N.tileID.overscaledZ,N.tileID.wrap,N.tileID.canonical.z,N.tileID.canonical.x,N.tileID.canonical.y),this.uid=N.uid,this.zoom=N.zoom,this.pixelRatio=N.pixelRatio,this.tileSize=N.tileSize,this.source=N.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=N.showCollisionBoxes,this.collectResourceTiming=!!N.collectResourceTiming,this.returnDependencies=!!N.returnDependencies,this.promoteId=N.promoteId};function fe(N,U,Y){for(var se=new v.EvaluationParameters(U),Te=0,Ze=N;Te<Ze.length;Te+=1)Ze[Te].recalculate(se,Y)}function J(N,U){var Y=v.getArrayBuffer(N.request,function(se,Te,Ze,We){se?U(se):Te&&U(null,{vectorTile:new v.vectorTile.VectorTile(new v.pbf(Te)),rawData:Te,cacheControl:Ze,expires:We})});return function(){Y.cancel(),U()}}ie.prototype.parse=function(N,U,Y,se,Te){var Ze=this;this.status="parsing",this.data=N,this.collisionBoxArray=new v.CollisionBoxArray;var We=new v.DictionaryCoder(Object.keys(N.layers).sort()),te=new v.FeatureIndex(this.tileID,this.promoteId);te.bucketLayerIDs=[];var Ie,nt,$t,lr,pt={},tr={featureIndex:te,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:Y},Hr=U.familiesBySource[this.source];for(var Rr in Hr){var Dt=N.layers[Rr];if(Dt){Dt.version===1&&v.warnOnce('Vector tile source "'+this.source+'" layer "'+Rr+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Dr=We.encode(Rr),Pr=[],Mr=0;Mr<Dt.length;Mr++){var Nn=Dt.feature(Mr),Lr=te.getId(Nn,Rr);Pr.push({feature:Nn,id:Lr,index:Mr,sourceLayerIndex:Dr})}for(var jn=0,ui=Hr[Rr];jn<ui.length;jn+=1){var zn=ui[jn],Pn=zn[0];Pn.minzoom&&this.zoom<Math.floor(Pn.minzoom)||Pn.maxzoom&&this.zoom>=Pn.maxzoom||Pn.visibility!=="none"&&(fe(zn,this.zoom,Y),(pt[Pn.id]=Pn.createBucket({index:te.bucketLayerIDs.length,layers:zn,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Dr,sourceID:this.source})).populate(Pr,tr,this.tileID.canonical),te.bucketLayerIDs.push(zn.map(function(Wn){return Wn.id})))}}}var Vn=v.mapObject(tr.glyphDependencies,function(Wn){return Object.keys(Wn).map(Number)});Object.keys(Vn).length?se.send("getGlyphs",{uid:this.uid,stacks:Vn},function(Wn,Zn){Ie||(Ie=Wn,nt=Zn,Li.call(Ze))}):nt={};var Sa=Object.keys(tr.iconDependencies);Sa.length?se.send("getImages",{icons:Sa,source:this.source,tileID:this.tileID,type:"icons"},function(Wn,Zn){Ie||(Ie=Wn,$t=Zn,Li.call(Ze))}):$t={};var vi=Object.keys(tr.patternDependencies);function Li(){if(Ie)return Te(Ie);if(nt&&$t&&lr){var Wn=new me(nt),Zn=new v.ImageAtlas($t,lr);for(var Jn in pt){var Qi=pt[Jn];Qi instanceof v.SymbolBucket?(fe(Qi.layers,this.zoom,Y),v.performSymbolLayout(Qi,nt,Wn.positions,$t,Zn.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Qi.hasPattern&&(Qi instanceof v.LineBucket||Qi instanceof v.FillBucket||Qi instanceof v.FillExtrusionBucket)&&(fe(Qi.layers,this.zoom,Y),Qi.addFeatures(tr,this.tileID.canonical,Zn.patternPositions))}this.status="done",Te(null,{buckets:v.values(pt).filter(function(gs){return!gs.isEmpty()}),featureIndex:te,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Wn.image,imageAtlas:Zn,glyphMap:this.returnDependencies?nt:null,iconMap:this.returnDependencies?$t:null,glyphPositions:this.returnDependencies?Wn.positions:null})}}vi.length?se.send("getImages",{icons:vi,source:this.source,tileID:this.tileID,type:"patterns"},function(Wn,Zn){Ie||(Ie=Wn,lr=Zn,Li.call(Ze))}):lr={},Li.call(this)};var be=function(N,U,Y,se){this.actor=N,this.layerIndex=U,this.availableImages=Y,this.loadVectorData=se||J,this.loading={},this.loaded={}};be.prototype.loadTile=function(N,U){var Y=this,se=N.uid;this.loading||(this.loading={});var Te=!!(N&&N.request&&N.request.collectResourceTiming)&&new v.RequestPerformance(N.request),Ze=this.loading[se]=new ie(N);Ze.abort=this.loadVectorData(N,function(We,te){if(delete Y.loading[se],We||!te)return Ze.status="done",Y.loaded[se]=Ze,U(We);var Ie=te.rawData,nt={};te.expires&&(nt.expires=te.expires),te.cacheControl&&(nt.cacheControl=te.cacheControl);var $t={};if(Te){var lr=Te.finish();lr&&($t.resourceTiming=JSON.parse(JSON.stringify(lr)))}Ze.vectorTile=te.vectorTile,Ze.parse(te.vectorTile,Y.layerIndex,Y.availableImages,Y.actor,function(pt,tr){if(pt||!tr)return U(pt);U(null,v.extend({rawTileData:Ie.slice(0)},tr,nt,$t))}),Y.loaded=Y.loaded||{},Y.loaded[se]=Ze})},be.prototype.reloadTile=function(N,U){var Y=this,se=this.loaded,Te=N.uid,Ze=this;if(se&&se[Te]){var We=se[Te];We.showCollisionBoxes=N.showCollisionBoxes;var te=function(Ie,nt){var $t=We.reloadCallback;$t&&(delete We.reloadCallback,We.parse(We.vectorTile,Ze.layerIndex,Y.availableImages,Ze.actor,$t)),U(Ie,nt)};We.status==="parsing"?We.reloadCallback=te:We.status==="done"&&(We.vectorTile?We.parse(We.vectorTile,this.layerIndex,this.availableImages,this.actor,te):te())}},be.prototype.abortTile=function(N,U){var Y=this.loading,se=N.uid;Y&&Y[se]&&Y[se].abort&&(Y[se].abort(),delete Y[se]),U()},be.prototype.removeTile=function(N,U){var Y=this.loaded,se=N.uid;Y&&Y[se]&&delete Y[se],U()};var Pe=v.window.ImageBitmap,M=function(){this.loaded={}};function Jt(N,U){if(N.length!==0){Ht(N[0],U);for(var Y=1;Y<N.length;Y++)Ht(N[Y],!U)}}function Ht(N,U){for(var Y=0,se=0,Te=N.length,Ze=Te-1;se<Te;Ze=se++)Y+=(N[se][0]-N[Ze][0])*(N[Ze][1]+N[se][1]);Y>=0!=!!U&&N.reverse()}M.prototype.loadTile=function(N,U){var Y=N.uid,se=N.encoding,Te=N.rawImageData,Ze=Pe&&Te instanceof Pe?this.getImageData(Te):Te,We=new v.DEMData(Y,Ze,se);this.loaded=this.loaded||{},this.loaded[Y]=We,U(null,We)},M.prototype.getImageData=function(N){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);var U=this.offscreenCanvasContext.getImageData(-1,-1,N.width+2,N.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new v.RGBAImage({width:U.width,height:U.height},U.data)},M.prototype.removeTile=function(N){var U=this.loaded,Y=N.uid;U&&U[Y]&&delete U[Y]};var Ft=v.vectorTile.VectorTileFeature.prototype.toGeoJSON,jt=function(N){this._feature=N,this.extent=v.EXTENT,this.type=N.type,this.properties=N.tags,"id"in N&&!isNaN(N.id)&&(this.id=parseInt(N.id,10))};jt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var N=[],U=0,Y=this._feature.geometry;U<Y.length;U+=1){var se=Y[U];N.push([new v.Point$1(se[0],se[1])])}return N}for(var Te=[],Ze=0,We=this._feature.geometry;Ze<We.length;Ze+=1){for(var te=[],Ie=0,nt=We[Ze];Ie<nt.length;Ie+=1){var $t=nt[Ie];te.push(new v.Point$1($t[0],$t[1]))}Te.push(te)}return Te},jt.prototype.toGeoJSON=function(N,U,Y){return Ft.call(this,N,U,Y)};var ft=function(N){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=v.EXTENT,this.length=N.length,this._features=N};ft.prototype.feature=function(N){return new jt(this._features[N])};var dt=v.vectorTile.VectorTileFeature,Ar=cr;function cr(N,U){this.options=U||{},this.features=N,this.length=N.length}function Bt(N,U){this.id=typeof N.id=="number"?N.id:void 0,this.type=N.type,this.rawGeometry=N.type===1?[N.geometry]:N.geometry,this.properties=N.tags,this.extent=U||4096}cr.prototype.feature=function(N){return new Bt(this.features[N],this.options.extent)},Bt.prototype.loadGeometry=function(){var N=this.rawGeometry;this.geometry=[];for(var U=0;U<N.length;U++){for(var Y=N[U],se=[],Te=0;Te<Y.length;Te++)se.push(new v.Point$1(Y[Te][0],Y[Te][1]));this.geometry.push(se)}return this.geometry},Bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var N=this.geometry,U=1/0,Y=-1/0,se=1/0,Te=-1/0,Ze=0;Ze<N.length;Ze++)for(var We=N[Ze],te=0;te<We.length;te++){var Ie=We[te];U=Math.min(U,Ie.x),Y=Math.max(Y,Ie.x),se=Math.min(se,Ie.y),Te=Math.max(Te,Ie.y)}return[U,se,Y,Te]},Bt.prototype.toGeoJSON=dt.prototype.toGeoJSON;var ot=ut,He=Ar;function ut(N){var U=new v.pbf;return function(Y,se){for(var Te in Y.layers)se.writeMessage(3,Ye,Y.layers[Te])}(N,U),U.finish()}function Ye(N,U){var Y;U.writeVarintField(15,N.version||1),U.writeStringField(1,N.name||""),U.writeVarintField(5,N.extent||4096);var se={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<N.length;Y++)se.feature=N.feature(Y),U.writeMessage(2,Lt,se);var Te=se.keys;for(Y=0;Y<Te.length;Y++)U.writeStringField(3,Te[Y]);var Ze=se.values;for(Y=0;Y<Ze.length;Y++)U.writeMessage(4,Ve,Ze[Y])}function Lt(N,U){var Y=N.feature;Y.id!==void 0&&U.writeVarintField(1,Y.id),U.writeMessage(2,ur,N),U.writeVarintField(3,Y.type),U.writeMessage(4,Ee,Y)}function ur(N,U){var Y=N.feature,se=N.keys,Te=N.values,Ze=N.keycache,We=N.valuecache;for(var te in Y.properties){var Ie=Ze[te];Ie===void 0&&(se.push(te),Ze[te]=Ie=se.length-1),U.writeVarint(Ie);var nt=Y.properties[te],$t=typeof nt;$t!=="string"&&$t!=="boolean"&&$t!=="number"&&(nt=JSON.stringify(nt));var lr=$t+":"+nt,pt=We[lr];pt===void 0&&(Te.push(nt),We[lr]=pt=Te.length-1),U.writeVarint(pt)}}function Ir(N,U){return(U<<3)+(7&N)}function Vr(N){return N<<1^N>>31}function Ee(N,U){for(var Y=N.loadGeometry(),se=N.type,Te=0,Ze=0,We=Y.length,te=0;te<We;te++){var Ie=Y[te],nt=1;se===1&&(nt=Ie.length),U.writeVarint(Ir(1,nt));for(var $t=se===3?Ie.length-1:Ie.length,lr=0;lr<$t;lr++){lr===1&&se!==1&&U.writeVarint(Ir(2,$t-1));var pt=Ie[lr].x-Te,tr=Ie[lr].y-Ze;U.writeVarint(Vr(pt)),U.writeVarint(Vr(tr)),Te+=pt,Ze+=tr}se===3&&U.writeVarint(Ir(7,1))}}function Ve(N,U){var Y=typeof N;Y==="string"?U.writeStringField(1,N):Y==="boolean"?U.writeBooleanField(7,N):Y==="number"&&(N%1!=0?U.writeDoubleField(3,N):N<0?U.writeSVarintField(6,N):U.writeVarintField(5,N))}function ke(N,U,Y,se){vt(N,Y,se),vt(U,2*Y,2*se),vt(U,2*Y+1,2*se+1)}function vt(N,U,Y){var se=N[U];N[U]=N[Y],N[Y]=se}function Ke(N,U,Y,se){var Te=N-Y,Ze=U-se;return Te*Te+Ze*Ze}ot.fromVectorTileJs=ut,ot.fromGeojsonVt=function(N,U){U=U||{};var Y={};for(var se in N)Y[se]=new Ar(N[se].features,U),Y[se].name=se,Y[se].version=U.version,Y[se].extent=U.extent;return ut({layers:Y})},ot.GeoJSONWrapper=He;var H=function(N){return N[0]},Je=function(N){return N[1]},Et=function(N,U,Y,se,Te){U===void 0&&(U=H),Y===void 0&&(Y=Je),se===void 0&&(se=64),Te===void 0&&(Te=Float64Array),this.nodeSize=se,this.points=N;for(var Ze=N.length<65536?Uint16Array:Uint32Array,We=this.ids=new Ze(N.length),te=this.coords=new Te(2*N.length),Ie=0;Ie<N.length;Ie++)We[Ie]=Ie,te[2*Ie]=U(N[Ie]),te[2*Ie+1]=Y(N[Ie]);(function nt($t,lr,pt,tr,Hr,Rr){if(!(Hr-tr<=pt)){var Dt=tr+Hr>>1;(function Dr(Pr,Mr,Nn,Lr,jn,ui){for(;jn>Lr;){if(jn-Lr>600){var zn=jn-Lr+1,Pn=Nn-Lr+1,Vn=Math.log(zn),Sa=.5*Math.exp(2*Vn/3),vi=.5*Math.sqrt(Vn*Sa*(zn-Sa)/zn)*(Pn-zn/2<0?-1:1);Dr(Pr,Mr,Nn,Math.max(Lr,Math.floor(Nn-Pn*Sa/zn+vi)),Math.min(jn,Math.floor(Nn+(zn-Pn)*Sa/zn+vi)),ui)}var Li=Mr[2*Nn+ui],Wn=Lr,Zn=jn;for(ke(Pr,Mr,Lr,Nn),Mr[2*jn+ui]>Li&&ke(Pr,Mr,Lr,jn);Wn<Zn;){for(ke(Pr,Mr,Wn,Zn),Wn++,Zn--;Mr[2*Wn+ui]<Li;)Wn++;for(;Mr[2*Zn+ui]>Li;)Zn--}Mr[2*Lr+ui]===Li?ke(Pr,Mr,Lr,Zn):ke(Pr,Mr,++Zn,jn),Zn<=Nn&&(Lr=Zn+1),Nn<=Zn&&(jn=Zn-1)}})($t,lr,Dt,tr,Hr,Rr%2),nt($t,lr,pt,tr,Dt-1,Rr+1),nt($t,lr,pt,Dt+1,Hr,Rr+1)}})(We,te,se,0,We.length-1,0)};Et.prototype.range=function(N,U,Y,se){return function(Te,Ze,We,te,Ie,nt,$t){for(var lr,pt,tr=[0,Te.length-1,0],Hr=[];tr.length;){var Rr=tr.pop(),Dt=tr.pop(),Dr=tr.pop();if(Dt-Dr<=$t)for(var Pr=Dr;Pr<=Dt;Pr++)pt=Ze[2*Pr+1],(lr=Ze[2*Pr])>=We&&lr<=Ie&&pt>=te&&pt<=nt&&Hr.push(Te[Pr]);else{var Mr=Math.floor((Dr+Dt)/2);pt=Ze[2*Mr+1],(lr=Ze[2*Mr])>=We&&lr<=Ie&&pt>=te&&pt<=nt&&Hr.push(Te[Mr]);var Nn=(Rr+1)%2;(Rr===0?We<=lr:te<=pt)&&(tr.push(Dr),tr.push(Mr-1),tr.push(Nn)),(Rr===0?Ie>=lr:nt>=pt)&&(tr.push(Mr+1),tr.push(Dt),tr.push(Nn))}}return Hr}(this.ids,this.coords,N,U,Y,se,this.nodeSize)},Et.prototype.within=function(N,U,Y){return function(se,Te,Ze,We,te,Ie){for(var nt=[0,se.length-1,0],$t=[],lr=te*te;nt.length;){var pt=nt.pop(),tr=nt.pop(),Hr=nt.pop();if(tr-Hr<=Ie)for(var Rr=Hr;Rr<=tr;Rr++)Ke(Te[2*Rr],Te[2*Rr+1],Ze,We)<=lr&&$t.push(se[Rr]);else{var Dt=Math.floor((Hr+tr)/2),Dr=Te[2*Dt],Pr=Te[2*Dt+1];Ke(Dr,Pr,Ze,We)<=lr&&$t.push(se[Dt]);var Mr=(pt+1)%2;(pt===0?Ze-te<=Dr:We-te<=Pr)&&(nt.push(Hr),nt.push(Dt-1),nt.push(Mr)),(pt===0?Ze+te>=Dr:We+te>=Pr)&&(nt.push(Dt+1),nt.push(tr),nt.push(Mr))}}return $t}(this.ids,this.coords,N,U,Y,this.nodeSize)};var _t={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(N){return N}},Yr=function(N){this.options=Oi(Object.create(_t),N),this.trees=new Array(this.options.maxZoom+1)};function wi(N,U,Y,se,Te){return{x:N,y:U,zoom:1/0,id:Y,parentId:-1,numPoints:se,properties:Te}}function On(N,U){var Y=N.geometry.coordinates,se=Y[1];return{x:Cn(Y[0]),y:sn(se),zoom:1/0,index:U,parentId:-1}}function An(N){return{type:"Feature",id:N.id,properties:gn(N),geometry:{type:"Point",coordinates:[(se=N.x,360*(se-.5)),(U=N.y,Y=(180-360*U)*Math.PI/180,360*Math.atan(Math.exp(Y))/Math.PI-90)]}};var U,Y,se}function gn(N){var U=N.numPoints,Y=U>=1e4?Math.round(U/1e3)+"k":U>=1e3?Math.round(U/100)/10+"k":U;return Oi(Oi({},N.properties),{cluster:!0,cluster_id:N.id,point_count:U,point_count_abbreviated:Y})}function Cn(N){return N/360+.5}function sn(N){var U=Math.sin(N*Math.PI/180),Y=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return Y<0?0:Y>1?1:Y}function Oi(N,U){for(var Y in U)N[Y]=U[Y];return N}function Si(N){return N.x}function da(N){return N.y}function sa(N,U,Y,se,Te,Ze){var We=Te-Y,te=Ze-se;if(We!==0||te!==0){var Ie=((N-Y)*We+(U-se)*te)/(We*We+te*te);Ie>1?(Y=Te,se=Ze):Ie>0&&(Y+=We*Ie,se+=te*Ie)}return(We=N-Y)*We+(te=U-se)*te}function Ai(N,U,Y,se){var Te={id:N===void 0?null:N,type:U,geometry:Y,tags:se,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Ze){var We=Ze.geometry,te=Ze.type;if(te==="Point"||te==="MultiPoint"||te==="LineString")uo(Ze,We);else if(te==="Polygon"||te==="MultiLineString")for(var Ie=0;Ie<We.length;Ie++)uo(Ze,We[Ie]);else if(te==="MultiPolygon")for(Ie=0;Ie<We.length;Ie++)for(var nt=0;nt<We[Ie].length;nt++)uo(Ze,We[Ie][nt])}(Te),Te}function uo(N,U){for(var Y=0;Y<U.length;Y+=3)N.minX=Math.min(N.minX,U[Y]),N.minY=Math.min(N.minY,U[Y+1]),N.maxX=Math.max(N.maxX,U[Y]),N.maxY=Math.max(N.maxY,U[Y+1])}function Mi(N,U,Y,se){if(U.geometry){var Te=U.geometry.coordinates,Ze=U.geometry.type,We=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),te=[],Ie=U.id;if(Y.promoteId?Ie=U.properties[Y.promoteId]:Y.generateId&&(Ie=se||0),Ze==="Point")Pi(Te,te);else if(Ze==="MultiPoint")for(var nt=0;nt<Te.length;nt++)Pi(Te[nt],te);else if(Ze==="LineString")To(Te,te,We,!1);else if(Ze==="MultiLineString"){if(Y.lineMetrics){for(nt=0;nt<Te.length;nt++)To(Te[nt],te=[],We,!1),N.push(Ai(Ie,"LineString",te,U.properties));return}le(Te,te,We,!1)}else if(Ze==="Polygon")le(Te,te,We,!0);else{if(Ze!=="MultiPolygon"){if(Ze==="GeometryCollection"){for(nt=0;nt<U.geometry.geometries.length;nt++)Mi(N,{id:Ie,geometry:U.geometry.geometries[nt],properties:U.properties},Y,se);return}throw new Error("Input data is not a valid GeoJSON object.")}for(nt=0;nt<Te.length;nt++){var $t=[];le(Te[nt],$t,We,!0),te.push($t)}}N.push(Ai(Ie,Ze,te,U.properties))}}function Pi(N,U){U.push(Ha(N[0])),U.push(ki(N[1])),U.push(0)}function To(N,U,Y,se){for(var Te,Ze,We=0,te=0;te<N.length;te++){var Ie=Ha(N[te][0]),nt=ki(N[te][1]);U.push(Ie),U.push(nt),U.push(0),te>0&&(We+=se?(Te*nt-Ie*Ze)/2:Math.sqrt(Math.pow(Ie-Te,2)+Math.pow(nt-Ze,2))),Te=Ie,Ze=nt}var $t=U.length-3;U[2]=1,function lr(pt,tr,Hr,Rr){for(var Dt,Dr=Rr,Pr=Hr-tr>>1,Mr=Hr-tr,Nn=pt[tr],Lr=pt[tr+1],jn=pt[Hr],ui=pt[Hr+1],zn=tr+3;zn<Hr;zn+=3){var Pn=sa(pt[zn],pt[zn+1],Nn,Lr,jn,ui);if(Pn>Dr)Dt=zn,Dr=Pn;else if(Pn===Dr){var Vn=Math.abs(zn-Pr);Vn<Mr&&(Dt=zn,Mr=Vn)}}Dr>Rr&&(Dt-tr>3&&lr(pt,tr,Dt,Rr),pt[Dt+2]=Dr,Hr-Dt>3&&lr(pt,Dt,Hr,Rr))}(U,0,$t,Y),U[$t+2]=1,U.size=Math.abs(We),U.start=0,U.end=U.size}function le(N,U,Y,se){for(var Te=0;Te<N.length;Te++){var Ze=[];To(N[Te],Ze,Y,se),U.push(Ze)}}function Ha(N){return N/360+.5}function ki(N){var U=Math.sin(N*Math.PI/180),Y=.5-.25*Math.log((1+U)/(1-U))/Math.PI;return Y<0?0:Y>1?1:Y}function Wo(N,U,Y,se,Te,Ze,We,te){if(se/=U,Ze>=(Y/=U)&&We<se)return N;if(We<Y||Ze>=se)return null;for(var Ie=[],nt=0;nt<N.length;nt++){var $t=N[nt],lr=$t.geometry,pt=$t.type,tr=Te===0?$t.minX:$t.minY,Hr=Te===0?$t.maxX:$t.maxY;if(tr>=Y&&Hr<se)Ie.push($t);else if(!(Hr<Y||tr>=se)){var Rr=[];if(pt==="Point"||pt==="MultiPoint")hu(lr,Rr,Y,se,Te);else if(pt==="LineString")rs(lr,Rr,Y,se,Te,!1,te.lineMetrics);else if(pt==="MultiLineString")bt(lr,Rr,Y,se,Te,!1);else if(pt==="Polygon")bt(lr,Rr,Y,se,Te,!0);else if(pt==="MultiPolygon")for(var Dt=0;Dt<lr.length;Dt++){var Dr=[];bt(lr[Dt],Dr,Y,se,Te,!0),Dr.length&&Rr.push(Dr)}if(Rr.length){if(te.lineMetrics&&pt==="LineString"){for(Dt=0;Dt<Rr.length;Dt++)Ie.push(Ai($t.id,pt,Rr[Dt],$t.tags));continue}pt!=="LineString"&&pt!=="MultiLineString"||(Rr.length===1?(pt="LineString",Rr=Rr[0]):pt="MultiLineString"),pt!=="Point"&&pt!=="MultiPoint"||(pt=Rr.length===3?"Point":"MultiPoint"),Ie.push(Ai($t.id,pt,Rr,$t.tags))}}}return Ie.length?Ie:null}function hu(N,U,Y,se,Te){for(var Ze=0;Ze<N.length;Ze+=3){var We=N[Ze+Te];We>=Y&&We<=se&&(U.push(N[Ze]),U.push(N[Ze+1]),U.push(N[Ze+2]))}}function rs(N,U,Y,se,Te,Ze,We){for(var te,Ie,nt=ns(N),$t=Te===0?Cr:zr,lr=N.start,pt=0;pt<N.length-3;pt+=3){var tr=N[pt],Hr=N[pt+1],Rr=N[pt+2],Dt=N[pt+3],Dr=N[pt+4],Pr=Te===0?tr:Hr,Mr=Te===0?Dt:Dr,Nn=!1;We&&(te=Math.sqrt(Math.pow(tr-Dt,2)+Math.pow(Hr-Dr,2))),Pr<Y?Mr>Y&&(Ie=$t(nt,tr,Hr,Dt,Dr,Y),We&&(nt.start=lr+te*Ie)):Pr>se?Mr<se&&(Ie=$t(nt,tr,Hr,Dt,Dr,se),We&&(nt.start=lr+te*Ie)):Yt(nt,tr,Hr,Rr),Mr<Y&&Pr>=Y&&(Ie=$t(nt,tr,Hr,Dt,Dr,Y),Nn=!0),Mr>se&&Pr<=se&&(Ie=$t(nt,tr,Hr,Dt,Dr,se),Nn=!0),!Ze&&Nn&&(We&&(nt.end=lr+te*Ie),U.push(nt),nt=ns(N)),We&&(lr+=te)}var Lr=N.length-3;tr=N[Lr],Hr=N[Lr+1],Rr=N[Lr+2],(Pr=Te===0?tr:Hr)>=Y&&Pr<=se&&Yt(nt,tr,Hr,Rr),Lr=nt.length-3,Ze&&Lr>=3&&(nt[Lr]!==nt[0]||nt[Lr+1]!==nt[1])&&Yt(nt,nt[0],nt[1],nt[2]),nt.length&&U.push(nt)}function ns(N){var U=[];return U.size=N.size,U.start=N.start,U.end=N.end,U}function bt(N,U,Y,se,Te,Ze){for(var We=0;We<N.length;We++)rs(N[We],U,Y,se,Te,Ze,!1)}function Yt(N,U,Y,se){N.push(U),N.push(Y),N.push(se)}function Cr(N,U,Y,se,Te,Ze){var We=(Ze-U)/(se-U);return N.push(Ze),N.push(Y+(Te-Y)*We),N.push(1),We}function zr(N,U,Y,se,Te,Ze){var We=(Ze-Y)/(Te-Y);return N.push(U+(se-U)*We),N.push(Ze),N.push(1),We}function dn(N,U){for(var Y=[],se=0;se<N.length;se++){var Te,Ze=N[se],We=Ze.type;if(We==="Point"||We==="MultiPoint"||We==="LineString")Te=si(Ze.geometry,U);else if(We==="MultiLineString"||We==="Polygon"){Te=[];for(var te=0;te<Ze.geometry.length;te++)Te.push(si(Ze.geometry[te],U))}else if(We==="MultiPolygon")for(Te=[],te=0;te<Ze.geometry.length;te++){for(var Ie=[],nt=0;nt<Ze.geometry[te].length;nt++)Ie.push(si(Ze.geometry[te][nt],U));Te.push(Ie)}Y.push(Ai(Ze.id,We,Te,Ze.tags))}return Y}function si(N,U){var Y=[];Y.size=N.size,N.start!==void 0&&(Y.start=N.start,Y.end=N.end);for(var se=0;se<N.length;se+=3)Y.push(N[se]+U,N[se+1],N[se+2]);return Y}function Fn(N,U){if(N.transformed)return N;var Y,se,Te,Ze=1<<N.z,We=N.x,te=N.y;for(Y=0;Y<N.features.length;Y++){var Ie=N.features[Y],nt=Ie.geometry,$t=Ie.type;if(Ie.geometry=[],$t===1)for(se=0;se<nt.length;se+=2)Ie.geometry.push($n(nt[se],nt[se+1],U,Ze,We,te));else for(se=0;se<nt.length;se++){var lr=[];for(Te=0;Te<nt[se].length;Te+=2)lr.push($n(nt[se][Te],nt[se][Te+1],U,Ze,We,te));Ie.geometry.push(lr)}}return N.transformed=!0,N}function $n(N,U,Y,se,Te,Ze){return[Math.round(Y*(N*se-Te)),Math.round(Y*(U*se-Ze))]}function Mn(N,U,Y,se,Te){for(var Ze=U===Te.maxZoom?0:Te.tolerance/((1<<U)*Te.extent),We={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:se,z:U,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},te=0;te<N.length;te++){We.numFeatures++,hi(We,N[te],Ze,Te);var Ie=N[te].minX,nt=N[te].minY,$t=N[te].maxX,lr=N[te].maxY;Ie<We.minX&&(We.minX=Ie),nt<We.minY&&(We.minY=nt),$t>We.maxX&&(We.maxX=$t),lr>We.maxY&&(We.maxY=lr)}return We}function hi(N,U,Y,se){var Te=U.geometry,Ze=U.type,We=[];if(Ze==="Point"||Ze==="MultiPoint")for(var te=0;te<Te.length;te+=3)We.push(Te[te]),We.push(Te[te+1]),N.numPoints++,N.numSimplified++;else if(Ze==="LineString")ni(We,Te,N,Y,!1,!1);else if(Ze==="MultiLineString"||Ze==="Polygon")for(te=0;te<Te.length;te++)ni(We,Te[te],N,Y,Ze==="Polygon",te===0);else if(Ze==="MultiPolygon")for(var Ie=0;Ie<Te.length;Ie++){var nt=Te[Ie];for(te=0;te<nt.length;te++)ni(We,nt[te],N,Y,!0,te===0)}if(We.length){var $t=U.tags||null;if(Ze==="LineString"&&se.lineMetrics){for(var lr in $t={},U.tags)$t[lr]=U.tags[lr];$t.mapbox_clip_start=Te.start/Te.size,$t.mapbox_clip_end=Te.end/Te.size}var pt={geometry:We,type:Ze==="Polygon"||Ze==="MultiPolygon"?3:Ze==="LineString"||Ze==="MultiLineString"?2:1,tags:$t};U.id!==null&&(pt.id=U.id),N.features.push(pt)}}function ni(N,U,Y,se,Te,Ze){var We=se*se;if(se>0&&U.size<(Te?We:se))Y.numPoints+=U.length/3;else{for(var te=[],Ie=0;Ie<U.length;Ie+=3)(se===0||U[Ie+2]>We)&&(Y.numSimplified++,te.push(U[Ie]),te.push(U[Ie+1])),Y.numPoints++;Te&&function(nt,$t){for(var lr=0,pt=0,tr=nt.length,Hr=tr-2;pt<tr;Hr=pt,pt+=2)lr+=(nt[pt]-nt[Hr])*(nt[pt+1]+nt[Hr+1]);if(lr>0===$t)for(pt=0,tr=nt.length;pt<tr/2;pt+=2){var Rr=nt[pt],Dt=nt[pt+1];nt[pt]=nt[tr-2-pt],nt[pt+1]=nt[tr-1-pt],nt[tr-2-pt]=Rr,nt[tr-1-pt]=Dt}}(te,Ze),N.push(te)}}function eo(N,U){var Y=(U=this.options=function(Te,Ze){for(var We in Ze)Te[We]=Ze[We];return Te}(Object.create(this.options),U)).debug;if(Y&&console.time("preprocess data"),U.maxZoom<0||U.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(U.promoteId&&U.generateId)throw new Error("promoteId and generateId cannot be used together.");var se=function(Te,Ze){var We=[];if(Te.type==="FeatureCollection")for(var te=0;te<Te.features.length;te++)Mi(We,Te.features[te],Ze,te);else Mi(We,Te.type==="Feature"?Te:{geometry:Te},Ze);return We}(N,U);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",U.indexMaxZoom,U.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(se=function(Te,Ze){var We=Ze.buffer/Ze.extent,te=Te,Ie=Wo(Te,1,-1-We,We,0,-1,2,Ze),nt=Wo(Te,1,1-We,2+We,0,-1,2,Ze);return(Ie||nt)&&(te=Wo(Te,1,-We,1+We,0,-1,2,Ze)||[],Ie&&(te=dn(Ie,1).concat(te)),nt&&(te=te.concat(dn(nt,-1)))),te}(se,U)).length&&this.splitTile(se,0,0,0),Y&&(se.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ao(N,U,Y){return 32*((1<<N)*Y+U)+N}function du(N,U){var Y=N.tileID.canonical;if(!this._geoJSONIndex)return U(null,null);var se=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!se)return U(null,null);var Te=new ft(se.features),Ze=ot(Te);Ze.byteOffset===0&&Ze.byteLength===Ze.buffer.byteLength||(Ze=new Uint8Array(Ze)),U(null,{vectorTile:Te,rawData:Ze.buffer})}Yr.prototype.load=function(N){var U=this.options,Y=U.log,se=U.minZoom,Te=U.maxZoom,Ze=U.nodeSize;Y&&console.time("total time");var We="prepare "+N.length+" points";Y&&console.time(We),this.points=N;for(var te=[],Ie=0;Ie<N.length;Ie++)N[Ie].geometry&&te.push(On(N[Ie],Ie));this.trees[Te+1]=new Et(te,Si,da,Ze,Float32Array),Y&&console.timeEnd(We);for(var nt=Te;nt>=se;nt--){var $t=+Date.now();te=this._cluster(te,nt),this.trees[nt]=new Et(te,Si,da,Ze,Float32Array),Y&&console.log("z%d: %d clusters in %dms",nt,te.length,+Date.now()-$t)}return Y&&console.timeEnd("total time"),this},Yr.prototype.getClusters=function(N,U){var Y=((N[0]+180)%360+360)%360-180,se=Math.max(-90,Math.min(90,N[1])),Te=N[2]===180?180:((N[2]+180)%360+360)%360-180,Ze=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)Y=-180,Te=180;else if(Y>Te){var We=this.getClusters([Y,se,180,Ze],U),te=this.getClusters([-180,se,Te,Ze],U);return We.concat(te)}for(var Ie=this.trees[this._limitZoom(U)],nt=[],$t=0,lr=Ie.range(Cn(Y),sn(Ze),Cn(Te),sn(se));$t<lr.length;$t+=1){var pt=Ie.points[lr[$t]];nt.push(pt.numPoints?An(pt):this.points[pt.index])}return nt},Yr.prototype.getChildren=function(N){var U=this._getOriginId(N),Y=this._getOriginZoom(N),se="No cluster with the specified id.",Te=this.trees[Y];if(!Te)throw new Error(se);var Ze=Te.points[U];if(!Ze)throw new Error(se);for(var We=this.options.radius/(this.options.extent*Math.pow(2,Y-1)),te=[],Ie=0,nt=Te.within(Ze.x,Ze.y,We);Ie<nt.length;Ie+=1){var $t=Te.points[nt[Ie]];$t.parentId===N&&te.push($t.numPoints?An($t):this.points[$t.index])}if(te.length===0)throw new Error(se);return te},Yr.prototype.getLeaves=function(N,U,Y){var se=[];return this._appendLeaves(se,N,U=U||10,Y=Y||0,0),se},Yr.prototype.getTile=function(N,U,Y){var se=this.trees[this._limitZoom(N)],Te=Math.pow(2,N),Ze=this.options,We=Ze.radius/Ze.extent,te=(Y-We)/Te,Ie=(Y+1+We)/Te,nt={features:[]};return this._addTileFeatures(se.range((U-We)/Te,te,(U+1+We)/Te,Ie),se.points,U,Y,Te,nt),U===0&&this._addTileFeatures(se.range(1-We/Te,te,1,Ie),se.points,Te,Y,Te,nt),U===Te-1&&this._addTileFeatures(se.range(0,te,We/Te,Ie),se.points,-1,Y,Te,nt),nt.features.length?nt:null},Yr.prototype.getClusterExpansionZoom=function(N){for(var U=this._getOriginZoom(N)-1;U<=this.options.maxZoom;){var Y=this.getChildren(N);if(U++,Y.length!==1)break;N=Y[0].properties.cluster_id}return U},Yr.prototype._appendLeaves=function(N,U,Y,se,Te){for(var Ze=0,We=this.getChildren(U);Ze<We.length;Ze+=1){var te=We[Ze],Ie=te.properties;if(Ie&&Ie.cluster?Te+Ie.point_count<=se?Te+=Ie.point_count:Te=this._appendLeaves(N,Ie.cluster_id,Y,se,Te):Te<se?Te++:N.push(te),N.length===Y)break}return Te},Yr.prototype._addTileFeatures=function(N,U,Y,se,Te,Ze){for(var We=0,te=N;We<te.length;We+=1){var Ie=U[te[We]],nt=Ie.numPoints,$t={type:1,geometry:[[Math.round(this.options.extent*(Ie.x*Te-Y)),Math.round(this.options.extent*(Ie.y*Te-se))]],tags:nt?gn(Ie):this.points[Ie.index].properties},lr=void 0;nt?lr=Ie.id:this.options.generateId?lr=Ie.index:this.points[Ie.index].id&&(lr=this.points[Ie.index].id),lr!==void 0&&($t.id=lr),Ze.features.push($t)}},Yr.prototype._limitZoom=function(N){return Math.max(this.options.minZoom,Math.min(+N,this.options.maxZoom+1))},Yr.prototype._cluster=function(N,U){for(var Y=[],se=this.options,Te=se.reduce,Ze=se.minPoints,We=se.radius/(se.extent*Math.pow(2,U)),te=0;te<N.length;te++){var Ie=N[te];if(!(Ie.zoom<=U)){Ie.zoom=U;for(var nt=this.trees[U+1],$t=nt.within(Ie.x,Ie.y,We),lr=Ie.numPoints||1,pt=lr,tr=0,Hr=$t;tr<Hr.length;tr+=1){var Rr=nt.points[Hr[tr]];Rr.zoom>U&&(pt+=Rr.numPoints||1)}if(pt>=Ze){for(var Dt=Ie.x*lr,Dr=Ie.y*lr,Pr=Te&&lr>1?this._map(Ie,!0):null,Mr=(te<<5)+(U+1)+this.points.length,Nn=0,Lr=$t;Nn<Lr.length;Nn+=1){var jn=nt.points[Lr[Nn]];if(!(jn.zoom<=U)){jn.zoom=U;var ui=jn.numPoints||1;Dt+=jn.x*ui,Dr+=jn.y*ui,jn.parentId=Mr,Te&&(Pr||(Pr=this._map(Ie,!0)),Te(Pr,this._map(jn)))}}Ie.parentId=Mr,Y.push(wi(Dt/pt,Dr/pt,Mr,pt,Pr))}else if(Y.push(Ie),pt>1)for(var zn=0,Pn=$t;zn<Pn.length;zn+=1){var Vn=nt.points[Pn[zn]];Vn.zoom<=U||(Vn.zoom=U,Y.push(Vn))}}}return Y},Yr.prototype._getOriginId=function(N){return N-this.points.length>>5},Yr.prototype._getOriginZoom=function(N){return(N-this.points.length)%32},Yr.prototype._map=function(N,U){if(N.numPoints)return U?Oi({},N.properties):N.properties;var Y=this.points[N.index].properties,se=this.options.map(Y);return U&&se===Y?Oi({},se):se},eo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},eo.prototype.splitTile=function(N,U,Y,se,Te,Ze,We){for(var te=[N,U,Y,se],Ie=this.options,nt=Ie.debug;te.length;){se=te.pop(),Y=te.pop(),U=te.pop(),N=te.pop();var $t=1<<U,lr=Ao(U,Y,se),pt=this.tiles[lr];if(!pt&&(nt>1&&console.time("creation"),pt=this.tiles[lr]=Mn(N,U,Y,se,Ie),this.tileCoords.push({z:U,x:Y,y:se}),nt)){nt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",U,Y,se,pt.numFeatures,pt.numPoints,pt.numSimplified),console.timeEnd("creation"));var tr="z"+U;this.stats[tr]=(this.stats[tr]||0)+1,this.total++}if(pt.source=N,Te){if(U===Ie.maxZoom||U===Te)continue;var Hr=1<<Te-U;if(Y!==Math.floor(Ze/Hr)||se!==Math.floor(We/Hr))continue}else if(U===Ie.indexMaxZoom||pt.numPoints<=Ie.indexMaxPoints)continue;if(pt.source=null,N.length!==0){nt>1&&console.time("clipping");var Rr,Dt,Dr,Pr,Mr,Nn,Lr=.5*Ie.buffer/Ie.extent,jn=.5-Lr,ui=.5+Lr,zn=1+Lr;Rr=Dt=Dr=Pr=null,Mr=Wo(N,$t,Y-Lr,Y+ui,0,pt.minX,pt.maxX,Ie),Nn=Wo(N,$t,Y+jn,Y+zn,0,pt.minX,pt.maxX,Ie),N=null,Mr&&(Rr=Wo(Mr,$t,se-Lr,se+ui,1,pt.minY,pt.maxY,Ie),Dt=Wo(Mr,$t,se+jn,se+zn,1,pt.minY,pt.maxY,Ie),Mr=null),Nn&&(Dr=Wo(Nn,$t,se-Lr,se+ui,1,pt.minY,pt.maxY,Ie),Pr=Wo(Nn,$t,se+jn,se+zn,1,pt.minY,pt.maxY,Ie),Nn=null),nt>1&&console.timeEnd("clipping"),te.push(Rr||[],U+1,2*Y,2*se),te.push(Dt||[],U+1,2*Y,2*se+1),te.push(Dr||[],U+1,2*Y+1,2*se),te.push(Pr||[],U+1,2*Y+1,2*se+1)}}},eo.prototype.getTile=function(N,U,Y){var se=this.options,Te=se.extent,Ze=se.debug;if(N<0||N>24)return null;var We=1<<N,te=Ao(N,U=(U%We+We)%We,Y);if(this.tiles[te])return Fn(this.tiles[te],Te);Ze>1&&console.log("drilling down to z%d-%d-%d",N,U,Y);for(var Ie,nt=N,$t=U,lr=Y;!Ie&&nt>0;)nt--,$t=Math.floor($t/2),lr=Math.floor(lr/2),Ie=this.tiles[Ao(nt,$t,lr)];return Ie&&Ie.source?(Ze>1&&console.log("found parent tile z%d-%d-%d",nt,$t,lr),Ze>1&&console.time("drilling down"),this.splitTile(Ie.source,nt,$t,lr,N,U,Y),Ze>1&&console.timeEnd("drilling down"),this.tiles[te]?Fn(this.tiles[te],Te):null):null};var ks=function(N){function U(Y,se,Te,Ze){N.call(this,Y,se,Te,du),Ze&&(this.loadGeoJSON=Ze)}return N&&(U.__proto__=N),(U.prototype=Object.create(N&&N.prototype)).constructor=U,U.prototype.loadData=function(Y,se){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=se,this._pendingLoadDataParams=Y,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},U.prototype._loadData=function(){var Y=this;if(this._pendingCallback&&this._pendingLoadDataParams){var se=this._pendingCallback,Te=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Ze=!!(Te&&Te.request&&Te.request.collectResourceTiming)&&new v.RequestPerformance(Te.request);this.loadGeoJSON(Te,function(We,te){if(We||!te)return se(We);if(typeof te!="object")return se(new Error("Input data given to '"+Te.source+"' is not a valid GeoJSON object."));(function pt(tr,Hr){var Rr,Dt=tr&&tr.type;if(Dt==="FeatureCollection")for(Rr=0;Rr<tr.features.length;Rr++)pt(tr.features[Rr],Hr);else if(Dt==="GeometryCollection")for(Rr=0;Rr<tr.geometries.length;Rr++)pt(tr.geometries[Rr],Hr);else if(Dt==="Feature")pt(tr.geometry,Hr);else if(Dt==="Polygon")Jt(tr.coordinates,Hr);else if(Dt==="MultiPolygon")for(Rr=0;Rr<tr.coordinates.length;Rr++)Jt(tr.coordinates[Rr],Hr);return tr})(te,!0);try{if(Te.filter){var Ie=v.createExpression(Te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ie.result==="error")throw new Error(Ie.value.map(function(pt){return pt.key+": "+pt.message}).join(", "));var nt=te.features.filter(function(pt){return Ie.value.evaluate({zoom:0},pt)});te={type:"FeatureCollection",features:nt}}Y._geoJSONIndex=Te.cluster?new Yr(function(pt){var tr=pt.superclusterOptions,Hr=pt.clusterProperties;if(!Hr||!tr)return tr;for(var Rr={},Dt={},Dr={accumulated:null,zoom:0},Pr={properties:null},Mr=Object.keys(Hr),Nn=0,Lr=Mr;Nn<Lr.length;Nn+=1){var jn=Lr[Nn],ui=Hr[jn],zn=ui[0],Pn=v.createExpression(ui[1]),Vn=v.createExpression(typeof zn=="string"?[zn,["accumulated"],["get",jn]]:zn);Rr[jn]=Pn.value,Dt[jn]=Vn.value}return tr.map=function(Sa){Pr.properties=Sa;for(var vi={},Li=0,Wn=Mr;Li<Wn.length;Li+=1){var Zn=Wn[Li];vi[Zn]=Rr[Zn].evaluate(Dr,Pr)}return vi},tr.reduce=function(Sa,vi){Pr.properties=vi;for(var Li=0,Wn=Mr;Li<Wn.length;Li+=1){var Zn=Wn[Li];Dr.accumulated=Sa[Zn],Sa[Zn]=Dt[Zn].evaluate(Dr,Pr)}},tr}(Te)).load(te.features):function(pt,tr){return new eo(pt,tr)}(te,Te.geojsonVtOptions)}catch(pt){return se(pt)}Y.loaded={};var $t={};if(Ze){var lr=Ze.finish();lr&&($t.resourceTiming={},$t.resourceTiming[Te.source]=JSON.parse(JSON.stringify(lr)))}se(null,$t)})}},U.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},U.prototype.reloadTile=function(Y,se){var Te=this.loaded;return Te&&Te[Y.uid]?N.prototype.reloadTile.call(this,Y,se):this.loadTile(Y,se)},U.prototype.loadGeoJSON=function(Y,se){if(Y.request)v.getJSON(Y.request,se);else{if(typeof Y.data!="string")return se(new Error("Input data given to '"+Y.source+"' is not a valid GeoJSON object."));try{return se(null,JSON.parse(Y.data))}catch(Te){return se(new Error("Input data given to '"+Y.source+"' is not a valid GeoJSON object."))}}},U.prototype.removeSource=function(Y,se){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),se()},U.prototype.getClusterExpansionZoom=function(Y,se){try{se(null,this._geoJSONIndex.getClusterExpansionZoom(Y.clusterId))}catch(Te){se(Te)}},U.prototype.getClusterChildren=function(Y,se){try{se(null,this._geoJSONIndex.getChildren(Y.clusterId))}catch(Te){se(Te)}},U.prototype.getClusterLeaves=function(Y,se){try{se(null,this._geoJSONIndex.getLeaves(Y.clusterId,Y.limit,Y.offset))}catch(Te){se(Te)}},U}(be),Ji=function(N){var U=this;this.self=N,this.actor=new v.Actor(N,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:be,geojson:ks},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(Y,se){if(U.workerSourceTypes[Y])throw new Error('Worker source with name "'+Y+'" already registered.');U.workerSourceTypes[Y]=se},this.self.registerRTLTextPlugin=function(Y){if(v.plugin.isParsed())throw new Error("RTL text plugin already registered.");v.plugin.applyArabicShaping=Y.applyArabicShaping,v.plugin.processBidirectionalText=Y.processBidirectionalText,v.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}};return Ji.prototype.setReferrer=function(N,U){this.referrer=U},Ji.prototype.setImages=function(N,U,Y){for(var se in this.availableImages[N]=U,this.workerSources[N]){var Te=this.workerSources[N][se];for(var Ze in Te)Te[Ze].availableImages=U}Y()},Ji.prototype.setLayers=function(N,U,Y){this.getLayerIndex(N).replace(U),Y()},Ji.prototype.updateLayers=function(N,U,Y){this.getLayerIndex(N).update(U.layers,U.removedIds),Y()},Ji.prototype.loadTile=function(N,U,Y){this.getWorkerSource(N,U.type,U.source).loadTile(U,Y)},Ji.prototype.loadDEMTile=function(N,U,Y){this.getDEMWorkerSource(N,U.source).loadTile(U,Y)},Ji.prototype.reloadTile=function(N,U,Y){this.getWorkerSource(N,U.type,U.source).reloadTile(U,Y)},Ji.prototype.abortTile=function(N,U,Y){this.getWorkerSource(N,U.type,U.source).abortTile(U,Y)},Ji.prototype.removeTile=function(N,U,Y){this.getWorkerSource(N,U.type,U.source).removeTile(U,Y)},Ji.prototype.removeDEMTile=function(N,U){this.getDEMWorkerSource(N,U.source).removeTile(U)},Ji.prototype.removeSource=function(N,U,Y){if(this.workerSources[N]&&this.workerSources[N][U.type]&&this.workerSources[N][U.type][U.source]){var se=this.workerSources[N][U.type][U.source];delete this.workerSources[N][U.type][U.source],se.removeSource!==void 0?se.removeSource(U,Y):Y()}},Ji.prototype.loadWorkerSource=function(N,U,Y){try{this.self.importScripts(U.url),Y()}catch(se){Y(se.toString())}},Ji.prototype.syncRTLPluginState=function(N,U,Y){try{v.plugin.setState(U);var se=v.plugin.getPluginURL();if(v.plugin.isLoaded()&&!v.plugin.isParsed()&&se!=null){this.self.importScripts(se);var Te=v.plugin.isParsed();Y(Te?void 0:new Error("RTL Text Plugin failed to import scripts from "+se),Te)}}catch(Ze){Y(Ze.toString())}},Ji.prototype.getAvailableImages=function(N){var U=this.availableImages[N];return U||(U=[]),U},Ji.prototype.getLayerIndex=function(N){var U=this.layerIndexes[N];return U||(U=this.layerIndexes[N]=new oe),U},Ji.prototype.getWorkerSource=function(N,U,Y){var se=this;return this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][U]||(this.workerSources[N][U]={}),this.workerSources[N][U][Y]||(this.workerSources[N][U][Y]=new this.workerSourceTypes[U]({send:function(Te,Ze,We){se.actor.send(Te,Ze,We,N)}},this.getLayerIndex(N),this.getAvailableImages(N))),this.workerSources[N][U][Y]},Ji.prototype.getDEMWorkerSource=function(N,U){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][U]||(this.demWorkerSources[N][U]=new M),this.demWorkerSources[N][U]},Ji.prototype.enforceCacheSizeLimit=function(N,U){v.enforceCacheSizeLimit(U)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Ji(self)),Ji}),ve(["./shared"],function(v){"use strict";var ye=v.createCommonjsModule(function(u){function f(x){return!l(x)}function l(x){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var E,P,R=new Blob([""],{type:"text/javascript"}),z=URL.createObjectURL(R);try{P=new Worker(z),E=!0}catch(j){E=!1}return P&&P.terminate(),URL.revokeObjectURL(z),E}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var E=document.createElement("canvas");E.width=E.height=1;var P=E.getContext("2d");if(!P)return!1;var R=P.getImageData(0,0,1,1);return R&&R.width===E.width}()?(h[S=x&&x.failIfMajorPerformanceCaveat]===void 0&&(h[S]=function(E){var P=function(z){var j=document.createElement("canvas"),ee=Object.create(f.webGLContextAttributes);return ee.failIfMajorPerformanceCaveat=z,j.probablySupportsContext?j.probablySupportsContext("webgl",ee)||j.probablySupportsContext("experimental-webgl",ee):j.supportsContext?j.supportsContext("webgl",ee)||j.supportsContext("experimental-webgl",ee):j.getContext("webgl",ee)||j.getContext("experimental-webgl",ee)}(E);if(!P)return!1;var R=P.createShader(P.VERTEX_SHADER);return!(!R||P.isContextLost())&&(P.shaderSource(R,"void main() {}"),P.compileShader(R),P.getShaderParameter(R,P.COMPILE_STATUS)===!0)}(S)),h[S]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var S}u.exports?u.exports=f:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=f,window.mapboxgl.notSupportedReason=l);var h={};f.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Z={create:function(u,f,l){var h=v.window.document.createElement(u);return f!==void 0&&(h.className=f),l&&l.appendChild(h),h},createNS:function(u,f){return v.window.document.createElementNS(u,f)}},oe=v.window.document&&v.window.document.documentElement.style;function me(u){if(!oe)return u[0];for(var f=0;f<u.length;f++)if(u[f]in oe)return u[f];return u[0]}var ie,fe=me(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Z.disableDrag=function(){oe&&fe&&(ie=oe[fe],oe[fe]="none")},Z.enableDrag=function(){oe&&fe&&(oe[fe]=ie)};var J=me(["transform","WebkitTransform"]);Z.setTransform=function(u,f){u.style[J]=f};var be=!1;try{var Pe=Object.defineProperty({},"passive",{get:function(){be=!0}});v.window.addEventListener("test",Pe,Pe),v.window.removeEventListener("test",Pe,Pe)}catch(u){be=!1}Z.addEventListener=function(u,f,l,h){h===void 0&&(h={}),u.addEventListener(f,l,"passive"in h&&be?h:h.capture)},Z.removeEventListener=function(u,f,l,h){h===void 0&&(h={}),u.removeEventListener(f,l,"passive"in h&&be?h:h.capture)};var M=function(u){u.preventDefault(),u.stopPropagation(),v.window.removeEventListener("click",M,!0)};function Jt(u){var f=u.userImage;return!!(f&&f.render&&f.render())&&(u.data.replace(new Uint8Array(f.data.buffer)),!0)}Z.suppressClick=function(){v.window.addEventListener("click",M,!0),v.window.setTimeout(function(){v.window.removeEventListener("click",M,!0)},0)},Z.mousePos=function(u,f){var l=u.getBoundingClientRect();return new v.Point(f.clientX-l.left-u.clientLeft,f.clientY-l.top-u.clientTop)},Z.touchPos=function(u,f){for(var l=u.getBoundingClientRect(),h=[],x=0;x<f.length;x++)h.push(new v.Point(f[x].clientX-l.left-u.clientLeft,f[x].clientY-l.top-u.clientTop));return h},Z.mouseButton=function(u){return v.window.InstallTrigger!==void 0&&u.button===2&&u.ctrlKey&&v.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:u.button},Z.remove=function(u){u.parentNode&&u.parentNode.removeChild(u)};var Ht=function(u){function f(){u.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new v.RGBAImage({width:1,height:1}),this.dirty=!0}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.isLoaded=function(){return this.loaded},f.prototype.setLoaded=function(l){if(this.loaded!==l&&(this.loaded=l,l)){for(var h=0,x=this.requestors;h<x.length;h+=1){var S=x[h];this._notify(S.ids,S.callback)}this.requestors=[]}},f.prototype.getImage=function(l){return this.images[l]},f.prototype.addImage=function(l,h){this._validate(l,h)&&(this.images[l]=h)},f.prototype._validate=function(l,h){var x=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new v.ErrorEvent(new Error('Image "'+l+'" has invalid "stretchX" value'))),x=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new v.ErrorEvent(new Error('Image "'+l+'" has invalid "stretchY" value'))),x=!1),this._validateContent(h.content,h)||(this.fire(new v.ErrorEvent(new Error('Image "'+l+'" has invalid "content" value'))),x=!1),x},f.prototype._validateStretch=function(l,h){if(!l)return!0;for(var x=0,S=0,E=l;S<E.length;S+=1){var P=E[S];if(P[0]<x||P[1]<P[0]||h<P[1])return!1;x=P[1]}return!0},f.prototype._validateContent=function(l,h){return!(l&&(l.length!==4||l[0]<0||h.data.width<l[0]||l[1]<0||h.data.height<l[1]||l[2]<0||h.data.width<l[2]||l[3]<0||h.data.height<l[3]||l[2]<l[0]||l[3]<l[1]))},f.prototype.updateImage=function(l,h){h.version=this.images[l].version+1,this.images[l]=h,this.updatedImages[l]=!0},f.prototype.removeImage=function(l){var h=this.images[l];delete this.images[l],delete this.patterns[l],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},f.prototype.listImages=function(){return Object.keys(this.images)},f.prototype.getImages=function(l,h){var x=!0;if(!this.isLoaded())for(var S=0,E=l;S<E.length;S+=1)this.images[E[S]]||(x=!1);this.isLoaded()||x?this._notify(l,h):this.requestors.push({ids:l,callback:h})},f.prototype._notify=function(l,h){for(var x={},S=0,E=l;S<E.length;S+=1){var P=E[S];this.images[P]||this.fire(new v.Event("styleimagemissing",{id:P}));var R=this.images[P];R?x[P]={data:R.data.clone(),pixelRatio:R.pixelRatio,sdf:R.sdf,version:R.version,stretchX:R.stretchX,stretchY:R.stretchY,content:R.content,hasRenderCallback:Boolean(R.userImage&&R.userImage.render)}:v.warnOnce('Image "'+P+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,x)},f.prototype.getPixelSize=function(){var l=this.atlasImage;return{width:l.width,height:l.height}},f.prototype.getPattern=function(l){var h=this.patterns[l],x=this.getImage(l);if(!x)return null;if(h&&h.position.version===x.version)return h.position;if(h)h.position.version=x.version;else{var S={w:x.data.width+2,h:x.data.height+2,x:0,y:0},E=new v.ImagePosition(S,x);this.patterns[l]={bin:S,position:E}}return this._updatePatternAtlas(),this.patterns[l].position},f.prototype.bind=function(l){var h=l.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new v.Texture(l,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},f.prototype._updatePatternAtlas=function(){var l=[];for(var h in this.patterns)l.push(this.patterns[h].bin);var x=v.potpack(l),S=x.w,E=x.h,P=this.atlasImage;for(var R in P.resize({width:S||1,height:E||1}),this.patterns){var z=this.patterns[R].bin,j=z.x+1,ee=z.y+1,ne=this.images[R].data,Ae=ne.width,Se=ne.height;v.RGBAImage.copy(ne,P,{x:0,y:0},{x:j,y:ee},{width:Ae,height:Se}),v.RGBAImage.copy(ne,P,{x:0,y:Se-1},{x:j,y:ee-1},{width:Ae,height:1}),v.RGBAImage.copy(ne,P,{x:0,y:0},{x:j,y:ee+Se},{width:Ae,height:1}),v.RGBAImage.copy(ne,P,{x:Ae-1,y:0},{x:j-1,y:ee},{width:1,height:Se}),v.RGBAImage.copy(ne,P,{x:0,y:0},{x:j+Ae,y:ee},{width:1,height:Se})}this.dirty=!0},f.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},f.prototype.dispatchRenderCallbacks=function(l){for(var h=0,x=l;h<x.length;h+=1){var S=x[h];if(!this.callbackDispatchedThisFrame[S]){this.callbackDispatchedThisFrame[S]=!0;var E=this.images[S];Jt(E)&&this.updateImage(S,E)}}},f}(v.Evented),Ft=dt,jt=dt,ft=1e20;function dt(u,f,l,h,x,S){this.fontSize=u||24,this.buffer=f===void 0?3:f,this.cutoff=h||.25,this.fontFamily=x||"sans-serif",this.fontWeight=S||"normal",this.radius=l||8;var E=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=E,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.d=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Int16Array(E),this.middle=Math.round(E/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ar(u,f,l,h,x,S,E){for(var P=0;P<f;P++){for(var R=0;R<l;R++)h[R]=u[R*f+P];for(cr(h,x,S,E,l),R=0;R<l;R++)u[R*f+P]=x[R]}for(R=0;R<l;R++){for(P=0;P<f;P++)h[P]=u[R*f+P];for(cr(h,x,S,E,f),P=0;P<f;P++)u[R*f+P]=Math.sqrt(x[P])}}function cr(u,f,l,h,x){l[0]=0,h[0]=-ft,h[1]=+ft;for(var S=1,E=0;S<x;S++){for(var P=(u[S]+S*S-(u[l[E]]+l[E]*l[E]))/(2*S-2*l[E]);P<=h[E];)E--,P=(u[S]+S*S-(u[l[E]]+l[E]*l[E]))/(2*S-2*l[E]);l[++E]=S,h[E]=P,h[E+1]=+ft}for(S=0,E=0;S<x;S++){for(;h[E+1]<S;)E++;f[S]=(S-l[E])*(S-l[E])+u[l[E]]}}dt.prototype.draw=function(u){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(u,this.buffer,this.middle);for(var f=this.ctx.getImageData(0,0,this.size,this.size),l=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var x=f.data[4*h+3]/255;this.gridOuter[h]=x===1?0:x===0?ft:Math.pow(Math.max(0,.5-x),2),this.gridInner[h]=x===1?ft:x===0?0:Math.pow(Math.max(0,x-.5),2)}for(Ar(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),Ar(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)l[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return l},Ft.default=jt;var Bt=function(u,f){this.requestManager=u,this.localIdeographFontFamily=f,this.entries={}};Bt.prototype.setURL=function(u){this.url=u},Bt.prototype.getGlyphs=function(u,f){var l=this,h=[];for(var x in u)for(var S=0,E=u[x];S<E.length;S+=1)h.push({stack:x,id:E[S]});v.asyncAll(h,function(P,R){var z=P.stack,j=P.id,ee=l.entries[z];ee||(ee=l.entries[z]={glyphs:{},requests:{},ranges:{}});var ne=ee.glyphs[j];if(ne===void 0){if(ne=l._tinySDF(ee,z,j))return ee.glyphs[j]=ne,void R(null,{stack:z,id:j,glyph:ne});var Ae=Math.floor(j/256);if(256*Ae>65535)R(new Error("glyphs > 65535 not supported"));else if(ee.ranges[Ae])R(null,{stack:z,id:j,glyph:ne});else{var Se=ee.requests[Ae];Se||(Se=ee.requests[Ae]=[],Bt.loadGlyphRange(z,Ae,l.url,l.requestManager,function(De,_e){if(_e){for(var Fe in _e)l._doesCharSupportLocalGlyph(+Fe)||(ee.glyphs[+Fe]=_e[+Fe]);ee.ranges[Ae]=!0}for(var Ge=0,at=Se;Ge<at.length;Ge+=1)(0,at[Ge])(De,_e);delete ee.requests[Ae]})),Se.push(function(De,_e){De?R(De):_e&&R(null,{stack:z,id:j,glyph:_e[j]||null})})}}else R(null,{stack:z,id:j,glyph:ne})},function(P,R){if(P)f(P);else if(R){for(var z={},j=0,ee=R;j<ee.length;j+=1){var ne=ee[j],Ae=ne.stack,Se=ne.id,De=ne.glyph;(z[Ae]||(z[Ae]={}))[Se]=De&&{id:De.id,bitmap:De.bitmap.clone(),metrics:De.metrics}}f(null,z)}})},Bt.prototype._doesCharSupportLocalGlyph=function(u){return!!this.localIdeographFontFamily&&(v.isChar["CJK Unified Ideographs"](u)||v.isChar["Hangul Syllables"](u)||v.isChar.Hiragana(u)||v.isChar.Katakana(u))},Bt.prototype._tinySDF=function(u,f,l){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(l)){var x=u.tinySDF;if(!x){var S="400";/bold/i.test(f)?S="900":/medium/i.test(f)?S="500":/light/i.test(f)&&(S="200"),x=u.tinySDF=new Bt.TinySDF(24,3,8,.25,h,S)}return{id:l,bitmap:new v.AlphaImage({width:30,height:30},x.draw(String.fromCharCode(l))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},Bt.loadGlyphRange=function(u,f,l,h,x){var S=256*f,E=S+255,P=h.transformRequest(h.normalizeGlyphsURL(l).replace("{fontstack}",u).replace("{range}",S+"-"+E),v.ResourceType.Glyphs);v.getArrayBuffer(P,function(R,z){if(R)x(R);else if(z){for(var j={},ee=0,ne=v.parseGlyphPBF(z);ee<ne.length;ee+=1){var Ae=ne[ee];j[Ae.id]=Ae}x(null,j)}})},Bt.TinySDF=Ft;var ot=function(){this.specification=v.styleSpec.light.position};ot.prototype.possiblyEvaluate=function(u,f){return v.sphericalToCartesian(u.expression.evaluate(f))},ot.prototype.interpolate=function(u,f,l){return{x:v.number(u.x,f.x,l),y:v.number(u.y,f.y,l),z:v.number(u.z,f.z,l)}};var He=new v.Properties({anchor:new v.DataConstantProperty(v.styleSpec.light.anchor),position:new ot,color:new v.DataConstantProperty(v.styleSpec.light.color),intensity:new v.DataConstantProperty(v.styleSpec.light.intensity)}),ut=function(u){function f(l){u.call(this),this._transitionable=new v.Transitionable(He),this.setLight(l),this._transitioning=this._transitionable.untransitioned()}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getLight=function(){return this._transitionable.serialize()},f.prototype.setLight=function(l,h){if(h===void 0&&(h={}),!this._validate(v.validateLight,l,h))for(var x in l){var S=l[x];v.endsWith(x,"-transition")?this._transitionable.setTransition(x.slice(0,-"-transition".length),S):this._transitionable.setValue(x,S)}},f.prototype.updateTransitions=function(l){this._transitioning=this._transitionable.transitioned(l,this._transitioning)},f.prototype.hasTransition=function(){return this._transitioning.hasTransition()},f.prototype.recalculate=function(l){this.properties=this._transitioning.possiblyEvaluate(l)},f.prototype._validate=function(l,h,x){return(!x||x.validate!==!1)&&v.emitValidationErrors(this,l.call(v.validateStyle,v.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:v.styleSpec})))},f}(v.Evented),Ye=function(u,f){this.width=u,this.height=f,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Ye.prototype.getDash=function(u,f){var l=u.join(",")+String(f);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(u,f)),this.dashEntry[l]},Ye.prototype.getDashRanges=function(u,f,l){var h=[],x=u.length%2==1?-u[u.length-1]*l:0,S=u[0]*l,E=!0;h.push({left:x,right:S,isDash:E,zeroLength:u[0]===0});for(var P=u[0],R=1;R<u.length;R++){var z=u[R];h.push({left:x=P*l,right:S=(P+=z)*l,isDash:E=!E,zeroLength:z===0})}return h},Ye.prototype.addRoundDash=function(u,f,l){for(var h=f/2,x=-l;x<=l;x++)for(var S=this.width*(this.nextRow+l+x),E=0,P=u[E],R=0;R<this.width;R++){R/P.right>1&&(P=u[++E]);var z=Math.abs(R-P.left),j=Math.abs(R-P.right),ee=Math.min(z,j),ne=void 0,Ae=x/l*(h+1);if(P.isDash){var Se=h-Math.abs(Ae);ne=Math.sqrt(ee*ee+Se*Se)}else ne=h-Math.sqrt(ee*ee+Ae*Ae);this.data[S+R]=Math.max(0,Math.min(255,ne+128))}},Ye.prototype.addRegularDash=function(u){for(var f=u.length-1;f>=0;--f){var l=u[f],h=u[f+1];l.zeroLength?u.splice(f,1):h&&h.isDash===l.isDash&&(h.left=l.left,u.splice(f,1))}var x=u[0],S=u[u.length-1];x.isDash===S.isDash&&(x.left=S.left-this.width,S.right=x.right+this.width);for(var E=this.width*this.nextRow,P=0,R=u[P],z=0;z<this.width;z++){z/R.right>1&&(R=u[++P]);var j=Math.abs(z-R.left),ee=Math.abs(z-R.right),ne=Math.min(j,ee);this.data[E+z]=Math.max(0,Math.min(255,(R.isDash?ne:-ne)+128))}},Ye.prototype.addDash=function(u,f){var l=f?7:0,h=2*l+1;if(this.nextRow+h>this.height)return v.warnOnce("LineAtlas out of space"),null;for(var x=0,S=0;S<u.length;S++)x+=u[S];if(x!==0){var E=this.width/x,P=this.getDashRanges(u,this.width,E);f?this.addRoundDash(P,E,l):this.addRegularDash(P)}var R={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:x};return this.nextRow+=h,this.dirty=!0,R},Ye.prototype.bind=function(u){var f=u.gl;this.texture?(f.bindTexture(f.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,f.texSubImage2D(f.TEXTURE_2D,0,0,0,this.width,this.height,f.ALPHA,f.UNSIGNED_BYTE,this.data))):(this.texture=f.createTexture(),f.bindTexture(f.TEXTURE_2D,this.texture),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,f.REPEAT),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,f.LINEAR),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,f.LINEAR),f.texImage2D(f.TEXTURE_2D,0,f.ALPHA,this.width,this.height,0,f.ALPHA,f.UNSIGNED_BYTE,this.data))};var Lt=function u(f,l){this.workerPool=f,this.actors=[],this.currentActor=0,this.id=v.uniqueId();for(var h=this.workerPool.acquire(this.id),x=0;x<h.length;x++){var S=new u.Actor(h[x],l,this.id);S.name="Worker "+x,this.actors.push(S)}};function ur(u,f,l){var h=function(x,S){if(x)return l(x);if(S){var E=v.pick(v.extend(S,u),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);S.vector_layers&&(E.vectorLayers=S.vector_layers,E.vectorLayerIds=E.vectorLayers.map(function(P){return P.id})),E.tiles=f.canonicalizeTileset(E,u.url),l(null,E)}};return u.url?v.getJSON(f.transformRequest(f.normalizeSourceURL(u.url),v.ResourceType.Source),h):v.browser.frame(function(){return h(null,u)})}Lt.prototype.broadcast=function(u,f,l){v.asyncAll(this.actors,function(h,x){h.send(u,f,x)},l=l||function(){})},Lt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Lt.prototype.remove=function(){this.actors.forEach(function(u){u.remove()}),this.actors=[],this.workerPool.release(this.id)},Lt.Actor=v.Actor;var Ir=function(u,f,l){this.bounds=v.LngLatBounds.convert(this.validateBounds(u)),this.minzoom=f||0,this.maxzoom=l||24};Ir.prototype.validateBounds=function(u){return Array.isArray(u)&&u.length===4?[Math.max(-180,u[0]),Math.max(-90,u[1]),Math.min(180,u[2]),Math.min(90,u[3])]:[-180,-90,180,90]},Ir.prototype.contains=function(u){var f=Math.pow(2,u.z),l=Math.floor(v.mercatorXfromLng(this.bounds.getWest())*f),h=Math.floor(v.mercatorYfromLat(this.bounds.getNorth())*f),x=Math.ceil(v.mercatorXfromLng(this.bounds.getEast())*f),S=Math.ceil(v.mercatorYfromLat(this.bounds.getSouth())*f);return u.x>=l&&u.x<x&&u.y>=h&&u.y<S};var Vr=function(u){function f(l,h,x,S){if(u.call(this),this.id=l,this.dispatcher=x,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,v.extend(this,v.pick(h,["url","scheme","tileSize","promoteId"])),this._options=v.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(S)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.load=function(){var l=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ur(this._options,this.map._requestManager,function(h,x){l._tileJSONRequest=null,l._loaded=!0,h?l.fire(new v.ErrorEvent(h)):x&&(v.extend(l,x),x.bounds&&(l.tileBounds=new Ir(x.bounds,l.minzoom,l.maxzoom)),v.postTurnstileEvent(x.tiles,l.map._requestManager._customAccessToken),v.postMapLoadEvent(x.tiles,l.map._getMapId(),l.map._requestManager._skuToken,l.map._requestManager._customAccessToken),l.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),l.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.hasTile=function(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)},f.prototype.onAdd=function(l){this.map=l,this.load()},f.prototype.setSourceProperty=function(l){this._tileJSONRequest&&this._tileJSONRequest.cancel(),l(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},f.prototype.setTiles=function(l){var h=this;return this.setSourceProperty(function(){h._options.tiles=l}),this},f.prototype.setUrl=function(l){var h=this;return this.setSourceProperty(function(){h.url=l,h._options.url=l}),this},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.loadTile=function(l,h){var x=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme)),S={request:this.map._requestManager.transformRequest(x,v.ResourceType.Tile),uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,tileSize:this.tileSize*l.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function E(P,R){return delete l.request,l.aborted?h(null):P&&P.status!==404?h(P):(R&&R.resourceTiming&&(l.resourceTiming=R.resourceTiming),this.map._refreshExpiredTiles&&R&&l.setExpiryData(R),l.loadVectorData(R,this.map.painter),v.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(l.reloadCallback&&(this.loadTile(l,l.reloadCallback),l.reloadCallback=null)))}S.request.collectResourceTiming=this._collectResourceTiming,l.actor&&l.state!=="expired"?l.state==="loading"?l.reloadCallback=h:l.request=l.actor.send("reloadTile",S,E.bind(this)):(l.actor=this.dispatcher.getActor(),l.request=l.actor.send("loadTile",S,E.bind(this)))},f.prototype.abortTile=function(l){l.request&&(l.request.cancel(),delete l.request),l.actor&&l.actor.send("abortTile",{uid:l.uid,type:this.type,source:this.id},void 0)},f.prototype.unloadTile=function(l){l.unloadVectorData(),l.actor&&l.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id},void 0)},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Ee=function(u){function f(l,h,x,S){u.call(this),this.id=l,this.dispatcher=x,this.setEventedParent(S),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=v.extend({type:"raster"},h),v.extend(this,v.pick(h,["url","scheme","tileSize"]))}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.load=function(){var l=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=ur(this._options,this.map._requestManager,function(h,x){l._tileJSONRequest=null,l._loaded=!0,h?l.fire(new v.ErrorEvent(h)):x&&(v.extend(l,x),x.bounds&&(l.tileBounds=new Ir(x.bounds,l.minzoom,l.maxzoom)),v.postTurnstileEvent(x.tiles),v.postMapLoadEvent(x.tiles,l.map._getMapId(),l.map._requestManager._skuToken),l.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})),l.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})))})},f.prototype.loaded=function(){return this._loaded},f.prototype.onAdd=function(l){this.map=l,this.load()},f.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},f.prototype.serialize=function(){return v.extend({},this._options)},f.prototype.hasTile=function(l){return!this.tileBounds||this.tileBounds.contains(l.canonical)},f.prototype.loadTile=function(l,h){var x=this,S=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);l.request=v.getImage(this.map._requestManager.transformRequest(S,v.ResourceType.Tile),function(E,P){if(delete l.request,l.aborted)l.state="unloaded",h(null);else if(E)l.state="errored",h(E);else if(P){x.map._refreshExpiredTiles&&l.setExpiryData(P),delete P.cacheControl,delete P.expires;var R=x.map.painter.context,z=R.gl;l.texture=x.map.painter.getTileTexture(P.width),l.texture?l.texture.update(P,{useMipmap:!0}):(l.texture=new v.Texture(R,P,z.RGBA,{useMipmap:!0}),l.texture.bind(z.LINEAR,z.CLAMP_TO_EDGE,z.LINEAR_MIPMAP_NEAREST),R.extTextureFilterAnisotropic&&z.texParameterf(z.TEXTURE_2D,R.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,R.extTextureFilterAnisotropicMax)),l.state="loaded",v.cacheEntryPossiblyAdded(x.dispatcher),h(null)}})},f.prototype.abortTile=function(l,h){l.request&&(l.request.cancel(),delete l.request),h()},f.prototype.unloadTile=function(l,h){l.texture&&this.map.painter.saveTileTexture(l.texture),h()},f.prototype.hasTransition=function(){return!1},f}(v.Evented),Ve=function(u){function f(l,h,x,S){u.call(this,l,h,x,S),this.type="raster-dem",this.maxzoom=22,this._options=v.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},f.prototype.loadTile=function(l,h){var x=this.map._requestManager.normalizeTileURL(l.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function S(E,P){E&&(l.state="errored",h(E)),P&&(l.dem=P,l.needsHillshadePrepare=!0,l.state="loaded",h(null))}l.request=v.getImage(this.map._requestManager.transformRequest(x,v.ResourceType.Tile),function(E,P){if(delete l.request,l.aborted)l.state="unloaded",h(null);else if(E)l.state="errored",h(E);else if(P){this.map._refreshExpiredTiles&&l.setExpiryData(P),delete P.cacheControl,delete P.expires;var R=v.window.ImageBitmap&&P instanceof v.window.ImageBitmap&&v.offscreenCanvasSupported()?P:v.browser.getImageData(P,1),z={uid:l.uid,coord:l.tileID,source:this.id,rawImageData:R,encoding:this.encoding};l.actor&&l.state!=="expired"||(l.actor=this.dispatcher.getActor(),l.actor.send("loadDEMTile",z,S.bind(this)))}}.bind(this)),l.neighboringTiles=this._getNeighboringTiles(l.tileID)},f.prototype._getNeighboringTiles=function(l){var h=l.canonical,x=Math.pow(2,h.z),S=(h.x-1+x)%x,E=h.x===0?l.wrap-1:l.wrap,P=(h.x+1+x)%x,R=h.x+1===x?l.wrap+1:l.wrap,z={};return z[new v.OverscaledTileID(l.overscaledZ,E,h.z,S,h.y).key]={backfilled:!1},z[new v.OverscaledTileID(l.overscaledZ,R,h.z,P,h.y).key]={backfilled:!1},h.y>0&&(z[new v.OverscaledTileID(l.overscaledZ,E,h.z,S,h.y-1).key]={backfilled:!1},z[new v.OverscaledTileID(l.overscaledZ,l.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},z[new v.OverscaledTileID(l.overscaledZ,R,h.z,P,h.y-1).key]={backfilled:!1}),h.y+1<x&&(z[new v.OverscaledTileID(l.overscaledZ,E,h.z,S,h.y+1).key]={backfilled:!1},z[new v.OverscaledTileID(l.overscaledZ,l.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},z[new v.OverscaledTileID(l.overscaledZ,R,h.z,P,h.y+1).key]={backfilled:!1}),z},f.prototype.unloadTile=function(l){l.demTexture&&this.map.painter.saveTileTexture(l.demTexture),l.fbo&&(l.fbo.destroy(),delete l.fbo),l.dem&&delete l.dem,delete l.neighboringTiles,l.state="unloaded",l.actor&&l.actor.send("removeDEMTile",{uid:l.uid,source:this.id})},f}(Ee),ke=function(u){function f(l,h,x,S){u.call(this),this.id=l,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=x.getActor(),this.setEventedParent(S),this._data=h.data,this._options=v.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var E=v.EXTENT/this.tileSize;this.workerOptions=v.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*E,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*E,extent:v.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:v.EXTENT,radius:(h.clusterRadius||50)*E,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.load=function(){var l=this;this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)l.fire(new v.ErrorEvent(h));else{var x={dataType:"source",sourceDataType:"metadata"};l._collectResourceTiming&&l._resourceTiming&&l._resourceTiming.length>0&&(x.resourceTiming=l._resourceTiming,l._resourceTiming=[]),l.fire(new v.Event("data",x))}})},f.prototype.onAdd=function(l){this.map=l,this.load()},f.prototype.setData=function(l){var h=this;return this._data=l,this.fire(new v.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(x){if(x)h.fire(new v.ErrorEvent(x));else{var S={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(S.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new v.Event("data",S))}}),this},f.prototype.getClusterExpansionZoom=function(l,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:l,source:this.id},h),this},f.prototype.getClusterChildren=function(l,h){return this.actor.send("geojson.getClusterChildren",{clusterId:l,source:this.id},h),this},f.prototype.getClusterLeaves=function(l,h,x,S){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:l,limit:h,offset:x},S),this},f.prototype._updateWorkerData=function(l){var h=this;this._loaded=!1;var x=v.extend({},this.workerOptions),S=this._data;typeof S=="string"?(x.request=this.map._requestManager.transformRequest(v.browser.resolveURL(S),v.ResourceType.Source),x.request.collectResourceTiming=this._collectResourceTiming):x.data=JSON.stringify(S),this.actor.send(this.type+".loadData",x,function(E,P){h._removed||P&&P.abandoned||(h._loaded=!0,P&&P.resourceTiming&&P.resourceTiming[h.id]&&(h._resourceTiming=P.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:x.source},null),l(E))})},f.prototype.loaded=function(){return this._loaded},f.prototype.loadTile=function(l,h){var x=this,S=l.actor?"reloadTile":"loadTile";l.actor=this.actor,l.request=this.actor.send(S,{type:this.type,uid:l.uid,tileID:l.tileID,zoom:l.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:v.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(E,P){return delete l.request,l.unloadVectorData(),l.aborted?h(null):E?h(E):(l.loadVectorData(P,x.map.painter,S==="reloadTile"),h(null))})},f.prototype.abortTile=function(l){l.request&&(l.request.cancel(),delete l.request),l.aborted=!0},f.prototype.unloadTile=function(l){l.unloadVectorData(),this.actor.send("removeTile",{uid:l.uid,type:this.type,source:this.id})},f.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},f.prototype.serialize=function(){return v.extend({},this._options,{type:this.type,data:this._data})},f.prototype.hasTransition=function(){return!1},f}(v.Evented),vt=v.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),Ke=function(u){function f(l,h,x,S){u.call(this),this.id=l,this.dispatcher=x,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(S),this.options=h}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.load=function(l,h){var x=this;this._loaded=!1,this.fire(new v.Event("dataloading",{dataType:"source"})),this.url=this.options.url,v.getImage(this.map._requestManager.transformRequest(this.url,v.ResourceType.Image),function(S,E){x._loaded=!0,S?x.fire(new v.ErrorEvent(S)):E&&(x.image=E,l&&(x.coordinates=l),h&&h(),x._finishLoading())})},f.prototype.loaded=function(){return this._loaded},f.prototype.updateImage=function(l){var h=this;return this.image&&l.url?(this.options.url=l.url,this.load(l.coordinates,function(){h.texture=null}),this):this},f.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"metadata"})))},f.prototype.onAdd=function(l){this.map=l,this.load()},f.prototype.setCoordinates=function(l){var h=this;this.coordinates=l;var x=l.map(v.MercatorCoordinate.fromLngLat);this.tileID=function(E){for(var P=1/0,R=1/0,z=-1/0,j=-1/0,ee=0,ne=E;ee<ne.length;ee+=1){var Ae=ne[ee];P=Math.min(P,Ae.x),R=Math.min(R,Ae.y),z=Math.max(z,Ae.x),j=Math.max(j,Ae.y)}var Se=Math.max(z-P,j-R),De=Math.max(0,Math.floor(-Math.log(Se)/Math.LN2)),_e=Math.pow(2,De);return new v.CanonicalTileID(De,Math.floor((P+z)/2*_e),Math.floor((R+j)/2*_e))}(x),this.minzoom=this.maxzoom=this.tileID.z;var S=x.map(function(E){return h.tileID.getTilePoint(E)._round()});return this._boundsArray=new v.StructArrayLayout4i8,this._boundsArray.emplaceBack(S[0].x,S[0].y,0,0),this._boundsArray.emplaceBack(S[1].x,S[1].y,v.EXTENT,0),this._boundsArray.emplaceBack(S[3].x,S[3].y,0,v.EXTENT),this._boundsArray.emplaceBack(S[2].x,S[2].y,v.EXTENT,v.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new v.Event("data",{dataType:"source",sourceDataType:"content"})),this},f.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var l=this.map.painter.context,h=l.gl;for(var x in this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,vt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new v.Texture(l,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},f.prototype.loadTile=function(l,h){this.tileID&&this.tileID.equals(l.tileID.canonical)?(this.tiles[String(l.tileID.wrap)]=l,l.buckets={},h(null)):(l.state="errored",h(null))},f.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return!1},f}(v.Evented),H=function(u){function f(l,h,x,S){u.call(this,l,h,x,S),this.roundZoom=!0,this.type="video",this.options=h}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.load=function(){var l=this;this._loaded=!1;var h=this.options;this.urls=[];for(var x=0,S=h.urls;x<S.length;x+=1)this.urls.push(this.map._requestManager.transformRequest(S[x],v.ResourceType.Source).url);v.getVideo(this.urls,function(E,P){l._loaded=!0,E?l.fire(new v.ErrorEvent(E)):P&&(l.video=P,l.video.loop=!0,l.video.addEventListener("playing",function(){l.map.triggerRepaint()}),l.map&&l.video.play(),l._finishLoading())})},f.prototype.pause=function(){this.video&&this.video.pause()},f.prototype.play=function(){this.video&&this.video.play()},f.prototype.seek=function(l){if(this.video){var h=this.video.seekable;l<h.start(0)||l>h.end(0)?this.fire(new v.ErrorEvent(new v.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=l}},f.prototype.getVideo=function(){return this.video},f.prototype.onAdd=function(l){this.map||(this.map=l,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},f.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var l=this.map.painter.context,h=l.gl;for(var x in this.boundsBuffer||(this.boundsBuffer=l.createVertexBuffer(this._boundsArray,vt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new v.Texture(l,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this.video&&!this.video.paused},f}(Ke),Je=function(u){function f(l,h,x,S){u.call(this,l,h,x,S),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(E){return!Array.isArray(E)||E.length!==2||E.some(function(P){return typeof P!="number"})})||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+l,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+l,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new v.ErrorEvent(new v.ValidationError("sources."+l,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof v.window.HTMLCanvasElement||this.fire(new v.ErrorEvent(new v.ValidationError("sources."+l,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new v.ErrorEvent(new v.ValidationError("sources."+l,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof v.window.HTMLCanvasElement?this.options.canvas:v.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new v.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},f.prototype.getCanvas=function(){return this.canvas},f.prototype.onAdd=function(l){this.map=l,this.load(),this.canvas&&this.animate&&this.play()},f.prototype.onRemove=function(){this.pause()},f.prototype.prepare=function(){var l=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,l=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,l=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,x=h.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,vt.members)),this.boundsSegments||(this.boundsSegments=v.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(l||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new v.Texture(h,this.canvas,x.RGBA,{premultiply:!0}),this.tiles){var E=this.tiles[S];E.state!=="loaded"&&(E.state="loaded",E.texture=this.texture)}}},f.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},f.prototype.hasTransition=function(){return this._playing},f.prototype._hasInvalidDimensions=function(){for(var l=0,h=[this.canvas.width,this.canvas.height];l<h.length;l+=1){var x=h[l];if(isNaN(x)||x<=0)return!0}return!1},f}(Ke),Et={vector:Vr,raster:Ee,"raster-dem":Ve,geojson:ke,video:H,image:Ke,canvas:Je};function _t(u,f){var l=v.identity([]);return v.translate(l,l,[1,1,0]),v.scale(l,l,[.5*u.width,.5*u.height,1]),v.multiply(l,l,u.calculatePosMatrix(f.toUnwrapped()))}function Yr(u,f,l,h,x,S){var E=function(De,_e,Fe){if(De)for(var Ge=0,at=De;Ge<at.length;Ge+=1){var Ct=_e[at[Ge]];if(Ct&&Ct.source===Fe&&Ct.type==="fill-extrusion")return!0}else for(var wt in _e){var Mt=_e[wt];if(Mt.source===Fe&&Mt.type==="fill-extrusion")return!0}return!1}(x&&x.layers,f,u.id),P=S.maxPitchScaleFactor(),R=u.tilesIn(h,P,E);R.sort(wi);for(var z=[],j=0,ee=R;j<ee.length;j+=1){var ne=ee[j];z.push({wrappedTileID:ne.tileID.wrapped().key,queryResults:ne.tile.queryRenderedFeatures(f,l,u._state,ne.queryGeometry,ne.cameraQueryGeometry,ne.scale,x,S,P,_t(u.transform,ne.tileID))})}var Ae=function(De){for(var _e={},Fe={},Ge=0,at=De;Ge<at.length;Ge+=1){var Ct=at[Ge],wt=Ct.queryResults,Mt=Ct.wrappedTileID,qt=Fe[Mt]=Fe[Mt]||{};for(var xr in wt)for(var pr=wt[xr],Fr=qt[xr]=qt[xr]||{},tn=_e[xr]=_e[xr]||[],pn=0,ln=pr;pn<ln.length;pn+=1){var pi=ln[pn];Fr[pi.featureIndex]||(Fr[pi.featureIndex]=!0,tn.push(pi))}}return _e}(z);for(var Se in Ae)Ae[Se].forEach(function(De){var _e=De.feature,Fe=u.getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=Fe});return Ae}function wi(u,f){var l=u.tileID,h=f.tileID;return l.overscaledZ-h.overscaledZ||l.canonical.y-h.canonical.y||l.wrap-h.wrap||l.canonical.x-h.canonical.x}var On=function(u,f){this.max=u,this.onRemove=f,this.reset()};On.prototype.reset=function(){for(var u in this.data)for(var f=0,l=this.data[u];f<l.length;f+=1){var h=l[f];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},On.prototype.add=function(u,f,l){var h=this,x=u.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);var S={value:f,timeout:void 0};if(l!==void 0&&(S.timeout=setTimeout(function(){h.remove(u,S)},l)),this.data[x].push(S),this.order.push(x),this.order.length>this.max){var E=this._getAndRemoveByKey(this.order[0]);E&&this.onRemove(E)}return this},On.prototype.has=function(u){return u.wrapped().key in this.data},On.prototype.getAndRemove=function(u){return this.has(u)?this._getAndRemoveByKey(u.wrapped().key):null},On.prototype._getAndRemoveByKey=function(u){var f=this.data[u].shift();return f.timeout&&clearTimeout(f.timeout),this.data[u].length===0&&delete this.data[u],this.order.splice(this.order.indexOf(u),1),f.value},On.prototype.getByKey=function(u){var f=this.data[u];return f?f[0].value:null},On.prototype.get=function(u){return this.has(u)?this.data[u.wrapped().key][0].value:null},On.prototype.remove=function(u,f){if(!this.has(u))return this;var l=u.wrapped().key,h=f===void 0?0:this.data[l].indexOf(f),x=this.data[l][h];return this.data[l].splice(h,1),x.timeout&&clearTimeout(x.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(x.value),this.order.splice(this.order.indexOf(l),1),this},On.prototype.setMaxSize=function(u){for(this.max=u;this.order.length>this.max;){var f=this._getAndRemoveByKey(this.order[0]);f&&this.onRemove(f)}return this},On.prototype.filter=function(u){var f=[];for(var l in this.data)for(var h=0,x=this.data[l];h<x.length;h+=1){var S=x[h];u(S.value)||f.push(S)}for(var E=0,P=f;E<P.length;E+=1){var R=P[E];this.remove(R.value.tileID,R)}};var An=function(u,f,l){this.context=u;var h=u.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(l),this.context.unbindVAO(),u.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};An.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},An.prototype.updateData=function(u){var f=this.context.gl;this.context.unbindVAO(),this.bind(),f.bufferSubData(f.ELEMENT_ARRAY_BUFFER,0,u.arrayBuffer)},An.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var gn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Cn=function(u,f,l,h){this.length=f.length,this.attributes=l,this.itemSize=f.bytesPerElement,this.dynamicDraw=h,this.context=u;var x=u.gl;this.buffer=x.createBuffer(),u.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,f.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete f.arrayBuffer};Cn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Cn.prototype.updateData=function(u){var f=this.context.gl;this.bind(),f.bufferSubData(f.ARRAY_BUFFER,0,u.arrayBuffer)},Cn.prototype.enableAttributes=function(u,f){for(var l=0;l<this.attributes.length;l++){var h=f.attributes[this.attributes[l].name];h!==void 0&&u.enableVertexAttribArray(h)}},Cn.prototype.setVertexAttribPointers=function(u,f,l){for(var h=0;h<this.attributes.length;h++){var x=this.attributes[h],S=f.attributes[x.name];S!==void 0&&u.vertexAttribPointer(S,x.components,u[gn[x.type]],!1,this.itemSize,x.offset+this.itemSize*(l||0))}},Cn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var sn=function(u){this.gl=u.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};sn.prototype.get=function(){return this.current},sn.prototype.set=function(u){},sn.prototype.getDefault=function(){return this.default},sn.prototype.setDefault=function(){this.set(this.default)};var Oi=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(l){var h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.clearColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)},f}(sn),Si=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return 1},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.clearDepth(l),this.current=l,this.dirty=!1)},f}(sn),da=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return 0},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.clearStencil(l),this.current=l,this.dirty=!1)},f}(sn),sa=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return[!0,!0,!0,!0]},f.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.colorMask(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)},f}(sn),Ai=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!0},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.depthMask(l),this.current=l,this.dirty=!1)},f}(sn),uo=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return 255},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.stencilMask(l),this.current=l,this.dirty=!1)},f}(sn),Mi=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},f.prototype.set=function(l){var h=this.current;(l.func!==h.func||l.ref!==h.ref||l.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(l.func,l.ref,l.mask),this.current=l,this.dirty=!1)},f}(sn),Pi=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){var l=this.gl;return[l.KEEP,l.KEEP,l.KEEP]},f.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(l[0],l[1],l[2]),this.current=l,this.dirty=!1)},f}(sn),To=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;l?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=l,this.dirty=!1}},f}(sn),le=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return[0,1]},f.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.depthRange(l[0],l[1]),this.current=l,this.dirty=!1)},f}(sn),Ha=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;l?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=l,this.dirty=!1}},f}(sn),ki=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.LESS},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.depthFunc(l),this.current=l,this.dirty=!1)},f}(sn),Wo=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;l?h.enable(h.BLEND):h.disable(h.BLEND),this.current=l,this.dirty=!1}},f}(sn),hu=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){var l=this.gl;return[l.ONE,l.ZERO]},f.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(l[0],l[1]),this.current=l,this.dirty=!1)},f}(sn),rs=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return v.Color.transparent},f.prototype.set=function(l){var h=this.current;(l.r!==h.r||l.g!==h.g||l.b!==h.b||l.a!==h.a||this.dirty)&&(this.gl.blendColor(l.r,l.g,l.b,l.a),this.current=l,this.dirty=!1)},f}(sn),ns=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.FUNC_ADD},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.blendEquation(l),this.current=l,this.dirty=!1)},f}(sn),bt=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;l?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=l,this.dirty=!1}},f}(sn),Yt=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.BACK},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.cullFace(l),this.current=l,this.dirty=!1)},f}(sn),Cr=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.CCW},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.frontFace(l),this.current=l,this.dirty=!1)},f}(sn),zr=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.useProgram(l),this.current=l,this.dirty=!1)},f}(sn),dn=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return this.gl.TEXTURE0},f.prototype.set=function(l){(l!==this.current||this.dirty)&&(this.gl.activeTexture(l),this.current=l,this.dirty=!1)},f}(sn),si=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){var l=this.gl;return[0,0,l.drawingBufferWidth,l.drawingBufferHeight]},f.prototype.set=function(l){var h=this.current;(l[0]!==h[0]||l[1]!==h[1]||l[2]!==h[2]||l[3]!==h[3]||this.dirty)&&(this.gl.viewport(l[0],l[1],l[2],l[3]),this.current=l,this.dirty=!1)},f}(sn),Fn=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,l),this.current=l,this.dirty=!1}},f}(sn),$n=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,l),this.current=l,this.dirty=!1}},f}(sn),Mn=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,l),this.current=l,this.dirty=!1}},f}(sn),hi=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,l),this.current=l,this.dirty=!1}},f}(sn),ni=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,l),this.current=l,this.dirty=!1},f}(sn),eo=function(u){function f(l){u.call(this,l),this.vao=l.extVertexArrayObject}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f.prototype.set=function(l){this.vao&&(l!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(l),this.current=l,this.dirty=!1)},f}(sn),Ao=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return 4},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,l),this.current=l,this.dirty=!1}},f}(sn),du=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,l),this.current=l,this.dirty=!1}},f}(sn),ks=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return!1},f.prototype.set=function(l){if(l!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,l),this.current=l,this.dirty=!1}},f}(sn),Ji=function(u){function f(l,h){u.call(this,l),this.context=l,this.parent=h}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getDefault=function(){return null},f}(sn),N=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.setDirty=function(){this.dirty=!0},f.prototype.set=function(l){if(l!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,l,0),this.current=l,this.dirty=!1}},f}(Ji),U=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.set=function(l){if(l!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,l),this.current=l,this.dirty=!1}},f}(Ji),Y=function(u,f,l,h){this.context=u,this.width=f,this.height=l;var x=this.framebuffer=u.gl.createFramebuffer();this.colorAttachment=new N(u,x),h&&(this.depthAttachment=new U(u,x))};Y.prototype.destroy=function(){var u=this.context.gl,f=this.colorAttachment.get();if(f&&u.deleteTexture(f),this.depthAttachment){var l=this.depthAttachment.get();l&&u.deleteRenderbuffer(l)}u.deleteFramebuffer(this.framebuffer)};var se=function(u,f,l){this.func=u,this.mask=f,this.range=l};se.ReadOnly=!1,se.ReadWrite=!0,se.disabled=new se(519,se.ReadOnly,[0,1]);var Te=function(u,f,l,h,x,S){this.test=u,this.ref=f,this.mask=l,this.fail=h,this.depthFail=x,this.pass=S};Te.disabled=new Te({func:519,mask:0},0,0,7680,7680,7680);var Ze=function(u,f,l){this.blendFunction=u,this.blendColor=f,this.mask=l};Ze.disabled=new Ze(Ze.Replace=[1,0],v.Color.transparent,[!1,!1,!1,!1]),Ze.unblended=new Ze(Ze.Replace,v.Color.transparent,[!0,!0,!0,!0]),Ze.alphaBlended=new Ze([1,771],v.Color.transparent,[!0,!0,!0,!0]);var We=function(u,f,l){this.enable=u,this.mode=f,this.frontFace=l};We.disabled=new We(!1,1029,2305),We.backCCW=new We(!0,1029,2305);var te=function(u){this.gl=u,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Oi(this),this.clearDepth=new Si(this),this.clearStencil=new da(this),this.colorMask=new sa(this),this.depthMask=new Ai(this),this.stencilMask=new uo(this),this.stencilFunc=new Mi(this),this.stencilOp=new Pi(this),this.stencilTest=new To(this),this.depthRange=new le(this),this.depthTest=new Ha(this),this.depthFunc=new ki(this),this.blend=new Wo(this),this.blendFunc=new hu(this),this.blendColor=new rs(this),this.blendEquation=new ns(this),this.cullFace=new bt(this),this.cullFaceSide=new Yt(this),this.frontFace=new Cr(this),this.program=new zr(this),this.activeTexture=new dn(this),this.viewport=new si(this),this.bindFramebuffer=new Fn(this),this.bindRenderbuffer=new $n(this),this.bindTexture=new Mn(this),this.bindVertexBuffer=new hi(this),this.bindElementBuffer=new ni(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new eo(this),this.pixelStoreUnpack=new Ao(this),this.pixelStoreUnpackPremultiplyAlpha=new du(this),this.pixelStoreUnpackFlipY=new ks(this),this.extTextureFilterAnisotropic=u.getExtension("EXT_texture_filter_anisotropic")||u.getExtension("MOZ_EXT_texture_filter_anisotropic")||u.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=u.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=u.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(u.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=u.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=u.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=u.getParameter(u.MAX_TEXTURE_SIZE)};te.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},te.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},te.prototype.createIndexBuffer=function(u,f){return new An(this,u,f)},te.prototype.createVertexBuffer=function(u,f,l){return new Cn(this,u,f,l)},te.prototype.createRenderbuffer=function(u,f,l){var h=this.gl,x=h.createRenderbuffer();return this.bindRenderbuffer.set(x),h.renderbufferStorage(h.RENDERBUFFER,u,f,l),this.bindRenderbuffer.set(null),x},te.prototype.createFramebuffer=function(u,f,l){return new Y(this,u,f,l)},te.prototype.clear=function(u){var f=u.color,l=u.depth,h=this.gl,x=0;f&&(x|=h.COLOR_BUFFER_BIT,this.clearColor.set(f),this.colorMask.set([!0,!0,!0,!0])),l!==void 0&&(x|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),h.clear(x)},te.prototype.setCullFace=function(u){u.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(u.mode),this.frontFace.set(u.frontFace))},te.prototype.setDepthMode=function(u){u.func!==this.gl.ALWAYS||u.mask?(this.depthTest.set(!0),this.depthFunc.set(u.func),this.depthMask.set(u.mask),this.depthRange.set(u.range)):this.depthTest.set(!1)},te.prototype.setStencilMode=function(u){u.test.func!==this.gl.ALWAYS||u.mask?(this.stencilTest.set(!0),this.stencilMask.set(u.mask),this.stencilOp.set([u.fail,u.depthFail,u.pass]),this.stencilFunc.set({func:u.test.func,ref:u.ref,mask:u.test.mask})):this.stencilTest.set(!1)},te.prototype.setColorMode=function(u){v.deepEqual(u.blendFunction,Ze.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(u.blendFunction),this.blendColor.set(u.blendColor)),this.colorMask.set(u.mask)},te.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ie=function(u){function f(l,h,x){var S=this;u.call(this),this.id=l,this.dispatcher=x,this.on("data",function(E){E.dataType==="source"&&E.sourceDataType==="metadata"&&(S._sourceLoaded=!0),S._sourceLoaded&&!S._paused&&E.dataType==="source"&&E.sourceDataType==="content"&&(S.reload(),S.transform&&S.update(S.transform))}),this.on("error",function(){S._sourceErrored=!0}),this._source=function(E,P,R,z){var j=new Et[P.type](E,P,R,z);if(j.id!==E)throw new Error("Expected Source id to be "+E+" instead of "+j.id);return v.bindAll(["load","abort","unload","serialize","prepare"],j),j}(l,h,x,this),this._tiles={},this._cache=new On(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new v.SourceFeatureState}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.onAdd=function(l){this.map=l,this._maxTileCacheSize=l?l._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(l)},f.prototype.onRemove=function(l){this._source&&this._source.onRemove&&this._source.onRemove(l)},f.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var l in this._tiles){var h=this._tiles[l];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},f.prototype.getSource=function(){return this._source},f.prototype.pause=function(){this._paused=!0},f.prototype.resume=function(){if(this._paused){var l=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,l&&this.reload(),this.transform&&this.update(this.transform)}},f.prototype._loadTile=function(l,h){return this._source.loadTile(l,h)},f.prototype._unloadTile=function(l){if(this._source.unloadTile)return this._source.unloadTile(l,function(){})},f.prototype._abortTile=function(l){if(this._source.abortTile)return this._source.abortTile(l,function(){})},f.prototype.serialize=function(){return this._source.serialize()},f.prototype.prepare=function(l){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var x=this._tiles[h];x.upload(l),x.prepare(this.map.style.imageManager)}},f.prototype.getIds=function(){return v.values(this._tiles).map(function(l){return l.tileID}).sort(nt).map(function(l){return l.key})},f.prototype.getRenderableIds=function(l){var h=this,x=[];for(var S in this._tiles)this._isIdRenderable(S,l)&&x.push(this._tiles[S]);return l?x.sort(function(E,P){var R=E.tileID,z=P.tileID,j=new v.Point(R.canonical.x,R.canonical.y)._rotate(h.transform.angle),ee=new v.Point(z.canonical.x,z.canonical.y)._rotate(h.transform.angle);return R.overscaledZ-z.overscaledZ||ee.y-j.y||ee.x-j.x}).map(function(E){return E.tileID.key}):x.map(function(E){return E.tileID}).sort(nt).map(function(E){return E.key})},f.prototype.hasRenderableParent=function(l){var h=this.findLoadedParent(l,0);return!!h&&this._isIdRenderable(h.tileID.key)},f.prototype._isIdRenderable=function(l,h){return this._tiles[l]&&this._tiles[l].hasData()&&!this._coveredTiles[l]&&(h||!this._tiles[l].holdingForFade())},f.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var l in this._cache.reset(),this._tiles)this._tiles[l].state!=="errored"&&this._reloadTile(l,"reloading")},f.prototype._reloadTile=function(l,h){var x=this._tiles[l];x&&(x.state!=="loading"&&(x.state=h),this._loadTile(x,this._tileLoaded.bind(this,x,l,h)))},f.prototype._tileLoaded=function(l,h,x,S){if(S)return l.state="errored",void(S.status!==404?this._source.fire(new v.ErrorEvent(S,{tile:l})):this.update(this.transform));l.timeAdded=v.browser.now(),x==="expired"&&(l.refreshedUponExpiration=!0),this._setTileReloadTimer(h,l),this.getSource().type==="raster-dem"&&l.dem&&this._backfillDEM(l),this._state.initializeTileState(l,this.map?this.map.painter:null),this._source.fire(new v.Event("data",{dataType:"source",tile:l,coord:l.tileID}))},f.prototype._backfillDEM=function(l){for(var h=this.getRenderableIds(),x=0;x<h.length;x++){var S=h[x];if(l.neighboringTiles&&l.neighboringTiles[S]){var E=this.getTileByID(S);P(l,E),P(E,l)}}function P(R,z){R.needsHillshadePrepare=!0;var j=z.tileID.canonical.x-R.tileID.canonical.x,ee=z.tileID.canonical.y-R.tileID.canonical.y,ne=Math.pow(2,R.tileID.canonical.z),Ae=z.tileID.key;j===0&&ee===0||Math.abs(ee)>1||(Math.abs(j)>1&&(Math.abs(j+ne)===1?j+=ne:Math.abs(j-ne)===1&&(j-=ne)),z.dem&&R.dem&&(R.dem.backfillBorder(z.dem,j,ee),R.neighboringTiles&&R.neighboringTiles[Ae]&&(R.neighboringTiles[Ae].backfilled=!0)))}},f.prototype.getTile=function(l){return this.getTileByID(l.key)},f.prototype.getTileByID=function(l){return this._tiles[l]},f.prototype._retainLoadedChildren=function(l,h,x,S){for(var E in this._tiles){var P=this._tiles[E];if(!(S[E]||!P.hasData()||P.tileID.overscaledZ<=h||P.tileID.overscaledZ>x)){for(var R=P.tileID;P&&P.tileID.overscaledZ>h+1;){var z=P.tileID.scaledTo(P.tileID.overscaledZ-1);(P=this._tiles[z.key])&&P.hasData()&&(R=z)}for(var j=R;j.overscaledZ>h;)if(l[(j=j.scaledTo(j.overscaledZ-1)).key]){S[R.key]=R;break}}}},f.prototype.findLoadedParent=function(l,h){if(l.key in this._loadedParentTiles){var x=this._loadedParentTiles[l.key];return x&&x.tileID.overscaledZ>=h?x:null}for(var S=l.overscaledZ-1;S>=h;S--){var E=l.scaledTo(S),P=this._getLoadedTile(E);if(P)return P}},f.prototype._getLoadedTile=function(l){var h=this._tiles[l.key];return h&&h.hasData()?h:this._cache.getByKey(l.wrapped().key)},f.prototype.updateCacheSize=function(l){var h=Math.ceil(l.width/this._source.tileSize)+1,x=Math.ceil(l.height/this._source.tileSize)+1,S=Math.floor(h*x*5),E=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(E)},f.prototype.handleWrapJump=function(l){var h=Math.round((l-(this._prevLng===void 0?l:this._prevLng))/360);if(this._prevLng=l,h){var x={};for(var S in this._tiles){var E=this._tiles[S];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+h),x[E.tileID.key]=E}for(var P in this._tiles=x,this._timers)clearTimeout(this._timers[P]),delete this._timers[P];for(var R in this._tiles)this._setTileReloadTimer(R,this._tiles[R])}},f.prototype.update=function(l){var h=this;if(this.transform=l,this._sourceLoaded&&!this._paused){var x;this.updateCacheSize(l),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?x=l.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(qt){return new v.OverscaledTileID(qt.canonical.z,qt.wrap,qt.canonical.z,qt.canonical.x,qt.canonical.y)}):(x=l.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(x=x.filter(function(qt){return h._source.hasTile(qt)}))):x=[];var S=l.coveringZoomLevel(this._source),E=Math.max(S-f.maxOverzooming,this._source.minzoom),P=Math.max(S+f.maxUnderzooming,this._source.minzoom),R=this._updateRetainedTiles(x,S);if($t(this._source.type)){for(var z={},j={},ee=0,ne=Object.keys(R);ee<ne.length;ee+=1){var Ae=ne[ee],Se=R[Ae],De=this._tiles[Ae];if(De&&!(De.fadeEndTime&&De.fadeEndTime<=v.browser.now())){var _e=this.findLoadedParent(Se,E);_e&&(this._addTile(_e.tileID),z[_e.tileID.key]=_e.tileID),j[Ae]=Se}}for(var Fe in this._retainLoadedChildren(j,S,P,R),z)R[Fe]||(this._coveredTiles[Fe]=!0,R[Fe]=z[Fe])}for(var Ge in R)this._tiles[Ge].clearFadeHold();for(var at=0,Ct=v.keysDifference(this._tiles,R);at<Ct.length;at+=1){var wt=Ct[at],Mt=this._tiles[wt];Mt.hasSymbolBuckets&&!Mt.holdingForFade()?Mt.setHoldDuration(this.map._fadeDuration):Mt.hasSymbolBuckets&&!Mt.symbolFadeFinished()||this._removeTile(wt)}this._updateLoadedParentTileCache()}},f.prototype.releaseSymbolFadeTiles=function(){for(var l in this._tiles)this._tiles[l].holdingForFade()&&this._removeTile(l)},f.prototype._updateRetainedTiles=function(l,h){for(var x={},S={},E=Math.max(h-f.maxOverzooming,this._source.minzoom),P=Math.max(h+f.maxUnderzooming,this._source.minzoom),R={},z=0,j=l;z<j.length;z+=1){var ee=j[z],ne=this._addTile(ee);x[ee.key]=ee,ne.hasData()||h<this._source.maxzoom&&(R[ee.key]=ee)}this._retainLoadedChildren(R,h,P,x);for(var Ae=0,Se=l;Ae<Se.length;Ae+=1){var De=Se[Ae],_e=this._tiles[De.key];if(!_e.hasData()){if(h+1>this._source.maxzoom){var Fe=De.children(this._source.maxzoom)[0],Ge=this.getTile(Fe);if(Ge&&Ge.hasData()){x[Fe.key]=Fe;continue}}else{var at=De.children(this._source.maxzoom);if(x[at[0].key]&&x[at[1].key]&&x[at[2].key]&&x[at[3].key])continue}for(var Ct=_e.wasRequested(),wt=De.overscaledZ-1;wt>=E;--wt){var Mt=De.scaledTo(wt);if(S[Mt.key]||(S[Mt.key]=!0,!(_e=this.getTile(Mt))&&Ct&&(_e=this._addTile(Mt)),_e&&(x[Mt.key]=Mt,Ct=_e.wasRequested(),_e.hasData())))break}}}return x},f.prototype._updateLoadedParentTileCache=function(){for(var l in this._loadedParentTiles={},this._tiles){for(var h=[],x=void 0,S=this._tiles[l].tileID;S.overscaledZ>0;){if(S.key in this._loadedParentTiles){x=this._loadedParentTiles[S.key];break}h.push(S.key);var E=S.scaledTo(S.overscaledZ-1);if(x=this._getLoadedTile(E))break;S=E}for(var P=0,R=h;P<R.length;P+=1)this._loadedParentTiles[R[P]]=x}},f.prototype._addTile=function(l){var h=this._tiles[l.key];if(h)return h;(h=this._cache.getAndRemove(l))&&(this._setTileReloadTimer(l.key,h),h.tileID=l,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[l.key]&&(clearTimeout(this._cacheTimers[l.key]),delete this._cacheTimers[l.key],this._setTileReloadTimer(l.key,h)));var x=Boolean(h);return x||(h=new v.Tile(l,this._source.tileSize*l.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,l.key,h.state))),h?(h.uses++,this._tiles[l.key]=h,x||this._source.fire(new v.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},f.prototype._setTileReloadTimer=function(l,h){var x=this;l in this._timers&&(clearTimeout(this._timers[l]),delete this._timers[l]);var S=h.getExpiryTimeout();S&&(this._timers[l]=setTimeout(function(){x._reloadTile(l,"expired"),delete x._timers[l]},S))},f.prototype._removeTile=function(l){var h=this._tiles[l];h&&(h.uses--,delete this._tiles[l],this._timers[l]&&(clearTimeout(this._timers[l]),delete this._timers[l]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},f.prototype.clearTiles=function(){for(var l in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(l);this._cache.reset()},f.prototype.tilesIn=function(l,h,x){var S=this,E=[],P=this.transform;if(!P)return E;for(var R=x?P.getCameraQueryGeometry(l):l,z=l.map(function(wt){return P.pointCoordinate(wt)}),j=R.map(function(wt){return P.pointCoordinate(wt)}),ee=this.getIds(),ne=1/0,Ae=1/0,Se=-1/0,De=-1/0,_e=0,Fe=j;_e<Fe.length;_e+=1){var Ge=Fe[_e];ne=Math.min(ne,Ge.x),Ae=Math.min(Ae,Ge.y),Se=Math.max(Se,Ge.x),De=Math.max(De,Ge.y)}for(var at=function(wt){var Mt=S._tiles[ee[wt]];if(!Mt.holdingForFade()){var qt=Mt.tileID,xr=Math.pow(2,P.zoom-Mt.tileID.overscaledZ),pr=h*Mt.queryPadding*v.EXTENT/Mt.tileSize/xr,Fr=[qt.getTilePoint(new v.MercatorCoordinate(ne,Ae)),qt.getTilePoint(new v.MercatorCoordinate(Se,De))];if(Fr[0].x-pr<v.EXTENT&&Fr[0].y-pr<v.EXTENT&&Fr[1].x+pr>=0&&Fr[1].y+pr>=0){var tn=z.map(function(ln){return qt.getTilePoint(ln)}),pn=j.map(function(ln){return qt.getTilePoint(ln)});E.push({tile:Mt,tileID:qt,queryGeometry:tn,cameraQueryGeometry:pn,scale:xr})}}},Ct=0;Ct<ee.length;Ct++)at(Ct);return E},f.prototype.getVisibleCoordinates=function(l){for(var h=this,x=this.getRenderableIds(l).map(function(R){return h._tiles[R].tileID}),S=0,E=x;S<E.length;S+=1){var P=E[S];P.posMatrix=this.transform.calculatePosMatrix(P.toUnwrapped())}return x},f.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if($t(this._source.type))for(var l in this._tiles){var h=this._tiles[l];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=v.browser.now())return!0}return!1},f.prototype.setFeatureState=function(l,h,x){this._state.updateState(l=l||"_geojsonTileLayer",h,x)},f.prototype.removeFeatureState=function(l,h,x){this._state.removeFeatureState(l=l||"_geojsonTileLayer",h,x)},f.prototype.getFeatureState=function(l,h){return this._state.getState(l=l||"_geojsonTileLayer",h)},f.prototype.setDependencies=function(l,h,x){var S=this._tiles[l];S&&S.setDependencies(h,x)},f.prototype.reloadTilesForDependencies=function(l,h){for(var x in this._tiles)this._tiles[x].hasDependency(l,h)&&this._reloadTile(x,"reloading");this._cache.filter(function(S){return!S.hasDependency(l,h)})},f}(v.Evented);function nt(u,f){var l=Math.abs(2*u.wrap)-+(u.wrap<0),h=Math.abs(2*f.wrap)-+(f.wrap<0);return u.overscaledZ-f.overscaledZ||h-l||f.canonical.y-u.canonical.y||f.canonical.x-u.canonical.x}function $t(u){return u==="raster"||u==="image"||u==="video"}function lr(){return new v.window.Worker(Kc.workerUrl)}Ie.maxOverzooming=10,Ie.maxUnderzooming=3;var pt="mapboxgl_preloaded_worker_pool",tr=function(){this.active={}};tr.prototype.acquire=function(u){if(!this.workers)for(this.workers=[];this.workers.length<tr.workerCount;)this.workers.push(new lr);return this.active[u]=!0,this.workers.slice()},tr.prototype.release=function(u){delete this.active[u],this.numActive()===0&&(this.workers.forEach(function(f){f.terminate()}),this.workers=null)},tr.prototype.isPreloaded=function(){return!!this.active[pt]},tr.prototype.numActive=function(){return Object.keys(this.active).length};var Hr,Rr=Math.floor(v.browser.hardwareConcurrency/2);function Dt(){return Hr||(Hr=new tr),Hr}function Dr(u,f){var l={};for(var h in u)h!=="ref"&&(l[h]=u[h]);return v.refProperties.forEach(function(x){x in f&&(l[x]=f[x])}),l}function Pr(u){u=u.slice();for(var f=Object.create(null),l=0;l<u.length;l++)f[u[l].id]=u[l];for(var h=0;h<u.length;h++)"ref"in u[h]&&(u[h]=Dr(u[h],f[u[h].ref]));return u}tr.workerCount=Math.max(Math.min(Rr,6),1);var Mr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Nn(u,f,l){l.push({command:Mr.addSource,args:[u,f[u]]})}function Lr(u,f,l){f.push({command:Mr.removeSource,args:[u]}),l[u]=!0}function jn(u,f,l,h){Lr(u,l,h),Nn(u,f,l)}function ui(u,f,l){var h;for(h in u[l])if(u[l].hasOwnProperty(h)&&h!=="data"&&!v.deepEqual(u[l][h],f[l][h]))return!1;for(h in f[l])if(f[l].hasOwnProperty(h)&&h!=="data"&&!v.deepEqual(u[l][h],f[l][h]))return!1;return!0}function zn(u,f,l,h,x,S){var E;for(E in f=f||{},u=u||{})u.hasOwnProperty(E)&&(v.deepEqual(u[E],f[E])||l.push({command:S,args:[h,E,f[E],x]}));for(E in f)f.hasOwnProperty(E)&&!u.hasOwnProperty(E)&&(v.deepEqual(u[E],f[E])||l.push({command:S,args:[h,E,f[E],x]}))}function Pn(u){return u.id}function Vn(u,f){return u[f.id]=f,u}var Sa=function(u,f){this.reset(u,f)};Sa.prototype.reset=function(u,f){this.points=u||[],this._distances=[0];for(var l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(f||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Sa.prototype.lerp=function(u){if(this.points.length===1)return this.points[0];u=v.clamp(u,0,1);for(var f=1,l=this._distances[f],h=u*this.paddedLength+this.padding;l<h&&f<this._distances.length;)l=this._distances[++f];var x=f-1,S=this._distances[x],E=l-S,P=E>0?(h-S)/E:0;return this.points[x].mult(1-P).add(this.points[f].mult(P))};var vi=function(u,f,l){var h=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(u/l),this.yCellCount=Math.ceil(f/l);for(var S=0;S<this.xCellCount*this.yCellCount;S++)h.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=u,this.height=f,this.xScale=this.xCellCount/u,this.yScale=this.yCellCount/f,this.boxUid=0,this.circleUid=0};function Li(u,f,l,h,x){var S=v.create();return f?(v.scale(S,S,[1/x,1/x,1]),l||v.rotateZ(S,S,h.angle)):v.multiply(S,h.labelPlaneMatrix,u),S}function Wn(u,f,l,h,x){if(f){var S=v.clone(u);return v.scale(S,S,[x,x,1]),l||v.rotateZ(S,S,-h.angle),S}return h.glCoordMatrix}function Zn(u,f){var l=[u.x,u.y,0,1];ua(l,l,f);var h=l[3];return{point:new v.Point(l[0]/h,l[1]/h),signedDistanceFromCamera:h}}function Jn(u,f){return .5+u/f*.5}function Qi(u,f){var l=u[0]/u[3],h=u[1]/u[3];return l>=-f[0]&&l<=f[0]&&h>=-f[1]&&h<=f[1]}function gs(u,f,l,h,x,S,E,P){var R=h?u.textSizeData:u.iconSizeData,z=v.evaluateSizeForZoom(R,l.transform.zoom),j=[256/l.width*2+1,256/l.height*2+1],ee=h?u.text.dynamicLayoutVertexArray:u.icon.dynamicLayoutVertexArray;ee.clear();for(var ne=u.lineVertexArray,Ae=h?u.text.placedSymbolArray:u.icon.placedSymbolArray,Se=l.transform.width/l.transform.height,De=!1,_e=0;_e<Ae.length;_e++){var Fe=Ae.get(_e);if(Fe.hidden||Fe.writingMode===v.WritingMode.vertical&&!De)Ea(Fe.numGlyphs,ee);else{De=!1;var Ge=[Fe.anchorX,Fe.anchorY,0,1];if(v.transformMat4(Ge,Ge,f),Qi(Ge,j)){var at=Jn(l.transform.cameraToCenterDistance,Ge[3]),Ct=v.evaluateSizeForFeature(R,z,Fe),wt=E?Ct/at:Ct*at,Mt=new v.Point(Fe.anchorX,Fe.anchorY),qt=Zn(Mt,x).point,xr={},pr=Bu(Fe,wt,!1,P,f,x,S,u.glyphOffsetArray,ne,ee,qt,Mt,xr,Se);De=pr.useVertical,(pr.notEnoughRoom||De||pr.needsFlipping&&Bu(Fe,wt,!0,P,f,x,S,u.glyphOffsetArray,ne,ee,qt,Mt,xr,Se).notEnoughRoom)&&Ea(Fe.numGlyphs,ee)}else Ea(Fe.numGlyphs,ee)}}h?u.text.dynamicLayoutVertexBuffer.updateData(ee):u.icon.dynamicLayoutVertexBuffer.updateData(ee)}function Bi(u,f,l,h,x,S,E,P,R,z,j){var ee=P.glyphStartIndex+P.numGlyphs,ne=P.lineStartIndex,Ae=P.lineStartIndex+P.lineLength,Se=f.getoffsetX(P.glyphStartIndex),De=f.getoffsetX(ee-1),_e=ji(u*Se,l,h,x,S,E,P.segment,ne,Ae,R,z,j);if(!_e)return null;var Fe=ji(u*De,l,h,x,S,E,P.segment,ne,Ae,R,z,j);return Fe?{first:_e,last:Fe}:null}function ea(u,f,l,h){return u===v.WritingMode.horizontal&&Math.abs(l.y-f.y)>Math.abs(l.x-f.x)*h?{useVertical:!0}:(u===v.WritingMode.vertical?f.y<l.y:f.x>l.x)?{needsFlipping:!0}:null}function Bu(u,f,l,h,x,S,E,P,R,z,j,ee,ne,Ae){var Se,De=f/24,_e=u.lineOffsetX*De,Fe=u.lineOffsetY*De;if(u.numGlyphs>1){var Ge=u.glyphStartIndex+u.numGlyphs,at=u.lineStartIndex,Ct=u.lineStartIndex+u.lineLength,wt=Bi(De,P,_e,Fe,l,j,ee,u,R,S,ne);if(!wt)return{notEnoughRoom:!0};var Mt=Zn(wt.first.point,E).point,qt=Zn(wt.last.point,E).point;if(h&&!l){var xr=ea(u.writingMode,Mt,qt,Ae);if(xr)return xr}Se=[wt.first];for(var pr=u.glyphStartIndex+1;pr<Ge-1;pr++)Se.push(ji(De*P.getoffsetX(pr),_e,Fe,l,j,ee,u.segment,at,Ct,R,S,ne));Se.push(wt.last)}else{if(h&&!l){var Fr=Zn(ee,x).point,tn=u.lineStartIndex+u.segment+1,pn=new v.Point(R.getx(tn),R.gety(tn)),ln=Zn(pn,x),pi=ln.signedDistanceFromCamera>0?ln.point:qs(ee,pn,Fr,1,x),yr=ea(u.writingMode,Fr,pi,Ae);if(yr)return yr}var $r=ji(De*P.getoffsetX(u.glyphStartIndex),_e,Fe,l,j,ee,u.segment,u.lineStartIndex,u.lineStartIndex+u.lineLength,R,S,ne);if(!$r)return{notEnoughRoom:!0};Se=[$r]}for(var kn=0,wn=Se;kn<wn.length;kn+=1){var vn=wn[kn];v.addDynamicAttributes(z,vn.point,vn.angle)}return{}}function qs(u,f,l,h,x){var S=Zn(u.add(u.sub(f)._unit()),x).point,E=l.sub(S);return l.add(E._mult(h/E.mag()))}function ji(u,f,l,h,x,S,E,P,R,z,j,ee){var ne=h?u-f:u+f,Ae=ne>0?1:-1,Se=0;h&&(Ae*=-1,Se=Math.PI),Ae<0&&(Se+=Math.PI);for(var De=Ae>0?P+E:P+E+1,_e=x,Fe=x,Ge=0,at=0,Ct=Math.abs(ne),wt=[];Ge+at<=Ct;){if((De+=Ae)<P||De>=R)return null;if(Fe=_e,wt.push(_e),(_e=ee[De])===void 0){var Mt=new v.Point(z.getx(De),z.gety(De)),qt=Zn(Mt,j);if(qt.signedDistanceFromCamera>0)_e=ee[De]=qt.point;else{var xr=De-Ae;_e=qs(Ge===0?S:new v.Point(z.getx(xr),z.gety(xr)),Mt,Fe,Ct-Ge+1,j)}}Ge+=at,at=Fe.dist(_e)}var pr=(Ct-Ge)/at,Fr=_e.sub(Fe),tn=Fr.mult(pr)._add(Fe);tn._add(Fr._unit()._perp()._mult(l*Ae));var pn=Se+Math.atan2(_e.y-Fe.y,_e.x-Fe.x);return wt.push(tn),{point:tn,angle:pn,path:wt}}vi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},vi.prototype.insert=function(u,f,l,h,x){this._forEachCell(f,l,h,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(u),this.bboxes.push(f),this.bboxes.push(l),this.bboxes.push(h),this.bboxes.push(x)},vi.prototype.insertCircle=function(u,f,l,h){this._forEachCell(f-h,l-h,f+h,l+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(u),this.circles.push(f),this.circles.push(l),this.circles.push(h)},vi.prototype._insertBoxCell=function(u,f,l,h,x,S){this.boxCells[x].push(S)},vi.prototype._insertCircleCell=function(u,f,l,h,x,S){this.circleCells[x].push(S)},vi.prototype._query=function(u,f,l,h,x,S){if(l<0||u>this.width||h<0||f>this.height)return!x&&[];var E=[];if(u<=0&&f<=0&&this.width<=l&&this.height<=h){if(x)return!0;for(var P=0;P<this.boxKeys.length;P++)E.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(var R=0;R<this.circleKeys.length;R++){var z=this.circles[3*R],j=this.circles[3*R+1],ee=this.circles[3*R+2];E.push({key:this.circleKeys[R],x1:z-ee,y1:j-ee,x2:z+ee,y2:j+ee})}return S?E.filter(S):E}return this._forEachCell(u,f,l,h,this._queryCell,E,{hitTest:x,seenUids:{box:{},circle:{}}},S),x?E.length>0:E},vi.prototype._queryCircle=function(u,f,l,h,x){var S=u-l,E=u+l,P=f-l,R=f+l;if(E<0||S>this.width||R<0||P>this.height)return!h&&[];var z=[];return this._forEachCell(S,P,E,R,this._queryCellCircle,z,{hitTest:h,circle:{x:u,y:f,radius:l},seenUids:{box:{},circle:{}}},x),h?z.length>0:z},vi.prototype.query=function(u,f,l,h,x){return this._query(u,f,l,h,!1,x)},vi.prototype.hitTest=function(u,f,l,h,x){return this._query(u,f,l,h,!0,x)},vi.prototype.hitTestCircle=function(u,f,l,h){return this._queryCircle(u,f,l,!0,h)},vi.prototype._queryCell=function(u,f,l,h,x,S,E,P){var R=E.seenUids,z=this.boxCells[x];if(z!==null)for(var j=this.bboxes,ee=0,ne=z;ee<ne.length;ee+=1){var Ae=ne[ee];if(!R.box[Ae]){R.box[Ae]=!0;var Se=4*Ae;if(u<=j[Se+2]&&f<=j[Se+3]&&l>=j[Se+0]&&h>=j[Se+1]&&(!P||P(this.boxKeys[Ae]))){if(E.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[Ae],x1:j[Se],y1:j[Se+1],x2:j[Se+2],y2:j[Se+3]})}}}var De=this.circleCells[x];if(De!==null)for(var _e=this.circles,Fe=0,Ge=De;Fe<Ge.length;Fe+=1){var at=Ge[Fe];if(!R.circle[at]){R.circle[at]=!0;var Ct=3*at;if(this._circleAndRectCollide(_e[Ct],_e[Ct+1],_e[Ct+2],u,f,l,h)&&(!P||P(this.circleKeys[at]))){if(E.hitTest)return S.push(!0),!0;var wt=_e[Ct],Mt=_e[Ct+1],qt=_e[Ct+2];S.push({key:this.circleKeys[at],x1:wt-qt,y1:Mt-qt,x2:wt+qt,y2:Mt+qt})}}}},vi.prototype._queryCellCircle=function(u,f,l,h,x,S,E,P){var R=E.circle,z=E.seenUids,j=this.boxCells[x];if(j!==null)for(var ee=this.bboxes,ne=0,Ae=j;ne<Ae.length;ne+=1){var Se=Ae[ne];if(!z.box[Se]){z.box[Se]=!0;var De=4*Se;if(this._circleAndRectCollide(R.x,R.y,R.radius,ee[De+0],ee[De+1],ee[De+2],ee[De+3])&&(!P||P(this.boxKeys[Se])))return S.push(!0),!0}}var _e=this.circleCells[x];if(_e!==null)for(var Fe=this.circles,Ge=0,at=_e;Ge<at.length;Ge+=1){var Ct=at[Ge];if(!z.circle[Ct]){z.circle[Ct]=!0;var wt=3*Ct;if(this._circlesCollide(Fe[wt],Fe[wt+1],Fe[wt+2],R.x,R.y,R.radius)&&(!P||P(this.circleKeys[Ct])))return S.push(!0),!0}}},vi.prototype._forEachCell=function(u,f,l,h,x,S,E,P){for(var R=this._convertToXCellCoord(u),z=this._convertToYCellCoord(f),j=this._convertToXCellCoord(l),ee=this._convertToYCellCoord(h),ne=R;ne<=j;ne++)for(var Ae=z;Ae<=ee;Ae++)if(x.call(this,u,f,l,h,this.xCellCount*Ae+ne,S,E,P))return},vi.prototype._convertToXCellCoord=function(u){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(u*this.xScale)))},vi.prototype._convertToYCellCoord=function(u){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(u*this.yScale)))},vi.prototype._circlesCollide=function(u,f,l,h,x,S){var E=h-u,P=x-f,R=l+S;return R*R>E*E+P*P},vi.prototype._circleAndRectCollide=function(u,f,l,h,x,S,E){var P=(S-h)/2,R=Math.abs(u-(h+P));if(R>P+l)return!1;var z=(E-x)/2,j=Math.abs(f-(x+z));if(j>z+l)return!1;if(R<=P||j<=z)return!0;var ee=R-P,ne=j-z;return ee*ee+ne*ne<=l*l};var Wa=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ea(u,f){for(var l=0;l<u;l++){var h=f.length;f.resize(h+4),f.float32.set(Wa,3*h)}}function ua(u,f,l){var h=f[0],x=f[1];return u[0]=l[0]*h+l[4]*x+l[12],u[1]=l[1]*h+l[5]*x+l[13],u[3]=l[3]*h+l[7]*x+l[15],u}var xo=function(u,f,l){f===void 0&&(f=new vi(u.width+200,u.height+200,25)),l===void 0&&(l=new vi(u.width+200,u.height+200,25)),this.transform=u,this.grid=f,this.ignoredGrid=l,this.pitchfactor=Math.cos(u._pitch)*u.cameraToCenterDistance,this.screenRightBoundary=u.width+100,this.screenBottomBoundary=u.height+100,this.gridRightBoundary=u.width+200,this.gridBottomBoundary=u.height+200};function bi(u,f,l){return f*(v.EXTENT/(u.tileSize*Math.pow(2,l-u.tileID.overscaledZ)))}xo.prototype.placeCollisionBox=function(u,f,l,h,x){var S=this.projectAndGetPerspectiveRatio(h,u.anchorPointX,u.anchorPointY),E=l*S.perspectiveRatio,P=u.x1*E+S.point.x,R=u.y1*E+S.point.y,z=u.x2*E+S.point.x,j=u.y2*E+S.point.y;return!this.isInsideGrid(P,R,z,j)||!f&&this.grid.hitTest(P,R,z,j,x)?{box:[],offscreen:!1}:{box:[P,R,z,j],offscreen:this.isOffscreen(P,R,z,j)}},xo.prototype.placeCollisionCircles=function(u,f,l,h,x,S,E,P,R,z,j,ee,ne){var Ae=[],Se=new v.Point(f.anchorX,f.anchorY),De=Zn(Se,S),_e=Jn(this.transform.cameraToCenterDistance,De.signedDistanceFromCamera),Fe=(z?x/_e:x*_e)/v.ONE_EM,Ge=Zn(Se,E).point,at=Bi(Fe,h,f.lineOffsetX*Fe,f.lineOffsetY*Fe,!1,Ge,Se,f,l,E,{}),Ct=!1,wt=!1,Mt=!0;if(at){for(var qt=.5*ee*_e+ne,xr=new v.Point(-100,-100),pr=new v.Point(this.screenRightBoundary,this.screenBottomBoundary),Fr=new Sa,tn=at.first,pn=at.last,ln=[],pi=tn.path.length-1;pi>=1;pi--)ln.push(tn.path[pi]);for(var yr=1;yr<pn.path.length;yr++)ln.push(pn.path[yr]);var $r=2.5*qt;if(P){var kn=ln.map(function(Lo){return Zn(Lo,P)});ln=kn.some(function(Lo){return Lo.signedDistanceFromCamera<=0})?[]:kn.map(function(Lo){return Lo.point})}var wn=[];if(ln.length>0){for(var vn=ln[0].clone(),Un=ln[0].clone(),Sn=1;Sn<ln.length;Sn++)vn.x=Math.min(vn.x,ln[Sn].x),vn.y=Math.min(vn.y,ln[Sn].y),Un.x=Math.max(Un.x,ln[Sn].x),Un.y=Math.max(Un.y,ln[Sn].y);wn=vn.x>=xr.x&&Un.x<=pr.x&&vn.y>=xr.y&&Un.y<=pr.y?[ln]:Un.x<xr.x||vn.x>pr.x||Un.y<xr.y||vn.y>pr.y?[]:v.clipLine([ln],xr.x,xr.y,pr.x,pr.y)}for(var _n=0,Da=wn;_n<Da.length;_n+=1){var Wi;Fr.reset(Da[_n],.25*qt),Wi=Fr.length<=.5*qt?1:Math.ceil(Fr.paddedLength/$r)+1;for(var Gi=0;Gi<Wi;Gi++){var ro=Gi/Math.max(Wi-1,1),ra=Fr.lerp(ro),_a=ra.x+100,Fa=ra.y+100;Ae.push(_a,Fa,qt,0);var no=_a-qt,Ts=Fa-qt,co=_a+qt,Jo=Fa+qt;if(Mt=Mt&&this.isOffscreen(no,Ts,co,Jo),wt=wt||this.isInsideGrid(no,Ts,co,Jo),!u&&this.grid.hitTestCircle(_a,Fa,qt,j)&&(Ct=!0,!R))return{circles:[],offscreen:!1,collisionDetected:Ct}}}}return{circles:!R&&Ct||!wt?[]:Ae,offscreen:Mt,collisionDetected:Ct}},xo.prototype.queryRenderedSymbols=function(u){if(u.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var f=[],l=1/0,h=1/0,x=-1/0,S=-1/0,E=0,P=u;E<P.length;E+=1){var R=P[E],z=new v.Point(R.x+100,R.y+100);l=Math.min(l,z.x),h=Math.min(h,z.y),x=Math.max(x,z.x),S=Math.max(S,z.y),f.push(z)}for(var j={},ee={},ne=0,Ae=this.grid.query(l,h,x,S).concat(this.ignoredGrid.query(l,h,x,S));ne<Ae.length;ne+=1){var Se=Ae[ne],De=Se.key;if(j[De.bucketInstanceId]===void 0&&(j[De.bucketInstanceId]={}),!j[De.bucketInstanceId][De.featureIndex]){var _e=[new v.Point(Se.x1,Se.y1),new v.Point(Se.x2,Se.y1),new v.Point(Se.x2,Se.y2),new v.Point(Se.x1,Se.y2)];v.polygonIntersectsPolygon(f,_e)&&(j[De.bucketInstanceId][De.featureIndex]=!0,ee[De.bucketInstanceId]===void 0&&(ee[De.bucketInstanceId]=[]),ee[De.bucketInstanceId].push(De.featureIndex))}}return ee},xo.prototype.insertCollisionBox=function(u,f,l,h,x){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:l,featureIndex:h,collisionGroupID:x},u[0],u[1],u[2],u[3])},xo.prototype.insertCollisionCircles=function(u,f,l,h,x){for(var S=f?this.ignoredGrid:this.grid,E={bucketInstanceId:l,featureIndex:h,collisionGroupID:x},P=0;P<u.length;P+=4)S.insertCircle(E,u[P],u[P+1],u[P+2])},xo.prototype.projectAndGetPerspectiveRatio=function(u,f,l){var h=[f,l,0,1];return ua(h,h,u),{point:new v.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},xo.prototype.isOffscreen=function(u,f,l,h){return l<100||u>=this.screenRightBoundary||h<100||f>this.screenBottomBoundary},xo.prototype.isInsideGrid=function(u,f,l,h){return l>=0&&u<this.gridRightBoundary&&h>=0&&f<this.gridBottomBoundary},xo.prototype.getViewportMatrix=function(){var u=v.identity([]);return v.translate(u,u,[-100,-100,0]),u};var bo=function(u,f,l,h){this.opacity=u?Math.max(0,Math.min(1,u.opacity+(u.placed?f:-f))):h&&l?1:0,this.placed=l};bo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var Xa=function(u,f,l,h,x){this.text=new bo(u?u.text:null,f,l,x),this.icon=new bo(u?u.icon:null,f,h,x)};Xa.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Mo=function(u,f,l){this.text=u,this.icon=f,this.skipFade=l},Xo=function(){this.invProjMatrix=v.create(),this.viewportMatrix=v.create(),this.circles=[]},Lc=function(u,f,l,h,x){this.bucketInstanceId=u,this.featureIndex=f,this.sourceLayerIndex=l,this.bucketIndex=h,this.tileID=x},Yo=function(u){this.crossSourceCollisions=u,this.maxGroupID=0,this.collisionGroups={}};function Ca(u,f,l,h,x){var S=v.getAnchorAlignment(u),E=-(S.horizontalAlign-.5)*f,P=-(S.verticalAlign-.5)*l,R=v.evaluateVariableOffset(u,h);return new v.Point(E+R[0]*x,P+R[1]*x)}function va(u,f,l,h,x,S){var E=u.x1,P=u.x2,R=u.y1,z=u.y2,j=u.anchorPointX,ee=u.anchorPointY,ne=new v.Point(f,l);return h&&ne._rotate(x?S:-S),{x1:E+ne.x,y1:R+ne.y,x2:P+ne.x,y2:z+ne.y,anchorPointX:j,anchorPointY:ee}}Yo.prototype.get=function(u){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[u]){var f=++this.maxGroupID;this.collisionGroups[u]={ID:f,predicate:function(l){return l.collisionGroupID===f}}}return this.collisionGroups[u]};var Ri=function(u,f,l,h){this.transform=u.clone(),this.collisionIndex=new xo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Yo(l),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function K(u,f,l,h,x){u.emplaceBack(f?1:0,l?1:0,h||0,x||0),u.emplaceBack(f?1:0,l?1:0,h||0,x||0),u.emplaceBack(f?1:0,l?1:0,h||0,x||0),u.emplaceBack(f?1:0,l?1:0,h||0,x||0)}Ri.prototype.getBucketParts=function(u,f,l,h){var x=l.getBucket(f),S=l.latestFeatureIndex;if(x&&S&&f.id===x.layerIds[0]){var E=l.collisionBoxArray,P=x.layers[0].layout,R=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),z=l.tileSize/v.EXTENT,j=this.transform.calculatePosMatrix(l.tileID.toUnwrapped()),ee=P.get("text-pitch-alignment")==="map",ne=P.get("text-rotation-alignment")==="map",Ae=bi(l,1,this.transform.zoom),Se=Li(j,ee,ne,this.transform,Ae),De=null;if(ee){var _e=Wn(j,ee,ne,this.transform,Ae);De=v.multiply([],this.transform.labelPlaneMatrix,_e)}this.retainedQueryData[x.bucketInstanceId]=new Lc(x.bucketInstanceId,S,x.sourceLayerIndex,x.index,l.tileID);var Fe={bucket:x,layout:P,posMatrix:j,textLabelPlaneMatrix:Se,labelToScreenMatrix:De,scale:R,textPixelRatio:z,holdingForFade:l.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:v.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(h)for(var Ge=0,at=x.sortKeyRanges;Ge<at.length;Ge+=1){var Ct=at[Ge];u.push({sortKey:Ct.sortKey,symbolInstanceStart:Ct.symbolInstanceStart,symbolInstanceEnd:Ct.symbolInstanceEnd,parameters:Fe})}else u.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Fe})}},Ri.prototype.attemptAnchorPlacement=function(u,f,l,h,x,S,E,P,R,z,j,ee,ne,Ae,Se){var De,_e=[ee.textOffset0,ee.textOffset1],Fe=Ca(u,l,h,_e,x),Ge=this.collisionIndex.placeCollisionBox(va(f,Fe.x,Fe.y,S,E,this.transform.angle),j,P,R,z.predicate);if(!Se||this.collisionIndex.placeCollisionBox(va(Se,Fe.x,Fe.y,S,E,this.transform.angle),j,P,R,z.predicate).box.length!==0)return Ge.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID]&&this.prevPlacement.placements[ee.crossTileID].text&&(De=this.prevPlacement.variableOffsets[ee.crossTileID].anchor),this.variableOffsets[ee.crossTileID]={textOffset:_e,width:l,height:h,anchor:u,textBoxScale:x,prevAnchor:De},this.markUsedJustification(ne,u,ee,Ae),ne.allowVerticalPlacement&&(this.markUsedOrientation(ne,Ae,ee),this.placedOrientations[ee.crossTileID]=Ae),{shift:Fe,placedGlyphBoxes:Ge}):void 0},Ri.prototype.placeLayerBucketPart=function(u,f,l){var h=this,x=u.parameters,S=x.bucket,E=x.layout,P=x.posMatrix,R=x.textLabelPlaneMatrix,z=x.labelToScreenMatrix,j=x.textPixelRatio,ee=x.holdingForFade,ne=x.collisionBoxArray,Ae=x.partiallyEvaluatedTextSize,Se=x.collisionGroup,De=E.get("text-optional"),_e=E.get("icon-optional"),Fe=E.get("text-allow-overlap"),Ge=E.get("icon-allow-overlap"),at=E.get("text-rotation-alignment")==="map",Ct=E.get("text-pitch-alignment")==="map",wt=E.get("icon-text-fit")!=="none",Mt=E.get("symbol-z-order")==="viewport-y",qt=Fe&&(Ge||!S.hasIconData()||_e),xr=Ge&&(Fe||!S.hasTextData()||De);!S.collisionArrays&&ne&&S.deserializeCollisionBoxes(ne);var pr=function(yr,$r){if(!f[yr.crossTileID])if(ee)h.placements[yr.crossTileID]=new Mo(!1,!1,!1);else{var kn,wn=!1,vn=!1,Un=!0,Sn=null,_n={box:null,offscreen:null},Da={box:null,offscreen:null},Wi=null,Gi=null,ro=0,ra=0,_a=0;$r.textFeatureIndex?ro=$r.textFeatureIndex:yr.useRuntimeCollisionCircles&&(ro=yr.featureIndex),$r.verticalTextFeatureIndex&&(ra=$r.verticalTextFeatureIndex);var Fa=$r.textBox;if(Fa){var no=function(di){var io=v.WritingMode.horizontal;if(S.allowVerticalPlacement&&!di&&h.prevPlacement){var ao=h.prevPlacement.placedOrientations[yr.crossTileID];ao&&(h.placedOrientations[yr.crossTileID]=ao,h.markUsedOrientation(S,io=ao,yr))}return io},Ts=function(di,io){if(S.allowVerticalPlacement&&yr.numVerticalGlyphVertices>0&&$r.verticalTextBox)for(var ao=0,ps=S.writingModes;ao<ps.length&&(ps[ao]===v.WritingMode.vertical?(_n=io(),Da=_n):_n=di(),!(_n&&_n.box&&_n.box.length));ao+=1);else _n=di()};if(E.get("text-variable-anchor")){var co=E.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[yr.crossTileID]){var Jo=h.prevPlacement.variableOffsets[yr.crossTileID];co.indexOf(Jo.anchor)>0&&(co=co.filter(function(di){return di!==Jo.anchor})).unshift(Jo.anchor)}var Lo=function(di,io,ao){for(var ps=di.x2-di.x1,$u=di.y2-di.y1,ou=yr.textBoxScale,ql=wt&&!Ge?io:null,Ju={box:[],offscreen:!1},bc=Fe?2*co.length:co.length,zs=0;zs<bc;++zs){var El=h.attemptAnchorPlacement(co[zs%co.length],di,ps,$u,ou,at,Ct,j,P,Se,zs>=co.length,yr,S,ao,ql);if(El&&(Ju=El.placedGlyphBoxes)&&Ju.box&&Ju.box.length){wn=!0,Sn=El.shift;break}}return Ju};Ts(function(){return Lo(Fa,$r.iconBox,v.WritingMode.horizontal)},function(){var di=$r.verticalTextBox;return S.allowVerticalPlacement&&!(_n&&_n.box&&_n.box.length)&&yr.numVerticalGlyphVertices>0&&di?Lo(di,$r.verticalIconBox,v.WritingMode.vertical):{box:null,offscreen:null}}),_n&&(wn=_n.box,Un=_n.offscreen);var ru=no(_n&&_n.box);if(!wn&&h.prevPlacement){var qu=h.prevPlacement.variableOffsets[yr.crossTileID];qu&&(h.variableOffsets[yr.crossTileID]=qu,h.markUsedJustification(S,qu.anchor,yr,ru))}}else{var nu=function(di,io){var ao=h.collisionIndex.placeCollisionBox(di,Fe,j,P,Se.predicate);return ao&&ao.box&&ao.box.length&&(h.markUsedOrientation(S,io,yr),h.placedOrientations[yr.crossTileID]=io),ao};Ts(function(){return nu(Fa,v.WritingMode.horizontal)},function(){var di=$r.verticalTextBox;return S.allowVerticalPlacement&&yr.numVerticalGlyphVertices>0&&di?nu(di,v.WritingMode.vertical):{box:null,offscreen:null}}),no(_n&&_n.box&&_n.box.length)}}if(wn=(kn=_n)&&kn.box&&kn.box.length>0,Un=kn&&kn.offscreen,yr.useRuntimeCollisionCircles){var iu=S.text.placedSymbolArray.get(yr.centerJustifiedTextSymbolIndex),Sl=v.evaluateSizeForFeature(S.textSizeData,Ae,iu),Bs=E.get("text-padding");Wi=h.collisionIndex.placeCollisionCircles(Fe,iu,S.lineVertexArray,S.glyphOffsetArray,Sl,P,R,z,l,Ct,Se.predicate,yr.collisionCircleDiameter,Bs),wn=Fe||Wi.circles.length>0&&!Wi.collisionDetected,Un=Un&&Wi.offscreen}if($r.iconFeatureIndex&&(_a=$r.iconFeatureIndex),$r.iconBox){var Ku=function(di){var io=wt&&Sn?va(di,Sn.x,Sn.y,at,Ct,h.transform.angle):di;return h.collisionIndex.placeCollisionBox(io,Ge,j,P,Se.predicate)};vn=Da&&Da.box&&Da.box.length&&$r.verticalIconBox?(Gi=Ku($r.verticalIconBox)).box.length>0:(Gi=Ku($r.iconBox)).box.length>0,Un=Un&&Gi.offscreen}var Ba=De||yr.numHorizontalGlyphVertices===0&&yr.numVerticalGlyphVertices===0,na=_e||yr.numIconVertices===0;if(Ba||na?na?Ba||(vn=vn&&wn):wn=vn&&wn:vn=wn=vn&&wn,wn&&kn&&kn.box&&h.collisionIndex.insertCollisionBox(kn.box,E.get("text-ignore-placement"),S.bucketInstanceId,Da&&Da.box&&ra?ra:ro,Se.ID),vn&&Gi&&h.collisionIndex.insertCollisionBox(Gi.box,E.get("icon-ignore-placement"),S.bucketInstanceId,_a,Se.ID),Wi&&(wn&&h.collisionIndex.insertCollisionCircles(Wi.circles,E.get("text-ignore-placement"),S.bucketInstanceId,ro,Se.ID),l)){var au=S.bucketInstanceId,Ns=h.collisionCircleArrays[au];Ns===void 0&&(Ns=h.collisionCircleArrays[au]=new Xo);for(var Uo=0;Uo<Wi.circles.length;Uo+=4)Ns.circles.push(Wi.circles[Uo+0]),Ns.circles.push(Wi.circles[Uo+1]),Ns.circles.push(Wi.circles[Uo+2]),Ns.circles.push(Wi.collisionDetected?1:0)}h.placements[yr.crossTileID]=new Mo(wn||qt,vn||xr,Un||S.justReloaded),f[yr.crossTileID]=!0}};if(Mt)for(var Fr=S.getSortedSymbolIndexes(this.transform.angle),tn=Fr.length-1;tn>=0;--tn){var pn=Fr[tn];pr(S.symbolInstances.get(pn),S.collisionArrays[pn])}else for(var ln=u.symbolInstanceStart;ln<u.symbolInstanceEnd;ln++)pr(S.symbolInstances.get(ln),S.collisionArrays[ln]);if(l&&S.bucketInstanceId in this.collisionCircleArrays){var pi=this.collisionCircleArrays[S.bucketInstanceId];v.invert(pi.invProjMatrix,P),pi.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1},Ri.prototype.markUsedJustification=function(u,f,l,h){var x;x=h===v.WritingMode.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[v.getAnchorJustification(f)];for(var S=0,E=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];S<E.length;S+=1){var P=E[S];P>=0&&(u.text.placedSymbolArray.get(P).crossTileID=x>=0&&P!==x?0:l.crossTileID)}},Ri.prototype.markUsedOrientation=function(u,f,l){for(var h=f===v.WritingMode.horizontal||f===v.WritingMode.horizontalOnly?f:0,x=f===v.WritingMode.vertical?f:0,S=0,E=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];S<E.length;S+=1)u.text.placedSymbolArray.get(E[S]).placedOrientation=h;l.verticalPlacedTextSymbolIndex&&(u.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=x)},Ri.prototype.commit=function(u){this.commitTime=u,this.zoomAtLastRecencyCheck=this.transform.zoom;var f=this.prevPlacement,l=!1;this.prevZoomAdjustment=f?f.zoomAdjustment(this.transform.zoom):0;var h=f?f.symbolFadeChange(u):1,x=f?f.opacities:{},S=f?f.variableOffsets:{},E=f?f.placedOrientations:{};for(var P in this.placements){var R=this.placements[P],z=x[P];z?(this.opacities[P]=new Xa(z,h,R.text,R.icon),l=l||R.text!==z.text.placed||R.icon!==z.icon.placed):(this.opacities[P]=new Xa(null,h,R.text,R.icon,R.skipFade),l=l||R.text||R.icon)}for(var j in x){var ee=x[j];if(!this.opacities[j]){var ne=new Xa(ee,h,!1,!1);ne.isHidden()||(this.opacities[j]=ne,l=l||ee.text.placed||ee.icon.placed)}}for(var Ae in S)this.variableOffsets[Ae]||!this.opacities[Ae]||this.opacities[Ae].isHidden()||(this.variableOffsets[Ae]=S[Ae]);for(var Se in E)this.placedOrientations[Se]||!this.opacities[Se]||this.opacities[Se].isHidden()||(this.placedOrientations[Se]=E[Se]);l?this.lastPlacementChangeTime=u:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=f?f.lastPlacementChangeTime:u)},Ri.prototype.updateLayerOpacities=function(u,f){for(var l={},h=0,x=f;h<x.length;h+=1){var S=x[h],E=S.getBucket(u);E&&S.latestFeatureIndex&&u.id===E.layerIds[0]&&this.updateBucketOpacities(E,l,S.collisionBoxArray)}},Ri.prototype.updateBucketOpacities=function(u,f,l){var h=this;u.hasTextData()&&u.text.opacityVertexArray.clear(),u.hasIconData()&&u.icon.opacityVertexArray.clear(),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexArray.clear(),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexArray.clear();var x=u.layers[0].layout,S=new Xa(null,0,!1,!1,!0),E=x.get("text-allow-overlap"),P=x.get("icon-allow-overlap"),R=x.get("text-variable-anchor"),z=x.get("text-rotation-alignment")==="map",j=x.get("text-pitch-alignment")==="map",ee=x.get("icon-text-fit")!=="none",ne=new Xa(null,0,E&&(P||!u.hasIconData()||x.get("icon-optional")),P&&(E||!u.hasTextData()||x.get("text-optional")),!0);!u.collisionArrays&&l&&(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData())&&u.deserializeCollisionBoxes(l);for(var Ae=function(Fe,Ge,at){for(var Ct=0;Ct<Ge/4;Ct++)Fe.opacityVertexArray.emplaceBack(at)},Se=function(Fe){var Ge=u.symbolInstances.get(Fe),at=Ge.numHorizontalGlyphVertices,Ct=Ge.numVerticalGlyphVertices,wt=Ge.crossTileID,Mt=h.opacities[wt];f[wt]?Mt=S:Mt||(h.opacities[wt]=Mt=ne),f[wt]=!0;var qt=Ge.numIconVertices>0,xr=h.placedOrientations[Ge.crossTileID],pr=xr===v.WritingMode.vertical,Fr=xr===v.WritingMode.horizontal||xr===v.WritingMode.horizontalOnly;if(at>0||Ct>0){var tn=Ya(Mt.text);Ae(u.text,at,pr?Ta:tn),Ae(u.text,Ct,Fr?Ta:tn);var pn=Mt.text.isHidden();[Ge.rightJustifiedTextSymbolIndex,Ge.centerJustifiedTextSymbolIndex,Ge.leftJustifiedTextSymbolIndex].forEach(function(_n){_n>=0&&(u.text.placedSymbolArray.get(_n).hidden=pn||pr?1:0)}),Ge.verticalPlacedTextSymbolIndex>=0&&(u.text.placedSymbolArray.get(Ge.verticalPlacedTextSymbolIndex).hidden=pn||Fr?1:0);var ln=h.variableOffsets[Ge.crossTileID];ln&&h.markUsedJustification(u,ln.anchor,Ge,xr);var pi=h.placedOrientations[Ge.crossTileID];pi&&(h.markUsedJustification(u,"left",Ge,pi),h.markUsedOrientation(u,pi,Ge))}if(qt){var yr=Ya(Mt.icon),$r=!(ee&&Ge.verticalPlacedIconSymbolIndex&&pr);Ge.placedIconSymbolIndex>=0&&(Ae(u.icon,Ge.numIconVertices,$r?yr:Ta),u.icon.placedSymbolArray.get(Ge.placedIconSymbolIndex).hidden=Mt.icon.isHidden()),Ge.verticalPlacedIconSymbolIndex>=0&&(Ae(u.icon,Ge.numVerticalIconVertices,$r?Ta:yr),u.icon.placedSymbolArray.get(Ge.verticalPlacedIconSymbolIndex).hidden=Mt.icon.isHidden())}if(u.hasIconCollisionBoxData()||u.hasTextCollisionBoxData()){var kn=u.collisionArrays[Fe];if(kn){var wn=new v.Point(0,0);if(kn.textBox||kn.verticalTextBox){var vn=!0;if(R){var Un=h.variableOffsets[wt];Un?(wn=Ca(Un.anchor,Un.width,Un.height,Un.textOffset,Un.textBoxScale),z&&wn._rotate(j?h.transform.angle:-h.transform.angle)):vn=!1}kn.textBox&&K(u.textCollisionBox.collisionVertexArray,Mt.text.placed,!vn||pr,wn.x,wn.y),kn.verticalTextBox&&K(u.textCollisionBox.collisionVertexArray,Mt.text.placed,!vn||Fr,wn.x,wn.y)}var Sn=Boolean(!Fr&&kn.verticalIconBox);kn.iconBox&&K(u.iconCollisionBox.collisionVertexArray,Mt.icon.placed,Sn,ee?wn.x:0,ee?wn.y:0),kn.verticalIconBox&&K(u.iconCollisionBox.collisionVertexArray,Mt.icon.placed,!Sn,ee?wn.x:0,ee?wn.y:0)}}},De=0;De<u.symbolInstances.length;De++)Se(De);if(u.sortFeatures(this.transform.angle),this.retainedQueryData[u.bucketInstanceId]&&(this.retainedQueryData[u.bucketInstanceId].featureSortOrder=u.featureSortOrder),u.hasTextData()&&u.text.opacityVertexBuffer&&u.text.opacityVertexBuffer.updateData(u.text.opacityVertexArray),u.hasIconData()&&u.icon.opacityVertexBuffer&&u.icon.opacityVertexBuffer.updateData(u.icon.opacityVertexArray),u.hasIconCollisionBoxData()&&u.iconCollisionBox.collisionVertexBuffer&&u.iconCollisionBox.collisionVertexBuffer.updateData(u.iconCollisionBox.collisionVertexArray),u.hasTextCollisionBoxData()&&u.textCollisionBox.collisionVertexBuffer&&u.textCollisionBox.collisionVertexBuffer.updateData(u.textCollisionBox.collisionVertexArray),u.bucketInstanceId in this.collisionCircleArrays){var _e=this.collisionCircleArrays[u.bucketInstanceId];u.placementInvProjMatrix=_e.invProjMatrix,u.placementViewportMatrix=_e.viewportMatrix,u.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[u.bucketInstanceId]}},Ri.prototype.symbolFadeChange=function(u){return this.fadeDuration===0?1:(u-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Ri.prototype.zoomAdjustment=function(u){return Math.max(0,(this.transform.zoom-u)/1.5)},Ri.prototype.hasTransitions=function(u){return this.stale||u-this.lastPlacementChangeTime<this.fadeDuration},Ri.prototype.stillRecent=function(u,f){var l=this.zoomAtLastRecencyCheck===f?1-this.zoomAdjustment(f):1;return this.zoomAtLastRecencyCheck=f,this.commitTime+this.fadeDuration*l>u},Ri.prototype.setStale=function(){this.stale=!0};var he=Math.pow(2,25),je=Math.pow(2,24),It=Math.pow(2,17),_r=Math.pow(2,16),rn=Math.pow(2,9),mi=Math.pow(2,8),ma=Math.pow(2,1);function Ya(u){if(u.opacity===0&&!u.placed)return 0;if(u.opacity===1&&u.placed)return 4294967295;var f=u.placed?1:0,l=Math.floor(127*u.opacity);return l*he+f*je+l*It+f*_r+l*rn+f*mi+l*ma+f}var Ta=0,qo=function(u){this._sortAcrossTiles=u.layout.get("symbol-z-order")!=="viewport-y"&&u.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};qo.prototype.continuePlacement=function(u,f,l,h,x){for(var S=this._bucketParts;this._currentTileIndex<u.length;)if(f.getBucketParts(S,h,u[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort(function(E,P){return E.sortKey-P.sortKey}));this._currentPartIndex<S.length;)if(f.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,x())return!0;return!1};var uc=function(u,f,l,h,x,S,E){this.placement=new Ri(u,x,S,E),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=l,this._showCollisionBoxes=h,this._done=!1};uc.prototype.isDone=function(){return this._done},uc.prototype.continuePlacement=function(u,f,l){for(var h=this,x=v.browser.now(),S=function(){var R=v.browser.now()-x;return!h._forceFullPlacement&&R>2};this._currentPlacementIndex>=0;){var E=f[u[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&(!E.minzoom||E.minzoom<=P)&&(!E.maxzoom||E.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new qo(E)),this._inProgressLayer.continuePlacement(l[E.source],this.placement,this._showCollisionBoxes,E,S))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},uc.prototype.commit=function(u){return this.placement.commit(u),this.placement};var lf=512/v.EXTENT/2,Rc=function(u,f,l){this.tileID=u,this.indexedSymbolInstances={},this.bucketInstanceId=l;for(var h=0;h<f.length;h++){var x=f.get(h),S=x.key;this.indexedSymbolInstances[S]||(this.indexedSymbolInstances[S]=[]),this.indexedSymbolInstances[S].push({crossTileID:x.crossTileID,coord:this.getScaledCoordinates(x,u)})}};Rc.prototype.getScaledCoordinates=function(u,f){var l=lf/Math.pow(2,f.canonical.z-this.tileID.canonical.z);return{x:Math.floor((f.canonical.x*v.EXTENT+u.anchorX)*l),y:Math.floor((f.canonical.y*v.EXTENT+u.anchorY)*l)}},Rc.prototype.findMatches=function(u,f,l){for(var h=this.tileID.canonical.z<f.canonical.z?1:Math.pow(2,this.tileID.canonical.z-f.canonical.z),x=0;x<u.length;x++){var S=u.get(x);if(!S.crossTileID){var E=this.indexedSymbolInstances[S.key];if(E)for(var P=this.getScaledCoordinates(S,f),R=0,z=E;R<z.length;R+=1){var j=z[R];if(Math.abs(j.coord.x-P.x)<=h&&Math.abs(j.coord.y-P.y)<=h&&!l[j.crossTileID]){l[j.crossTileID]=!0,S.crossTileID=j.crossTileID;break}}}}};var is=function(){this.maxCrossTileID=0};is.prototype.generate=function(){return++this.maxCrossTileID};var Nu=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Nu.prototype.handleWrapJump=function(u){var f=Math.round((u-this.lng)/360);if(f!==0)for(var l in this.indexes){var h=this.indexes[l],x={};for(var S in h){var E=h[S];E.tileID=E.tileID.unwrapTo(E.tileID.wrap+f),x[E.tileID.key]=E}this.indexes[l]=x}this.lng=u},Nu.prototype.addBucket=function(u,f,l){if(this.indexes[u.overscaledZ]&&this.indexes[u.overscaledZ][u.key]){if(this.indexes[u.overscaledZ][u.key].bucketInstanceId===f.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(u.overscaledZ,this.indexes[u.overscaledZ][u.key])}for(var h=0;h<f.symbolInstances.length;h++)f.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[u.overscaledZ]||(this.usedCrossTileIDs[u.overscaledZ]={});var x=this.usedCrossTileIDs[u.overscaledZ];for(var S in this.indexes){var E=this.indexes[S];if(Number(S)>u.overscaledZ)for(var P in E){var R=E[P];R.tileID.isChildOf(u)&&R.findMatches(f.symbolInstances,u,x)}else{var z=E[u.scaledTo(Number(S)).key];z&&z.findMatches(f.symbolInstances,u,x)}}for(var j=0;j<f.symbolInstances.length;j++){var ee=f.symbolInstances.get(j);ee.crossTileID||(ee.crossTileID=l.generate(),x[ee.crossTileID]=!0)}return this.indexes[u.overscaledZ]===void 0&&(this.indexes[u.overscaledZ]={}),this.indexes[u.overscaledZ][u.key]=new Rc(u,f.symbolInstances,f.bucketInstanceId),!0},Nu.prototype.removeBucketCrossTileIDs=function(u,f){for(var l in f.indexedSymbolInstances)for(var h=0,x=f.indexedSymbolInstances[l];h<x.length;h+=1)delete this.usedCrossTileIDs[u][x[h].crossTileID]},Nu.prototype.removeStaleBuckets=function(u){var f=!1;for(var l in this.indexes){var h=this.indexes[l];for(var x in h)u[h[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,h[x]),delete h[x],f=!0)}return f};var as=function(){this.layerIndexes={},this.crossTileIDs=new is,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};as.prototype.addLayer=function(u,f,l){var h=this.layerIndexes[u.id];h===void 0&&(h=this.layerIndexes[u.id]=new Nu);var x=!1,S={};h.handleWrapJump(l);for(var E=0,P=f;E<P.length;E+=1){var R=P[E],z=R.getBucket(u);z&&u.id===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(R.tileID,z,this.crossTileIDs)&&(x=!0),S[z.bucketInstanceId]=!0)}return h.removeStaleBuckets(S)&&(x=!0),x},as.prototype.pruneUnusedLayers=function(u){var f={};for(var l in u.forEach(function(h){f[h]=!0}),this.layerIndexes)f[l]||delete this.layerIndexes[l]};var ll=function(u,f){return v.emitValidationErrors(u,f&&f.filter(function(l){return l.identifier!=="source.canvas"}))},vu=v.pick(Mr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),_s=v.pick(Mr,["setCenter","setZoom","setBearing","setPitch"]),Fl=function(){var u={},f=v.styleSpec.$version;for(var l in v.styleSpec.$root){var h,x=v.styleSpec.$root[l];x.required&&(h=l==="version"?f:x.type==="array"?[]:{})!=null&&(u[l]=h)}return u}(),Po=function(u){function f(l,h){var x=this;h===void 0&&(h={}),u.call(this),this.map=l,this.dispatcher=new Lt(Dt(),this),this.imageManager=new Ht,this.imageManager.setEventedParent(this),this.glyphManager=new Bt(l._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Ye(256,512),this.crossTileSymbolIndex=new as,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new v.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",v.getReferrer());var S=this;this._rtlTextPluginCallback=f.registerForPluginStateChange(function(E){S.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:E.pluginStatus,pluginURL:E.pluginURL},function(P,R){if(v.triggerPluginCompletionEvent(P),R&&R.every(function(j){return j}))for(var z in S.sourceCaches)S.sourceCaches[z].reload()})}),this.on("data",function(E){if(E.dataType==="source"&&E.sourceDataType==="metadata"){var P=x.sourceCaches[E.sourceId];if(P){var R=P.getSource();if(R&&R.vectorLayerIds)for(var z in x._layers){var j=x._layers[z];j.source===R.id&&x._validateLayer(j)}}}})}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.loadURL=function(l,h){var x=this;h===void 0&&(h={}),this.fire(new v.Event("dataloading",{dataType:"style"}));var S=typeof h.validate=="boolean"?h.validate:!v.isMapboxURL(l);l=this.map._requestManager.normalizeStyleURL(l,h.accessToken);var E=this.map._requestManager.transformRequest(l,v.ResourceType.Style);this._request=v.getJSON(E,function(P,R){x._request=null,P?x.fire(new v.ErrorEvent(P)):R&&x._load(R,S)})},f.prototype.loadJSON=function(l,h){var x=this;h===void 0&&(h={}),this.fire(new v.Event("dataloading",{dataType:"style"})),this._request=v.browser.frame(function(){x._request=null,x._load(l,h.validate!==!1)})},f.prototype.loadEmpty=function(){this.fire(new v.Event("dataloading",{dataType:"style"})),this._load(Fl,!1)},f.prototype._load=function(l,h){if(!h||!ll(this,v.validateStyle(l))){for(var x in this._loaded=!0,this.stylesheet=l,l.sources)this.addSource(x,l.sources[x],{validate:!1});l.sprite?this._loadSprite(l.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(l.glyphs);var S=Pr(this.stylesheet.layers);this._order=S.map(function(z){return z.id}),this._layers={},this._serializedLayers={};for(var E=0,P=S;E<P.length;E+=1){var R=P[E];(R=v.createStyleLayer(R)).setEventedParent(this,{layer:{id:R.id}}),this._layers[R.id]=R,this._serializedLayers[R.id]=R.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new ut(this.stylesheet.light),this.fire(new v.Event("data",{dataType:"style"})),this.fire(new v.Event("style.load"))}},f.prototype._loadSprite=function(l){var h=this;this._spriteRequest=function(x,S,E){var P,R,z,j=v.browser.devicePixelRatio>1?"@2x":"",ee=v.getJSON(S.transformRequest(S.normalizeSpriteURL(x,j,".json"),v.ResourceType.SpriteJSON),function(Se,De){ee=null,z||(z=Se,P=De,Ae())}),ne=v.getImage(S.transformRequest(S.normalizeSpriteURL(x,j,".png"),v.ResourceType.SpriteImage),function(Se,De){ne=null,z||(z=Se,R=De,Ae())});function Ae(){if(z)E(z);else if(P&&R){var Se=v.browser.getImageData(R),De={};for(var _e in P){var Fe=P[_e],Ge=Fe.width,at=Fe.height,Ct=Fe.x,wt=Fe.y,Mt=Fe.sdf,qt=Fe.pixelRatio,xr=Fe.stretchX,pr=Fe.stretchY,Fr=Fe.content,tn=new v.RGBAImage({width:Ge,height:at});v.RGBAImage.copy(Se,tn,{x:Ct,y:wt},{x:0,y:0},{width:Ge,height:at}),De[_e]={data:tn,pixelRatio:qt,sdf:Mt,stretchX:xr,stretchY:pr,content:Fr}}E(null,De)}}return{cancel:function(){ee&&(ee.cancel(),ee=null),ne&&(ne.cancel(),ne=null)}}}(l,this.map._requestManager,function(x,S){if(h._spriteRequest=null,x)h.fire(new v.ErrorEvent(x));else if(S)for(var E in S)h.imageManager.addImage(E,S[E]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new v.Event("data",{dataType:"style"}))})},f.prototype._validateLayer=function(l){var h=this.sourceCaches[l.source];if(h){var x=l.sourceLayer;if(x){var S=h.getSource();(S.type==="geojson"||S.vectorLayerIds&&S.vectorLayerIds.indexOf(x)===-1)&&this.fire(new v.ErrorEvent(new Error('Source layer "'+x+'" does not exist on source "'+S.id+'" as specified by style layer "'+l.id+'"')))}}},f.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var l in this.sourceCaches)if(!this.sourceCaches[l].loaded())return!1;return!!this.imageManager.isLoaded()},f.prototype._serializeLayers=function(l){for(var h=[],x=0,S=l;x<S.length;x+=1){var E=this._layers[S[x]];E.type!=="custom"&&h.push(E.serialize())}return h},f.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var l in this.sourceCaches)if(this.sourceCaches[l].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},f.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},f.prototype.update=function(l){if(this._loaded){var h=this._changed;if(this._changed){var x=Object.keys(this._updatedLayers),S=Object.keys(this._removedLayers);for(var E in(x.length||S.length)&&this._updateWorkerLayers(x,S),this._updatedSources){var P=this._updatedSources[E];P==="reload"?this._reloadSource(E):P==="clear"&&this._clearSource(E)}for(var R in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[R].updateTransitions(l);this.light.updateTransitions(l),this._resetUpdates()}var z={};for(var j in this.sourceCaches){var ee=this.sourceCaches[j];z[j]=ee.used,ee.used=!1}for(var ne=0,Ae=this._order;ne<Ae.length;ne+=1){var Se=this._layers[Ae[ne]];Se.recalculate(l,this._availableImages),!Se.isHidden(l.zoom)&&Se.source&&(this.sourceCaches[Se.source].used=!0)}for(var De in z){var _e=this.sourceCaches[De];z[De]!==_e.used&&_e.fire(new v.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:De}))}this.light.recalculate(l),this.z=l.zoom,h&&this.fire(new v.Event("data",{dataType:"style"}))}},f.prototype._updateTilesForChangedImages=function(){var l=Object.keys(this._changedImages);if(l.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],l);this._changedImages={}}},f.prototype._updateWorkerLayers=function(l,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(l),removedIds:h})},f.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},f.prototype.setState=function(l){var h=this;if(this._checkLoaded(),ll(this,v.validateStyle(l)))return!1;(l=v.clone$1(l)).layers=Pr(l.layers);var x=function(E,P){if(!E)return[{command:Mr.setStyle,args:[P]}];var R=[];try{if(!v.deepEqual(E.version,P.version))return[{command:Mr.setStyle,args:[P]}];v.deepEqual(E.center,P.center)||R.push({command:Mr.setCenter,args:[P.center]}),v.deepEqual(E.zoom,P.zoom)||R.push({command:Mr.setZoom,args:[P.zoom]}),v.deepEqual(E.bearing,P.bearing)||R.push({command:Mr.setBearing,args:[P.bearing]}),v.deepEqual(E.pitch,P.pitch)||R.push({command:Mr.setPitch,args:[P.pitch]}),v.deepEqual(E.sprite,P.sprite)||R.push({command:Mr.setSprite,args:[P.sprite]}),v.deepEqual(E.glyphs,P.glyphs)||R.push({command:Mr.setGlyphs,args:[P.glyphs]}),v.deepEqual(E.transition,P.transition)||R.push({command:Mr.setTransition,args:[P.transition]}),v.deepEqual(E.light,P.light)||R.push({command:Mr.setLight,args:[P.light]});var z={},j=[];(function(ne,Ae,Se,De){var _e;for(_e in Ae=Ae||{},ne=ne||{})ne.hasOwnProperty(_e)&&(Ae.hasOwnProperty(_e)||Lr(_e,Se,De));for(_e in Ae)Ae.hasOwnProperty(_e)&&(ne.hasOwnProperty(_e)?v.deepEqual(ne[_e],Ae[_e])||(ne[_e].type==="geojson"&&Ae[_e].type==="geojson"&&ui(ne,Ae,_e)?Se.push({command:Mr.setGeoJSONSourceData,args:[_e,Ae[_e].data]}):jn(_e,Ae,Se,De)):Nn(_e,Ae,Se))})(E.sources,P.sources,j,z);var ee=[];E.layers&&E.layers.forEach(function(ne){z[ne.source]?R.push({command:Mr.removeLayer,args:[ne.id]}):ee.push(ne)}),R=R.concat(j),function(ne,Ae,Se){Ae=Ae||[];var De,_e,Fe,Ge,at,Ct,wt,Mt=(ne=ne||[]).map(Pn),qt=Ae.map(Pn),xr=ne.reduce(Vn,{}),pr=Ae.reduce(Vn,{}),Fr=Mt.slice(),tn=Object.create(null);for(De=0,_e=0;De<Mt.length;De++)pr.hasOwnProperty(Fe=Mt[De])?_e++:(Se.push({command:Mr.removeLayer,args:[Fe]}),Fr.splice(Fr.indexOf(Fe,_e),1));for(De=0,_e=0;De<qt.length;De++)Fr[Fr.length-1-De]!==(Fe=qt[qt.length-1-De])&&(xr.hasOwnProperty(Fe)?(Se.push({command:Mr.removeLayer,args:[Fe]}),Fr.splice(Fr.lastIndexOf(Fe,Fr.length-_e),1)):_e++,Se.push({command:Mr.addLayer,args:[pr[Fe],Ct=Fr[Fr.length-De]]}),Fr.splice(Fr.length-De,0,Fe),tn[Fe]=!0);for(De=0;De<qt.length;De++)if(Ge=xr[Fe=qt[De]],at=pr[Fe],!tn[Fe]&&!v.deepEqual(Ge,at))if(v.deepEqual(Ge.source,at.source)&&v.deepEqual(Ge["source-layer"],at["source-layer"])&&v.deepEqual(Ge.type,at.type)){for(wt in zn(Ge.layout,at.layout,Se,Fe,null,Mr.setLayoutProperty),zn(Ge.paint,at.paint,Se,Fe,null,Mr.setPaintProperty),v.deepEqual(Ge.filter,at.filter)||Se.push({command:Mr.setFilter,args:[Fe,at.filter]}),v.deepEqual(Ge.minzoom,at.minzoom)&&v.deepEqual(Ge.maxzoom,at.maxzoom)||Se.push({command:Mr.setLayerZoomRange,args:[Fe,at.minzoom,at.maxzoom]}),Ge)Ge.hasOwnProperty(wt)&&wt!=="layout"&&wt!=="paint"&&wt!=="filter"&&wt!=="metadata"&&wt!=="minzoom"&&wt!=="maxzoom"&&(wt.indexOf("paint.")===0?zn(Ge[wt],at[wt],Se,Fe,wt.slice(6),Mr.setPaintProperty):v.deepEqual(Ge[wt],at[wt])||Se.push({command:Mr.setLayerProperty,args:[Fe,wt,at[wt]]}));for(wt in at)at.hasOwnProperty(wt)&&!Ge.hasOwnProperty(wt)&&wt!=="layout"&&wt!=="paint"&&wt!=="filter"&&wt!=="metadata"&&wt!=="minzoom"&&wt!=="maxzoom"&&(wt.indexOf("paint.")===0?zn(Ge[wt],at[wt],Se,Fe,wt.slice(6),Mr.setPaintProperty):v.deepEqual(Ge[wt],at[wt])||Se.push({command:Mr.setLayerProperty,args:[Fe,wt,at[wt]]}))}else Se.push({command:Mr.removeLayer,args:[Fe]}),Ct=Fr[Fr.lastIndexOf(Fe)+1],Se.push({command:Mr.addLayer,args:[at,Ct]})}(ee,P.layers,R)}catch(ne){console.warn("Unable to compute style diff:",ne),R=[{command:Mr.setStyle,args:[P]}]}return R}(this.serialize(),l).filter(function(E){return!(E.command in _s)});if(x.length===0)return!1;var S=x.filter(function(E){return!(E.command in vu)});if(S.length>0)throw new Error("Unimplemented: "+S.map(function(E){return E.command}).join(", ")+".");return x.forEach(function(E){E.command!=="setTransition"&&h[E.command].apply(h,E.args)}),this.stylesheet=l,!0},f.prototype.addImage=function(l,h){if(this.getImage(l))return this.fire(new v.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(l,h),this._afterImageUpdated(l)},f.prototype.updateImage=function(l,h){this.imageManager.updateImage(l,h)},f.prototype.getImage=function(l){return this.imageManager.getImage(l)},f.prototype.removeImage=function(l){if(!this.getImage(l))return this.fire(new v.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(l),this._afterImageUpdated(l)},f.prototype._afterImageUpdated=function(l){this._availableImages=this.imageManager.listImages(),this._changedImages[l]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new v.Event("data",{dataType:"style"}))},f.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},f.prototype.addSource=function(l,h,x){var S=this;if(x===void 0&&(x={}),this._checkLoaded(),this.sourceCaches[l]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(v.validateStyle.source,"sources."+l,h,null,x))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var E=this.sourceCaches[l]=new Ie(l,h,this.dispatcher);E.style=this,E.setEventedParent(this,function(){return{isSourceLoaded:S.loaded(),source:E.serialize(),sourceId:l}}),E.onAdd(this.map),this._changed=!0}},f.prototype.removeSource=function(l){if(this._checkLoaded(),this.sourceCaches[l]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===l)return this.fire(new v.ErrorEvent(new Error('Source "'+l+'" cannot be removed while layer "'+h+'" is using it.')));var x=this.sourceCaches[l];delete this.sourceCaches[l],delete this._updatedSources[l],x.fire(new v.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:l})),x.setEventedParent(null),x.clearTiles(),x.onRemove&&x.onRemove(this.map),this._changed=!0},f.prototype.setGeoJSONSourceData=function(l,h){this._checkLoaded(),this.sourceCaches[l].getSource().setData(h),this._changed=!0},f.prototype.getSource=function(l){return this.sourceCaches[l]&&this.sourceCaches[l].getSource()},f.prototype.addLayer=function(l,h,x){x===void 0&&(x={}),this._checkLoaded();var S=l.id;if(this.getLayer(S))this.fire(new v.ErrorEvent(new Error('Layer with id "'+S+'" already exists on this map')));else{var E;if(l.type==="custom"){if(ll(this,v.validateCustomStyleLayer(l)))return;E=v.createStyleLayer(l)}else{if(typeof l.source=="object"&&(this.addSource(S,l.source),l=v.clone$1(l),l=v.extend(l,{source:S})),this._validate(v.validateStyle.layer,"layers."+S,l,{arrayIndex:-1},x))return;E=v.createStyleLayer(l),this._validateLayer(E),E.setEventedParent(this,{layer:{id:S}}),this._serializedLayers[E.id]=E.serialize()}var P=h?this._order.indexOf(h):this._order.length;if(h&&P===-1)this.fire(new v.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(P,0,S),this._layerOrderChanged=!0,this._layers[S]=E,this._removedLayers[S]&&E.source&&E.type!=="custom"){var R=this._removedLayers[S];delete this._removedLayers[S],R.type!==E.type?this._updatedSources[E.source]="clear":(this._updatedSources[E.source]="reload",this.sourceCaches[E.source].pause())}this._updateLayer(E),E.onAdd&&E.onAdd(this.map)}}},f.prototype.moveLayer=function(l,h){if(this._checkLoaded(),this._changed=!0,this._layers[l]){if(l!==h){var x=this._order.indexOf(l);this._order.splice(x,1);var S=h?this._order.indexOf(h):this._order.length;h&&S===-1?this.fire(new v.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(S,0,l),this._layerOrderChanged=!0)}}else this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be moved.")))},f.prototype.removeLayer=function(l){this._checkLoaded();var h=this._layers[l];if(h){h.setEventedParent(null);var x=this._order.indexOf(l);this._order.splice(x,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[l]=h,delete this._layers[l],delete this._serializedLayers[l],delete this._updatedLayers[l],delete this._updatedPaintProps[l],h.onRemove&&h.onRemove(this.map)}else this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be removed.")))},f.prototype.getLayer=function(l){return this._layers[l]},f.prototype.hasLayer=function(l){return l in this._layers},f.prototype.setLayerZoomRange=function(l,h,x){this._checkLoaded();var S=this.getLayer(l);S?S.minzoom===h&&S.maxzoom===x||(h!=null&&(S.minzoom=h),x!=null&&(S.maxzoom=x),this._updateLayer(S)):this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot have zoom extent.")))},f.prototype.setFilter=function(l,h,x){x===void 0&&(x={}),this._checkLoaded();var S=this.getLayer(l);if(S){if(!v.deepEqual(S.filter,h))return h==null?(S.filter=void 0,void this._updateLayer(S)):void(this._validate(v.validateStyle.filter,"layers."+S.id+".filter",h,null,x)||(S.filter=v.clone$1(h),this._updateLayer(S)))}else this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be filtered.")))},f.prototype.getFilter=function(l){return v.clone$1(this.getLayer(l).filter)},f.prototype.setLayoutProperty=function(l,h,x,S){S===void 0&&(S={}),this._checkLoaded();var E=this.getLayer(l);E?v.deepEqual(E.getLayoutProperty(h),x)||(E.setLayoutProperty(h,x,S),this._updateLayer(E)):this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getLayoutProperty=function(l,h){var x=this.getLayer(l);if(x)return x.getLayoutProperty(h);this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style.")))},f.prototype.setPaintProperty=function(l,h,x,S){S===void 0&&(S={}),this._checkLoaded();var E=this.getLayer(l);E?v.deepEqual(E.getPaintProperty(h),x)||(E.setPaintProperty(h,x,S)&&this._updateLayer(E),this._changed=!0,this._updatedPaintProps[l]=!0):this.fire(new v.ErrorEvent(new Error("The layer '"+l+"' does not exist in the map's style and cannot be styled.")))},f.prototype.getPaintProperty=function(l,h){return this.getLayer(l).getPaintProperty(h)},f.prototype.setFeatureState=function(l,h){this._checkLoaded();var x=l.source,S=l.sourceLayer,E=this.sourceCaches[x];if(E!==void 0){var P=E.getSource().type;P==="geojson"&&S?this.fire(new v.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||S?(l.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),E.setFeatureState(S,l.id,h)):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+x+"' does not exist in the map's style.")))},f.prototype.removeFeatureState=function(l,h){this._checkLoaded();var x=l.source,S=this.sourceCaches[x];if(S!==void 0){var E=S.getSource().type,P=E==="vector"?l.sourceLayer:void 0;E!=="vector"||P?h&&typeof l.id!="string"&&typeof l.id!="number"?this.fire(new v.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):S.removeFeatureState(P,l.id,h):this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+x+"' does not exist in the map's style.")))},f.prototype.getFeatureState=function(l){this._checkLoaded();var h=l.source,x=l.sourceLayer,S=this.sourceCaches[h];if(S!==void 0){if(S.getSource().type!=="vector"||x)return l.id===void 0&&this.fire(new v.ErrorEvent(new Error("The feature id parameter must be provided."))),S.getFeatureState(x,l.id);this.fire(new v.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new v.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},f.prototype.getTransition=function(){return v.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},f.prototype.serialize=function(){return v.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:v.mapObject(this.sourceCaches,function(l){return l.serialize()}),layers:this._serializeLayers(this._order)},function(l){return l!==void 0})},f.prototype._updateLayer=function(l){this._updatedLayers[l.id]=!0,l.source&&!this._updatedSources[l.source]&&this.sourceCaches[l.source].getSource().type!=="raster"&&(this._updatedSources[l.source]="reload",this.sourceCaches[l.source].pause()),this._changed=!0},f.prototype._flattenAndSortRenderedFeatures=function(l){for(var h=this,x=function(xr){return h._layers[xr].type==="fill-extrusion"},S={},E=[],P=this._order.length-1;P>=0;P--){var R=this._order[P];if(x(R)){S[R]=P;for(var z=0,j=l;z<j.length;z+=1){var ee=j[z][R];if(ee)for(var ne=0,Ae=ee;ne<Ae.length;ne+=1)E.push(Ae[ne])}}}E.sort(function(xr,pr){return pr.intersectionZ-xr.intersectionZ});for(var Se=[],De=this._order.length-1;De>=0;De--){var _e=this._order[De];if(x(_e))for(var Fe=E.length-1;Fe>=0;Fe--){var Ge=E[Fe].feature;if(S[Ge.layer.id]<De)break;Se.push(Ge),E.pop()}else for(var at=0,Ct=l;at<Ct.length;at+=1){var wt=Ct[at][_e];if(wt)for(var Mt=0,qt=wt;Mt<qt.length;Mt+=1)Se.push(qt[Mt].feature)}}return Se},f.prototype.queryRenderedFeatures=function(l,h,x){h&&h.filter&&this._validate(v.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var S={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new v.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var E=0,P=h.layers;E<P.length;E+=1){var R=P[E],z=this._layers[R];if(!z)return this.fire(new v.ErrorEvent(new Error("The layer '"+R+"' does not exist in the map's style and cannot be queried for features."))),[];S[z.source]=!0}}var j=[];for(var ee in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!S[ee]||j.push(Yr(this.sourceCaches[ee],this._layers,this._serializedLayers,l,h,x));return this.placement&&j.push(function(ne,Ae,Se,De,_e,Fe,Ge){for(var at={},Ct=Fe.queryRenderedSymbols(De),wt=[],Mt=0,qt=Object.keys(Ct).map(Number);Mt<qt.length;Mt+=1)wt.push(Ge[qt[Mt]]);wt.sort(wi);for(var xr=function(){var ln=Fr[pr],pi=ln.featureIndex.lookupSymbolFeatures(Ct[ln.bucketInstanceId],Ae,ln.bucketIndex,ln.sourceLayerIndex,_e.filter,_e.layers,_e.availableImages,ne);for(var yr in pi){var $r=at[yr]=at[yr]||[],kn=pi[yr];kn.sort(function(Un,Sn){var _n=ln.featureSortOrder;if(_n){var Da=_n.indexOf(Un.featureIndex);return _n.indexOf(Sn.featureIndex)-Da}return Sn.featureIndex-Un.featureIndex});for(var wn=0,vn=kn;wn<vn.length;wn+=1)$r.push(vn[wn])}},pr=0,Fr=wt;pr<Fr.length;pr+=1)xr();var tn=function(ln){at[ln].forEach(function(pi){var yr=pi.feature,$r=Se[ne[ln].source].getFeatureState(yr.layer["source-layer"],yr.id);yr.source=yr.layer.source,yr.layer["source-layer"]&&(yr.sourceLayer=yr.layer["source-layer"]),yr.state=$r})};for(var pn in at)tn(pn);return at}(this._layers,this._serializedLayers,this.sourceCaches,l,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(j)},f.prototype.querySourceFeatures=function(l,h){h&&h.filter&&this._validate(v.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var x=this.sourceCaches[l];return x?function(S,E){for(var P=S.getRenderableIds().map(function(Ae){return S.getTileByID(Ae)}),R=[],z={},j=0;j<P.length;j++){var ee=P[j],ne=ee.tileID.canonical.key;z[ne]||(z[ne]=!0,ee.querySourceFeatures(R,E))}return R}(x,h):[]},f.prototype.addSourceType=function(l,h,x){return f.getSourceType(l)?x(new Error('A source type called "'+l+'" already exists.')):(f.setSourceType(l,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:l,url:h.workerSourceURL},x):x(null,null))},f.prototype.getLight=function(){return this.light.getLight()},f.prototype.setLight=function(l,h){h===void 0&&(h={}),this._checkLoaded();var x=this.light.getLight(),S=!1;for(var E in l)if(!v.deepEqual(l[E],x[E])){S=!0;break}if(S){var P={now:v.browser.now(),transition:v.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(l,h),this.light.updateTransitions(P)}},f.prototype._validate=function(l,h,x,S,E){return E===void 0&&(E={}),(!E||E.validate!==!1)&&ll(this,l.call(v.validateStyle,v.extend({key:h,style:this.serialize(),value:x,styleSpec:v.styleSpec},S)))},f.prototype._remove=function(){for(var l in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),v.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[l].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},f.prototype._clearSource=function(l){this.sourceCaches[l].clearTiles()},f.prototype._reloadSource=function(l){this.sourceCaches[l].resume(),this.sourceCaches[l].reload()},f.prototype._updateSources=function(l){for(var h in this.sourceCaches)this.sourceCaches[h].update(l)},f.prototype._generateCollisionBoxes=function(){for(var l in this.sourceCaches)this._reloadSource(l)},f.prototype._updatePlacement=function(l,h,x,S,E){E===void 0&&(E=!1);for(var P=!1,R=!1,z={},j=0,ee=this._order;j<ee.length;j+=1){var ne=this._layers[ee[j]];if(ne.type==="symbol"){if(!z[ne.source]){var Ae=this.sourceCaches[ne.source];z[ne.source]=Ae.getRenderableIds(!0).map(function(Ge){return Ae.getTileByID(Ge)}).sort(function(Ge,at){return at.tileID.overscaledZ-Ge.tileID.overscaledZ||(Ge.tileID.isLessThan(at.tileID)?-1:1)})}var Se=this.crossTileSymbolIndex.addLayer(ne,z[ne.source],l.center.lng);P=P||Se}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((E=E||this._layerOrderChanged||x===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(v.browser.now(),l.zoom))&&(this.pauseablePlacement=new uc(l,this._order,E,h,x,S,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,z),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(v.browser.now()),R=!0),P&&this.pauseablePlacement.placement.setStale()),R||P)for(var De=0,_e=this._order;De<_e.length;De+=1){var Fe=this._layers[_e[De]];Fe.type==="symbol"&&this.placement.updateLayerOpacities(Fe,z[Fe.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(v.browser.now())},f.prototype._releaseSymbolFadeTiles=function(){for(var l in this.sourceCaches)this.sourceCaches[l].releaseSymbolFadeTiles()},f.prototype.getImages=function(l,h,x){this.imageManager.getImages(h.icons,x),this._updateTilesForChangedImages();var S=this.sourceCaches[h.source];S&&S.setDependencies(h.tileID.key,h.type,h.icons)},f.prototype.getGlyphs=function(l,h,x){this.glyphManager.getGlyphs(h.stacks,x)},f.prototype.getResource=function(l,h,x){return v.makeRequest(h,x)},f}(v.Evented);Po.getSourceType=function(u){return Et[u]},Po.setSourceType=function(u,f){Et[u]=f},Po.registerForPluginStateChange=v.registerForPluginStateChange;var la=v.createLayout([{name:"a_pos",type:"Int16",components:2}]),Bl=Di(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),Dc=Di(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),cf=Di(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),mu=Di(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),yu=Di("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Fc=Di(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),Ii=Di(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),gu=Di("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Gf=Di("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),Hf=Di("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),Wf=Di(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),lc=Di(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Nl=Di(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Xf=Di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),qi=Di(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),ff=Di(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),zu=Di(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),La=Di(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Ls=Di(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Io=Di(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),_u=Di(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ko=Di(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),xu=Di(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),Oo=Di(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),cc=Di(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),Yf=Di(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Di(u,f){var l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=f.match(/attribute ([\w]+) ([\w]+)/g),x=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),E=S?S.concat(x):x,P={};return{fragmentSource:u=u.replace(l,function(R,z,j,ee,ne){return P[ne]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_`+ne+`
varying `+j+" "+ee+" "+ne+`;
#else
uniform `+j+" "+ee+" u_"+ne+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+ne+`
    `+j+" "+ee+" "+ne+" = u_"+ne+`;
#endif
`}),vertexSource:f=f.replace(l,function(R,z,j,ee,ne){var Ae=ee==="float"?"vec2":"vec4",Se=ne.match(/color/)?"color":Ae;return P[ne]?z==="define"?`
#ifndef HAS_UNIFORM_u_`+ne+`
uniform lowp float u_`+ne+`_t;
attribute `+j+" "+Ae+" a_"+ne+`;
varying `+j+" "+ee+" "+ne+`;
#else
uniform `+j+" "+ee+" u_"+ne+`;
#endif
`:Se==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ne+`
    `+ne+" = a_"+ne+`;
#else
    `+j+" "+ee+" "+ne+" = u_"+ne+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ne+`
    `+ne+" = unpack_mix_"+Se+"(a_"+ne+", u_"+ne+`_t);
#else
    `+j+" "+ee+" "+ne+" = u_"+ne+`;
#endif
`:z==="define"?`
#ifndef HAS_UNIFORM_u_`+ne+`
uniform lowp float u_`+ne+`_t;
attribute `+j+" "+Ae+" a_"+ne+`;
#else
uniform `+j+" "+ee+" u_"+ne+`;
#endif
`:Se==="vec4"?`
#ifndef HAS_UNIFORM_u_`+ne+`
    `+j+" "+ee+" "+ne+" = a_"+ne+`;
#else
    `+j+" "+ee+" "+ne+" = u_"+ne+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+ne+`
    `+j+" "+ee+" "+ne+" = unpack_mix_"+Se+"(a_"+ne+", u_"+ne+`_t);
#else
    `+j+" "+ee+" "+ne+" = u_"+ne+`;
#endif
`}),staticAttributes:h,staticUniforms:E}}var dp=Object.freeze({__proto__:null,prelude:Bl,background:Dc,backgroundPattern:cf,circle:mu,clippingMask:yu,heatmap:Fc,heatmapTexture:Ii,collisionBox:gu,collisionCircle:Gf,debug:Hf,fill:Wf,fillOutline:lc,fillOutlinePattern:Nl,fillPattern:Xf,fillExtrusion:qi,fillExtrusionPattern:ff,hillshadePrepare:zu,hillshade:La,line:Ls,lineGradient:Io,linePattern:_u,lineSDF:Ko,raster:xu,symbolIcon:Oo,symbolSDF:cc,symbolTextAndIcon:Yf}),fc=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function qf(u){for(var f=[],l=0;l<u.length;l++)if(u[l]!==null){var h=u[l].split(" ");f.push(h.pop())}return f}fc.prototype.bind=function(u,f,l,h,x,S,E,P){this.context=u;for(var R=this.boundPaintVertexBuffers.length!==h.length,z=0;!R&&z<h.length;z++)this.boundPaintVertexBuffers[z]!==h[z]&&(R=!0);u.extVertexArrayObject&&this.vao&&this.boundProgram===f&&this.boundLayoutVertexBuffer===l&&!R&&this.boundIndexBuffer===x&&this.boundVertexOffset===S&&this.boundDynamicVertexBuffer===E&&this.boundDynamicVertexBuffer2===P?(u.bindVertexArrayOES.set(this.vao),E&&E.bind(),x&&x.dynamicDraw&&x.bind(),P&&P.bind()):this.freshBind(f,l,h,x,S,E,P)},fc.prototype.freshBind=function(u,f,l,h,x,S,E){var P,R=u.numAttributes,z=this.context,j=z.gl;if(z.extVertexArrayObject)this.vao&&this.destroy(),this.vao=z.extVertexArrayObject.createVertexArrayOES(),z.bindVertexArrayOES.set(this.vao),P=0,this.boundProgram=u,this.boundLayoutVertexBuffer=f,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=h,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=E;else{P=z.currentNumAttributes||0;for(var ee=R;ee<P;ee++)j.disableVertexAttribArray(ee)}f.enableAttributes(j,u);for(var ne=0,Ae=l;ne<Ae.length;ne+=1)Ae[ne].enableAttributes(j,u);S&&S.enableAttributes(j,u),E&&E.enableAttributes(j,u),f.bind(),f.setVertexAttribPointers(j,u,x);for(var Se=0,De=l;Se<De.length;Se+=1){var _e=De[Se];_e.bind(),_e.setVertexAttribPointers(j,u,x)}S&&(S.bind(),S.setVertexAttribPointers(j,u,x)),h&&h.bind(),E&&(E.bind(),E.setVertexAttribPointers(j,u,x)),z.currentNumAttributes=R},fc.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var pf=function(u,f,l,h,x,S){var E=u.gl;this.program=E.createProgram();for(var P=qf(l.staticAttributes),R=h?h.getBinderAttributes():[],z=P.concat(R),j=l.staticUniforms?qf(l.staticUniforms):[],ee=h?h.getBinderUniforms():[],ne=[],Ae=0,Se=j.concat(ee);Ae<Se.length;Ae+=1){var De=Se[Ae];ne.indexOf(De)<0&&ne.push(De)}var _e=h?h.defines():[];S&&_e.push("#define OVERDRAW_INSPECTOR;");var Fe=_e.concat(Bl.fragmentSource,l.fragmentSource).join(`
`),Ge=_e.concat(Bl.vertexSource,l.vertexSource).join(`
`),at=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(at,Fe),E.compileShader(at),E.attachShader(this.program,at);var Ct=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())this.failedToCreate=!0;else{E.shaderSource(Ct,Ge),E.compileShader(Ct),E.attachShader(this.program,Ct),this.attributes={};var wt={};this.numAttributes=z.length;for(var Mt=0;Mt<this.numAttributes;Mt++)z[Mt]&&(E.bindAttribLocation(this.program,Mt,z[Mt]),this.attributes[z[Mt]]=Mt);E.linkProgram(this.program),E.deleteShader(Ct),E.deleteShader(at);for(var qt=0;qt<ne.length;qt++){var xr=ne[qt];if(xr&&!wt[xr]){var pr=E.getUniformLocation(this.program,xr);pr&&(wt[xr]=pr)}}this.fixedUniforms=x(u,wt),this.binderUniforms=h?h.getUniforms(u,wt):[]}}};function hf(u,f,l){var h=1/bi(l,1,f.transform.tileZoom),x=Math.pow(2,l.tileID.overscaledZ),S=l.tileSize*Math.pow(2,f.transform.tileZoom)/x,E=S*(l.tileID.canonical.x+l.tileID.wrap*x),P=S*l.tileID.canonical.y;return{u_image:0,u_texsize:l.imageAtlasTexture.size,u_scale:[h,u.fromScale,u.toScale],u_fade:u.t,u_pixel_coord_upper:[E>>16,P>>16],u_pixel_coord_lower:[65535&E,65535&P]}}pf.prototype.draw=function(u,f,l,h,x,S,E,P,R,z,j,ee,ne,Ae,Se,De){var _e,Fe=u.gl;if(!this.failedToCreate){for(var Ge in u.program.set(this.program),u.setDepthMode(l),u.setStencilMode(h),u.setColorMode(x),u.setCullFace(S),this.fixedUniforms)this.fixedUniforms[Ge].set(E[Ge]);Ae&&Ae.setUniforms(u,this.binderUniforms,ee,{zoom:ne});for(var at=(_e={},_e[Fe.LINES]=2,_e[Fe.TRIANGLES]=3,_e[Fe.LINE_STRIP]=1,_e)[f],Ct=0,wt=j.get();Ct<wt.length;Ct+=1){var Mt=wt[Ct],qt=Mt.vaos||(Mt.vaos={});(qt[P]||(qt[P]=new fc)).bind(u,this,R,Ae?Ae.getPaintVertexBuffers():[],z,Mt.vertexOffset,Se,De),Fe.drawElements(f,Mt.primitiveLength*at,Fe.UNSIGNED_SHORT,Mt.primitiveOffset*at*2)}}};var ca=function(u,f,l,h){var x=f.style.light,S=x.properties.get("position"),E=[S.x,S.y,S.z],P=v.create$1();x.properties.get("anchor")==="viewport"&&v.fromRotation(P,-f.transform.angle),v.transformMat3(E,E,P);var R=x.properties.get("color");return{u_matrix:u,u_lightpos:E,u_lightintensity:x.properties.get("intensity"),u_lightcolor:[R.r,R.g,R.b],u_vertical_gradient:+l,u_opacity:h}},bu=function(u,f,l,h,x,S,E){return v.extend(ca(u,f,l,h),hf(S,f,E),{u_height_factor:-Math.pow(2,x.overscaledZ)/E.tileSize/8})},Zu=function(u){return{u_matrix:u}},ko=function(u,f,l,h){return v.extend(Zu(u),hf(l,f,h))},Bc=function(u,f){return{u_matrix:u,u_world:f}},pc=function(u,f,l,h,x){return v.extend(ko(u,f,l,h),{u_world:x})},wu=function(u,f,l,h){var x,S,E=u.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var P=bi(l,1,E.zoom);x=!0,S=[P,P]}else x=!1,S=E.pixelsToGLUnits;return{u_camera_to_center_distance:E.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:u.translatePosMatrix(f.posMatrix,l,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:v.browser.devicePixelRatio,u_extrude_scale:S}},Ks=function(u,f,l){var h=bi(l,1,f.zoom),x=Math.pow(2,f.zoom-l.tileID.overscaledZ),S=l.tileID.overscaleFactor();return{u_matrix:u,u_camera_to_center_distance:f.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[f.pixelsToGLUnits[0]/(h*x),f.pixelsToGLUnits[1]/(h*x)],u_overscale_factor:S}},hc=function(u,f,l){return{u_matrix:u,u_inv_matrix:f,u_camera_to_center_distance:l.cameraToCenterDistance,u_viewport_size:[l.width,l.height]}},Rs=function(u,f,l){return l===void 0&&(l=1),{u_matrix:u,u_color:f,u_overlay:0,u_overlay_scale:l}},$s=function(u){return{u_matrix:u}},df=function(u,f,l,h){return{u_matrix:u,u_extrude_scale:bi(f,1,l),u_intensity:h}},cl=function(u,f,l){var h=u.transform;return{u_matrix:$f(u,f,l),u_ratio:1/bi(f,1,h.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ni=function(u,f,l,h){return v.extend(cl(u,f,l),{u_image:0,u_image_height:h})},Nc=function(u,f,l,h){var x=u.transform,S=zl(f,x);return{u_matrix:$f(u,f,l),u_texsize:f.imageAtlasTexture.size,u_ratio:1/bi(f,1,x.zoom),u_device_pixel_ratio:v.browser.devicePixelRatio,u_image:0,u_scale:[S,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Kf=function(u,f,l,h,x){var S=u.lineAtlas,E=zl(f,u.transform),P=l.layout.get("line-cap")==="round",R=S.getDash(h.from,P),z=S.getDash(h.to,P),j=R.width*x.fromScale,ee=z.width*x.toScale;return v.extend(cl(u,f,l),{u_patternscale_a:[E/j,-R.height/2],u_patternscale_b:[E/ee,-z.height/2],u_sdfgamma:S.width/(256*Math.min(j,ee)*v.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:R.y,u_tex_y_b:z.y,u_mix:x.t})};function zl(u,f){return 1/bi(u,1,f.tileZoom)}function $f(u,f,l){return u.translatePosMatrix(f.tileID.posMatrix,f,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}var vf=function(u,f,l,h,x){return{u_matrix:u,u_tl_parent:f,u_scale_parent:l,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*x.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:x.paint.get("raster-brightness-min"),u_brightness_high:x.paint.get("raster-brightness-max"),u_saturation_factor:(E=x.paint.get("raster-saturation"),E>0?1-1/(1.001-E):-E),u_contrast_factor:(S=x.paint.get("raster-contrast"),S>0?1/(1-S):1+S),u_spin_weights:fl(x.paint.get("raster-hue-rotate"))};var S,E};function fl(u){u*=Math.PI/180;var f=Math.sin(u),l=Math.cos(u);return[(2*l+1)/3,(-Math.sqrt(3)*f-l+1)/3,(Math.sqrt(3)*f-l+1)/3]}var Zl,Uu=function(u,f,l,h,x,S,E,P,R,z){var j=x.transform;return{u_is_size_zoom_constant:+(u==="constant"||u==="source"),u_is_size_feature_constant:+(u==="constant"||u==="camera"),u_size_t:f?f.uSizeT:0,u_size:f?f.uSize:0,u_camera_to_center_distance:j.cameraToCenterDistance,u_pitch:j.pitch/360*2*Math.PI,u_rotate_symbol:+l,u_aspect_ratio:j.width/j.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:S,u_label_plane_matrix:E,u_coord_matrix:P,u_is_text:+R,u_pitch_with_map:+h,u_texsize:z,u_texture:0}},Ds=function(u,f,l,h,x,S,E,P,R,z,j){var ee=x.transform;return v.extend(Uu(u,f,l,h,x,S,E,P,R,z),{u_gamma_scale:h?Math.cos(ee._pitch)*ee.cameraToCenterDistance:1,u_device_pixel_ratio:v.browser.devicePixelRatio,u_is_halo:+j})},pl=function(u,f,l,h,x,S,E,P,R,z){return v.extend(Ds(u,f,l,h,x,S,E,P,!0,R,!0),{u_texsize_icon:z,u_texture_icon:1})},hl=function(u,f,l){return{u_matrix:u,u_opacity:f,u_color:l}},Su=function(u,f,l,h,x,S){return v.extend(function(E,P,R,z){var j=R.imageManager.getPattern(E.from.toString()),ee=R.imageManager.getPattern(E.to.toString()),ne=R.imageManager.getPixelSize(),Ae=ne.width,Se=ne.height,De=Math.pow(2,z.tileID.overscaledZ),_e=z.tileSize*Math.pow(2,R.transform.tileZoom)/De,Fe=_e*(z.tileID.canonical.x+z.tileID.wrap*De),Ge=_e*z.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:j.tl,u_pattern_br_a:j.br,u_pattern_tl_b:ee.tl,u_pattern_br_b:ee.br,u_texsize:[Ae,Se],u_mix:P.t,u_pattern_size_a:j.displaySize,u_pattern_size_b:ee.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/bi(z,1,R.transform.tileZoom),u_pixel_coord_upper:[Fe>>16,Ge>>16],u_pixel_coord_lower:[65535&Fe,65535&Ge]}}(h,S,l,x),{u_matrix:u,u_opacity:f})},dc={fillExtrusion:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_lightpos:new v.Uniform3f(u,f.u_lightpos),u_lightintensity:new v.Uniform1f(u,f.u_lightintensity),u_lightcolor:new v.Uniform3f(u,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(u,f.u_vertical_gradient),u_opacity:new v.Uniform1f(u,f.u_opacity)}},fillExtrusionPattern:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_lightpos:new v.Uniform3f(u,f.u_lightpos),u_lightintensity:new v.Uniform1f(u,f.u_lightintensity),u_lightcolor:new v.Uniform3f(u,f.u_lightcolor),u_vertical_gradient:new v.Uniform1f(u,f.u_vertical_gradient),u_height_factor:new v.Uniform1f(u,f.u_height_factor),u_image:new v.Uniform1i(u,f.u_image),u_texsize:new v.Uniform2f(u,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(u,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(u,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(u,f.u_scale),u_fade:new v.Uniform1f(u,f.u_fade),u_opacity:new v.Uniform1f(u,f.u_opacity)}},fill:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix)}},fillPattern:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_image:new v.Uniform1i(u,f.u_image),u_texsize:new v.Uniform2f(u,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(u,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(u,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(u,f.u_scale),u_fade:new v.Uniform1f(u,f.u_fade)}},fillOutline:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_world:new v.Uniform2f(u,f.u_world)}},fillOutlinePattern:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_world:new v.Uniform2f(u,f.u_world),u_image:new v.Uniform1i(u,f.u_image),u_texsize:new v.Uniform2f(u,f.u_texsize),u_pixel_coord_upper:new v.Uniform2f(u,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(u,f.u_pixel_coord_lower),u_scale:new v.Uniform3f(u,f.u_scale),u_fade:new v.Uniform1f(u,f.u_fade)}},circle:function(u,f){return{u_camera_to_center_distance:new v.Uniform1f(u,f.u_camera_to_center_distance),u_scale_with_map:new v.Uniform1i(u,f.u_scale_with_map),u_pitch_with_map:new v.Uniform1i(u,f.u_pitch_with_map),u_extrude_scale:new v.Uniform2f(u,f.u_extrude_scale),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_matrix:new v.UniformMatrix4f(u,f.u_matrix)}},collisionBox:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_camera_to_center_distance:new v.Uniform1f(u,f.u_camera_to_center_distance),u_pixels_to_tile_units:new v.Uniform1f(u,f.u_pixels_to_tile_units),u_extrude_scale:new v.Uniform2f(u,f.u_extrude_scale),u_overscale_factor:new v.Uniform1f(u,f.u_overscale_factor)}},collisionCircle:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_inv_matrix:new v.UniformMatrix4f(u,f.u_inv_matrix),u_camera_to_center_distance:new v.Uniform1f(u,f.u_camera_to_center_distance),u_viewport_size:new v.Uniform2f(u,f.u_viewport_size)}},debug:function(u,f){return{u_color:new v.UniformColor(u,f.u_color),u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_overlay:new v.Uniform1i(u,f.u_overlay),u_overlay_scale:new v.Uniform1f(u,f.u_overlay_scale)}},clippingMask:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix)}},heatmap:function(u,f){return{u_extrude_scale:new v.Uniform1f(u,f.u_extrude_scale),u_intensity:new v.Uniform1f(u,f.u_intensity),u_matrix:new v.UniformMatrix4f(u,f.u_matrix)}},heatmapTexture:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_world:new v.Uniform2f(u,f.u_world),u_image:new v.Uniform1i(u,f.u_image),u_color_ramp:new v.Uniform1i(u,f.u_color_ramp),u_opacity:new v.Uniform1f(u,f.u_opacity)}},hillshade:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_image:new v.Uniform1i(u,f.u_image),u_latrange:new v.Uniform2f(u,f.u_latrange),u_light:new v.Uniform2f(u,f.u_light),u_shadow:new v.UniformColor(u,f.u_shadow),u_highlight:new v.UniformColor(u,f.u_highlight),u_accent:new v.UniformColor(u,f.u_accent)}},hillshadePrepare:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_image:new v.Uniform1i(u,f.u_image),u_dimension:new v.Uniform2f(u,f.u_dimension),u_zoom:new v.Uniform1f(u,f.u_zoom),u_unpack:new v.Uniform4f(u,f.u_unpack)}},line:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_ratio:new v.Uniform1f(u,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(u,f.u_units_to_pixels)}},lineGradient:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_ratio:new v.Uniform1f(u,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(u,f.u_units_to_pixels),u_image:new v.Uniform1i(u,f.u_image),u_image_height:new v.Uniform1f(u,f.u_image_height)}},linePattern:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_texsize:new v.Uniform2f(u,f.u_texsize),u_ratio:new v.Uniform1f(u,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_image:new v.Uniform1i(u,f.u_image),u_units_to_pixels:new v.Uniform2f(u,f.u_units_to_pixels),u_scale:new v.Uniform3f(u,f.u_scale),u_fade:new v.Uniform1f(u,f.u_fade)}},lineSDF:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_ratio:new v.Uniform1f(u,f.u_ratio),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_units_to_pixels:new v.Uniform2f(u,f.u_units_to_pixels),u_patternscale_a:new v.Uniform2f(u,f.u_patternscale_a),u_patternscale_b:new v.Uniform2f(u,f.u_patternscale_b),u_sdfgamma:new v.Uniform1f(u,f.u_sdfgamma),u_image:new v.Uniform1i(u,f.u_image),u_tex_y_a:new v.Uniform1f(u,f.u_tex_y_a),u_tex_y_b:new v.Uniform1f(u,f.u_tex_y_b),u_mix:new v.Uniform1f(u,f.u_mix)}},raster:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_tl_parent:new v.Uniform2f(u,f.u_tl_parent),u_scale_parent:new v.Uniform1f(u,f.u_scale_parent),u_buffer_scale:new v.Uniform1f(u,f.u_buffer_scale),u_fade_t:new v.Uniform1f(u,f.u_fade_t),u_opacity:new v.Uniform1f(u,f.u_opacity),u_image0:new v.Uniform1i(u,f.u_image0),u_image1:new v.Uniform1i(u,f.u_image1),u_brightness_low:new v.Uniform1f(u,f.u_brightness_low),u_brightness_high:new v.Uniform1f(u,f.u_brightness_high),u_saturation_factor:new v.Uniform1f(u,f.u_saturation_factor),u_contrast_factor:new v.Uniform1f(u,f.u_contrast_factor),u_spin_weights:new v.Uniform3f(u,f.u_spin_weights)}},symbolIcon:function(u,f){return{u_is_size_zoom_constant:new v.Uniform1i(u,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(u,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(u,f.u_size_t),u_size:new v.Uniform1f(u,f.u_size),u_camera_to_center_distance:new v.Uniform1f(u,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(u,f.u_pitch),u_rotate_symbol:new v.Uniform1i(u,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(u,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(u,f.u_fade_change),u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(u,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(u,f.u_coord_matrix),u_is_text:new v.Uniform1i(u,f.u_is_text),u_pitch_with_map:new v.Uniform1i(u,f.u_pitch_with_map),u_texsize:new v.Uniform2f(u,f.u_texsize),u_texture:new v.Uniform1i(u,f.u_texture)}},symbolSDF:function(u,f){return{u_is_size_zoom_constant:new v.Uniform1i(u,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(u,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(u,f.u_size_t),u_size:new v.Uniform1f(u,f.u_size),u_camera_to_center_distance:new v.Uniform1f(u,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(u,f.u_pitch),u_rotate_symbol:new v.Uniform1i(u,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(u,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(u,f.u_fade_change),u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(u,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(u,f.u_coord_matrix),u_is_text:new v.Uniform1i(u,f.u_is_text),u_pitch_with_map:new v.Uniform1i(u,f.u_pitch_with_map),u_texsize:new v.Uniform2f(u,f.u_texsize),u_texture:new v.Uniform1i(u,f.u_texture),u_gamma_scale:new v.Uniform1f(u,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(u,f.u_is_halo)}},symbolTextAndIcon:function(u,f){return{u_is_size_zoom_constant:new v.Uniform1i(u,f.u_is_size_zoom_constant),u_is_size_feature_constant:new v.Uniform1i(u,f.u_is_size_feature_constant),u_size_t:new v.Uniform1f(u,f.u_size_t),u_size:new v.Uniform1f(u,f.u_size),u_camera_to_center_distance:new v.Uniform1f(u,f.u_camera_to_center_distance),u_pitch:new v.Uniform1f(u,f.u_pitch),u_rotate_symbol:new v.Uniform1i(u,f.u_rotate_symbol),u_aspect_ratio:new v.Uniform1f(u,f.u_aspect_ratio),u_fade_change:new v.Uniform1f(u,f.u_fade_change),u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_label_plane_matrix:new v.UniformMatrix4f(u,f.u_label_plane_matrix),u_coord_matrix:new v.UniformMatrix4f(u,f.u_coord_matrix),u_is_text:new v.Uniform1i(u,f.u_is_text),u_pitch_with_map:new v.Uniform1i(u,f.u_pitch_with_map),u_texsize:new v.Uniform2f(u,f.u_texsize),u_texsize_icon:new v.Uniform2f(u,f.u_texsize_icon),u_texture:new v.Uniform1i(u,f.u_texture),u_texture_icon:new v.Uniform1i(u,f.u_texture_icon),u_gamma_scale:new v.Uniform1f(u,f.u_gamma_scale),u_device_pixel_ratio:new v.Uniform1f(u,f.u_device_pixel_ratio),u_is_halo:new v.Uniform1i(u,f.u_is_halo)}},background:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_opacity:new v.Uniform1f(u,f.u_opacity),u_color:new v.UniformColor(u,f.u_color)}},backgroundPattern:function(u,f){return{u_matrix:new v.UniformMatrix4f(u,f.u_matrix),u_opacity:new v.Uniform1f(u,f.u_opacity),u_image:new v.Uniform1i(u,f.u_image),u_pattern_tl_a:new v.Uniform2f(u,f.u_pattern_tl_a),u_pattern_br_a:new v.Uniform2f(u,f.u_pattern_br_a),u_pattern_tl_b:new v.Uniform2f(u,f.u_pattern_tl_b),u_pattern_br_b:new v.Uniform2f(u,f.u_pattern_br_b),u_texsize:new v.Uniform2f(u,f.u_texsize),u_mix:new v.Uniform1f(u,f.u_mix),u_pattern_size_a:new v.Uniform2f(u,f.u_pattern_size_a),u_pattern_size_b:new v.Uniform2f(u,f.u_pattern_size_b),u_scale_a:new v.Uniform1f(u,f.u_scale_a),u_scale_b:new v.Uniform1f(u,f.u_scale_b),u_pixel_coord_upper:new v.Uniform2f(u,f.u_pixel_coord_upper),u_pixel_coord_lower:new v.Uniform2f(u,f.u_pixel_coord_lower),u_tile_units_to_pixels:new v.Uniform1f(u,f.u_tile_units_to_pixels)}}};function dl(u,f,l,h,x,S,E){for(var P=u.context,R=P.gl,z=u.useProgram("collisionBox"),j=[],ee=0,ne=0,Ae=0;Ae<h.length;Ae++){var Se=h[Ae],De=f.getTile(Se),_e=De.getBucket(l);if(_e){var Fe=Se.posMatrix;x[0]===0&&x[1]===0||(Fe=u.translatePosMatrix(Se.posMatrix,De,x,S));var Ge=E?_e.textCollisionBox:_e.iconCollisionBox,at=_e.collisionCircleArray;if(at.length>0){var Ct=v.create(),wt=Fe;v.mul(Ct,_e.placementInvProjMatrix,u.transform.glCoordMatrix),v.mul(Ct,Ct,_e.placementViewportMatrix),j.push({circleArray:at,circleOffset:ne,transform:wt,invTransform:Ct}),ne=ee+=at.length/4}Ge&&z.draw(P,R.LINES,se.disabled,Te.disabled,u.colorModeForRenderPass(),We.disabled,Ks(Fe,u.transform,De),l.id,Ge.layoutVertexBuffer,Ge.indexBuffer,Ge.segments,null,u.transform.zoom,null,null,Ge.collisionVertexBuffer)}}if(E&&j.length){var Mt=u.useProgram("collisionCircle"),qt=new v.StructArrayLayout2f1f2i16;qt.resize(4*ee),qt._trim();for(var xr=0,pr=0,Fr=j;pr<Fr.length;pr+=1)for(var tn=Fr[pr],pn=0;pn<tn.circleArray.length/4;pn++){var ln=4*pn,pi=tn.circleArray[ln+0],yr=tn.circleArray[ln+1],$r=tn.circleArray[ln+2],kn=tn.circleArray[ln+3];qt.emplace(xr++,pi,yr,$r,kn,0),qt.emplace(xr++,pi,yr,$r,kn,1),qt.emplace(xr++,pi,yr,$r,kn,2),qt.emplace(xr++,pi,yr,$r,kn,3)}(!Zl||Zl.length<2*ee)&&(Zl=function(Wi){var Gi=2*Wi,ro=new v.StructArrayLayout3ui6;ro.resize(Gi),ro._trim();for(var ra=0;ra<Gi;ra++){var _a=6*ra;ro.uint16[_a+0]=4*ra+0,ro.uint16[_a+1]=4*ra+1,ro.uint16[_a+2]=4*ra+2,ro.uint16[_a+3]=4*ra+2,ro.uint16[_a+4]=4*ra+3,ro.uint16[_a+5]=4*ra+0}return ro}(ee));for(var wn=P.createIndexBuffer(Zl,!0),vn=P.createVertexBuffer(qt,v.collisionCircleLayout.members,!0),Un=0,Sn=j;Un<Sn.length;Un+=1){var _n=Sn[Un],Da=hc(_n.transform,_n.invTransform,u.transform);Mt.draw(P,R.TRIANGLES,se.disabled,Te.disabled,u.colorModeForRenderPass(),We.disabled,Da,l.id,vn,wn,v.SegmentVector.simpleSegment(0,2*_n.circleOffset,_n.circleArray.length,_n.circleArray.length/2),null,u.transform.zoom,null,null,null)}vn.destroy(),wn.destroy()}}var xs=v.identity(new Float32Array(16));function zc(u,f,l,h,x,S){var E=v.getAnchorAlignment(u),P=-(E.horizontalAlign-.5)*f,R=-(E.verticalAlign-.5)*l,z=v.evaluateVariableOffset(u,h);return new v.Point((P/x+z[0])*S,(R/x+z[1])*S)}function mf(u,f,l,h,x,S,E,P,R,z,j){var ee=u.text.placedSymbolArray,ne=u.text.dynamicLayoutVertexArray,Ae=u.icon.dynamicLayoutVertexArray,Se={};ne.clear();for(var De=0;De<ee.length;De++){var _e=ee.get(De),Fe=_e.hidden||!_e.crossTileID||u.allowVerticalPlacement&&!_e.placedOrientation?null:h[_e.crossTileID];if(Fe){var Ge=new v.Point(_e.anchorX,_e.anchorY),at=Zn(Ge,l?P:E),Ct=Jn(S.cameraToCenterDistance,at.signedDistanceFromCamera),wt=x.evaluateSizeForFeature(u.textSizeData,z,_e)*Ct/v.ONE_EM;l&&(wt*=u.tilePixelRatio/R);for(var Mt=zc(Fe.anchor,Fe.width,Fe.height,Fe.textOffset,Fe.textBoxScale,wt),qt=l?Zn(Ge.add(Mt),E).point:at.point.add(f?Mt.rotate(-S.angle):Mt),xr=u.allowVerticalPlacement&&_e.placedOrientation===v.WritingMode.vertical?Math.PI/2:0,pr=0;pr<_e.numGlyphs;pr++)v.addDynamicAttributes(ne,qt,xr);j&&_e.associatedIconIndex>=0&&(Se[_e.associatedIconIndex]={shiftedAnchor:qt,angle:xr})}else Ea(_e.numGlyphs,ne)}if(j){Ae.clear();for(var Fr=u.icon.placedSymbolArray,tn=0;tn<Fr.length;tn++){var pn=Fr.get(tn);if(pn.hidden)Ea(pn.numGlyphs,Ae);else{var ln=Se[tn];if(ln)for(var pi=0;pi<pn.numGlyphs;pi++)v.addDynamicAttributes(Ae,ln.shiftedAnchor,ln.angle);else Ea(pn.numGlyphs,Ae)}}u.icon.dynamicLayoutVertexBuffer.updateData(Ae)}u.text.dynamicLayoutVertexBuffer.updateData(ne)}function Zc(u,f,l){return l.iconsInText&&f?"symbolTextAndIcon":u?"symbolSDF":"symbolIcon"}function Eu(u,f,l,h,x,S,E,P,R,z,j,ee){for(var ne=u.context,Ae=ne.gl,Se=u.transform,De=P==="map",_e=R==="map",Fe=De&&l.layout.get("symbol-placement")!=="point",Ge=De&&!_e&&!Fe,at=l.layout.get("symbol-sort-key").constantOr(1)!==void 0,Ct=!1,wt=u.depthModeForSublayer(0,se.ReadOnly),Mt=l.layout.get("text-variable-anchor"),qt=[],xr=0,pr=h;xr<pr.length;xr+=1){var Fr=pr[xr],tn=f.getTile(Fr),pn=tn.getBucket(l);if(pn){var ln=x?pn.text:pn.icon;if(ln&&ln.segments.get().length){var pi=ln.programConfigurations.get(l.id),yr=x||pn.sdfIcons,$r=x?pn.textSizeData:pn.iconSizeData,kn=_e||Se.pitch!==0,wn=u.useProgram(Zc(yr,x,pn),pi),vn=v.evaluateSizeForZoom($r,Se.zoom),Un=void 0,Sn=[0,0],_n=void 0,Da=void 0,Wi=null,Gi=void 0;if(x)_n=tn.glyphAtlasTexture,Da=Ae.LINEAR,Un=tn.glyphAtlasTexture.size,pn.iconsInText&&(Sn=tn.imageAtlasTexture.size,Wi=tn.imageAtlasTexture,Gi=kn||u.options.rotating||u.options.zooming||$r.kind==="composite"||$r.kind==="camera"?Ae.LINEAR:Ae.NEAREST);else{var ro=l.layout.get("icon-size").constantOr(0)!==1||pn.iconsNeedLinear;_n=tn.imageAtlasTexture,Da=yr||u.options.rotating||u.options.zooming||ro||kn?Ae.LINEAR:Ae.NEAREST,Un=tn.imageAtlasTexture.size}var ra=bi(tn,1,u.transform.zoom),_a=Li(Fr.posMatrix,_e,De,u.transform,ra),Fa=Wn(Fr.posMatrix,_e,De,u.transform,ra),no=Mt&&pn.hasTextData(),Ts=l.layout.get("icon-text-fit")!=="none"&&no&&pn.hasIconData();Fe&&gs(pn,Fr.posMatrix,u,x,_a,Fa,_e,z);var co=u.translatePosMatrix(Fr.posMatrix,tn,S,E),Jo=Fe||x&&Mt||Ts?xs:_a,Lo=u.translatePosMatrix(Fa,tn,S,E,!0),ru=yr&&l.paint.get(x?"text-halo-width":"icon-halo-width").constantOr(1)!==0,qu={program:wn,buffers:ln,uniformValues:yr?pn.iconsInText?pl($r.kind,vn,Ge,_e,u,co,Jo,Lo,Un,Sn):Ds($r.kind,vn,Ge,_e,u,co,Jo,Lo,x,Un,!0):Uu($r.kind,vn,Ge,_e,u,co,Jo,Lo,x,Un),atlasTexture:_n,atlasTextureIcon:Wi,atlasInterpolation:Da,atlasInterpolationIcon:Gi,isSDF:yr,hasHalo:ru};if(at&&pn.canOverlap){Ct=!0;for(var nu=0,iu=ln.segments.get();nu<iu.length;nu+=1){var Sl=iu[nu];qt.push({segments:new v.SegmentVector([Sl]),sortKey:Sl.sortKey,state:qu})}}else qt.push({segments:ln.segments,sortKey:0,state:qu})}}}Ct&&qt.sort(function(Ns,Uo){return Ns.sortKey-Uo.sortKey});for(var Bs=0,Ku=qt;Bs<Ku.length;Bs+=1){var Ba=Ku[Bs],na=Ba.state;if(ne.activeTexture.set(Ae.TEXTURE0),na.atlasTexture.bind(na.atlasInterpolation,Ae.CLAMP_TO_EDGE),na.atlasTextureIcon&&(ne.activeTexture.set(Ae.TEXTURE1),na.atlasTextureIcon&&na.atlasTextureIcon.bind(na.atlasInterpolationIcon,Ae.CLAMP_TO_EDGE)),na.isSDF){var au=na.uniformValues;na.hasHalo&&(au.u_is_halo=1,Ul(na.buffers,Ba.segments,l,u,na.program,wt,j,ee,au)),au.u_is_halo=0}Ul(na.buffers,Ba.segments,l,u,na.program,wt,j,ee,na.uniformValues)}}function Ul(u,f,l,h,x,S,E,P,R){var z=h.context;x.draw(z,z.gl.TRIANGLES,S,E,P,We.disabled,R,l.id,u.layoutVertexBuffer,u.indexBuffer,f,l.paint,h.transform.zoom,u.programConfigurations.get(l.id),u.dynamicLayoutVertexBuffer,u.opacityVertexBuffer)}function jl(u,f,l,h,x,S,E){var P,R,z,j,ee,ne=u.context.gl,Ae=l.paint.get("fill-pattern"),Se=Ae&&Ae.constantOr(1),De=l.getCrossfadeParameters();E?(R=Se&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",P=ne.LINES):(R=Se?"fillPattern":"fill",P=ne.TRIANGLES);for(var _e=0,Fe=h;_e<Fe.length;_e+=1){var Ge=Fe[_e],at=f.getTile(Ge);if(!Se||at.patternsLoaded()){var Ct=at.getBucket(l);if(Ct){var wt=Ct.programConfigurations.get(l.id),Mt=u.useProgram(R,wt);Se&&(u.context.activeTexture.set(ne.TEXTURE0),at.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),wt.updatePaintBuffers(De));var qt=Ae.constantOr(null);if(qt&&at.imageAtlas){var xr=at.imageAtlas,pr=xr.patternPositions[qt.to.toString()],Fr=xr.patternPositions[qt.from.toString()];pr&&Fr&&wt.setConstantPatternPositions(pr,Fr)}var tn=u.translatePosMatrix(Ge.posMatrix,at,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(E){j=Ct.indexBuffer2,ee=Ct.segments2;var pn=[ne.drawingBufferWidth,ne.drawingBufferHeight];z=R==="fillOutlinePattern"&&Se?pc(tn,u,De,at,pn):Bc(tn,pn)}else j=Ct.indexBuffer,ee=Ct.segments,z=Se?ko(tn,u,De,at):Zu(tn);Mt.draw(u.context,P,x,u.stencilModeForClipping(Ge),S,We.disabled,z,l.id,Ct.layoutVertexBuffer,j,ee,l.paint,u.transform.zoom,wt)}}}}function Cu(u,f,l,h,x,S,E){for(var P=u.context,R=P.gl,z=l.paint.get("fill-extrusion-pattern"),j=z.constantOr(1),ee=l.getCrossfadeParameters(),ne=l.paint.get("fill-extrusion-opacity"),Ae=0,Se=h;Ae<Se.length;Ae+=1){var De=Se[Ae],_e=f.getTile(De),Fe=_e.getBucket(l);if(Fe){var Ge=Fe.programConfigurations.get(l.id),at=u.useProgram(j?"fillExtrusionPattern":"fillExtrusion",Ge);j&&(u.context.activeTexture.set(R.TEXTURE0),_e.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Ge.updatePaintBuffers(ee));var Ct=z.constantOr(null);if(Ct&&_e.imageAtlas){var wt=_e.imageAtlas,Mt=wt.patternPositions[Ct.to.toString()],qt=wt.patternPositions[Ct.from.toString()];Mt&&qt&&Ge.setConstantPatternPositions(Mt,qt)}var xr=u.translatePosMatrix(De.posMatrix,_e,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),pr=l.paint.get("fill-extrusion-vertical-gradient"),Fr=j?bu(xr,u,pr,ne,De,ee,_e):ca(xr,u,pr,ne);at.draw(P,P.gl.TRIANGLES,x,S,E,We.backCCW,Fr,l.id,Fe.layoutVertexBuffer,Fe.indexBuffer,Fe.segments,l.paint,u.transform.zoom,Ge)}}}function Vl(u,f,l,h,x,S){var E=u.context,P=E.gl,R=f.fbo;if(R){var z=u.useProgram("hillshade");E.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,R.colorAttachment.get());var j=function(ee,ne,Ae){var Se=Ae.paint.get("hillshade-shadow-color"),De=Ae.paint.get("hillshade-highlight-color"),_e=Ae.paint.get("hillshade-accent-color"),Fe=Ae.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ae.paint.get("hillshade-illumination-anchor")==="viewport"&&(Fe-=ee.transform.angle);var Ge,at,Ct,wt=!ee.options.moving;return{u_matrix:ee.transform.calculatePosMatrix(ne.tileID.toUnwrapped(),wt),u_image:0,u_latrange:(Ge=ne.tileID,at=Math.pow(2,Ge.canonical.z),Ct=Ge.canonical.y,[new v.MercatorCoordinate(0,Ct/at).toLngLat().lat,new v.MercatorCoordinate(0,(Ct+1)/at).toLngLat().lat]),u_light:[Ae.paint.get("hillshade-exaggeration"),Fe],u_shadow:Se,u_highlight:De,u_accent:_e}}(u,f,l);z.draw(E,P.TRIANGLES,h,x,S,We.disabled,j,l.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}}function yf(u,f,l,h,x,S){var E=u.context,P=E.gl,R=f.dem;if(R&&R.data){var z=R.dim,j=R.stride,ee=R.getPixels();if(E.activeTexture.set(P.TEXTURE1),E.pixelStoreUnpackPremultiplyAlpha.set(!1),f.demTexture=f.demTexture||u.getTileTexture(j),f.demTexture){var ne=f.demTexture;ne.update(ee,{premultiply:!1}),ne.bind(P.NEAREST,P.CLAMP_TO_EDGE)}else f.demTexture=new v.Texture(E,ee,P.RGBA,{premultiply:!1}),f.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);E.activeTexture.set(P.TEXTURE0);var Ae=f.fbo;if(!Ae){var Se=new v.Texture(E,{width:z,height:z,data:null},P.RGBA);Se.bind(P.LINEAR,P.CLAMP_TO_EDGE),(Ae=f.fbo=E.createFramebuffer(z,z,!0)).colorAttachment.set(Se.texture)}E.bindFramebuffer.set(Ae.framebuffer),E.viewport.set([0,0,z,z]),u.useProgram("hillshadePrepare").draw(E,P.TRIANGLES,h,x,S,We.disabled,function(De,_e){var Fe=_e.stride,Ge=v.create();return v.ortho(Ge,0,v.EXTENT,-v.EXTENT,0,0,1),v.translate(Ge,Ge,[0,-v.EXTENT,0]),{u_matrix:Ge,u_image:1,u_dimension:[Fe,Fe],u_zoom:De.overscaledZ,u_unpack:_e.getUnpackVector()}}(f.tileID,R),l.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments),f.needsHillshadePrepare=!1}}function Tu(u,f,l,h,x){var S=h.paint.get("raster-fade-duration");if(S>0){var E=v.browser.now(),P=(E-u.timeAdded)/S,R=f?(E-f.timeAdded)/S:-1,z=l.getSource(),j=x.coveringZoomLevel({tileSize:z.tileSize,roundZoom:z.roundZoom}),ee=!f||Math.abs(f.tileID.overscaledZ-j)>Math.abs(u.tileID.overscaledZ-j),ne=ee&&u.refreshedUponExpiration?1:v.clamp(ee?P:1-R,0,1);return u.refreshedUponExpiration&&P>=1&&(u.refreshedUponExpiration=!1),f?{opacity:1,mix:1-ne}:{opacity:ne,mix:0}}return{opacity:1,mix:0}}var gf=new v.Color(1,0,0,1),Jf=new v.Color(0,1,0,1),_f=new v.Color(0,0,1,1),vl=new v.Color(1,0,1,1),Uc=new v.Color(0,1,1,1);function vc(u,f,l,h){ml(u,0,f+l/2,u.transform.width,l,h)}function xf(u,f,l,h){ml(u,f-l/2,0,l,u.transform.height,h)}function ml(u,f,l,h,x,S){var E=u.context,P=E.gl;P.enable(P.SCISSOR_TEST),P.scissor(f*v.browser.devicePixelRatio,l*v.browser.devicePixelRatio,h*v.browser.devicePixelRatio,x*v.browser.devicePixelRatio),E.clear({color:S}),P.disable(P.SCISSOR_TEST)}function Qf(u,f,l){var h=u.context,x=h.gl,S=l.posMatrix,E=u.useProgram("debug"),P=se.disabled,R=Te.disabled,z=u.colorModeForRenderPass();h.activeTexture.set(x.TEXTURE0),u.emptyTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),E.draw(h,x.LINE_STRIP,P,R,z,We.disabled,Rs(S,v.Color.red),"$debug",u.debugBuffer,u.tileBorderIndexBuffer,u.debugSegments);var j=f.getTileByID(l.key).latestRawTileData,ee=Math.floor((j&&j.byteLength||0)/1024),ne=f.getTile(l).tileSize,Ae=512/Math.min(ne,512)*(l.overscaledZ/u.transform.zoom)*.5,Se=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Se+=" => "+l.overscaledZ),function(De,_e){De.initDebugOverlayCanvas();var Fe=De.debugOverlayCanvas,Ge=De.context.gl,at=De.debugOverlayCanvas.getContext("2d");at.clearRect(0,0,Fe.width,Fe.height),at.shadowColor="white",at.shadowBlur=2,at.lineWidth=1.5,at.strokeStyle="white",at.textBaseline="top",at.font="bold 36px Open Sans, sans-serif",at.fillText(_e,5,5),at.strokeText(_e,5,5),De.debugOverlayTexture.update(Fe),De.debugOverlayTexture.bind(Ge.LINEAR,Ge.CLAMP_TO_EDGE)}(u,Se+" "+ee+"kb"),E.draw(h,x.TRIANGLES,P,R,Ze.alphaBlended,We.disabled,Rs(S,v.Color.transparent,Ae),"$debug",u.debugBuffer,u.quadTriangleIndexBuffer,u.debugSegments)}var Tn={symbol:function(u,f,l,h,x){if(u.renderPass==="translucent"){var S=Te.disabled,E=u.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(P,R,z,j,ee,ne,Ae){for(var Se=R.transform,De=ee==="map",_e=ne==="map",Fe=0,Ge=P;Fe<Ge.length;Fe+=1){var at=Ge[Fe],Ct=j.getTile(at),wt=Ct.getBucket(z);if(wt&&wt.text&&wt.text.segments.get().length){var Mt=v.evaluateSizeForZoom(wt.textSizeData,Se.zoom),qt=bi(Ct,1,R.transform.zoom),xr=Li(at.posMatrix,_e,De,R.transform,qt),pr=z.layout.get("icon-text-fit")!=="none"&&wt.hasIconData();if(Mt){var Fr=Math.pow(2,Se.zoom-Ct.tileID.overscaledZ);mf(wt,De,_e,Ae,v.symbolSize,Se,xr,at.posMatrix,Fr,Mt,pr)}}}}(h,u,l,f,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),x),l.paint.get("icon-opacity").constantOr(1)!==0&&Eu(u,f,l,h,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),S,E),l.paint.get("text-opacity").constantOr(1)!==0&&Eu(u,f,l,h,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),S,E),f.map.showCollisionBoxes&&(dl(u,f,l,h,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),dl(u,f,l,h,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))}},circle:function(u,f,l,h){if(u.renderPass==="translucent"){var x=l.paint.get("circle-opacity"),S=l.paint.get("circle-stroke-width"),E=l.paint.get("circle-stroke-opacity"),P=l.layout.get("circle-sort-key").constantOr(1)!==void 0;if(x.constantOr(1)!==0||S.constantOr(1)!==0&&E.constantOr(1)!==0){for(var R=u.context,z=R.gl,j=u.depthModeForSublayer(0,se.ReadOnly),ee=Te.disabled,ne=u.colorModeForRenderPass(),Ae=[],Se=0;Se<h.length;Se++){var De=h[Se],_e=f.getTile(De),Fe=_e.getBucket(l);if(Fe){var Ge=Fe.programConfigurations.get(l.id),at={programConfiguration:Ge,program:u.useProgram("circle",Ge),layoutVertexBuffer:Fe.layoutVertexBuffer,indexBuffer:Fe.indexBuffer,uniformValues:wu(u,De,_e,l)};if(P)for(var Ct=0,wt=Fe.segments.get();Ct<wt.length;Ct+=1){var Mt=wt[Ct];Ae.push({segments:new v.SegmentVector([Mt]),sortKey:Mt.sortKey,state:at})}else Ae.push({segments:Fe.segments,sortKey:0,state:at})}}P&&Ae.sort(function(tn,pn){return tn.sortKey-pn.sortKey});for(var qt=0,xr=Ae;qt<xr.length;qt+=1){var pr=xr[qt],Fr=pr.state;Fr.program.draw(R,z.TRIANGLES,j,ee,ne,We.disabled,Fr.uniformValues,l.id,Fr.layoutVertexBuffer,Fr.indexBuffer,pr.segments,l.paint,u.transform.zoom,Fr.programConfiguration)}}}},heatmap:function(u,f,l,h){if(l.paint.get("heatmap-opacity")!==0)if(u.renderPass==="offscreen"){var x=u.context,S=x.gl,E=Te.disabled,P=new Ze([S.ONE,S.ONE],v.Color.transparent,[!0,!0,!0,!0]);(function(Ae,Se,De){var _e=Ae.gl;Ae.activeTexture.set(_e.TEXTURE1),Ae.viewport.set([0,0,Se.width/4,Se.height/4]);var Fe=De.heatmapFbo;if(Fe)_e.bindTexture(_e.TEXTURE_2D,Fe.colorAttachment.get()),Ae.bindFramebuffer.set(Fe.framebuffer);else{var Ge=_e.createTexture();_e.bindTexture(_e.TEXTURE_2D,Ge),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_WRAP_S,_e.CLAMP_TO_EDGE),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_WRAP_T,_e.CLAMP_TO_EDGE),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_MIN_FILTER,_e.LINEAR),_e.texParameteri(_e.TEXTURE_2D,_e.TEXTURE_MAG_FILTER,_e.LINEAR),Fe=De.heatmapFbo=Ae.createFramebuffer(Se.width/4,Se.height/4,!1),function(at,Ct,wt,Mt){var qt=at.gl;qt.texImage2D(qt.TEXTURE_2D,0,qt.RGBA,Ct.width/4,Ct.height/4,0,qt.RGBA,at.extRenderToTextureHalfFloat?at.extTextureHalfFloat.HALF_FLOAT_OES:qt.UNSIGNED_BYTE,null),Mt.colorAttachment.set(wt)}(Ae,Se,Ge,Fe)}})(x,u,l),x.clear({color:v.Color.transparent});for(var R=0;R<h.length;R++){var z=h[R];if(!f.hasRenderableParent(z)){var j=f.getTile(z),ee=j.getBucket(l);if(ee){var ne=ee.programConfigurations.get(l.id);u.useProgram("heatmap",ne).draw(x,S.TRIANGLES,se.disabled,E,P,We.disabled,df(z.posMatrix,j,u.transform.zoom,l.paint.get("heatmap-intensity")),l.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,l.paint,u.transform.zoom,ne)}}}x.viewport.set([0,0,u.width,u.height])}else u.renderPass==="translucent"&&(u.context.setColorMode(u.colorModeForRenderPass()),function(Ae,Se){var De=Ae.context,_e=De.gl,Fe=Se.heatmapFbo;if(Fe){De.activeTexture.set(_e.TEXTURE0),_e.bindTexture(_e.TEXTURE_2D,Fe.colorAttachment.get()),De.activeTexture.set(_e.TEXTURE1);var Ge=Se.colorRampTexture;Ge||(Ge=Se.colorRampTexture=new v.Texture(De,Se.colorRamp,_e.RGBA)),Ge.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),Ae.useProgram("heatmapTexture").draw(De,_e.TRIANGLES,se.disabled,Te.disabled,Ae.colorModeForRenderPass(),We.disabled,function(at,Ct,wt,Mt){var qt=v.create();v.ortho(qt,0,at.width,at.height,0,0,1);var xr=at.context.gl;return{u_matrix:qt,u_world:[xr.drawingBufferWidth,xr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:Ct.paint.get("heatmap-opacity")}}(Ae,Se),Se.id,Ae.viewportBuffer,Ae.quadTriangleIndexBuffer,Ae.viewportSegments,Se.paint,Ae.transform.zoom)}}(u,l))},line:function(u,f,l,h){if(u.renderPass==="translucent"){var x=l.paint.get("line-opacity"),S=l.paint.get("line-width");if(x.constantOr(1)!==0&&S.constantOr(1)!==0)for(var E=u.depthModeForSublayer(0,se.ReadOnly),P=u.colorModeForRenderPass(),R=l.paint.get("line-dasharray"),z=l.paint.get("line-pattern"),j=z.constantOr(1),ee=l.paint.get("line-gradient"),ne=l.getCrossfadeParameters(),Ae=j?"linePattern":R?"lineSDF":ee?"lineGradient":"line",Se=u.context,De=Se.gl,_e=!0,Fe=0,Ge=h;Fe<Ge.length;Fe+=1){var at=Ge[Fe],Ct=f.getTile(at);if(!j||Ct.patternsLoaded()){var wt=Ct.getBucket(l);if(wt){var Mt=wt.programConfigurations.get(l.id),qt=u.context.program.get(),xr=u.useProgram(Ae,Mt),pr=_e||xr.program!==qt,Fr=z.constantOr(null);if(Fr&&Ct.imageAtlas){var tn=Ct.imageAtlas,pn=tn.patternPositions[Fr.to.toString()],ln=tn.patternPositions[Fr.from.toString()];pn&&ln&&Mt.setConstantPatternPositions(pn,ln)}var pi=j?Nc(u,Ct,l,ne):R?Kf(u,Ct,l,R,ne):ee?Ni(u,Ct,l,wt.lineClipsArray.length):cl(u,Ct,l);if(j)Se.activeTexture.set(De.TEXTURE0),Ct.imageAtlasTexture.bind(De.LINEAR,De.CLAMP_TO_EDGE),Mt.updatePaintBuffers(ne);else if(R&&(pr||u.lineAtlas.dirty))Se.activeTexture.set(De.TEXTURE0),u.lineAtlas.bind(Se);else if(ee){var yr=wt.gradients[l.id],$r=yr.texture;if(l.gradientVersion!==yr.version){var kn=256;if(l.stepInterpolant){var wn=f.getSource().maxzoom,vn=at.canonical.z===wn?Math.ceil(1<<u.transform.maxZoom-at.canonical.z):1;kn=v.clamp(v.nextPowerOfTwo(wt.maxLineLength/v.EXTENT*1024*vn),256,Se.maxTextureSize)}yr.gradient=v.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:kn,image:yr.gradient||void 0,clips:wt.lineClipsArray}),yr.texture?yr.texture.update(yr.gradient):yr.texture=new v.Texture(Se,yr.gradient,De.RGBA),yr.version=l.gradientVersion,$r=yr.texture}Se.activeTexture.set(De.TEXTURE0),$r.bind(l.stepInterpolant?De.NEAREST:De.LINEAR,De.CLAMP_TO_EDGE)}xr.draw(Se,De.TRIANGLES,E,u.stencilModeForClipping(at),P,We.disabled,pi,l.id,wt.layoutVertexBuffer,wt.indexBuffer,wt.segments,l.paint,u.transform.zoom,Mt,wt.layoutVertexBuffer2),_e=!1}}}}},fill:function(u,f,l,h){var x=l.paint.get("fill-color"),S=l.paint.get("fill-opacity");if(S.constantOr(1)!==0){var E=u.colorModeForRenderPass(),P=l.paint.get("fill-pattern"),R=u.opaquePassEnabledForLayer()&&!P.constantOr(1)&&x.constantOr(v.Color.transparent).a===1&&S.constantOr(0)===1?"opaque":"translucent";if(u.renderPass===R){var z=u.depthModeForSublayer(1,u.renderPass==="opaque"?se.ReadWrite:se.ReadOnly);jl(u,f,l,h,z,E,!1)}if(u.renderPass==="translucent"&&l.paint.get("fill-antialias")){var j=u.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,se.ReadOnly);jl(u,f,l,h,j,E,!0)}}},"fill-extrusion":function(u,f,l,h){var x=l.paint.get("fill-extrusion-opacity");if(x!==0&&u.renderPass==="translucent"){var S=new se(u.context.gl.LEQUAL,se.ReadWrite,u.depthRangeFor3D);if(x!==1||l.paint.get("fill-extrusion-pattern").constantOr(1))Cu(u,f,l,h,S,Te.disabled,Ze.disabled),Cu(u,f,l,h,S,u.stencilModeFor3D(),u.colorModeForRenderPass());else{var E=u.colorModeForRenderPass();Cu(u,f,l,h,S,Te.disabled,E)}}},hillshade:function(u,f,l,h){if(u.renderPass==="offscreen"||u.renderPass==="translucent"){for(var x=u.context,S=u.depthModeForSublayer(0,se.ReadOnly),E=u.colorModeForRenderPass(),P=u.renderPass==="translucent"?u.stencilConfigForOverlap(h):[{},h],R=P[0],z=0,j=P[1];z<j.length;z+=1){var ee=j[z],ne=f.getTile(ee);ne.needsHillshadePrepare&&u.renderPass==="offscreen"?yf(u,ne,l,S,Te.disabled,E):u.renderPass==="translucent"&&Vl(u,ne,l,S,R[ee.overscaledZ],E)}x.viewport.set([0,0,u.width,u.height])}},raster:function(u,f,l,h){if(u.renderPass==="translucent"&&l.paint.get("raster-opacity")!==0&&h.length)for(var x=u.context,S=x.gl,E=f.getSource(),P=u.useProgram("raster"),R=u.colorModeForRenderPass(),z=E instanceof Ke?[{},h]:u.stencilConfigForOverlap(h),j=z[0],ee=z[1],ne=ee[ee.length-1].overscaledZ,Ae=!u.options.moving,Se=0,De=ee;Se<De.length;Se+=1){var _e=De[Se],Fe=u.depthModeForSublayer(_e.overscaledZ-ne,l.paint.get("raster-opacity")===1?se.ReadWrite:se.ReadOnly,S.LESS),Ge=f.getTile(_e),at=u.transform.calculatePosMatrix(_e.toUnwrapped(),Ae);Ge.registerFadeDuration(l.paint.get("raster-fade-duration"));var Ct=f.findLoadedParent(_e,0),wt=Tu(Ge,Ct,f,l,u.transform),Mt=void 0,qt=void 0,xr=l.paint.get("raster-resampling")==="nearest"?S.NEAREST:S.LINEAR;x.activeTexture.set(S.TEXTURE0),Ge.texture.bind(xr,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),x.activeTexture.set(S.TEXTURE1),Ct?(Ct.texture.bind(xr,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST),Mt=Math.pow(2,Ct.tileID.overscaledZ-Ge.tileID.overscaledZ),qt=[Ge.tileID.canonical.x*Mt%1,Ge.tileID.canonical.y*Mt%1]):Ge.texture.bind(xr,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST);var pr=vf(at,qt||[0,0],Mt||1,wt,l);E instanceof Ke?P.draw(x,S.TRIANGLES,Fe,Te.disabled,R,We.disabled,pr,l.id,E.boundsBuffer,u.quadTriangleIndexBuffer,E.boundsSegments):P.draw(x,S.TRIANGLES,Fe,j[_e.overscaledZ],R,We.disabled,pr,l.id,u.rasterBoundsBuffer,u.quadTriangleIndexBuffer,u.rasterBoundsSegments)}},background:function(u,f,l){var h=l.paint.get("background-color"),x=l.paint.get("background-opacity");if(x!==0){var S=u.context,E=S.gl,P=u.transform,R=P.tileSize,z=l.paint.get("background-pattern");if(!u.isPatternMissing(z)){var j=!z&&h.a===1&&x===1&&u.opaquePassEnabledForLayer()?"opaque":"translucent";if(u.renderPass===j){var ee=Te.disabled,ne=u.depthModeForSublayer(0,j==="opaque"?se.ReadWrite:se.ReadOnly),Ae=u.colorModeForRenderPass(),Se=u.useProgram(z?"backgroundPattern":"background"),De=P.coveringTiles({tileSize:R});z&&(S.activeTexture.set(E.TEXTURE0),u.imageManager.bind(u.context));for(var _e=l.getCrossfadeParameters(),Fe=0,Ge=De;Fe<Ge.length;Fe+=1){var at=Ge[Fe],Ct=u.transform.calculatePosMatrix(at.toUnwrapped()),wt=z?Su(Ct,x,u,z,{tileID:at,tileSize:R},_e):hl(Ct,x,h);Se.draw(S,E.TRIANGLES,ne,ee,Ae,We.disabled,wt,l.id,u.tileExtentBuffer,u.quadTriangleIndexBuffer,u.tileExtentSegments)}}}}},debug:function(u,f,l){for(var h=0;h<l.length;h++)Qf(u,f,l[h])},custom:function(u,f,l){var h=u.context,x=l.implementation;if(u.renderPass==="offscreen"){var S=x.prerender;S&&(u.setCustomLayerDefaults(),h.setColorMode(u.colorModeForRenderPass()),S.call(x,h.gl,u.transform.customLayerMatrix()),h.setDirty(),u.setBaseState())}else if(u.renderPass==="translucent"){u.setCustomLayerDefaults(),h.setColorMode(u.colorModeForRenderPass()),h.setStencilMode(Te.disabled);var E=x.renderingMode==="3d"?new se(u.context.gl.LEQUAL,se.ReadWrite,u.depthRangeFor3D):u.depthModeForSublayer(0,se.ReadOnly);h.setDepthMode(E),x.render(h.gl,u.transform.customLayerMatrix()),h.setDirty(),u.setBaseState(),h.bindFramebuffer.set(null)}}},Kr=function(u,f){this.context=new te(u),this.transform=f,this._tileTextures={},this.setup(),this.numSublayers=Ie.maxUnderzooming+Ie.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new as,this.gpuTimers={}};Kr.prototype.resize=function(u,f){if(this.width=u*v.browser.devicePixelRatio,this.height=f*v.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var l=0,h=this.style._order;l<h.length;l+=1)this.style._layers[h[l]].resize()},Kr.prototype.setup=function(){var u=this.context,f=new v.StructArrayLayout2i4;f.emplaceBack(0,0),f.emplaceBack(v.EXTENT,0),f.emplaceBack(0,v.EXTENT),f.emplaceBack(v.EXTENT,v.EXTENT),this.tileExtentBuffer=u.createVertexBuffer(f,la.members),this.tileExtentSegments=v.SegmentVector.simpleSegment(0,0,4,2);var l=new v.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(v.EXTENT,0),l.emplaceBack(0,v.EXTENT),l.emplaceBack(v.EXTENT,v.EXTENT),this.debugBuffer=u.createVertexBuffer(l,la.members),this.debugSegments=v.SegmentVector.simpleSegment(0,0,4,5);var h=new v.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(v.EXTENT,0,v.EXTENT,0),h.emplaceBack(0,v.EXTENT,0,v.EXTENT),h.emplaceBack(v.EXTENT,v.EXTENT,v.EXTENT,v.EXTENT),this.rasterBoundsBuffer=u.createVertexBuffer(h,vt.members),this.rasterBoundsSegments=v.SegmentVector.simpleSegment(0,0,4,2);var x=new v.StructArrayLayout2i4;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=u.createVertexBuffer(x,la.members),this.viewportSegments=v.SegmentVector.simpleSegment(0,0,4,2);var S=new v.StructArrayLayout1ui2;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=u.createIndexBuffer(S);var E=new v.StructArrayLayout3ui6;E.emplaceBack(0,1,2),E.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=u.createIndexBuffer(E),this.emptyTexture=new v.Texture(u,{width:1,height:1,data:new Uint8Array([0,0,0,0])},u.gl.RGBA);var P=this.context.gl;this.stencilClearMode=new Te({func:P.ALWAYS,mask:0},0,255,P.ZERO,P.ZERO,P.ZERO)},Kr.prototype.clearStencil=function(){var u=this.context,f=u.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var l=v.create();v.ortho(l,0,this.width,this.height,0,0,1),v.scale(l,l,[f.drawingBufferWidth,f.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(u,f.TRIANGLES,se.disabled,this.stencilClearMode,Ze.disabled,We.disabled,$s(l),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},Kr.prototype._renderTileClippingMasks=function(u,f){if(this.currentStencilSource!==u.source&&u.isTileClipped()&&f&&f.length){this.currentStencilSource=u.source;var l=this.context,h=l.gl;this.nextStencilID+f.length>256&&this.clearStencil(),l.setColorMode(Ze.disabled),l.setDepthMode(se.disabled);var x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var S=0,E=f;S<E.length;S+=1){var P=E[S],R=this._tileClippingMaskIDs[P.key]=this.nextStencilID++;x.draw(l,h.TRIANGLES,se.disabled,new Te({func:h.ALWAYS,mask:0},R,255,h.KEEP,h.KEEP,h.REPLACE),Ze.disabled,We.disabled,$s(P.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},Kr.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var u=this.nextStencilID++,f=this.context.gl;return new Te({func:f.NOTEQUAL,mask:255},u,255,f.KEEP,f.KEEP,f.REPLACE)},Kr.prototype.stencilModeForClipping=function(u){var f=this.context.gl;return new Te({func:f.EQUAL,mask:255},this._tileClippingMaskIDs[u.key],0,f.KEEP,f.KEEP,f.REPLACE)},Kr.prototype.stencilConfigForOverlap=function(u){var f,l=this.context.gl,h=u.sort(function(R,z){return z.overscaledZ-R.overscaledZ}),x=h[h.length-1].overscaledZ,S=h[0].overscaledZ-x+1;if(S>1){this.currentStencilSource=void 0,this.nextStencilID+S>256&&this.clearStencil();for(var E={},P=0;P<S;P++)E[P+x]=new Te({func:l.GEQUAL,mask:255},P+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=S,[E,h]}return[(f={},f[x]=Te.disabled,f),h]},Kr.prototype.colorModeForRenderPass=function(){var u=this.context.gl;return this._showOverdrawInspector?new Ze([u.CONSTANT_COLOR,u.ONE],new v.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Ze.unblended:Ze.alphaBlended},Kr.prototype.depthModeForSublayer=function(u,f,l){if(!this.opaquePassEnabledForLayer())return se.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+u)*this.depthEpsilon;return new se(l||this.context.gl.LEQUAL,f,[h,h])},Kr.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},Kr.prototype.render=function(u,f){var l=this;this.style=u,this.options=f,this.lineAtlas=u.lineAtlas,this.imageManager=u.imageManager,this.glyphManager=u.glyphManager,this.symbolFadeChange=u.placement.symbolFadeChange(v.browser.now()),this.imageManager.beginFrame();var h=this.style._order,x=this.style.sourceCaches;for(var S in x){var E=x[S];E.used&&E.prepare(this.context)}var P,R,z={},j={},ee={};for(var ne in x){var Ae=x[ne];z[ne]=Ae.getVisibleCoordinates(),j[ne]=z[ne].slice().reverse(),ee[ne]=Ae.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Se=0;Se<h.length;Se++)if(this.style._layers[h[Se]].is3D()){this.opaquePassCutoff=Se;break}this.renderPass="offscreen";for(var De=0,_e=h;De<_e.length;De+=1){var Fe=this.style._layers[_e[De]];if(Fe.hasOffscreenPass()&&!Fe.isHidden(this.transform.zoom)){var Ge=j[Fe.source];(Fe.type==="custom"||Ge.length)&&this.renderLayer(this,x[Fe.source],Fe,Ge)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:f.showOverdrawInspector?v.Color.black:v.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=f.showOverdrawInspector,this.depthRangeFor3D=[0,1-(u._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var at=this.style._layers[h[this.currentLayer]],Ct=x[at.source],wt=z[at.source];this._renderTileClippingMasks(at,wt),this.renderLayer(this,Ct,at,wt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var Mt=this.style._layers[h[this.currentLayer]],qt=x[Mt.source],xr=(Mt.type==="symbol"?ee:j)[Mt.source];this._renderTileClippingMasks(Mt,z[Mt.source]),this.renderLayer(this,qt,Mt,xr)}this.options.showTileBoundaries&&(v.values(this.style._layers).forEach(function(pr){pr.source&&!pr.isHidden(l.transform.zoom)&&(pr.source!==(R&&R.id)&&(R=l.style.sourceCaches[pr.source]),(!P||P.getSource().maxzoom<R.getSource().maxzoom)&&(P=R))}),P&&Tn.debug(this,P,P.getVisibleCoordinates())),this.options.showPadding&&function(pr){var Fr=pr.transform.padding;vc(pr,pr.transform.height-(Fr.top||0),3,gf),vc(pr,Fr.bottom||0,3,Jf),xf(pr,Fr.left||0,3,_f),xf(pr,pr.transform.width-(Fr.right||0),3,vl);var tn=pr.transform.centerPoint;(function(pn,ln,pi,yr){ml(pn,ln-1,pi-10,2,20,yr),ml(pn,ln-10,pi-1,20,2,yr)})(pr,tn.x,pr.transform.height-tn.y,Uc)}(this),this.context.setDefault()},Kr.prototype.renderLayer=function(u,f,l,h){l.isHidden(this.transform.zoom)||(l.type==="background"||l.type==="custom"||h.length)&&(this.id=l.id,this.gpuTimingStart(l),Tn[l.type](u,f,l,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},Kr.prototype.gpuTimingStart=function(u){if(this.options.gpuTiming){var f=this.context.extTimerQuery,l=this.gpuTimers[u.id];l||(l=this.gpuTimers[u.id]={calls:0,cpuTime:0,query:f.createQueryEXT()}),l.calls++,f.beginQueryEXT(f.TIME_ELAPSED_EXT,l.query)}},Kr.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var u=this.context.extTimerQuery;u.endQueryEXT(u.TIME_ELAPSED_EXT)}},Kr.prototype.collectGpuTimers=function(){var u=this.gpuTimers;return this.gpuTimers={},u},Kr.prototype.queryGpuTimers=function(u){var f={};for(var l in u){var h=u[l],x=this.context.extTimerQuery,S=x.getQueryObjectEXT(h.query,x.QUERY_RESULT_EXT)/1e6;x.deleteQueryEXT(h.query),f[l]=S}return f},Kr.prototype.translatePosMatrix=function(u,f,l,h,x){if(!l[0]&&!l[1])return u;var S=x?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(S){var E=Math.sin(S),P=Math.cos(S);l=[l[0]*P-l[1]*E,l[0]*E+l[1]*P]}var R=[x?l[0]:bi(f,l[0],this.transform.zoom),x?l[1]:bi(f,l[1],this.transform.zoom),0],z=new Float32Array(16);return v.translate(z,u,R),z},Kr.prototype.saveTileTexture=function(u){var f=this._tileTextures[u.size[0]];f?f.push(u):this._tileTextures[u.size[0]]=[u]},Kr.prototype.getTileTexture=function(u){var f=this._tileTextures[u];return f&&f.length>0?f.pop():null},Kr.prototype.isPatternMissing=function(u){if(!u)return!1;if(!u.from||!u.to)return!0;var f=this.imageManager.getPattern(u.from.toString()),l=this.imageManager.getPattern(u.to.toString());return!f||!l},Kr.prototype.useProgram=function(u,f){this.cache=this.cache||{};var l=""+u+(f?f.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[l]||(this.cache[l]=new pf(this.context,u,dp[u],f,dc[u],this._showOverdrawInspector)),this.cache[l]},Kr.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},Kr.prototype.setBaseState=function(){var u=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(u.FUNC_ADD)},Kr.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=v.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new v.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},Kr.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Gl=function(u,f){this.points=u,this.planes=f};Gl.fromInvProjectionMatrix=function(u,f,l){var h=Math.pow(2,l),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(E){return v.transformMat4([],E,u)}).map(function(E){return v.scale$1([],E,1/E[3]/f*h)}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(E){var P=v.sub([],x[E[0]],x[E[1]]),R=v.sub([],x[E[2]],x[E[1]]),z=v.normalize([],v.cross([],P,R)),j=-v.dot(z,x[E[1]]);return z.concat(j)});return new Gl(x,S)};var ju=function(u,f){this.min=u,this.max=f,this.center=v.scale$2([],v.add([],this.min,this.max),.5)};ju.prototype.quadrant=function(u){for(var f=[u%2==0,u<2],l=v.clone$2(this.min),h=v.clone$2(this.max),x=0;x<f.length;x++)l[x]=f[x]?this.min[x]:this.center[x],h[x]=f[x]?this.center[x]:this.max[x];return h[2]=this.max[2],new ju(l,h)},ju.prototype.distanceX=function(u){return Math.max(Math.min(this.max[0],u[0]),this.min[0])-u[0]},ju.prototype.distanceY=function(u){return Math.max(Math.min(this.max[1],u[1]),this.min[1])-u[1]},ju.prototype.intersects=function(u){for(var f=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],l=!0,h=0;h<u.planes.length;h++){for(var x=u.planes[h],S=0,E=0;E<f.length;E++)S+=v.dot$1(x,f[E])>=0;if(S===0)return 0;S!==f.length&&(l=!1)}if(l)return 2;for(var P=0;P<3;P++){for(var R=Number.MAX_VALUE,z=-Number.MAX_VALUE,j=0;j<u.points.length;j++){var ee=u.points[j][P]-this.min[P];R=Math.min(R,ee),z=Math.max(z,ee)}if(z<0||R>this.max[P]-this.min[P])return 0}return 1};var Vu=function(u,f,l,h){if(u===void 0&&(u=0),f===void 0&&(f=0),l===void 0&&(l=0),h===void 0&&(h=0),isNaN(u)||u<0||isNaN(f)||f<0||isNaN(l)||l<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=u,this.bottom=f,this.left=l,this.right=h};Vu.prototype.interpolate=function(u,f,l){return f.top!=null&&u.top!=null&&(this.top=v.number(u.top,f.top,l)),f.bottom!=null&&u.bottom!=null&&(this.bottom=v.number(u.bottom,f.bottom,l)),f.left!=null&&u.left!=null&&(this.left=v.number(u.left,f.left,l)),f.right!=null&&u.right!=null&&(this.right=v.number(u.right,f.right,l)),this},Vu.prototype.getCenter=function(u,f){var l=v.clamp((this.left+u-this.right)/2,0,u),h=v.clamp((this.top+f-this.bottom)/2,0,f);return new v.Point(l,h)},Vu.prototype.equals=function(u){return this.top===u.top&&this.bottom===u.bottom&&this.left===u.left&&this.right===u.right},Vu.prototype.clone=function(){return new Vu(this.top,this.bottom,this.left,this.right)},Vu.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ii=function(u,f,l,h,x){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=x===void 0||x,this._minZoom=u||0,this._maxZoom=f||22,this._minPitch=l==null?0:l,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new v.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Vu,this._posMatrixCache={},this._alignedPosMatrixCache={}},Vi={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ii.prototype.clone=function(){var u=new ii(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return u.tileSize=this.tileSize,u.latRange=this.latRange,u.width=this.width,u.height=this.height,u._center=this._center,u.zoom=this.zoom,u.angle=this.angle,u._fov=this._fov,u._pitch=this._pitch,u._unmodified=this._unmodified,u._edgeInsets=this._edgeInsets.clone(),u._calcMatrices(),u},Vi.minZoom.get=function(){return this._minZoom},Vi.minZoom.set=function(u){this._minZoom!==u&&(this._minZoom=u,this.zoom=Math.max(this.zoom,u))},Vi.maxZoom.get=function(){return this._maxZoom},Vi.maxZoom.set=function(u){this._maxZoom!==u&&(this._maxZoom=u,this.zoom=Math.min(this.zoom,u))},Vi.minPitch.get=function(){return this._minPitch},Vi.minPitch.set=function(u){this._minPitch!==u&&(this._minPitch=u,this.pitch=Math.max(this.pitch,u))},Vi.maxPitch.get=function(){return this._maxPitch},Vi.maxPitch.set=function(u){this._maxPitch!==u&&(this._maxPitch=u,this.pitch=Math.min(this.pitch,u))},Vi.renderWorldCopies.get=function(){return this._renderWorldCopies},Vi.renderWorldCopies.set=function(u){u===void 0?u=!0:u===null&&(u=!1),this._renderWorldCopies=u},Vi.worldSize.get=function(){return this.tileSize*this.scale},Vi.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Vi.size.get=function(){return new v.Point(this.width,this.height)},Vi.bearing.get=function(){return-this.angle/Math.PI*180},Vi.bearing.set=function(u){var f=-v.wrap(u,-180,180)*Math.PI/180;this.angle!==f&&(this._unmodified=!1,this.angle=f,this._calcMatrices(),this.rotationMatrix=v.create$2(),v.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Vi.pitch.get=function(){return this._pitch/Math.PI*180},Vi.pitch.set=function(u){var f=v.clamp(u,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==f&&(this._unmodified=!1,this._pitch=f,this._calcMatrices())},Vi.fov.get=function(){return this._fov/Math.PI*180},Vi.fov.set=function(u){u=Math.max(.01,Math.min(60,u)),this._fov!==u&&(this._unmodified=!1,this._fov=u/180*Math.PI,this._calcMatrices())},Vi.zoom.get=function(){return this._zoom},Vi.zoom.set=function(u){var f=Math.min(Math.max(u,this.minZoom),this.maxZoom);this._zoom!==f&&(this._unmodified=!1,this._zoom=f,this.scale=this.zoomScale(f),this.tileZoom=Math.floor(f),this.zoomFraction=f-this.tileZoom,this._constrain(),this._calcMatrices())},Vi.center.get=function(){return this._center},Vi.center.set=function(u){u.lat===this._center.lat&&u.lng===this._center.lng||(this._unmodified=!1,this._center=u,this._constrain(),this._calcMatrices())},Vi.padding.get=function(){return this._edgeInsets.toJSON()},Vi.padding.set=function(u){this._edgeInsets.equals(u)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,u,1),this._calcMatrices())},Vi.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ii.prototype.isPaddingEqual=function(u){return this._edgeInsets.equals(u)},ii.prototype.interpolatePadding=function(u,f,l){this._unmodified=!1,this._edgeInsets.interpolate(u,f,l),this._constrain(),this._calcMatrices()},ii.prototype.coveringZoomLevel=function(u){var f=(u.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/u.tileSize));return Math.max(0,f)},ii.prototype.getVisibleUnwrappedCoordinates=function(u){var f=[new v.UnwrappedTileID(0,u)];if(this._renderWorldCopies)for(var l=this.pointCoordinate(new v.Point(0,0)),h=this.pointCoordinate(new v.Point(this.width,0)),x=this.pointCoordinate(new v.Point(this.width,this.height)),S=this.pointCoordinate(new v.Point(0,this.height)),E=Math.floor(Math.min(l.x,h.x,x.x,S.x)),P=Math.floor(Math.max(l.x,h.x,x.x,S.x)),R=E-1;R<=P+1;R++)R!==0&&f.push(new v.UnwrappedTileID(R,u));return f},ii.prototype.coveringTiles=function(u){var f=this.coveringZoomLevel(u),l=f;if(u.minzoom!==void 0&&f<u.minzoom)return[];u.maxzoom!==void 0&&f>u.maxzoom&&(f=u.maxzoom);var h=v.MercatorCoordinate.fromLngLat(this.center),x=Math.pow(2,f),S=[x*h.x,x*h.y,0],E=Gl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,f),P=u.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(P=f);var R=function(pr){return{aabb:new ju([pr*x,0,0],[(pr+1)*x,x,0]),zoom:0,x:0,y:0,wrap:pr,fullyVisible:!1}},z=[],j=[],ee=f,ne=u.reparseOverscaled?l:f;if(this._renderWorldCopies)for(var Ae=1;Ae<=3;Ae++)z.push(R(-Ae)),z.push(R(Ae));for(z.push(R(0));z.length>0;){var Se=z.pop(),De=Se.x,_e=Se.y,Fe=Se.fullyVisible;if(!Fe){var Ge=Se.aabb.intersects(E);if(Ge===0)continue;Fe=Ge===2}var at=Se.aabb.distanceX(S),Ct=Se.aabb.distanceY(S),wt=Math.max(Math.abs(at),Math.abs(Ct));if(Se.zoom===ee||wt>3+(1<<ee-Se.zoom)-2&&Se.zoom>=P)j.push({tileID:new v.OverscaledTileID(Se.zoom===ee?ne:Se.zoom,Se.wrap,Se.zoom,De,_e),distanceSq:v.sqrLen([S[0]-.5-De,S[1]-.5-_e])});else for(var Mt=0;Mt<4;Mt++){var qt=(De<<1)+Mt%2,xr=(_e<<1)+(Mt>>1);z.push({aabb:Se.aabb.quadrant(Mt),zoom:Se.zoom+1,x:qt,y:xr,wrap:Se.wrap,fullyVisible:Fe})}}return j.sort(function(pr,Fr){return pr.distanceSq-Fr.distanceSq}).map(function(pr){return pr.tileID})},ii.prototype.resize=function(u,f){this.width=u,this.height=f,this.pixelsToGLUnits=[2/u,-2/f],this._constrain(),this._calcMatrices()},Vi.unmodified.get=function(){return this._unmodified},ii.prototype.zoomScale=function(u){return Math.pow(2,u)},ii.prototype.scaleZoom=function(u){return Math.log(u)/Math.LN2},ii.prototype.project=function(u){var f=v.clamp(u.lat,-this.maxValidLatitude,this.maxValidLatitude);return new v.Point(v.mercatorXfromLng(u.lng)*this.worldSize,v.mercatorYfromLat(f)*this.worldSize)},ii.prototype.unproject=function(u){return new v.MercatorCoordinate(u.x/this.worldSize,u.y/this.worldSize).toLngLat()},Vi.point.get=function(){return this.project(this.center)},ii.prototype.setLocationAtPoint=function(u,f){var l=this.pointCoordinate(f),h=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(u),S=new v.MercatorCoordinate(x.x-(l.x-h.x),x.y-(l.y-h.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())},ii.prototype.locationPoint=function(u){return this.coordinatePoint(this.locationCoordinate(u))},ii.prototype.pointLocation=function(u){return this.coordinateLocation(this.pointCoordinate(u))},ii.prototype.locationCoordinate=function(u){return v.MercatorCoordinate.fromLngLat(u)},ii.prototype.coordinateLocation=function(u){return u.toLngLat()},ii.prototype.pointCoordinate=function(u){var f=[u.x,u.y,0,1],l=[u.x,u.y,1,1];v.transformMat4(f,f,this.pixelMatrixInverse),v.transformMat4(l,l,this.pixelMatrixInverse);var h=f[3],x=l[3],S=f[1]/h,E=l[1]/x,P=f[2]/h,R=l[2]/x,z=P===R?0:(0-P)/(R-P);return new v.MercatorCoordinate(v.number(f[0]/h,l[0]/x,z)/this.worldSize,v.number(S,E,z)/this.worldSize)},ii.prototype.coordinatePoint=function(u){var f=[u.x*this.worldSize,u.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix),new v.Point(f[0]/f[3],f[1]/f[3])},ii.prototype.getBounds=function(){return new v.LngLatBounds().extend(this.pointLocation(new v.Point(0,0))).extend(this.pointLocation(new v.Point(this.width,0))).extend(this.pointLocation(new v.Point(this.width,this.height))).extend(this.pointLocation(new v.Point(0,this.height)))},ii.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new v.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ii.prototype.setMaxBounds=function(u){u?(this.lngRange=[u.getWest(),u.getEast()],this.latRange=[u.getSouth(),u.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ii.prototype.calculatePosMatrix=function(u,f){f===void 0&&(f=!1);var l=u.key,h=f?this._alignedPosMatrixCache:this._posMatrixCache;if(h[l])return h[l];var x=u.canonical,S=this.worldSize/this.zoomScale(x.z),E=x.x+Math.pow(2,x.z)*u.wrap,P=v.identity(new Float64Array(16));return v.translate(P,P,[E*S,x.y*S,0]),v.scale(P,P,[S/v.EXTENT,S/v.EXTENT,1]),v.multiply(P,f?this.alignedProjMatrix:this.projMatrix,P),h[l]=new Float32Array(P),h[l]},ii.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ii.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var u,f,l,h,x=-90,S=90,E=-180,P=180,R=this.size,z=this._unmodified;if(this.latRange){var j=this.latRange;x=v.mercatorYfromLat(j[1])*this.worldSize,u=(S=v.mercatorYfromLat(j[0])*this.worldSize)-x<R.y?R.y/(S-x):0}if(this.lngRange){var ee=this.lngRange;E=v.mercatorXfromLng(ee[0])*this.worldSize,f=(P=v.mercatorXfromLng(ee[1])*this.worldSize)-E<R.x?R.x/(P-E):0}var ne=this.point,Ae=Math.max(f||0,u||0);if(Ae)return this.center=this.unproject(new v.Point(f?(P+E)/2:ne.x,u?(S+x)/2:ne.y)),this.zoom+=this.scaleZoom(Ae),this._unmodified=z,void(this._constraining=!1);if(this.latRange){var Se=ne.y,De=R.y/2;Se-De<x&&(h=x+De),Se+De>S&&(h=S-De)}if(this.lngRange){var _e=ne.x,Fe=R.x/2;_e-Fe<E&&(l=E+Fe),_e+Fe>P&&(l=P-Fe)}l===void 0&&h===void 0||(this.center=this.unproject(new v.Point(l!==void 0?l:ne.x,h!==void 0?h:ne.y))),this._unmodified=z,this._constraining=!1}},ii.prototype._calcMatrices=function(){if(this.height){var u=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var f=Math.PI/2+this._pitch,l=this._fov*(.5+u.y/this.height),h=Math.sin(l)*this.cameraToCenterDistance/Math.sin(v.clamp(Math.PI-f-l,.01,Math.PI-.01)),x=this.point,S=x.x,E=x.y,P=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),R=this.height/50,z=new Float64Array(16);v.perspective(z,this._fov,this.width/this.height,R,P),z[8]=2*-u.x/this.width,z[9]=2*u.y/this.height,v.scale(z,z,[1,-1,1]),v.translate(z,z,[0,0,-this.cameraToCenterDistance]),v.rotateX(z,z,this._pitch),v.rotateZ(z,z,this.angle),v.translate(z,z,[-S,-E,0]),this.mercatorMatrix=v.scale([],z,[this.worldSize,this.worldSize,this.worldSize]),v.scale(z,z,[1,1,v.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=z,this.invProjMatrix=v.invert([],this.projMatrix);var j=this.width%2/2,ee=this.height%2/2,ne=Math.cos(this.angle),Ae=Math.sin(this.angle),Se=S-Math.round(S)+ne*j+Ae*ee,De=E-Math.round(E)+ne*ee+Ae*j,_e=new Float64Array(z);if(v.translate(_e,_e,[Se>.5?Se-1:Se,De>.5?De-1:De,0]),this.alignedProjMatrix=_e,z=v.create(),v.scale(z,z,[this.width/2,-this.height/2,1]),v.translate(z,z,[1,-1,0]),this.labelPlaneMatrix=z,z=v.create(),v.scale(z,z,[1,-1,1]),v.translate(z,z,[-1,-1,0]),v.scale(z,z,[2/this.width,2/this.height,1]),this.glCoordMatrix=z,this.pixelMatrix=v.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(z=v.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=z,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ii.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var u=this.pointCoordinate(new v.Point(0,0)),f=[u.x*this.worldSize,u.y*this.worldSize,0,1];return v.transformMat4(f,f,this.pixelMatrix)[3]/this.cameraToCenterDistance},ii.prototype.getCameraPoint=function(){var u=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new v.Point(0,u))},ii.prototype.getCameraQueryGeometry=function(u){var f=this.getCameraPoint();if(u.length===1)return[u[0],f];for(var l=f.x,h=f.y,x=f.x,S=f.y,E=0,P=u;E<P.length;E+=1){var R=P[E];l=Math.min(l,R.x),h=Math.min(h,R.y),x=Math.max(x,R.x),S=Math.max(S,R.y)}return[new v.Point(l,h),new v.Point(x,h),new v.Point(x,S),new v.Point(l,S),new v.Point(l,h)]},Object.defineProperties(ii.prototype,Vi);var bs=function(u){var f,l,h,x;this._hashName=u&&encodeURIComponent(u),v.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(f=this._updateHashUnthrottled.bind(this),l=!1,h=null,x=function(){h=null,l&&(f(),h=setTimeout(x,300),l=!1)},function(){return l=!0,h||x(),h})};bs.prototype.addTo=function(u){return this._map=u,v.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},bs.prototype.remove=function(){return v.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},bs.prototype.getHashString=function(u){var f=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,h=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,h),S=Math.round(f.lng*x)/x,E=Math.round(f.lat*x)/x,P=this._map.getBearing(),R=this._map.getPitch(),z="";if(z+=u?"/"+S+"/"+E+"/"+l:l+"/"+E+"/"+S,(P||R)&&(z+="/"+Math.round(10*P)/10),R&&(z+="/"+Math.round(R)),this._hashName){var j=this._hashName,ee=!1,ne=v.window.location.hash.slice(1).split("&").map(function(Ae){var Se=Ae.split("=")[0];return Se===j?(ee=!0,Se+"="+z):Ae}).filter(function(Ae){return Ae});return ee||ne.push(j+"="+z),"#"+ne.join("&")}return"#"+z},bs.prototype._getCurrentHash=function(){var u,f=this,l=v.window.location.hash.replace("#","");return this._hashName?(l.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===f._hashName&&(u=h)}),(u&&u[1]||"").split("/")):l.split("/")},bs.prototype._onHashChange=function(){var u=this._getCurrentHash();if(u.length>=3&&!u.some(function(l){return isNaN(l)})){var f=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:f,pitch:+(u[4]||0)}),!0}return!1},bs.prototype._updateHashUnthrottled=function(){var u=v.window.location.href.replace(/(#.+)?$/,this.getHashString());try{v.window.history.replaceState(v.window.history.state,null,u)}catch(f){}};var jc={linearity:.3,easing:v.bezier(0,0,.3,1)},mc=v.extend({deceleration:2500,maxSpeed:1400},jc),Vc=v.extend({deceleration:20,maxSpeed:1400},jc),rh=v.extend({deceleration:1e3,maxSpeed:360},jc),nh=v.extend({deceleration:1e3,maxSpeed:90},jc),yc=function(u){this._map=u,this.clear()};function Gu(u,f){(!u.duration||u.duration<f.duration)&&(u.duration=f.duration,u.easing=f.easing)}function Hu(u,f,l){var h=l.maxSpeed,x=l.linearity,S=l.deceleration,E=v.clamp(u*x/(f/1e3),-h,h),P=Math.abs(E)/(S*x);return{easing:l.easing,duration:1e3*P,amount:E*(P/2)}}yc.prototype.clear=function(){this._inertiaBuffer=[]},yc.prototype.record=function(u){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:v.browser.now(),settings:u})},yc.prototype._drainInertiaBuffer=function(){for(var u=this._inertiaBuffer,f=v.browser.now();u.length>0&&f-u[0].time>160;)u.shift()},yc.prototype._onMoveEnd=function(u){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var f={zoom:0,bearing:0,pitch:0,pan:new v.Point(0,0),pinchAround:void 0,around:void 0},l=0,h=this._inertiaBuffer;l<h.length;l+=1){var x=h[l].settings;f.zoom+=x.zoomDelta||0,f.bearing+=x.bearingDelta||0,f.pitch+=x.pitchDelta||0,x.panDelta&&f.pan._add(x.panDelta),x.around&&(f.around=x.around),x.pinchAround&&(f.pinchAround=x.pinchAround)}var S=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,E={};if(f.pan.mag()){var P=Hu(f.pan.mag(),S,v.extend({},mc,u||{}));E.offset=f.pan.mult(P.amount/f.pan.mag()),E.center=this._map.transform.center,Gu(E,P)}if(f.zoom){var R=Hu(f.zoom,S,Vc);E.zoom=this._map.transform.zoom+R.amount,Gu(E,R)}if(f.bearing){var z=Hu(f.bearing,S,rh);E.bearing=this._map.transform.bearing+v.clamp(z.amount,-179,179),Gu(E,z)}if(f.pitch){var j=Hu(f.pitch,S,nh);E.pitch=this._map.transform.pitch+j.amount,Gu(E,j)}if(E.zoom||E.bearing){var ee=f.pinchAround===void 0?f.around:f.pinchAround;E.around=ee?this._map.unproject(ee):this._map.getCenter()}return this.clear(),v.extend(E,{noMoveStart:!0})}};var fa=function(u){function f(h,x,S,E){E===void 0&&(E={});var P=Z.mousePos(x.getCanvasContainer(),S),R=x.unproject(P);u.call(this,h,v.extend({point:P,lngLat:R,originalEvent:S},E)),this._defaultPrevented=!1,this.target=x}u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f;var l={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},l.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,l),f}(v.Event),Fo=function(u){function f(h,x,S){var E=h==="touchend"?S.changedTouches:S.touches,P=Z.touchPos(x.getCanvasContainer(),E),R=P.map(function(ee){return x.unproject(ee)}),z=P.reduce(function(ee,ne,Ae,Se){return ee.add(ne.div(Se.length))},new v.Point(0,0)),j=x.unproject(z);u.call(this,h,{points:P,point:z,lngLats:R,lngLat:j,originalEvent:S}),this._defaultPrevented=!1}u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f;var l={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},l.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,l),f}(v.Event),Hl=function(u){function f(h,x,S){u.call(this,h,{originalEvent:S}),this._defaultPrevented=!1}u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f;var l={defaultPrevented:{configurable:!0}};return f.prototype.preventDefault=function(){this._defaultPrevented=!0},l.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(f.prototype,l),f}(v.Event),Aa=function(u,f){this._map=u,this._clickTolerance=f.clickTolerance};Aa.prototype.reset=function(){delete this._mousedownPos},Aa.prototype.wheel=function(u){return this._firePreventable(new Hl(u.type,this._map,u))},Aa.prototype.mousedown=function(u,f){return this._mousedownPos=f,this._firePreventable(new fa(u.type,this._map,u))},Aa.prototype.mouseup=function(u){this._map.fire(new fa(u.type,this._map,u))},Aa.prototype.click=function(u,f){this._mousedownPos&&this._mousedownPos.dist(f)>=this._clickTolerance||this._map.fire(new fa(u.type,this._map,u))},Aa.prototype.dblclick=function(u){return this._firePreventable(new fa(u.type,this._map,u))},Aa.prototype.mouseover=function(u){this._map.fire(new fa(u.type,this._map,u))},Aa.prototype.mouseout=function(u){this._map.fire(new fa(u.type,this._map,u))},Aa.prototype.touchstart=function(u){return this._firePreventable(new Fo(u.type,this._map,u))},Aa.prototype.touchmove=function(u){this._map.fire(new Fo(u.type,this._map,u))},Aa.prototype.touchend=function(u){this._map.fire(new Fo(u.type,this._map,u))},Aa.prototype.touchcancel=function(u){this._map.fire(new Fo(u.type,this._map,u))},Aa.prototype._firePreventable=function(u){if(this._map.fire(u),u.defaultPrevented)return{}},Aa.prototype.isEnabled=function(){return!0},Aa.prototype.isActive=function(){return!1},Aa.prototype.enable=function(){},Aa.prototype.disable=function(){};var Gr=function(u){this._map=u};Gr.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Gr.prototype.mousemove=function(u){this._map.fire(new fa(u.type,this._map,u))},Gr.prototype.mousedown=function(){this._delayContextMenu=!0},Gr.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new fa("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Gr.prototype.contextmenu=function(u){this._delayContextMenu?this._contextMenuEvent=u:this._map.fire(new fa(u.type,this._map,u)),this._map.listens("contextmenu")&&u.preventDefault()},Gr.prototype.isEnabled=function(){return!0},Gr.prototype.isActive=function(){return!1},Gr.prototype.enable=function(){},Gr.prototype.disable=function(){};var os=function(u,f){this._map=u,this._el=u.getCanvasContainer(),this._container=u.getContainer(),this._clickTolerance=f.clickTolerance||1};function Gc(u,f){for(var l={},h=0;h<u.length;h++)l[u[h].identifier]=f[h];return l}os.prototype.isEnabled=function(){return!!this._enabled},os.prototype.isActive=function(){return!!this._active},os.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},os.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},os.prototype.mousedown=function(u,f){this.isEnabled()&&u.shiftKey&&u.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=f,this._active=!0)},os.prototype.mousemoveWindow=function(u,f){if(this._active){var l=f;if(!(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=l,this._box||(this._box=Z.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",u));var x=Math.min(h.x,l.x),S=Math.max(h.x,l.x),E=Math.min(h.y,l.y),P=Math.max(h.y,l.y);Z.setTransform(this._box,"translate("+x+"px,"+E+"px)"),this._box.style.width=S-x+"px",this._box.style.height=P-E+"px"}}},os.prototype.mouseupWindow=function(u,f){var l=this;if(this._active&&u.button===0){var h=this._startPos,x=f;if(this.reset(),Z.suppressClick(),h.x!==x.x||h.y!==x.y)return this._map.fire(new v.Event("boxzoomend",{originalEvent:u})),{cameraAnimation:function(S){return S.fitScreenCoordinates(h,x,l._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",u)}},os.prototype.keydown=function(u){this._active&&u.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",u))},os.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos},os.prototype._fireEvent=function(u,f){return this._map.fire(new v.Event(u,{originalEvent:f}))};var Wl=function(u){this.reset(),this.numTouches=u.numTouches};Wl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Wl.prototype.touchstart=function(u,f,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=u.timeStamp),l.length===this.numTouches&&(this.centroid=function(h){for(var x=new v.Point(0,0),S=0,E=h;S<E.length;S+=1)x._add(E[S]);return x.div(h.length)}(f),this.touches=Gc(l,f)))},Wl.prototype.touchmove=function(u,f,l){if(!this.aborted&&this.centroid){var h=Gc(l,f);for(var x in this.touches){var S=h[x];(!S||S.dist(this.touches[x])>30)&&(this.aborted=!0)}}},Wl.prototype.touchend=function(u,f,l){if((!this.centroid||u.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var Fs=function(u){this.singleTap=new Wl(u),this.numTaps=u.numTaps,this.reset()};Fs.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Fs.prototype.touchstart=function(u,f,l){this.singleTap.touchstart(u,f,l)},Fs.prototype.touchmove=function(u,f,l){this.singleTap.touchmove(u,f,l)},Fs.prototype.touchend=function(u,f,l){var h=this.singleTap.touchend(u,f,l);if(h){var x=u.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(h)<30;if(x&&S||this.reset(),this.count++,this.lastTime=u.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var ss=function(){this._zoomIn=new Fs({numTouches:1,numTaps:2}),this._zoomOut=new Fs({numTouches:2,numTaps:1}),this.reset()};ss.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ss.prototype.touchstart=function(u,f,l){this._zoomIn.touchstart(u,f,l),this._zoomOut.touchstart(u,f,l)},ss.prototype.touchmove=function(u,f,l){this._zoomIn.touchmove(u,f,l),this._zoomOut.touchmove(u,f,l)},ss.prototype.touchend=function(u,f,l){var h=this,x=this._zoomIn.touchend(u,f,l),S=this._zoomOut.touchend(u,f,l);return x?(this._active=!0,u.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(E){return E.easeTo({duration:300,zoom:E.getZoom()+1,around:E.unproject(x)},{originalEvent:u})}}):S?(this._active=!0,u.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(E){return E.easeTo({duration:300,zoom:E.getZoom()-1,around:E.unproject(S)},{originalEvent:u})}}):void 0},ss.prototype.touchcancel=function(){this.reset()},ss.prototype.enable=function(){this._enabled=!0},ss.prototype.disable=function(){this._enabled=!1,this.reset()},ss.prototype.isEnabled=function(){return this._enabled},ss.prototype.isActive=function(){return this._active};var yl={0:1,2:2},dr=function(u){this.reset(),this._clickTolerance=u.clickTolerance||1};dr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},dr.prototype._correctButton=function(u,f){return!1},dr.prototype._move=function(u,f){return{}},dr.prototype.mousedown=function(u,f){if(!this._lastPoint){var l=Z.mouseButton(u);this._correctButton(u,l)&&(this._lastPoint=f,this._eventButton=l)}},dr.prototype.mousemoveWindow=function(u,f){var l=this._lastPoint;if(l){if(u.preventDefault(),function(h,x){var S=yl[x];return h.buttons===void 0||(h.buttons&S)!==S}(u,this._eventButton))this.reset();else if(this._moved||!(f.dist(l)<this._clickTolerance))return this._moved=!0,this._lastPoint=f,this._move(l,f)}},dr.prototype.mouseupWindow=function(u){this._lastPoint&&Z.mouseButton(u)===this._eventButton&&(this._moved&&Z.suppressClick(),this.reset())},dr.prototype.enable=function(){this._enabled=!0},dr.prototype.disable=function(){this._enabled=!1,this.reset()},dr.prototype.isEnabled=function(){return this._enabled},dr.prototype.isActive=function(){return this._active};var bf=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.mousedown=function(l,h){u.prototype.mousedown.call(this,l,h),this._lastPoint&&(this._active=!0)},f.prototype._correctButton=function(l,h){return h===0&&!l.ctrlKey},f.prototype._move=function(l,h){return{around:h,panDelta:h.sub(l)}},f}(dr),gl=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype._correctButton=function(l,h){return h===0&&l.ctrlKey||h===2},f.prototype._move=function(l,h){var x=.8*(h.x-l.x);if(x)return this._active=!0,{bearingDelta:x}},f.prototype.contextmenu=function(l){l.preventDefault()},f}(dr),Wu=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype._correctButton=function(l,h){return h===0&&l.ctrlKey||h===2},f.prototype._move=function(l,h){var x=-.5*(h.y-l.y);if(x)return this._active=!0,{pitchDelta:x}},f.prototype.contextmenu=function(l){l.preventDefault()},f}(dr),ws=function(u){this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset()};ws.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new v.Point(0,0)},ws.prototype.touchstart=function(u,f,l){return this._calculateTransform(u,f,l)},ws.prototype.touchmove=function(u,f,l){if(this._active&&!(l.length<this._minTouches))return u.preventDefault(),this._calculateTransform(u,f,l)},ws.prototype.touchend=function(u,f,l){this._calculateTransform(u,f,l),this._active&&l.length<this._minTouches&&this.reset()},ws.prototype.touchcancel=function(){this.reset()},ws.prototype._calculateTransform=function(u,f,l){l.length>0&&(this._active=!0);var h=Gc(l,f),x=new v.Point(0,0),S=new v.Point(0,0),E=0;for(var P in h){var R=h[P],z=this._touches[P];z&&(x._add(R),S._add(R.sub(z)),E++,h[P]=R)}if(this._touches=h,!(E<this._minTouches)&&S.mag()){var j=S.div(E);if(this._sum._add(j),!(this._sum.mag()<this._clickTolerance))return{around:x.div(E),panDelta:j}}},ws.prototype.enable=function(){this._enabled=!0},ws.prototype.disable=function(){this._enabled=!1,this.reset()},ws.prototype.isEnabled=function(){return this._enabled},ws.prototype.isActive=function(){return this._active};var $o=function(){this.reset()};function wf(u,f,l){for(var h=0;h<u.length;h++)if(u[h].identifier===l)return f[h]}function Sf(u,f){return Math.log(u/f)/Math.LN2}$o.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},$o.prototype._start=function(u){},$o.prototype._move=function(u,f,l){return{}},$o.prototype.touchstart=function(u,f,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([f[0],f[1]]))},$o.prototype.touchmove=function(u,f,l){if(this._firstTwoTouches){u.preventDefault();var h=this._firstTwoTouches,x=h[1],S=wf(l,f,h[0]),E=wf(l,f,x);if(S&&E){var P=this._aroundCenter?null:S.add(E).div(2);return this._move([S,E],P,u)}}},$o.prototype.touchend=function(u,f,l){if(this._firstTwoTouches){var h=this._firstTwoTouches,x=h[1],S=wf(l,f,h[0]),E=wf(l,f,x);S&&E||(this._active&&Z.suppressClick(),this.reset())}},$o.prototype.touchcancel=function(){this.reset()},$o.prototype.enable=function(u){this._enabled=!0,this._aroundCenter=!!u&&u.around==="center"},$o.prototype.disable=function(){this._enabled=!1,this.reset()},$o.prototype.isEnabled=function(){return this._enabled},$o.prototype.isActive=function(){return this._active};var us=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.reset=function(){u.prototype.reset.call(this),delete this._distance,delete this._startDistance},f.prototype._start=function(l){this._startDistance=this._distance=l[0].dist(l[1])},f.prototype._move=function(l,h){var x=this._distance;if(this._distance=l[0].dist(l[1]),this._active||!(Math.abs(Sf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Sf(this._distance,x),pinchAround:h}},f}($o);function Xu(u,f){return 180*u.angleWith(f)/Math.PI}var Ef=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.reset=function(){u.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},f.prototype._start=function(l){this._startVector=this._vector=l[0].sub(l[1]),this._minDiameter=l[0].dist(l[1])},f.prototype._move=function(l,h){var x=this._vector;if(this._vector=l[0].sub(l[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Xu(this._vector,x),pinchAround:h}},f.prototype._isBelowThreshold=function(l){this._minDiameter=Math.min(this._minDiameter,l.mag());var h=25/(Math.PI*this._minDiameter)*360,x=Xu(l,this._startVector);return Math.abs(x)<h},f}($o);function gc(u){return Math.abs(u.y)>Math.abs(u.x)}var ep=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.reset=function(){u.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},f.prototype._start=function(l){this._lastPoints=l,gc(l[0].sub(l[1]))&&(this._valid=!1)},f.prototype._move=function(l,h,x){var S=l[0].sub(this._lastPoints[0]),E=l[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(S,E,x.timeStamp),this._valid)return this._lastPoints=l,this._active=!0,{pitchDelta:(S.y+E.y)/2*-.5}},f.prototype.gestureBeginsVertically=function(l,h,x){if(this._valid!==void 0)return this._valid;var S=l.mag()>=2,E=h.mag()>=2;if(S||E){if(!S||!E)return this._firstMove===void 0&&(this._firstMove=x),x-this._firstMove<100&&void 0;var P=l.y>0==h.y>0;return gc(l)&&gc(h)&&P}},f}($o),Cf={panStep:100,bearingStep:15,pitchStep:10},Js=function(){var u=Cf;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1};function Ss(u){return u*(2-u)}Js.prototype.reset=function(){this._active=!1},Js.prototype.keydown=function(u){var f=this;if(!(u.altKey||u.ctrlKey||u.metaKey)){var l=0,h=0,x=0,S=0,E=0;switch(u.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:u.shiftKey?h=-1:(u.preventDefault(),S=-1);break;case 39:u.shiftKey?h=1:(u.preventDefault(),S=1);break;case 38:u.shiftKey?x=1:(u.preventDefault(),E=-1);break;case 40:u.shiftKey?x=-1:(u.preventDefault(),E=1);break;default:return}return this._rotationDisabled&&(h=0,x=0),{cameraAnimation:function(P){var R=P.getZoom();P.easeTo({duration:300,easeId:"keyboardHandler",easing:Ss,zoom:l?Math.round(R)+l*(u.shiftKey?2:1):R,bearing:P.getBearing()+h*f._bearingStep,pitch:P.getPitch()+x*f._pitchStep,offset:[-S*f._panStep,-E*f._panStep],center:P.getCenter()},{originalEvent:u})}}}},Js.prototype.enable=function(){this._enabled=!0},Js.prototype.disable=function(){this._enabled=!1,this.reset()},Js.prototype.isEnabled=function(){return this._enabled},Js.prototype.isActive=function(){return this._active},Js.prototype.disableRotation=function(){this._rotationDisabled=!0},Js.prototype.enableRotation=function(){this._rotationDisabled=!1};var Xn=function(u,f){this._map=u,this._el=u.getCanvasContainer(),this._handler=f,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,v.bindAll(["_onTimeout"],this)};Xn.prototype.setZoomRate=function(u){this._defaultZoomRate=u},Xn.prototype.setWheelZoomRate=function(u){this._wheelZoomRate=u},Xn.prototype.isEnabled=function(){return!!this._enabled},Xn.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Xn.prototype.isZooming=function(){return!!this._zooming},Xn.prototype.enable=function(u){this.isEnabled()||(this._enabled=!0,this._aroundCenter=u&&u.around==="center")},Xn.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Xn.prototype.wheel=function(u){if(this.isEnabled()){var f=u.deltaMode===v.window.WheelEvent.DOM_DELTA_LINE?40*u.deltaY:u.deltaY,l=v.browser.now(),h=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,f!==0&&f%4.000244140625==0?this._type="wheel":f!==0&&Math.abs(f)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=f,this._timeout=setTimeout(this._onTimeout,40,u)):this._type||(this._type=Math.abs(h*f)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,f+=this._lastValue)),u.shiftKey&&f&&(f/=4),this._type&&(this._lastWheelEvent=u,this._delta-=f,this._active||this._start(u)),u.preventDefault()}},Xn.prototype._onTimeout=function(u){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(u)},Xn.prototype._start=function(u){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var f=Z.mousePos(this._el,u);this._around=v.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(f)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Xn.prototype.renderFrame=function(){var u=this;if(this._frameId&&(this._frameId=null,this.isActive())){var f=this._map.transform;if(this._delta!==0){var l=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*l)));this._delta<0&&h!==0&&(h=1/h);var x=typeof this._targetZoom=="number"?f.zoomScale(this._targetZoom):f.scale;this._targetZoom=Math.min(f.maxZoom,Math.max(f.minZoom,f.scaleZoom(x*h))),this._type==="wheel"&&(this._startZoom=f.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var S,E=typeof this._targetZoom=="number"?this._targetZoom:f.zoom,P=this._startZoom,R=this._easing,z=!1;if(this._type==="wheel"&&P&&R){var j=Math.min((v.browser.now()-this._lastWheelEventTime)/200,1),ee=R(j);S=v.number(P,E,ee),j<1?this._frameId||(this._frameId=!0):z=!0}else S=E,z=!0;return this._active=!0,z&&(this._active=!1,this._finishTimeout=setTimeout(function(){u._zooming=!1,u._handler._triggerRenderFrame(),delete u._targetZoom,delete u._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!z,zoomDelta:S-f.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Xn.prototype._smoothOutEasing=function(u){var f=v.ease;if(this._prevEase){var l=this._prevEase,h=(v.browser.now()-l.start)/l.duration,x=l.easing(h+.01)-l.easing(h),S=.27/Math.sqrt(x*x+1e-4)*.01,E=Math.sqrt(.0729-S*S);f=v.bezier(S,E,.25,1)}return this._prevEase={start:v.browser.now(),duration:u,easing:f},f},Xn.prototype.reset=function(){this._active=!1};var Qs=function(u,f){this._clickZoom=u,this._tapZoom=f};Qs.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Qs.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Qs.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Qs.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var to=function(){this.reset()};to.prototype.reset=function(){this._active=!1},to.prototype.dblclick=function(u,f){return u.preventDefault(),{cameraAnimation:function(l){l.easeTo({duration:300,zoom:l.getZoom()+(u.shiftKey?-1:1),around:l.unproject(f)},{originalEvent:u})}}},to.prototype.enable=function(){this._enabled=!0},to.prototype.disable=function(){this._enabled=!1,this.reset()},to.prototype.isEnabled=function(){return this._enabled},to.prototype.isActive=function(){return this._active};var Ma=function(){this._tap=new Fs({numTouches:1,numTaps:1}),this.reset()};Ma.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ma.prototype.touchstart=function(u,f,l){this._swipePoint||(this._tapTime&&u.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?l.length>0&&(this._swipePoint=f[0],this._swipeTouch=l[0].identifier):this._tap.touchstart(u,f,l))},Ma.prototype.touchmove=function(u,f,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;var h=f[0],x=h.y-this._swipePoint.y;return this._swipePoint=h,u.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(u,f,l)},Ma.prototype.touchend=function(u,f,l){this._tapTime?this._swipePoint&&l.length===0&&this.reset():this._tap.touchend(u,f,l)&&(this._tapTime=u.timeStamp)},Ma.prototype.touchcancel=function(){this.reset()},Ma.prototype.enable=function(){this._enabled=!0},Ma.prototype.disable=function(){this._enabled=!1,this.reset()},Ma.prototype.isEnabled=function(){return this._enabled},Ma.prototype.isActive=function(){return this._active};var Bo=function(u,f,l){this._el=u,this._mousePan=f,this._touchPan=l};Bo.prototype.enable=function(u){this._inertiaOptions=u||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Bo.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Bo.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Bo.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var No=function(u,f,l){this._pitchWithRotate=u.pitchWithRotate,this._mouseRotate=f,this._mousePitch=l};No.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},No.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},No.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},No.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var ls=function(u,f,l,h){this._el=u,this._touchZoom=f,this._touchRotate=l,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};ls.prototype.enable=function(u){this._touchZoom.enable(u),this._rotationDisabled||this._touchRotate.enable(u),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},ls.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},ls.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},ls.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},ls.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},ls.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var lo=function(u){return u.zoom||u.drag||u.pitch||u.rotate},_l=function(u){function f(){u.apply(this,arguments)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f}(v.Event);function nn(u){return u.panDelta&&u.panDelta.mag()||u.zoomDelta||u.bearingDelta||u.pitchDelta}var Wr=function(u,f){this._map=u,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yc(u),this._bearingSnap=f.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(f),v.bindAll(["handleEvent","handleWindowEvent"],this);var l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[v.window.document,"mousemove",{capture:!0}],[v.window.document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[v.window,"blur",void 0]];for(var h=0,x=this._listeners;h<x.length;h+=1){var S=x[h],E=S[0];Z.addEventListener(E,S[1],E===v.window.document?this.handleWindowEvent:this.handleEvent,S[2])}};Wr.prototype.destroy=function(){for(var u=0,f=this._listeners;u<f.length;u+=1){var l=f[u],h=l[0];Z.removeEventListener(h,l[1],h===v.window.document?this.handleWindowEvent:this.handleEvent,l[2])}},Wr.prototype._addDefaultHandlers=function(u){var f=this._map,l=f.getCanvasContainer();this._add("mapEvent",new Aa(f,u));var h=f.boxZoom=new os(f,u);this._add("boxZoom",h);var x=new ss,S=new to;f.doubleClickZoom=new Qs(S,x),this._add("tapZoom",x),this._add("clickZoom",S);var E=new Ma;this._add("tapDragZoom",E);var P=f.touchPitch=new ep;this._add("touchPitch",P);var R=new gl(u),z=new Wu(u);f.dragRotate=new No(u,R,z),this._add("mouseRotate",R,["mousePitch"]),this._add("mousePitch",z,["mouseRotate"]);var j=new bf(u),ee=new ws(u);f.dragPan=new Bo(l,j,ee),this._add("mousePan",j),this._add("touchPan",ee,["touchZoom","touchRotate"]);var ne=new Ef,Ae=new us;f.touchZoomRotate=new ls(l,Ae,ne,E),this._add("touchRotate",ne,["touchPan","touchZoom"]),this._add("touchZoom",Ae,["touchPan","touchRotate"]);var Se=f.scrollZoom=new Xn(f,this);this._add("scrollZoom",Se,["mousePan"]);var De=f.keyboard=new Js;this._add("keyboard",De),this._add("blockableMapEvent",new Gr(f));for(var _e=0,Fe=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];_e<Fe.length;_e+=1){var Ge=Fe[_e];u.interactive&&u[Ge]&&f[Ge].enable(u[Ge])}},Wr.prototype._add=function(u,f,l){this._handlers.push({handlerName:u,handler:f,allowed:l}),this._handlersById[u]=f},Wr.prototype.stop=function(u){if(!this._updatingCamera){for(var f=0,l=this._handlers;f<l.length;f+=1)l[f].handler.reset();this._inertia.clear(),this._fireEvents({},{},u),this._changes=[]}},Wr.prototype.isActive=function(){for(var u=0,f=this._handlers;u<f.length;u+=1)if(f[u].handler.isActive())return!0;return!1},Wr.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},Wr.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},Wr.prototype.isMoving=function(){return Boolean(lo(this._eventsInProgress))||this.isZooming()},Wr.prototype._blockedByActive=function(u,f,l){for(var h in u)if(h!==l&&(!f||f.indexOf(h)<0))return!0;return!1},Wr.prototype.handleWindowEvent=function(u){this.handleEvent(u,u.type+"Window")},Wr.prototype._getMapTouches=function(u){for(var f=[],l=0,h=u;l<h.length;l+=1){var x=h[l];this._el.contains(x.target)&&f.push(x)}return f},Wr.prototype.handleEvent=function(u,f){if(u.type!=="blur"){this._updatingCamera=!0;for(var l=u.type==="renderFrame"?void 0:u,h={needsRenderFrame:!1},x={},S={},E=u.touches?this._getMapTouches(u.touches):void 0,P=E?Z.touchPos(this._el,E):Z.mousePos(this._el,u),R=0,z=this._handlers;R<z.length;R+=1){var j=z[R],ee=j.handlerName,ne=j.handler,Ae=j.allowed;if(ne.isEnabled()){var Se=void 0;this._blockedByActive(S,Ae,ee)?ne.reset():ne[f||u.type]&&(Se=ne[f||u.type](u,P,E),this.mergeHandlerResult(h,x,Se,ee,l),Se&&Se.needsRenderFrame&&this._triggerRenderFrame()),(Se||ne.isActive())&&(S[ee]=ne)}}var De={};for(var _e in this._previousActiveHandlers)S[_e]||(De[_e]=l);this._previousActiveHandlers=S,(Object.keys(De).length||nn(h))&&(this._changes.push([h,x,De]),this._triggerRenderFrame()),(Object.keys(S).length||nn(h))&&this._map._stop(!0),this._updatingCamera=!1;var Fe=h.cameraAnimation;Fe&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],Fe(this._map))}else this.stop(!0)},Wr.prototype.mergeHandlerResult=function(u,f,l,h,x){if(l){v.extend(u,l);var S={handlerName:h,originalEvent:l.originalEvent||x};l.zoomDelta!==void 0&&(f.zoom=S),l.panDelta!==void 0&&(f.drag=S),l.pitchDelta!==void 0&&(f.pitch=S),l.bearingDelta!==void 0&&(f.rotate=S)}},Wr.prototype._applyChanges=function(){for(var u={},f={},l={},h=0,x=this._changes;h<x.length;h+=1){var S=x[h],E=S[0],P=S[1],R=S[2];E.panDelta&&(u.panDelta=(u.panDelta||new v.Point(0,0))._add(E.panDelta)),E.zoomDelta&&(u.zoomDelta=(u.zoomDelta||0)+E.zoomDelta),E.bearingDelta&&(u.bearingDelta=(u.bearingDelta||0)+E.bearingDelta),E.pitchDelta&&(u.pitchDelta=(u.pitchDelta||0)+E.pitchDelta),E.around!==void 0&&(u.around=E.around),E.pinchAround!==void 0&&(u.pinchAround=E.pinchAround),E.noInertia&&(u.noInertia=E.noInertia),v.extend(f,P),v.extend(l,R)}this._updateMapTransform(u,f,l),this._changes=[]},Wr.prototype._updateMapTransform=function(u,f,l){var h=this._map,x=h.transform;if(!nn(u))return this._fireEvents(f,l,!0);var S=u.panDelta,E=u.zoomDelta,P=u.bearingDelta,R=u.pitchDelta,z=u.around,j=u.pinchAround;j!==void 0&&(z=j),h._stop(!0),z=z||h.transform.centerPoint;var ee=x.pointLocation(S?z.sub(S):z);P&&(x.bearing+=P),R&&(x.pitch+=R),E&&(x.zoom+=E),x.setLocationAtPoint(ee,z),this._map._update(),u.noInertia||this._inertia.record(u),this._fireEvents(f,l,!0)},Wr.prototype._fireEvents=function(u,f,l){var h=this,x=lo(this._eventsInProgress),S=lo(u),E={};for(var P in u)this._eventsInProgress[P]||(E[P+"start"]=u[P].originalEvent),this._eventsInProgress[P]=u[P];for(var R in!x&&S&&this._fireEvent("movestart",S.originalEvent),E)this._fireEvent(R,E[R]);for(var z in S&&this._fireEvent("move",S.originalEvent),u)this._fireEvent(z,u[z].originalEvent);var j,ee={};for(var ne in this._eventsInProgress){var Ae=this._eventsInProgress[ne],Se=Ae.handlerName,De=Ae.originalEvent;this._handlersById[Se].isActive()||(delete this._eventsInProgress[ne],ee[ne+"end"]=j=f[Se]||De)}for(var _e in ee)this._fireEvent(_e,ee[_e]);var Fe=lo(this._eventsInProgress);if(l&&(x||S)&&!Fe){this._updatingCamera=!0;var Ge=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),at=function(Ct){return Ct!==0&&-h._bearingSnap<Ct&&Ct<h._bearingSnap};Ge?(at(Ge.bearing||this._map.getBearing())&&(Ge.bearing=0),this._map.easeTo(Ge,{originalEvent:j})):(this._map.fire(new v.Event("moveend",{originalEvent:j})),at(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},Wr.prototype._fireEvent=function(u,f){this._map.fire(new v.Event(u,f?{originalEvent:f}:{}))},Wr.prototype._requestFrame=function(){var u=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(f){delete u._frameId,u.handleEvent(new _l("renderFrame",{timeStamp:f})),u._applyChanges()})},Wr.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var _c=function(u){function f(l,h){u.call(this),this._moving=!1,this._zooming=!1,this.transform=l,this._bearingSnap=h.bearingSnap,v.bindAll(["_renderFrameCallback"],this)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.getCenter=function(){return new v.LngLat(this.transform.center.lng,this.transform.center.lat)},f.prototype.setCenter=function(l,h){return this.jumpTo({center:l},h)},f.prototype.panBy=function(l,h,x){return l=v.Point.convert(l).mult(-1),this.panTo(this.transform.center,v.extend({offset:l},h),x)},f.prototype.panTo=function(l,h,x){return this.easeTo(v.extend({center:l},h),x)},f.prototype.getZoom=function(){return this.transform.zoom},f.prototype.setZoom=function(l,h){return this.jumpTo({zoom:l},h),this},f.prototype.zoomTo=function(l,h,x){return this.easeTo(v.extend({zoom:l},h),x)},f.prototype.zoomIn=function(l,h){return this.zoomTo(this.getZoom()+1,l,h),this},f.prototype.zoomOut=function(l,h){return this.zoomTo(this.getZoom()-1,l,h),this},f.prototype.getBearing=function(){return this.transform.bearing},f.prototype.setBearing=function(l,h){return this.jumpTo({bearing:l},h),this},f.prototype.getPadding=function(){return this.transform.padding},f.prototype.setPadding=function(l,h){return this.jumpTo({padding:l},h),this},f.prototype.rotateTo=function(l,h,x){return this.easeTo(v.extend({bearing:l},h),x)},f.prototype.resetNorth=function(l,h){return this.rotateTo(0,v.extend({duration:1e3},l),h),this},f.prototype.resetNorthPitch=function(l,h){return this.easeTo(v.extend({bearing:0,pitch:0,duration:1e3},l),h),this},f.prototype.snapToNorth=function(l,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(l,h):this},f.prototype.getPitch=function(){return this.transform.pitch},f.prototype.setPitch=function(l,h){return this.jumpTo({pitch:l},h),this},f.prototype.cameraForBounds=function(l,h){l=v.LngLatBounds.convert(l);var x=h&&h.bearing||0;return this._cameraForBoxAndBearing(l.getNorthWest(),l.getSouthEast(),x,h)},f.prototype._cameraForBoxAndBearing=function(l,h,x,S){var E={top:0,bottom:0,right:0,left:0};if(typeof(S=v.extend({padding:E,offset:[0,0],maxZoom:this.transform.maxZoom},S)).padding=="number"){var P=S.padding;S.padding={top:P,bottom:P,right:P,left:P}}S.padding=v.extend(E,S.padding);var R=this.transform,z=R.padding,j=R.project(v.LngLat.convert(l)),ee=R.project(v.LngLat.convert(h)),ne=j.rotate(-x*Math.PI/180),Ae=ee.rotate(-x*Math.PI/180),Se=new v.Point(Math.max(ne.x,Ae.x),Math.max(ne.y,Ae.y)),De=new v.Point(Math.min(ne.x,Ae.x),Math.min(ne.y,Ae.y)),_e=Se.sub(De),Fe=(R.width-(z.left+z.right+S.padding.left+S.padding.right))/_e.x,Ge=(R.height-(z.top+z.bottom+S.padding.top+S.padding.bottom))/_e.y;if(!(Ge<0||Fe<0)){var at=Math.min(R.scaleZoom(R.scale*Math.min(Fe,Ge)),S.maxZoom),Ct=typeof S.offset.x=="number"?new v.Point(S.offset.x,S.offset.y):v.Point.convert(S.offset),wt=new v.Point((S.padding.left-S.padding.right)/2,(S.padding.top-S.padding.bottom)/2).rotate(x*Math.PI/180),Mt=Ct.add(wt).mult(R.scale/R.zoomScale(at));return{center:R.unproject(j.add(ee).div(2).sub(Mt)),zoom:at,bearing:x}}v.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},f.prototype.fitBounds=function(l,h,x){return this._fitInternal(this.cameraForBounds(l,h),h,x)},f.prototype.fitScreenCoordinates=function(l,h,x,S,E){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(v.Point.convert(l)),this.transform.pointLocation(v.Point.convert(h)),x,S),S,E)},f.prototype._fitInternal=function(l,h,x){return l?(delete(h=v.extend(l,h)).padding,h.linear?this.easeTo(h,x):this.flyTo(h,x)):this},f.prototype.jumpTo=function(l,h){this.stop();var x=this.transform,S=!1,E=!1,P=!1;return"zoom"in l&&x.zoom!==+l.zoom&&(S=!0,x.zoom=+l.zoom),l.center!==void 0&&(x.center=v.LngLat.convert(l.center)),"bearing"in l&&x.bearing!==+l.bearing&&(E=!0,x.bearing=+l.bearing),"pitch"in l&&x.pitch!==+l.pitch&&(P=!0,x.pitch=+l.pitch),l.padding==null||x.isPaddingEqual(l.padding)||(x.padding=l.padding),this.fire(new v.Event("movestart",h)).fire(new v.Event("move",h)),S&&this.fire(new v.Event("zoomstart",h)).fire(new v.Event("zoom",h)).fire(new v.Event("zoomend",h)),E&&this.fire(new v.Event("rotatestart",h)).fire(new v.Event("rotate",h)).fire(new v.Event("rotateend",h)),P&&this.fire(new v.Event("pitchstart",h)).fire(new v.Event("pitch",h)).fire(new v.Event("pitchend",h)),this.fire(new v.Event("moveend",h))},f.prototype.easeTo=function(l,h){var x=this;this._stop(!1,l.easeId),((l=v.extend({offset:[0,0],duration:500,easing:v.ease},l)).animate===!1||!l.essential&&v.browser.prefersReducedMotion)&&(l.duration=0);var S=this.transform,E=this.getZoom(),P=this.getBearing(),R=this.getPitch(),z=this.getPadding(),j="zoom"in l?+l.zoom:E,ee="bearing"in l?this._normalizeBearing(l.bearing,P):P,ne="pitch"in l?+l.pitch:R,Ae="padding"in l?l.padding:S.padding,Se=v.Point.convert(l.offset),De=S.centerPoint.add(Se),_e=S.pointLocation(De),Fe=v.LngLat.convert(l.center||_e);this._normalizeCenter(Fe);var Ge,at,Ct=S.project(_e),wt=S.project(Fe).sub(Ct),Mt=S.zoomScale(j-E);l.around&&(Ge=v.LngLat.convert(l.around),at=S.locationPoint(Ge));var qt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||j!==E,this._rotating=this._rotating||P!==ee,this._pitching=this._pitching||ne!==R,this._padding=!S.isPaddingEqual(Ae),this._easeId=l.easeId,this._prepareEase(h,l.noMoveStart,qt),this._ease(function(xr){if(x._zooming&&(S.zoom=v.number(E,j,xr)),x._rotating&&(S.bearing=v.number(P,ee,xr)),x._pitching&&(S.pitch=v.number(R,ne,xr)),x._padding&&(S.interpolatePadding(z,Ae,xr),De=S.centerPoint.add(Se)),Ge)S.setLocationAtPoint(Ge,at);else{var pr=S.zoomScale(S.zoom-E),Fr=j>E?Math.min(2,Mt):Math.max(.5,Mt),tn=Math.pow(Fr,1-xr),pn=S.unproject(Ct.add(wt.mult(xr*tn)).mult(pr));S.setLocationAtPoint(S.renderWorldCopies?pn.wrap():pn,De)}x._fireMoveEvents(h)},function(xr){x._afterEase(h,xr)},l),this},f.prototype._prepareEase=function(l,h,x){x===void 0&&(x={}),this._moving=!0,h||x.moving||this.fire(new v.Event("movestart",l)),this._zooming&&!x.zooming&&this.fire(new v.Event("zoomstart",l)),this._rotating&&!x.rotating&&this.fire(new v.Event("rotatestart",l)),this._pitching&&!x.pitching&&this.fire(new v.Event("pitchstart",l))},f.prototype._fireMoveEvents=function(l){this.fire(new v.Event("move",l)),this._zooming&&this.fire(new v.Event("zoom",l)),this._rotating&&this.fire(new v.Event("rotate",l)),this._pitching&&this.fire(new v.Event("pitch",l))},f.prototype._afterEase=function(l,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var x=this._zooming,S=this._rotating,E=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,x&&this.fire(new v.Event("zoomend",l)),S&&this.fire(new v.Event("rotateend",l)),E&&this.fire(new v.Event("pitchend",l)),this.fire(new v.Event("moveend",l))}},f.prototype.flyTo=function(l,h){var x=this;if(!l.essential&&v.browser.prefersReducedMotion){var S=v.pick(l,["center","zoom","bearing","pitch","around"]);return this.jumpTo(S,h)}this.stop(),l=v.extend({offset:[0,0],speed:1.2,curve:1.42,easing:v.ease},l);var E=this.transform,P=this.getZoom(),R=this.getBearing(),z=this.getPitch(),j=this.getPadding(),ee="zoom"in l?v.clamp(+l.zoom,E.minZoom,E.maxZoom):P,ne="bearing"in l?this._normalizeBearing(l.bearing,R):R,Ae="pitch"in l?+l.pitch:z,Se="padding"in l?l.padding:E.padding,De=E.zoomScale(ee-P),_e=v.Point.convert(l.offset),Fe=E.centerPoint.add(_e),Ge=E.pointLocation(Fe),at=v.LngLat.convert(l.center||Ge);this._normalizeCenter(at);var Ct=E.project(Ge),wt=E.project(at).sub(Ct),Mt=l.curve,qt=Math.max(E.width,E.height),xr=qt/De,pr=wt.mag();if("minZoom"in l){var Fr=v.clamp(Math.min(l.minZoom,P,ee),E.minZoom,E.maxZoom),tn=qt/E.zoomScale(Fr-P);Mt=Math.sqrt(tn/pr*2)}var pn=Mt*Mt;function ln(Sn){var _n=(xr*xr-qt*qt+(Sn?-1:1)*pn*pn*pr*pr)/(2*(Sn?xr:qt)*pn*pr);return Math.log(Math.sqrt(_n*_n+1)-_n)}function pi(Sn){return(Math.exp(Sn)-Math.exp(-Sn))/2}function yr(Sn){return(Math.exp(Sn)+Math.exp(-Sn))/2}var $r=ln(0),kn=function(Sn){return yr($r)/yr($r+Mt*Sn)},wn=function(Sn){return qt*((yr($r)*(pi(_n=$r+Mt*Sn)/yr(_n))-pi($r))/pn)/pr;var _n},vn=(ln(1)-$r)/Mt;if(Math.abs(pr)<1e-6||!isFinite(vn)){if(Math.abs(qt-xr)<1e-6)return this.easeTo(l,h);var Un=xr<qt?-1:1;vn=Math.abs(Math.log(xr/qt))/Mt,wn=function(){return 0},kn=function(Sn){return Math.exp(Un*Mt*Sn)}}return l.duration="duration"in l?+l.duration:1e3*vn/("screenSpeed"in l?+l.screenSpeed/Mt:+l.speed),l.maxDuration&&l.duration>l.maxDuration&&(l.duration=0),this._zooming=!0,this._rotating=R!==ne,this._pitching=Ae!==z,this._padding=!E.isPaddingEqual(Se),this._prepareEase(h,!1),this._ease(function(Sn){var _n=Sn*vn,Da=1/kn(_n);E.zoom=Sn===1?ee:P+E.scaleZoom(Da),x._rotating&&(E.bearing=v.number(R,ne,Sn)),x._pitching&&(E.pitch=v.number(z,Ae,Sn)),x._padding&&(E.interpolatePadding(j,Se,Sn),Fe=E.centerPoint.add(_e));var Wi=Sn===1?at:E.unproject(Ct.add(wt.mult(wn(_n))).mult(Da));E.setLocationAtPoint(E.renderWorldCopies?Wi.wrap():Wi,Fe),x._fireMoveEvents(h)},function(){return x._afterEase(h)},l),this},f.prototype.isEasing=function(){return!!this._easeFrameId},f.prototype.stop=function(){return this._stop()},f.prototype._stop=function(l,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var x=this._onEaseEnd;delete this._onEaseEnd,x.call(this,h)}if(!l){var S=this.handlers;S&&S.stop(!1)}return this},f.prototype._ease=function(l,h,x){x.animate===!1||x.duration===0?(l(1),h()):(this._easeStart=v.browser.now(),this._easeOptions=x,this._onEaseFrame=l,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},f.prototype._renderFrameCallback=function(){var l=Math.min((v.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},f.prototype._normalizeBearing=function(l,h){l=v.wrap(l,-180,180);var x=Math.abs(l-h);return Math.abs(l-360-h)<x&&(l-=360),Math.abs(l+360-h)<x&&(l+=360),l},f.prototype._normalizeCenter=function(l){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var x=l.lng-h.center.lng;l.lng+=x>180?-360:x<-180?360:0}},f}(v.Evented),wo=function(u){u===void 0&&(u={}),this.options=u,v.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};wo.prototype.getDefaultPosition=function(){return"bottom-right"},wo.prototype.onAdd=function(u){var f=this.options&&this.options.compact;return this._map=u,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),f&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),f===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},wo.prototype.onRemove=function(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},wo.prototype._setElementTitle=function(u,f){var l=this._map._getUIString("AttributionControl."+f);u.title=l,u.setAttribute("aria-label",l)},wo.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},wo.prototype._updateEditLink=function(){var u=this._editLink;u||(u=this._editLink=this._container.querySelector(".mapbox-improve-map"));var f=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||v.config.ACCESS_TOKEN}];if(u){var l=f.reduce(function(h,x,S){return x.value&&(h+=x.key+"="+x.value+(S<f.length-1?"&":"")),h},"?");u.href=v.config.FEEDBACK_URL+"/"+l+(this._map._hash?this._map._hash.getHashString(!0):""),u.rel="noopener nofollow",this._setElementTitle(u,"MapFeedback")}},wo.prototype._updateData=function(u){!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},wo.prototype._updateAttributions=function(){if(this._map.style){var u=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?u=u.concat(this.options.customAttribution.map(function(P){return typeof P!="string"?"":P})):typeof this.options.customAttribution=="string"&&u.push(this.options.customAttribution)),this._map.style.stylesheet){var f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}var l=this._map.style.sourceCaches;for(var h in l){var x=l[h];if(x.used){var S=x.getSource();S.attribution&&u.indexOf(S.attribution)<0&&u.push(S.attribution)}}u.sort(function(P,R){return P.length-R.length});var E=(u=u.filter(function(P,R){for(var z=R+1;z<u.length;z++)if(u[z].indexOf(P)>=0)return!1;return!0})).join(" | ");E!==this._attribHTML&&(this._attribHTML=E,u.length?(this._innerContainer.innerHTML=E,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},wo.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Ra=function(){v.bindAll(["_updateLogo"],this),v.bindAll(["_updateCompact"],this)};Ra.prototype.onAdd=function(u){this._map=u,this._container=Z.create("div","mapboxgl-ctrl");var f=Z.create("a","mapboxgl-ctrl-logo");return f.target="_blank",f.rel="noopener nofollow",f.href="https://www.mapbox.com/",f.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),f.setAttribute("rel","noopener nofollow"),this._container.appendChild(f),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Ra.prototype.onRemove=function(){Z.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Ra.prototype.getDefaultPosition=function(){return"bottom-left"},Ra.prototype._updateLogo=function(u){u&&u.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Ra.prototype._logoRequired=function(){if(this._map.style){var u=this._map.style.sourceCaches;for(var f in u)if(u[f].getSource().mapbox_logo)return!0;return!1}},Ra.prototype._updateCompact=function(){var u=this._container.children;if(u.length){var f=u[0];this._map.getCanvasContainer().offsetWidth<250?f.classList.add("mapboxgl-compact"):f.classList.remove("mapboxgl-compact")}};var ya=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};ya.prototype.add=function(u){var f=++this._id;return this._queue.push({callback:u,id:f,cancelled:!1}),f},ya.prototype.remove=function(u){for(var f=this._currentlyRunning,l=0,h=f?this._queue.concat(f):this._queue;l<h.length;l+=1){var x=h[l];if(x.id===u)return void(x.cancelled=!0)}},ya.prototype.run=function(u){u===void 0&&(u=0);var f=this._currentlyRunning=this._queue;this._queue=[];for(var l=0,h=f;l<h.length;l+=1){var x=h[l];if(!x.cancelled&&(x.callback(u),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},ya.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var ta={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Es=v.window.HTMLImageElement,xl=v.window.HTMLElement,fi=v.window.ImageBitmap,pa={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Hc=function(u){function f(h){var x=this;if((h=v.extend({},pa,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var S=new ii(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(u.call(this,S,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new ya,this._controls=[],this._mapId=v.uniqueId(),this._locale=v.extend({},ta,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new v.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=v.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof xl))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),v.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return x._update(!1)}),this.on("moveend",function(){return x._update(!1)}),this.on("zoom",function(){return x._update(!0)}),v.window!==void 0&&(v.window.addEventListener("online",this._onWindowOnline,!1),v.window.addEventListener("resize",this._onWindowResize,!1),v.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Wr(this,h),this._hash=h.hash&&new bs(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,v.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new wo({customAttribution:h.customAttribution})),this.addControl(new Ra,h.logoPosition),this.on("style.load",function(){x.transform.unmodified&&x.jumpTo(x.style.stylesheet)}),this.on("data",function(E){x._update(E.dataType==="style"),x.fire(new v.Event(E.dataType+"data",E))}),this.on("dataloading",function(E){x.fire(new v.Event(E.dataType+"dataloading",E))})}u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f;var l={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return f.prototype._getMapId=function(){return this._mapId},f.prototype.addControl=function(h,x){if(x===void 0&&(x=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var S=h.onAdd(this);this._controls.push(h);var E=this._controlPositions[x];return x.indexOf("bottom")!==-1?E.insertBefore(S,E.firstChild):E.appendChild(S),this},f.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new v.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var x=this._controls.indexOf(h);return x>-1&&this._controls.splice(x,1),h.onRemove(this),this},f.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},f.prototype.resize=function(h){var x=this._containerDimensions(),S=x[0],E=x[1];this._resizeCanvas(S,E),this.transform.resize(S,E),this.painter.resize(S,E);var P=!this._moving;return P&&(this.stop(),this.fire(new v.Event("movestart",h)).fire(new v.Event("move",h))),this.fire(new v.Event("resize",h)),P&&this.fire(new v.Event("moveend",h)),this},f.prototype.getBounds=function(){return this.transform.getBounds()},f.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},f.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(v.LngLatBounds.convert(h)),this._update()},f.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},f.prototype.getMinZoom=function(){return this.transform.minZoom},f.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},f.prototype.getMaxZoom=function(){return this.transform.maxZoom},f.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},f.prototype.getMinPitch=function(){return this.transform.minPitch},f.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},f.prototype.getMaxPitch=function(){return this.transform.maxPitch},f.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},f.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},f.prototype.project=function(h){return this.transform.locationPoint(v.LngLat.convert(h))},f.prototype.unproject=function(h){return this.transform.pointLocation(v.Point.convert(h))},f.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},f.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},f.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},f.prototype._createDelegatedListener=function(h,x,S){var E,P=this;if(h==="mouseenter"||h==="mouseover"){var R=!1;return{layer:x,listener:S,delegates:{mousemove:function(j){var ee=P.getLayer(x)?P.queryRenderedFeatures(j.point,{layers:[x]}):[];ee.length?R||(R=!0,S.call(P,new fa(h,P,j.originalEvent,{features:ee}))):R=!1},mouseout:function(){R=!1}}}}if(h==="mouseleave"||h==="mouseout"){var z=!1;return{layer:x,listener:S,delegates:{mousemove:function(j){(P.getLayer(x)?P.queryRenderedFeatures(j.point,{layers:[x]}):[]).length?z=!0:z&&(z=!1,S.call(P,new fa(h,P,j.originalEvent)))},mouseout:function(j){z&&(z=!1,S.call(P,new fa(h,P,j.originalEvent)))}}}}return{layer:x,listener:S,delegates:(E={},E[h]=function(j){var ee=P.getLayer(x)?P.queryRenderedFeatures(j.point,{layers:[x]}):[];ee.length&&(j.features=ee,S.call(P,j),delete j.features)},E)}},f.prototype.on=function(h,x,S){if(S===void 0)return u.prototype.on.call(this,h,x);var E=this._createDelegatedListener(h,x,S);for(var P in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(E),E.delegates)this.on(P,E.delegates[P]);return this},f.prototype.once=function(h,x,S){if(S===void 0)return u.prototype.once.call(this,h,x);var E=this._createDelegatedListener(h,x,S);for(var P in E.delegates)this.once(P,E.delegates[P]);return this},f.prototype.off=function(h,x,S){var E=this;return S===void 0?u.prototype.off.call(this,h,x):(this._delegatedListeners&&this._delegatedListeners[h]&&function(P){for(var R=P[h],z=0;z<R.length;z++){var j=R[z];if(j.layer===x&&j.listener===S){for(var ee in j.delegates)E.off(ee,j.delegates[ee]);return R.splice(z,1),E}}}(this._delegatedListeners),this)},f.prototype.queryRenderedFeatures=function(h,x){if(!this.style)return[];var S;if(x!==void 0||h===void 0||h instanceof v.Point||Array.isArray(h)||(x=h,h=void 0),x=x||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof v.Point||typeof h[0]=="number")S=[v.Point.convert(h)];else{var E=v.Point.convert(h[0]),P=v.Point.convert(h[1]);S=[E,new v.Point(P.x,E.y),P,new v.Point(E.x,P.y),E]}return this.style.queryRenderedFeatures(S,x,this.transform)},f.prototype.querySourceFeatures=function(h,x){return this.style.querySourceFeatures(h,x)},f.prototype.setStyle=function(h,x){return(x=v.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},x)).diff!==!1&&x.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,x),this):(this._localIdeographFontFamily=x.localIdeographFontFamily,this._updateStyle(h,x))},f.prototype._getUIString=function(h){var x=this._locale[h];if(x==null)throw new Error("Missing UI string '"+h+"'");return x},f.prototype._updateStyle=function(h,x){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new Po(this,x||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},f.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Po(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},f.prototype._diffStyle=function(h,x){var S=this;if(typeof h=="string"){var E=this._requestManager.normalizeStyleURL(h),P=this._requestManager.transformRequest(E,v.ResourceType.Style);v.getJSON(P,function(R,z){R?S.fire(new v.ErrorEvent(R)):z&&S._updateDiff(z,x)})}else typeof h=="object"&&this._updateDiff(h,x)},f.prototype._updateDiff=function(h,x){try{this.style.setState(h)&&this._update(!0)}catch(S){v.warnOnce("Unable to perform style diff: "+(S.message||S.error||S)+".  Rebuilding the style from scratch."),this._updateStyle(h,x)}},f.prototype.getStyle=function(){if(this.style)return this.style.serialize()},f.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():v.warnOnce("There is no style added to the map.")},f.prototype.addSource=function(h,x){return this._lazyInitEmptyStyle(),this.style.addSource(h,x),this._update(!0)},f.prototype.isSourceLoaded=function(h){var x=this.style&&this.style.sourceCaches[h];if(x!==void 0)return x.loaded();this.fire(new v.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},f.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var x in h){var S=h[x]._tiles;for(var E in S){var P=S[E];if(P.state!=="loaded"&&P.state!=="errored")return!1}}return!0},f.prototype.addSourceType=function(h,x,S){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,x,S)},f.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},f.prototype.getSource=function(h){return this.style.getSource(h)},f.prototype.addImage=function(h,x,S){S===void 0&&(S={});var E=S.pixelRatio;E===void 0&&(E=1);var P=S.sdf;P===void 0&&(P=!1);var R=S.stretchX,z=S.stretchY,j=S.content;if(this._lazyInitEmptyStyle(),x instanceof Es||fi&&x instanceof fi){var ee=v.browser.getImageData(x);this.style.addImage(h,{data:new v.RGBAImage({width:ee.width,height:ee.height},ee.data),pixelRatio:E,stretchX:R,stretchY:z,content:j,sdf:P,version:0})}else{if(x.width===void 0||x.height===void 0)return this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var ne=x;this.style.addImage(h,{data:new v.RGBAImage({width:x.width,height:x.height},new Uint8Array(x.data)),pixelRatio:E,stretchX:R,stretchY:z,content:j,sdf:P,version:0,userImage:ne}),ne.onAdd&&ne.onAdd(this,h)}},f.prototype.updateImage=function(h,x){var S=this.style.getImage(h);if(!S)return this.fire(new v.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var E=x instanceof Es||fi&&x instanceof fi?v.browser.getImageData(x):x,P=E.width,R=E.height,z=E.data;return P===void 0||R===void 0?this.fire(new v.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):P!==S.data.width||R!==S.data.height?this.fire(new v.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(S.data.replace(z,!(x instanceof Es||fi&&x instanceof fi)),void this.style.updateImage(h,S))},f.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new v.ErrorEvent(new Error("Missing required image id"))),!1)},f.prototype.removeImage=function(h){this.style.removeImage(h)},f.prototype.loadImage=function(h,x){v.getImage(this._requestManager.transformRequest(h,v.ResourceType.Image),x)},f.prototype.listImages=function(){return this.style.listImages()},f.prototype.addLayer=function(h,x){return this._lazyInitEmptyStyle(),this.style.addLayer(h,x),this._update(!0)},f.prototype.moveLayer=function(h,x){return this.style.moveLayer(h,x),this._update(!0)},f.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},f.prototype.getLayer=function(h){return this.style.getLayer(h)},f.prototype.setLayerZoomRange=function(h,x,S){return this.style.setLayerZoomRange(h,x,S),this._update(!0)},f.prototype.setFilter=function(h,x,S){return S===void 0&&(S={}),this.style.setFilter(h,x,S),this._update(!0)},f.prototype.getFilter=function(h){return this.style.getFilter(h)},f.prototype.setPaintProperty=function(h,x,S,E){return E===void 0&&(E={}),this.style.setPaintProperty(h,x,S,E),this._update(!0)},f.prototype.getPaintProperty=function(h,x){return this.style.getPaintProperty(h,x)},f.prototype.setLayoutProperty=function(h,x,S,E){return E===void 0&&(E={}),this.style.setLayoutProperty(h,x,S,E),this._update(!0)},f.prototype.getLayoutProperty=function(h,x){return this.style.getLayoutProperty(h,x)},f.prototype.setLight=function(h,x){return x===void 0&&(x={}),this._lazyInitEmptyStyle(),this.style.setLight(h,x),this._update(!0)},f.prototype.getLight=function(){return this.style.getLight()},f.prototype.setFeatureState=function(h,x){return this.style.setFeatureState(h,x),this._update()},f.prototype.removeFeatureState=function(h,x){return this.style.removeFeatureState(h,x),this._update()},f.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},f.prototype.getContainer=function(){return this._container},f.prototype.getCanvasContainer=function(){return this._canvasContainer},f.prototype.getCanvas=function(){return this._canvas},f.prototype._containerDimensions=function(){var h=0,x=0;return this._container&&(h=this._container.clientWidth||400,x=this._container.clientHeight||300),[h,x]},f.prototype._detectMissingCSS=function(){v.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&v.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},f.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var x=this._canvasContainer=Z.create("div","mapboxgl-canvas-container",h);this._interactive&&x.classList.add("mapboxgl-interactive"),this._canvas=Z.create("canvas","mapboxgl-canvas",x),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var S=this._containerDimensions();this._resizeCanvas(S[0],S[1]);var E=this._controlContainer=Z.create("div","mapboxgl-control-container",h),P=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(R){P[R]=Z.create("div","mapboxgl-ctrl-"+R,E)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},f.prototype._resizeCanvas=function(h,x){var S=v.browser.devicePixelRatio||1;this._canvas.width=S*h,this._canvas.height=S*x,this._canvas.style.width=h+"px",this._canvas.style.height=x+"px"},f.prototype._setupPainter=function(){var h=v.extend({},ye.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),x=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);x?(this.painter=new Kr(x,this.transform),v.webpSupported.testSupport(x)):this.fire(new v.ErrorEvent(new Error("Failed to initialize WebGL")))},f.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new v.Event("webglcontextlost",{originalEvent:h}))},f.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new v.Event("webglcontextrestored",{originalEvent:h}))},f.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},f.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},f.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},f.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},f.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},f.prototype._render=function(h){var x,S=this,E=0,P=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(x=P.createQueryEXT(),P.beginQueryEXT(P.TIME_ELAPSED_EXT,x),E=v.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var R=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var z=this.transform.zoom,j=v.browser.now();this.style.zoomHistory.update(z,j);var ee=new v.EvaluationParameters(z,{now:j,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),ne=ee.crossFadingFactor();ne===1&&ne===this._crossFadingFactor||(R=!0,this._crossFadingFactor=ne),this.style.update(ee)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new v.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new v.Event("load"))),this.style&&(this.style.hasTransitions()||R)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ae=v.browser.now()-E;P.endQueryEXT(P.TIME_ELAPSED_EXT,x),setTimeout(function(){var _e=P.getQueryObjectEXT(x,P.QUERY_RESULT_EXT)/1e6;P.deleteQueryEXT(x),S.fire(new v.Event("gpu-timing-frame",{cpuTime:Ae,gpuTime:_e}))},50)}if(this.listens("gpu-timing-layer")){var Se=this.painter.collectGpuTimers();setTimeout(function(){var _e=S.painter.queryGpuTimers(Se);S.fire(new v.Event("gpu-timing-layer",{layerTimes:_e}))},50)}var De=this._sourcesDirty||this._styleDirty||this._placementDirty;return De||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new v.Event("idle")),!this._loaded||this._fullyLoaded||De||(this._fullyLoaded=!0),this}},f.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,x=this._controls;h<x.length;h+=1)x[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),v.window!==void 0&&(v.window.removeEventListener("resize",this._onWindowResize,!1),v.window.removeEventListener("orientationchange",this._onWindowResize,!1),v.window.removeEventListener("online",this._onWindowOnline,!1));var S=this.painter.context.gl.getExtension("WEBGL_lose_context");S&&S.loseContext(),Yu(this._canvasContainer),Yu(this._controlContainer),Yu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new v.Event("remove"))},f.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=v.browser.frame(function(x){h._frame=null,h._render(x)}))},f.prototype._onWindowOnline=function(){this._update()},f.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},l.showTileBoundaries.get=function(){return!!this._showTileBoundaries},l.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},l.showPadding.get=function(){return!!this._showPadding},l.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},l.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},l.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},l.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},l.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},l.repaint.get=function(){return!!this._repaint},l.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},l.vertices.get=function(){return!!this._vertices},l.vertices.set=function(h){this._vertices=h,this._update()},f.prototype._setCacheLimits=function(h,x){v.setCacheLimits(h,x)},l.version.get=function(){return v.version},Object.defineProperties(f.prototype,l),f}(_c);function Yu(u){u.parentNode&&u.parentNode.removeChild(u)}var Wc={showCompass:!0,showZoom:!0,visualizePitch:!1},eu=function(u){var f=this;this.options=v.extend({},Wc,u),this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(l){return l.preventDefault()}),this.options.showZoom&&(v.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(l){return f._map.zoomIn({},{originalEvent:l})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(l){return f._map.zoomOut({},{originalEvent:l})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(v.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(l){f.options.visualizePitch?f._map.resetNorthPitch({},{originalEvent:l}):f._map.resetNorth({},{originalEvent:l})}),this._compassIcon=Z.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};eu.prototype._updateZoomButtons=function(){var u=this._map.getZoom(),f=u===this._map.getMaxZoom(),l=u===this._map.getMinZoom();this._zoomInButton.disabled=f,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",f.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},eu.prototype._rotateCompassArrow=function(){var u=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=u},eu.prototype.onAdd=function(u){return this._map=u,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zo(this._map,this._compass,this.options.visualizePitch)),this._container},eu.prototype.onRemove=function(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},eu.prototype._createButton=function(u,f){var l=Z.create("button",u,this._container);return l.type="button",l.addEventListener("click",f),l},eu.prototype._setButtonTitle=function(u,f){var l=this._map._getUIString("NavigationControl."+f);u.title=l,u.setAttribute("aria-label",l)};var zo=function(u,f,l){l===void 0&&(l=!1),this._clickTolerance=10,this.element=f,this.mouseRotate=new gl({clickTolerance:u.dragRotate._mouseRotate._clickTolerance}),this.map=u,l&&(this.mousePitch=new Wu({clickTolerance:u.dragRotate._mousePitch._clickTolerance})),v.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Z.addEventListener(f,"mousedown",this.mousedown),Z.addEventListener(f,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(f,"touchmove",this.touchmove),Z.addEventListener(f,"touchend",this.touchend),Z.addEventListener(f,"touchcancel",this.reset)};function Zo(u,f,l){if(u=new v.LngLat(u.lng,u.lat),f){var h=new v.LngLat(u.lng-360,u.lat),x=new v.LngLat(u.lng+360,u.lat),S=l.locationPoint(u).distSqr(f);l.locationPoint(h).distSqr(f)<S?u=h:l.locationPoint(x).distSqr(f)<S&&(u=x)}for(;Math.abs(u.lng-l.center.lng)>180;){var E=l.locationPoint(u);if(E.x>=0&&E.y>=0&&E.x<=l.width&&E.y<=l.height)break;u.lng>l.center.lng?u.lng-=360:u.lng+=360}return u}zo.prototype.down=function(u,f){this.mouseRotate.mousedown(u,f),this.mousePitch&&this.mousePitch.mousedown(u,f),Z.disableDrag()},zo.prototype.move=function(u,f){var l=this.map,h=this.mouseRotate.mousemoveWindow(u,f);if(h&&h.bearingDelta&&l.setBearing(l.getBearing()+h.bearingDelta),this.mousePitch){var x=this.mousePitch.mousemoveWindow(u,f);x&&x.pitchDelta&&l.setPitch(l.getPitch()+x.pitchDelta)}},zo.prototype.off=function(){var u=this.element;Z.removeEventListener(u,"mousedown",this.mousedown),Z.removeEventListener(u,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(u,"touchmove",this.touchmove),Z.removeEventListener(u,"touchend",this.touchend),Z.removeEventListener(u,"touchcancel",this.reset),this.offTemp()},zo.prototype.offTemp=function(){Z.enableDrag(),Z.removeEventListener(v.window,"mousemove",this.mousemove),Z.removeEventListener(v.window,"mouseup",this.mouseup)},zo.prototype.mousedown=function(u){this.down(v.extend({},u,{ctrlKey:!0,preventDefault:function(){return u.preventDefault()}}),Z.mousePos(this.element,u)),Z.addEventListener(v.window,"mousemove",this.mousemove),Z.addEventListener(v.window,"mouseup",this.mouseup)},zo.prototype.mousemove=function(u){this.move(u,Z.mousePos(this.element,u))},zo.prototype.mouseup=function(u){this.mouseRotate.mouseupWindow(u),this.mousePitch&&this.mousePitch.mouseupWindow(u),this.offTemp()},zo.prototype.touchstart=function(u){u.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,u.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return u.preventDefault()}},this._startPos))},zo.prototype.touchmove=function(u){u.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,u.targetTouches)[0],this.move({preventDefault:function(){return u.preventDefault()}},this._lastPos))},zo.prototype.touchend=function(u){u.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},zo.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var tu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function ga(u,f,l){var h=u.classList;for(var x in tu)h.remove("mapboxgl-"+l+"-anchor-"+x);h.add("mapboxgl-"+l+"-anchor-"+f)}var re,Xl=function(u){function f(l,h){if(u.call(this),(l instanceof v.window.HTMLElement||h)&&(l=v.extend({element:l},h)),v.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=l&&l.anchor||"center",this._color=l&&l.color||"#3FB1CE",this._scale=l&&l.scale||1,this._draggable=l&&l.draggable||!1,this._clickTolerance=l&&l.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=l&&l.rotation||0,this._rotationAlignment=l&&l.rotationAlignment||"auto",this._pitchAlignment=l&&l.pitchAlignment&&l.pitchAlignment!=="auto"?l.pitchAlignment:this._rotationAlignment,l&&l.element)this._element=l.element,this._offset=v.Point.convert(l&&l.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div"),this._element.setAttribute("aria-label","Map marker");var x=Z.createNS("http://www.w3.org/2000/svg","svg");x.setAttributeNS(null,"display","block"),x.setAttributeNS(null,"height","41px"),x.setAttributeNS(null,"width","27px"),x.setAttributeNS(null,"viewBox","0 0 27 41");var S=Z.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");var E=Z.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"fill-rule","nonzero");var P=Z.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");for(var R=0,z=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];R<z.length;R+=1){var j=z[R],ee=Z.createNS("http://www.w3.org/2000/svg","ellipse");ee.setAttributeNS(null,"opacity","0.04"),ee.setAttributeNS(null,"cx","10.5"),ee.setAttributeNS(null,"cy","5.80029008"),ee.setAttributeNS(null,"rx",j.rx),ee.setAttributeNS(null,"ry",j.ry),P.appendChild(ee)}var ne=Z.createNS("http://www.w3.org/2000/svg","g");ne.setAttributeNS(null,"fill",this._color);var Ae=Z.createNS("http://www.w3.org/2000/svg","path");Ae.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),ne.appendChild(Ae);var Se=Z.createNS("http://www.w3.org/2000/svg","g");Se.setAttributeNS(null,"opacity","0.25"),Se.setAttributeNS(null,"fill","#000000");var De=Z.createNS("http://www.w3.org/2000/svg","path");De.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Se.appendChild(De);var _e=Z.createNS("http://www.w3.org/2000/svg","g");_e.setAttributeNS(null,"transform","translate(6.0, 7.0)"),_e.setAttributeNS(null,"fill","#FFFFFF");var Fe=Z.createNS("http://www.w3.org/2000/svg","g");Fe.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Ge=Z.createNS("http://www.w3.org/2000/svg","circle");Ge.setAttributeNS(null,"fill","#000000"),Ge.setAttributeNS(null,"opacity","0.25"),Ge.setAttributeNS(null,"cx","5.5"),Ge.setAttributeNS(null,"cy","5.5"),Ge.setAttributeNS(null,"r","5.4999962");var at=Z.createNS("http://www.w3.org/2000/svg","circle");at.setAttributeNS(null,"fill","#FFFFFF"),at.setAttributeNS(null,"cx","5.5"),at.setAttributeNS(null,"cy","5.5"),at.setAttributeNS(null,"r","5.4999962"),Fe.appendChild(Ge),Fe.appendChild(at),E.appendChild(P),E.appendChild(ne),E.appendChild(Se),E.appendChild(_e),E.appendChild(Fe),x.appendChild(E),x.setAttributeNS(null,"height",41*this._scale+"px"),x.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(x),this._offset=v.Point.convert(l&&l.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(Ct){Ct.preventDefault()}),this._element.addEventListener("mousedown",function(Ct){Ct.preventDefault()}),ga(this._element,this._anchor,"marker"),this._popup=null}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.addTo=function(l){return this.remove(),this._map=l,l.getCanvasContainer().appendChild(this._element),l.on("move",this._update),l.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},f.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(l){return this._lngLat=v.LngLat.convert(l),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},f.prototype.getElement=function(){return this._element},f.prototype.setPopup=function(l){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),l){if(!("offset"in l.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);l.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=l,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},f.prototype._onKeyPress=function(l){var h=l.code,x=l.charCode||l.keyCode;h!=="Space"&&h!=="Enter"&&x!==32&&x!==13||this.togglePopup()},f.prototype._onMapClick=function(l){var h=l.originalEvent.target,x=this._element;this._popup&&(h===x||x.contains(h))&&this.togglePopup()},f.prototype.getPopup=function(){return this._popup},f.prototype.togglePopup=function(){var l=this._popup;return l?(l.isOpen()?l.remove():l.addTo(this._map),this):this},f.prototype._update=function(l){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Zo(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var x="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?x="rotateX(0deg)":this._pitchAlignment==="map"&&(x="rotateX("+this._map.getPitch()+"deg)"),l&&l.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,tu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+x+" "+h)}},f.prototype.getOffset=function(){return this._offset},f.prototype.setOffset=function(l){return this._offset=v.Point.convert(l),this._update(),this},f.prototype._onMove=function(l){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=l.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=l.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new v.Event("dragstart"))),this.fire(new v.Event("drag")))},f.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new v.Event("dragend")),this._state="inactive"},f.prototype._addDragHandler=function(l){this._element.contains(l.originalEvent.target)&&(l.preventDefault(),this._positionDelta=l.point.sub(this._pos).add(this._offset),this._pointerdownPos=l.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},f.prototype.setDraggable=function(l){return this._draggable=!!l,this._map&&(l?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},f.prototype.isDraggable=function(){return this._draggable},f.prototype.setRotation=function(l){return this._rotation=l||0,this._update(),this},f.prototype.getRotation=function(){return this._rotation},f.prototype.setRotationAlignment=function(l){return this._rotationAlignment=l||"auto",this._update(),this},f.prototype.getRotationAlignment=function(){return this._rotationAlignment},f.prototype.setPitchAlignment=function(l){return this._pitchAlignment=l&&l!=="auto"?l:this._rotationAlignment,this._update(),this},f.prototype.getPitchAlignment=function(){return this._pitchAlignment},f}(v.Evented),Xc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},bl=0,Au=!1,xc=function(u){function f(l){u.call(this),this.options=v.extend({},Xc,l),v.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.onAdd=function(l){var h;return this._map=l,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,re!==void 0?h(re):v.window.navigator.permissions!==void 0?v.window.navigator.permissions.query({name:"geolocation"}).then(function(x){h(re=x.state!=="denied")}):h(re=!!v.window.navigator.geolocation),this._container},f.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,bl=0,Au=!1},f.prototype._isOutOfMapMaxBounds=function(l){var h=this._map.getMaxBounds(),x=l.coords;return h&&(x.longitude<h.getWest()||x.longitude>h.getEast()||x.latitude<h.getSouth()||x.latitude>h.getNorth())},f.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},f.prototype._onSuccess=function(l){if(this._map){if(this._isOutOfMapMaxBounds(l))return this._setErrorState(),this.fire(new v.Event("outofmaxbounds",l)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=l,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(l),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(l),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("geolocate",l)),this._finish()}},f.prototype._updateCamera=function(l){var h=new v.LngLat(l.coords.longitude,l.coords.latitude),x=l.coords.accuracy,S=this._map.getBearing(),E=v.extend({bearing:S},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(x),E,{geolocateSource:!0})},f.prototype._updateMarker=function(l){if(l){var h=new v.LngLat(l.coords.longitude,l.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=l.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},f.prototype._updateCircleRadius=function(){var l=this._map._container.clientHeight/2,h=this._map.unproject([0,l]),x=this._map.unproject([1,l]),S=h.distanceTo(x),E=Math.ceil(2*this._accuracy/S);this._circleElement.style.width=E+"px",this._circleElement.style.height=E+"px"},f.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},f.prototype._onError=function(l){if(this._map){if(this.options.trackUserLocation)if(l.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(l.code===3&&Au)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new v.Event("error",l)),this._finish()}},f.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},f.prototype._setupUI=function(l){var h=this;if(this._container.addEventListener("contextmenu",function(E){return E.preventDefault()}),this._geolocateButton=Z.create("button","mapboxgl-ctrl-geolocate",this._container),Z.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",l===!1){v.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var x=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=x,this._geolocateButton.setAttribute("aria-label",x)}else{var S=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Xl(this._dotElement),this._circleElement=Z.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Xl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(E){E.geolocateSource||h._watchState!=="ACTIVE_LOCK"||E.originalEvent&&E.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new v.Event("trackuserlocationend")))})},f.prototype.trigger=function(){if(!this._setup)return v.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new v.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":bl--,Au=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new v.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new v.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var l;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++bl>1?(l={maximumAge:6e5,timeout:0},Au=!0):(l=this.options.positionOptions,Au=!1),this._geolocationWatchID=v.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,l)}}else v.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},f.prototype._clearWatch=function(){v.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},f}(v.Evented),Mu={maxWidth:100,unit:"metric"},cs=function(u){this.options=v.extend({},Mu,u),v.bindAll(["_onMove","setUnit"],this)};function wl(u,f,l){var h=l&&l.maxWidth||100,x=u._container.clientHeight/2,S=u.unproject([0,x]),E=u.unproject([h,x]),P=S.distanceTo(E);if(l&&l.unit==="imperial"){var R=3.2808*P;R>5280?Cs(f,h,R/5280,u._getUIString("ScaleControl.Miles")):Cs(f,h,R,u._getUIString("ScaleControl.Feet"))}else l&&l.unit==="nautical"?Cs(f,h,P/1852,u._getUIString("ScaleControl.NauticalMiles")):P>=1e3?Cs(f,h,P/1e3,u._getUIString("ScaleControl.Kilometers")):Cs(f,h,P,u._getUIString("ScaleControl.Meters"))}function Cs(u,f,l,h){var x,S,E,P=(x=l,(S=Math.pow(10,(""+Math.floor(x)).length-1))*(E=(E=x/S)>=10?10:E>=5?5:E>=3?3:E>=2?2:E>=1?1:function(R){var z=Math.pow(10,Math.ceil(-Math.log(R)/Math.LN10));return Math.round(R*z)/z}(E)));u.style.width=f*(P/l)+"px",u.innerHTML=P+"&nbsp;"+h}cs.prototype.getDefaultPosition=function(){return"bottom-left"},cs.prototype._onMove=function(){wl(this._map,this._container,this.options)},cs.prototype.onAdd=function(u){return this._map=u,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",u.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},cs.prototype.onRemove=function(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},cs.prototype.setUnit=function(u){this.options.unit=u,wl(this._map,this._container,this.options)};var fs=function(u){this._fullscreen=!1,u&&u.container&&(u.container instanceof v.window.HTMLElement?this._container=u.container:v.warnOnce("Full screen control 'container' must be a DOM element.")),v.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in v.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in v.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in v.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in v.window.document&&(this._fullscreenchange="MSFullscreenChange")};fs.prototype.onAdd=function(u){return this._map=u,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",v.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},fs.prototype.onRemove=function(){Z.remove(this._controlContainer),this._map=null,v.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},fs.prototype._checkFullscreenSupport=function(){return!!(v.window.document.fullscreenEnabled||v.window.document.mozFullScreenEnabled||v.window.document.msFullscreenEnabled||v.window.document.webkitFullscreenEnabled)},fs.prototype._setupUI=function(){var u=this._fullscreenButton=Z.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z.create("span","mapboxgl-ctrl-icon",u).setAttribute("aria-hidden",!0),u.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),v.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},fs.prototype._updateTitle=function(){var u=this._getTitle();this._fullscreenButton.setAttribute("aria-label",u),this._fullscreenButton.title=u},fs.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},fs.prototype._isFullscreen=function(){return this._fullscreen},fs.prototype._changeIcon=function(){(v.window.document.fullscreenElement||v.window.document.mozFullScreenElement||v.window.document.webkitFullscreenElement||v.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},fs.prototype._onClickFullscreen=function(){this._isFullscreen()?v.window.document.exitFullscreen?v.window.document.exitFullscreen():v.window.document.mozCancelFullScreen?v.window.document.mozCancelFullScreen():v.window.document.msExitFullscreen?v.window.document.msExitFullscreen():v.window.document.webkitCancelFullScreen&&v.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Yc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Yl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),qc=function(u){function f(l){u.call(this),this.options=v.extend(Object.create(Yc),l),v.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return u&&(f.__proto__=u),(f.prototype=Object.create(u&&u.prototype)).constructor=f,f.prototype.addTo=function(l){return this._map&&this.remove(),this._map=l,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new v.Event("open")),this},f.prototype.isOpen=function(){return!!this._map},f.prototype.remove=function(){return this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new v.Event("close")),this},f.prototype.getLngLat=function(){return this._lngLat},f.prototype.setLngLat=function(l){return this._lngLat=v.LngLat.convert(l),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},f.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},f.prototype.getElement=function(){return this._container},f.prototype.setText=function(l){return this.setDOMContent(v.window.document.createTextNode(l))},f.prototype.setHTML=function(l){var h,x=v.window.document.createDocumentFragment(),S=v.window.document.createElement("body");for(S.innerHTML=l;h=S.firstChild;)x.appendChild(h);return this.setDOMContent(x)},f.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},f.prototype.setMaxWidth=function(l){return this.options.maxWidth=l,this._update(),this},f.prototype.setDOMContent=function(l){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(l),this._createCloseButton(),this._update(),this._focusFirstElement(),this},f.prototype.addClassName=function(l){this._container&&this._container.classList.add(l)},f.prototype.removeClassName=function(l){this._container&&this._container.classList.remove(l)},f.prototype.setOffset=function(l){return this.options.offset=l,this._update(),this},f.prototype.toggleClassName=function(l){if(this._container)return this._container.classList.toggle(l)},f.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Z.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},f.prototype._onMouseUp=function(l){this._update(l.point)},f.prototype._onMouseMove=function(l){this._update(l.point)},f.prototype._onDrag=function(l){this._update(l.point)},f.prototype._update=function(l){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Z.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Z.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ee){return h._container.classList.add(ee)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Zo(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||l)){var x=this._pos=this._trackPointer&&l?l:this._map.project(this._lngLat),S=this.options.anchor,E=function ee(ne){if(ne){if(typeof ne=="number"){var Ae=Math.round(Math.sqrt(.5*Math.pow(ne,2)));return{center:new v.Point(0,0),top:new v.Point(0,ne),"top-left":new v.Point(Ae,Ae),"top-right":new v.Point(-Ae,Ae),bottom:new v.Point(0,-ne),"bottom-left":new v.Point(Ae,-Ae),"bottom-right":new v.Point(-Ae,-Ae),left:new v.Point(ne,0),right:new v.Point(-ne,0)}}if(ne instanceof v.Point||Array.isArray(ne)){var Se=v.Point.convert(ne);return{center:Se,top:Se,"top-left":Se,"top-right":Se,bottom:Se,"bottom-left":Se,"bottom-right":Se,left:Se,right:Se}}return{center:v.Point.convert(ne.center||[0,0]),top:v.Point.convert(ne.top||[0,0]),"top-left":v.Point.convert(ne["top-left"]||[0,0]),"top-right":v.Point.convert(ne["top-right"]||[0,0]),bottom:v.Point.convert(ne.bottom||[0,0]),"bottom-left":v.Point.convert(ne["bottom-left"]||[0,0]),"bottom-right":v.Point.convert(ne["bottom-right"]||[0,0]),left:v.Point.convert(ne.left||[0,0]),right:v.Point.convert(ne.right||[0,0])}}return ee(new v.Point(0,0))}(this.options.offset);if(!S){var P,R=this._container.offsetWidth,z=this._container.offsetHeight;P=x.y+E.bottom.y<z?["top"]:x.y>this._map.transform.height-z?["bottom"]:[],x.x<R/2?P.push("left"):x.x>this._map.transform.width-R/2&&P.push("right"),S=P.length===0?"bottom":P.join("-")}var j=x.add(E[S]).round();Z.setTransform(this._container,tu[S]+" translate("+j.x+"px,"+j.y+"px)"),ga(this._container,S,"popup")}},f.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var l=this._container.querySelector(Yl);l&&l.focus()}},f.prototype._onClose=function(){this.remove()},f}(v.Evented),Kc={version:v.version,supported:ye,setRTLTextPlugin:v.setRTLTextPlugin,getRTLTextPluginStatus:v.getRTLTextPluginStatus,Map:Hc,NavigationControl:eu,GeolocateControl:xc,AttributionControl:wo,ScaleControl:cs,FullscreenControl:fs,Popup:qc,Marker:Xl,Style:Po,LngLat:v.LngLat,LngLatBounds:v.LngLatBounds,Point:v.Point,MercatorCoordinate:v.MercatorCoordinate,Evented:v.Evented,config:v.config,prewarm:function(){Dt().acquire(pt)},clearPrewarmedResources:function(){var u=Hr;u&&(u.isPreloaded()&&u.numActive()===1?(u.release(pt),Hr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return v.config.ACCESS_TOKEN},set accessToken(u){v.config.ACCESS_TOKEN=u},get baseApiUrl(){return v.config.API_URL},set baseApiUrl(u){v.config.API_URL=u},get workerCount(){return tr.workerCount},set workerCount(u){tr.workerCount=u},get maxParallelImageRequests(){return v.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(u){v.config.MAX_PARALLEL_IMAGE_REQUESTS=u},clearStorage:function(u){v.clearTileCache(u)},workerUrl:""};return Kc}),Me})},28660:function(hr,X,G){var Me=G(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var ve;(function(v){(function(ye){var Z=typeof G.g=="object"?G.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),oe=me(v);typeof Z.Reflect=="undefined"?Z.Reflect=v:oe=me(Z.Reflect,oe),ye(oe);function me(ie,fe){return function(J,be){typeof ie[J]!="function"&&Object.defineProperty(ie,J,{configurable:!0,writable:!0,value:be}),fe&&fe(J,be)}}})(function(ye){var Z=Object.prototype.hasOwnProperty,oe=typeof Symbol=="function",me=oe&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",ie=oe&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",fe=typeof Object.create=="function",J={__proto__:[]}instanceof Array,be=!fe&&!J,Pe={create:fe?function(){return ns(Object.create(null))}:J?function(){return ns({__proto__:null})}:function(){return ns({})},has:be?function(bt,Yt){return Z.call(bt,Yt)}:function(bt,Yt){return Yt in bt},get:be?function(bt,Yt){return Z.call(bt,Yt)?bt[Yt]:void 0}:function(bt,Yt){return bt[Yt]}},M=Object.getPrototypeOf(Function),Jt=typeof Me=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Ht=!Jt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Wo(),Ft=!Jt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:hu(),jt=!Jt&&typeof WeakMap=="function"?WeakMap:rs(),ft=new jt;function dt(bt,Yt,Cr,zr){if(Yr(Cr)){if(!da(bt))throw new TypeError;if(!Ai(Yt))throw new TypeError;return Ir(bt,Yt)}else{if(!da(bt))throw new TypeError;if(!An(Yt))throw new TypeError;if(!An(zr)&&!Yr(zr)&&!wi(zr))throw new TypeError;return wi(zr)&&(zr=void 0),Cr=Si(Cr),Vr(bt,Yt,Cr,zr)}}ye("decorate",dt);function Ar(bt,Yt){function Cr(zr,dn){if(!An(zr))throw new TypeError;if(!Yr(dn)&&!uo(dn))throw new TypeError;H(bt,Yt,zr,dn)}return Cr}ye("metadata",Ar);function cr(bt,Yt,Cr,zr){if(!An(Cr))throw new TypeError;return Yr(zr)||(zr=Si(zr)),H(bt,Yt,Cr,zr)}ye("defineMetadata",cr);function Bt(bt,Yt,Cr){if(!An(Yt))throw new TypeError;return Yr(Cr)||(Cr=Si(Cr)),Ve(bt,Yt,Cr)}ye("hasMetadata",Bt);function ot(bt,Yt,Cr){if(!An(Yt))throw new TypeError;return Yr(Cr)||(Cr=Si(Cr)),ke(bt,Yt,Cr)}ye("hasOwnMetadata",ot);function He(bt,Yt,Cr){if(!An(Yt))throw new TypeError;return Yr(Cr)||(Cr=Si(Cr)),vt(bt,Yt,Cr)}ye("getMetadata",He);function ut(bt,Yt,Cr){if(!An(Yt))throw new TypeError;return Yr(Cr)||(Cr=Si(Cr)),Ke(bt,Yt,Cr)}ye("getOwnMetadata",ut);function Ye(bt,Yt){if(!An(bt))throw new TypeError;return Yr(Yt)||(Yt=Si(Yt)),Je(bt,Yt)}ye("getMetadataKeys",Ye);function Lt(bt,Yt){if(!An(bt))throw new TypeError;return Yr(Yt)||(Yt=Si(Yt)),Et(bt,Yt)}ye("getOwnMetadataKeys",Lt);function ur(bt,Yt,Cr){if(!An(Yt))throw new TypeError;Yr(Cr)||(Cr=Si(Cr));var zr=Ee(Yt,Cr,!1);if(Yr(zr)||!zr.delete(bt))return!1;if(zr.size>0)return!0;var dn=ft.get(Yt);return dn.delete(Cr),dn.size>0||ft.delete(Yt),!0}ye("deleteMetadata",ur);function Ir(bt,Yt){for(var Cr=bt.length-1;Cr>=0;--Cr){var zr=bt[Cr],dn=zr(Yt);if(!Yr(dn)&&!wi(dn)){if(!Ai(dn))throw new TypeError;Yt=dn}}return Yt}function Vr(bt,Yt,Cr,zr){for(var dn=bt.length-1;dn>=0;--dn){var si=bt[dn],Fn=si(Yt,Cr,zr);if(!Yr(Fn)&&!wi(Fn)){if(!An(Fn))throw new TypeError;zr=Fn}}return zr}function Ee(bt,Yt,Cr){var zr=ft.get(bt);if(Yr(zr)){if(!Cr)return;zr=new Ht,ft.set(bt,zr)}var dn=zr.get(Yt);if(Yr(dn)){if(!Cr)return;dn=new Ht,zr.set(Yt,dn)}return dn}function Ve(bt,Yt,Cr){var zr=ke(bt,Yt,Cr);if(zr)return!0;var dn=ki(Yt);return wi(dn)?!1:Ve(bt,dn,Cr)}function ke(bt,Yt,Cr){var zr=Ee(Yt,Cr,!1);return Yr(zr)?!1:sn(zr.has(bt))}function vt(bt,Yt,Cr){var zr=ke(bt,Yt,Cr);if(zr)return Ke(bt,Yt,Cr);var dn=ki(Yt);if(!wi(dn))return vt(bt,dn,Cr)}function Ke(bt,Yt,Cr){var zr=Ee(Yt,Cr,!1);if(!Yr(zr))return zr.get(bt)}function H(bt,Yt,Cr,zr){var dn=Ee(Cr,zr,!0);dn.set(bt,Yt)}function Je(bt,Yt){var Cr=Et(bt,Yt),zr=ki(bt);if(zr===null)return Cr;var dn=Je(zr,Yt);if(dn.length<=0)return Cr;if(Cr.length<=0)return dn;for(var si=new Ft,Fn=[],$n=0,Mn=Cr;$n<Mn.length;$n++){var hi=Mn[$n],ni=si.has(hi);ni||(si.add(hi),Fn.push(hi))}for(var eo=0,Ao=dn;eo<Ao.length;eo++){var hi=Ao[eo],ni=si.has(hi);ni||(si.add(hi),Fn.push(hi))}return Fn}function Et(bt,Yt){var Cr=[],zr=Ee(bt,Yt,!1);if(Yr(zr))return Cr;for(var dn=zr.keys(),si=Pi(dn),Fn=0;;){var $n=le(si);if(!$n)return Cr.length=Fn,Cr;var Mn=To($n);try{Cr[Fn]=Mn}catch(hi){try{Ha(si)}finally{throw hi}}Fn++}}function _t(bt){if(bt===null)return 1;switch(typeof bt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return bt===null?1:6;default:return 6}}function Yr(bt){return bt===void 0}function wi(bt){return bt===null}function On(bt){return typeof bt=="symbol"}function An(bt){return typeof bt=="object"?bt!==null:typeof bt=="function"}function gn(bt,Yt){switch(_t(bt)){case 0:return bt;case 1:return bt;case 2:return bt;case 3:return bt;case 4:return bt;case 5:return bt}var Cr=Yt===3?"string":Yt===5?"number":"default",zr=Mi(bt,me);if(zr!==void 0){var dn=zr.call(bt,Cr);if(An(dn))throw new TypeError;return dn}return Cn(bt,Cr==="default"?"number":Cr)}function Cn(bt,Yt){if(Yt==="string"){var Cr=bt.toString;if(sa(Cr)){var zr=Cr.call(bt);if(!An(zr))return zr}var dn=bt.valueOf;if(sa(dn)){var zr=dn.call(bt);if(!An(zr))return zr}}else{var dn=bt.valueOf;if(sa(dn)){var zr=dn.call(bt);if(!An(zr))return zr}var si=bt.toString;if(sa(si)){var zr=si.call(bt);if(!An(zr))return zr}}throw new TypeError}function sn(bt){return!!bt}function Oi(bt){return""+bt}function Si(bt){var Yt=gn(bt,3);return On(Yt)?Yt:Oi(Yt)}function da(bt){return Array.isArray?Array.isArray(bt):bt instanceof Object?bt instanceof Array:Object.prototype.toString.call(bt)==="[object Array]"}function sa(bt){return typeof bt=="function"}function Ai(bt){return typeof bt=="function"}function uo(bt){switch(_t(bt)){case 3:return!0;case 4:return!0;default:return!1}}function Mi(bt,Yt){var Cr=bt[Yt];if(Cr!=null){if(!sa(Cr))throw new TypeError;return Cr}}function Pi(bt){var Yt=Mi(bt,ie);if(!sa(Yt))throw new TypeError;var Cr=Yt.call(bt);if(!An(Cr))throw new TypeError;return Cr}function To(bt){return bt.value}function le(bt){var Yt=bt.next();return Yt.done?!1:Yt}function Ha(bt){var Yt=bt.return;Yt&&Yt.call(bt)}function ki(bt){var Yt=Object.getPrototypeOf(bt);if(typeof bt!="function"||bt===M||Yt!==M)return Yt;var Cr=bt.prototype,zr=Cr&&Object.getPrototypeOf(Cr);if(zr==null||zr===Object.prototype)return Yt;var dn=zr.constructor;return typeof dn!="function"||dn===bt?Yt:dn}function Wo(){var bt={},Yt=[],Cr=function(){function Fn($n,Mn,hi){this._index=0,this._keys=$n,this._values=Mn,this._selector=hi}return Fn.prototype["@@iterator"]=function(){return this},Fn.prototype[ie]=function(){return this},Fn.prototype.next=function(){var $n=this._index;if($n>=0&&$n<this._keys.length){var Mn=this._selector(this._keys[$n],this._values[$n]);return $n+1>=this._keys.length?(this._index=-1,this._keys=Yt,this._values=Yt):this._index++,{value:Mn,done:!1}}return{value:void 0,done:!0}},Fn.prototype.throw=function($n){throw this._index>=0&&(this._index=-1,this._keys=Yt,this._values=Yt),$n},Fn.prototype.return=function($n){return this._index>=0&&(this._index=-1,this._keys=Yt,this._values=Yt),{value:$n,done:!0}},Fn}();return function(){function Fn(){this._keys=[],this._values=[],this._cacheKey=bt,this._cacheIndex=-2}return Object.defineProperty(Fn.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Fn.prototype.has=function($n){return this._find($n,!1)>=0},Fn.prototype.get=function($n){var Mn=this._find($n,!1);return Mn>=0?this._values[Mn]:void 0},Fn.prototype.set=function($n,Mn){var hi=this._find($n,!0);return this._values[hi]=Mn,this},Fn.prototype.delete=function($n){var Mn=this._find($n,!1);if(Mn>=0){for(var hi=this._keys.length,ni=Mn+1;ni<hi;ni++)this._keys[ni-1]=this._keys[ni],this._values[ni-1]=this._values[ni];return this._keys.length--,this._values.length--,$n===this._cacheKey&&(this._cacheKey=bt,this._cacheIndex=-2),!0}return!1},Fn.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=bt,this._cacheIndex=-2},Fn.prototype.keys=function(){return new Cr(this._keys,this._values,zr)},Fn.prototype.values=function(){return new Cr(this._keys,this._values,dn)},Fn.prototype.entries=function(){return new Cr(this._keys,this._values,si)},Fn.prototype["@@iterator"]=function(){return this.entries()},Fn.prototype[ie]=function(){return this.entries()},Fn.prototype._find=function($n,Mn){return this._cacheKey!==$n&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=$n)),this._cacheIndex<0&&Mn&&(this._cacheIndex=this._keys.length,this._keys.push($n),this._values.push(void 0)),this._cacheIndex},Fn}();function zr(Fn,$n){return Fn}function dn(Fn,$n){return $n}function si(Fn,$n){return[Fn,$n]}}function hu(){return function(){function bt(){this._map=new Ht}return Object.defineProperty(bt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),bt.prototype.has=function(Yt){return this._map.has(Yt)},bt.prototype.add=function(Yt){return this._map.set(Yt,Yt),this},bt.prototype.delete=function(Yt){return this._map.delete(Yt)},bt.prototype.clear=function(){this._map.clear()},bt.prototype.keys=function(){return this._map.keys()},bt.prototype.values=function(){return this._map.values()},bt.prototype.entries=function(){return this._map.entries()},bt.prototype["@@iterator"]=function(){return this.keys()},bt.prototype[ie]=function(){return this.keys()},bt}()}function rs(){var bt=16,Yt=Pe.create(),Cr=zr();return function(){function Mn(){this._key=zr()}return Mn.prototype.has=function(hi){var ni=dn(hi,!1);return ni!==void 0?Pe.has(ni,this._key):!1},Mn.prototype.get=function(hi){var ni=dn(hi,!1);return ni!==void 0?Pe.get(ni,this._key):void 0},Mn.prototype.set=function(hi,ni){var eo=dn(hi,!0);return eo[this._key]=ni,this},Mn.prototype.delete=function(hi){var ni=dn(hi,!1);return ni!==void 0?delete ni[this._key]:!1},Mn.prototype.clear=function(){this._key=zr()},Mn}();function zr(){var Mn;do Mn="@@WeakMap@@"+$n();while(Pe.has(Yt,Mn));return Yt[Mn]=!0,Mn}function dn(Mn,hi){if(!Z.call(Mn,Cr)){if(!hi)return;Object.defineProperty(Mn,Cr,{value:Pe.create()})}return Mn[Cr]}function si(Mn,hi){for(var ni=0;ni<hi;++ni)Mn[ni]=Math.random()*255|0;return Mn}function Fn(Mn){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Mn)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Mn)):si(new Uint8Array(Mn),Mn):si(new Array(Mn),Mn)}function $n(){var Mn=Fn(bt);Mn[6]=Mn[6]&79|64,Mn[8]=Mn[8]&191|128;for(var hi="",ni=0;ni<bt;++ni){var eo=Mn[ni];(ni===4||ni===6||ni===8)&&(hi+="-"),eo<16&&(hi+="0"),hi+=eo.toString(16).toLowerCase()}return hi}}function ns(bt){return bt.__=void 0,delete bt.__,bt}})})(ve||(ve={}))},81550:function(hr){(function(X,G){hr.exports=G()})(this,function(){"use strict";var X=function(L){return L instanceof Uint8Array||L instanceof Uint16Array||L instanceof Uint32Array||L instanceof Int8Array||L instanceof Int16Array||L instanceof Int32Array||L instanceof Float32Array||L instanceof Float64Array||L instanceof Uint8ClampedArray},G=function(L,ae){for(var ge=Object.keys(ae),gt=0;gt<ge.length;++gt)L[ge[gt]]=ae[ge[gt]];return L},Me=`
`;function ve(L){return typeof atob!="undefined"?atob(L):"base64:"+L}function v(L){var ae=new Error("(regl) "+L);throw console.error(ae),ae}function ye(L,ae){L||v(ae)}function Z(L){return L?": "+L:""}function oe(L,ae,ge){L in ae||v("unknown parameter ("+L+")"+Z(ge)+". possible values: "+Object.keys(ae).join())}function me(L,ae){X(L)||v("invalid parameter type"+Z(ae)+". must be a typed array")}function ie(L,ae){switch(ae){case"number":return typeof L=="number";case"object":return typeof L=="object";case"string":return typeof L=="string";case"boolean":return typeof L=="boolean";case"function":return typeof L=="function";case"undefined":return typeof L=="undefined";case"symbol":return typeof L=="symbol"}}function fe(L,ae,ge){ie(L,ae)||v("invalid parameter type"+Z(ge)+". expected "+ae+", got "+typeof L)}function J(L,ae){L>=0&&(L|0)===L||v("invalid parameter type, ("+L+")"+Z(ae)+". must be a nonnegative integer")}function be(L,ae,ge){ae.indexOf(L)<0&&v("invalid value"+Z(ge)+". must be one of: "+ae)}var Pe=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function M(L){Object.keys(L).forEach(function(ae){Pe.indexOf(ae)<0&&v('invalid regl constructor argument "'+ae+'". must be one of '+Pe)})}function Jt(L,ae){for(L=L+"";L.length<ae;)L=" "+L;return L}function Ht(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Ft(L,ae){this.number=L,this.line=ae,this.errors=[]}function jt(L,ae,ge){this.file=L,this.line=ae,this.message=ge}function ft(){var L=new Error,ae=(L.stack||L).toString(),ge=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(ae);if(ge)return ge[1];var gt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(ae);return gt?gt[1]:"unknown"}function dt(){var L=new Error,ae=(L.stack||L).toString(),ge=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(ae);if(ge)return ge[1];var gt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(ae);return gt?gt[1]:"unknown"}function Ar(L,ae){var ge=L.split(`
`),gt=1,Zt=0,ht={unknown:new Ht,0:new Ht};ht.unknown.name=ht[0].name=ae||ft(),ht.unknown.lines.push(new Ft(0,""));for(var Pt=0;Pt<ge.length;++Pt){var rr=ge[Pt],ar=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(rr);if(ar)switch(ar[1]){case"line":var fr=/(\d+)(\s+\d+)?/.exec(ar[2]);fr&&(gt=fr[1]|0,fr[2]&&(Zt=fr[2]|0,Zt in ht||(ht[Zt]=new Ht)));break;case"define":var ir=/SHADER_NAME(_B64)?\s+(.*)$/.exec(ar[2]);ir&&(ht[Zt].name=ir[1]?ve(ir[2]):ir[2]);break}ht[Zt].lines.push(new Ft(gt++,rr))}return Object.keys(ht).forEach(function(vr){var Tr=ht[vr];Tr.lines.forEach(function(er){Tr.index[er.number]=er})}),ht}function cr(L){var ae=[];return L.split(`
`).forEach(function(ge){if(!(ge.length<5)){var gt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(ge);gt?ae.push(new jt(gt[1]|0,gt[2]|0,gt[3].trim())):ge.length>0&&ae.push(new jt("unknown",0,ge))}}),ae}function Bt(L,ae){ae.forEach(function(ge){var gt=L[ge.file];if(gt){var Zt=gt.index[ge.line];if(Zt){Zt.errors.push(ge),gt.hasErrors=!0;return}}L.unknown.hasErrors=!0,L.unknown.lines[0].errors.push(ge)})}function ot(L,ae,ge,gt,Zt){if(!L.getShaderParameter(ae,L.COMPILE_STATUS)){var ht=L.getShaderInfoLog(ae),Pt=gt===L.FRAGMENT_SHADER?"fragment":"vertex";Vr(ge,"string",Pt+" shader source must be a string",Zt);var rr=Ar(ge,Zt),ar=cr(ht);Bt(rr,ar),Object.keys(rr).forEach(function(fr){var ir=rr[fr];if(!ir.hasErrors)return;var vr=[""],Tr=[""];function er(br,et){vr.push(br),Tr.push(et||"")}er("file number "+fr+": "+ir.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),ir.lines.forEach(function(br){if(br.errors.length>0){er(Jt(br.number,4)+"|  ","background-color:yellow; font-weight:bold"),er(br.line+Me,"color:red; background-color:yellow; font-weight:bold");var et=0;br.errors.forEach(function(Tt){var nr=Tt.message,Or=/^\s*'(.*)'\s*:\s*(.*)$/.exec(nr);if(Or){var Wt=Or[1];switch(nr=Or[2],Wt){case"assign":Wt="=";break}et=Math.max(br.line.indexOf(Wt,et),0)}else et=0;er(Jt("| ",6)),er(Jt("^^^",et+3)+Me,"font-weight:bold"),er(Jt("| ",6)),er(nr+Me,"font-weight:bold")}),er(Jt("| ",6)+Me)}else er(Jt(br.number,4)+"|  "),er(br.line+Me,"color:red")}),typeof document!="undefined"&&!window.chrome?(Tr[0]=vr.join("%c"),console.log.apply(console,Tr)):console.log(vr.join(""))}),ye.raise("Error compiling "+Pt+" shader, "+rr[0].name)}}function He(L,ae,ge,gt,Zt){if(!L.getProgramParameter(ae,L.LINK_STATUS)){var ht=L.getProgramInfoLog(ae),Pt=Ar(ge,Zt),rr=Ar(gt,Zt),ar='Error linking program with vertex shader, "'+rr[0].name+'", and fragment shader "'+Pt[0].name+'"';typeof document!="undefined"?console.log("%c"+ar+Me+"%c"+ht,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(ar+Me+ht),ye.raise(ar)}}function ut(L){L._commandRef=ft()}function Ye(L,ae,ge,gt){ut(L);function Zt(ar){return ar?gt.id(ar):0}L._fragId=Zt(L.static.frag),L._vertId=Zt(L.static.vert);function ht(ar,fr){Object.keys(fr).forEach(function(ir){ar[gt.id(ir)]=!0})}var Pt=L._uniformSet={};ht(Pt,ae.static),ht(Pt,ae.dynamic);var rr=L._attributeSet={};ht(rr,ge.static),ht(rr,ge.dynamic),L._hasCount="count"in L.static||"count"in L.dynamic||"elements"in L.static||"elements"in L.dynamic}function Lt(L,ae){var ge=dt();v(L+" in command "+(ae||ft())+(ge==="unknown"?"":" called from "+ge))}function ur(L,ae,ge){L||Lt(ae,ge||ft())}function Ir(L,ae,ge,gt){L in ae||Lt("unknown parameter ("+L+")"+Z(ge)+". possible values: "+Object.keys(ae).join(),gt||ft())}function Vr(L,ae,ge,gt){ie(L,ae)||Lt("invalid parameter type"+Z(ge)+". expected "+ae+", got "+typeof L,gt||ft())}function Ee(L){L()}function Ve(L,ae,ge){L.texture?be(L.texture._texture.internalformat,ae,"unsupported texture format for attachment"):be(L.renderbuffer._renderbuffer.format,ge,"unsupported renderbuffer format for attachment")}var ke=33071,vt=9728,Ke=9984,H=9985,Je=9986,Et=9987,_t=5120,Yr=5121,wi=5122,On=5123,An=5124,gn=5125,Cn=5126,sn=32819,Oi=32820,Si=33635,da=34042,sa=36193,Ai={};Ai[_t]=Ai[Yr]=1,Ai[wi]=Ai[On]=Ai[sa]=Ai[Si]=Ai[sn]=Ai[Oi]=2,Ai[An]=Ai[gn]=Ai[Cn]=Ai[da]=4;function uo(L,ae){return L===Oi||L===sn||L===Si?2:L===da?4:Ai[L]*ae}function Mi(L){return!(L&L-1)&&!!L}function Pi(L,ae,ge){var gt,Zt=ae.width,ht=ae.height,Pt=ae.channels;ye(Zt>0&&Zt<=ge.maxTextureSize&&ht>0&&ht<=ge.maxTextureSize,"invalid texture shape"),(L.wrapS!==ke||L.wrapT!==ke)&&ye(Mi(Zt)&&Mi(ht),"incompatible wrap mode for texture, both width and height must be power of 2"),ae.mipmask===1?Zt!==1&&ht!==1&&ye(L.minFilter!==Ke&&L.minFilter!==Je&&L.minFilter!==H&&L.minFilter!==Et,"min filter requires mipmap"):(ye(Mi(Zt)&&Mi(ht),"texture must be a square power of 2 to support mipmapping"),ye(ae.mipmask===(Zt<<1)-1,"missing or incomplete mipmap data")),ae.type===Cn&&(ge.extensions.indexOf("oes_texture_float_linear")<0&&ye(L.minFilter===vt&&L.magFilter===vt,"filter not supported, must enable oes_texture_float_linear"),ye(!L.genMipmaps,"mipmap generation not supported with float textures"));var rr=ae.images;for(gt=0;gt<16;++gt)if(rr[gt]){var ar=Zt>>gt,fr=ht>>gt;ye(ae.mipmask&1<<gt,"missing mipmap data");var ir=rr[gt];if(ye(ir.width===ar&&ir.height===fr,"invalid shape for mip images"),ye(ir.format===ae.format&&ir.internalformat===ae.internalformat&&ir.type===ae.type,"incompatible type for mip image"),!ir.compressed)if(ir.data){var vr=Math.ceil(uo(ir.type,Pt)*ar/ir.unpackAlignment)*ir.unpackAlignment;ye(ir.data.byteLength===vr*fr,"invalid data for image, buffer size is inconsistent with image format")}else ir.element||ir.copy}else L.genMipmaps||ye((ae.mipmask&1<<gt)==0,"extra mipmap data");ae.compressed&&ye(!L.genMipmaps,"mipmap generation for compressed images not supported")}function To(L,ae,ge,gt){var Zt=L.width,ht=L.height,Pt=L.channels;ye(Zt>0&&Zt<=gt.maxTextureSize&&ht>0&&ht<=gt.maxTextureSize,"invalid texture shape"),ye(Zt===ht,"cube map must be square"),ye(ae.wrapS===ke&&ae.wrapT===ke,"wrap mode not supported by cube map");for(var rr=0;rr<ge.length;++rr){var ar=ge[rr];ye(ar.width===Zt&&ar.height===ht,"inconsistent cube map face shape"),ae.genMipmaps&&(ye(!ar.compressed,"can not generate mipmap for compressed textures"),ye(ar.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var fr=ar.images,ir=0;ir<16;++ir){var vr=fr[ir];if(vr){var Tr=Zt>>ir,er=ht>>ir;ye(ar.mipmask&1<<ir,"missing mipmap data"),ye(vr.width===Tr&&vr.height===er,"invalid shape for mip images"),ye(vr.format===L.format&&vr.internalformat===L.internalformat&&vr.type===L.type,"incompatible type for mip image"),vr.compressed||(vr.data?ye(vr.data.byteLength===Tr*er*Math.max(uo(vr.type,Pt),vr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):vr.element||vr.copy)}}}}var le=G(ye,{optional:Ee,raise:v,commandRaise:Lt,command:ur,parameter:oe,commandParameter:Ir,constructor:M,type:fe,commandType:Vr,isTypedArray:me,nni:J,oneOf:be,shaderError:ot,linkError:He,callSite:dt,saveCommandRef:ut,saveDrawInfo:Ye,framebufferFormat:Ve,guessCommand:ft,texture2D:Pi,textureCube:To}),Ha=0,ki=0,Wo=5,hu=6;function rs(L,ae){this.id=Ha++,this.type=L,this.data=ae}function ns(L){return L.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function bt(L){if(L.length===0)return[];var ae=L.charAt(0),ge=L.charAt(L.length-1);if(L.length>1&&ae===ge&&(ae==='"'||ae==="'"))return['"'+ns(L.substr(1,L.length-2))+'"'];var gt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(L);if(gt)return bt(L.substr(0,gt.index)).concat(bt(gt[1])).concat(bt(L.substr(gt.index+gt[0].length)));var Zt=L.split(".");if(Zt.length===1)return['"'+ns(L)+'"'];for(var ht=[],Pt=0;Pt<Zt.length;++Pt)ht=ht.concat(bt(Zt[Pt]));return ht}function Yt(L){return"["+bt(L).join("][")+"]"}function Cr(L,ae){return new rs(L,Yt(ae+""))}function zr(L){return typeof L=="function"&&!L._reglType||L instanceof rs}function dn(L,ae){if(typeof L=="function")return new rs(ki,L);if(typeof L=="number"||typeof L=="boolean")return new rs(Wo,L);if(Array.isArray(L))return new rs(hu,L.map((ge,gt)=>dn(ge,ae+"["+gt+"]")));if(L instanceof rs)return L;le(!1,"invalid option type in uniform "+ae)}var si={DynamicVariable:rs,define:Cr,isDynamic:zr,unbox:dn,accessor:Yt},Fn={next:typeof requestAnimationFrame=="function"?function(L){return requestAnimationFrame(L)}:function(L){return setTimeout(L,16)},cancel:typeof cancelAnimationFrame=="function"?function(L){return cancelAnimationFrame(L)}:clearTimeout},$n=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function Mn(){var L={"":0},ae=[""];return{id:function(ge){var gt=L[ge];return gt||(gt=L[ge]=ae.length,ae.push(ge),gt)},str:function(ge){return ae[ge]}}}function hi(L,ae,ge){var gt=document.createElement("canvas");G(gt.style,{border:0,margin:0,padding:0,top:0,left:0}),L.appendChild(gt),L===document.body&&(gt.style.position="absolute",G(L.style,{margin:0,padding:0}));function Zt(){var rr=window.innerWidth,ar=window.innerHeight;if(L!==document.body){var fr=L.getBoundingClientRect();rr=fr.right-fr.left,ar=fr.bottom-fr.top}gt.width=ge*rr,gt.height=ge*ar,G(gt.style,{width:rr+"px",height:ar+"px"})}var ht;L!==document.body&&typeof ResizeObserver=="function"?(ht=new ResizeObserver(function(){setTimeout(Zt)}),ht.observe(L)):window.addEventListener("resize",Zt,!1);function Pt(){ht?ht.disconnect():window.removeEventListener("resize",Zt),L.removeChild(gt)}return Zt(),{canvas:gt,onDestroy:Pt}}function ni(L,ae){function ge(gt){try{return L.getContext(gt,ae)}catch(Zt){return null}}return ge("webgl")||ge("experimental-webgl")||ge("webgl-experimental")}function eo(L){return typeof L.nodeName=="string"&&typeof L.appendChild=="function"&&typeof L.getBoundingClientRect=="function"}function Ao(L){return typeof L.drawArrays=="function"||typeof L.drawElements=="function"}function du(L){return typeof L=="string"?L.split():(le(Array.isArray(L),"invalid extension array"),L)}function ks(L){return typeof L=="string"?(le(typeof document!="undefined","not supported outside of DOM"),document.querySelector(L)):L}function Ji(L){var ae=L||{},ge,gt,Zt,ht,Pt={},rr=[],ar=[],fr=typeof window=="undefined"?1:window.devicePixelRatio,ir=!1,vr=function(br){br&&le.raise(br)},Tr=function(){};if(typeof ae=="string"?(le(typeof document!="undefined","selector queries only supported in DOM enviroments"),ge=document.querySelector(ae),le(ge,"invalid query string for element")):typeof ae=="object"?eo(ae)?ge=ae:Ao(ae)?(ht=ae,Zt=ht.canvas):(le.constructor(ae),"gl"in ae?ht=ae.gl:"canvas"in ae?Zt=ks(ae.canvas):"container"in ae&&(gt=ks(ae.container)),"attributes"in ae&&(Pt=ae.attributes,le.type(Pt,"object","invalid context attributes")),"extensions"in ae&&(rr=du(ae.extensions)),"optionalExtensions"in ae&&(ar=du(ae.optionalExtensions)),"onDone"in ae&&(le.type(ae.onDone,"function","invalid or missing onDone callback"),vr=ae.onDone),"profile"in ae&&(ir=!!ae.profile),"pixelRatio"in ae&&(fr=+ae.pixelRatio,le(fr>0,"invalid pixel ratio"))):le.raise("invalid arguments to regl"),ge&&(ge.nodeName.toLowerCase()==="canvas"?Zt=ge:gt=ge),!ht){if(!Zt){le(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var er=hi(gt||document.body,vr,fr);if(!er)return null;Zt=er.canvas,Tr=er.onDestroy}Pt.premultipliedAlpha===void 0&&(Pt.premultipliedAlpha=!0),ht=ni(Zt,Pt)}return ht?{gl:ht,canvas:Zt,container:gt,extensions:rr,optionalExtensions:ar,pixelRatio:fr,profile:ir,onDone:vr,onDestroy:Tr}:(Tr(),vr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function N(L,ae){var ge={};function gt(Pt){le.type(Pt,"string","extension name must be string");var rr=Pt.toLowerCase(),ar;try{ar=ge[rr]=L.getExtension(rr)}catch(fr){}return!!ar}for(var Zt=0;Zt<ae.extensions.length;++Zt){var ht=ae.extensions[Zt];if(!gt(ht))return ae.onDestroy(),ae.onDone('"'+ht+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return ae.optionalExtensions.forEach(gt),{extensions:ge,restore:function(){Object.keys(ge).forEach(function(Pt){if(ge[Pt]&&!gt(Pt))throw new Error("(regl): error restoring extension "+Pt)})}}}function U(L,ae){for(var ge=Array(L),gt=0;gt<L;++gt)ge[gt]=ae(gt);return ge}var Y=5120,se=5121,Te=5122,Ze=5123,We=5124,te=5125,Ie=5126;function nt(L){for(var ae=16;ae<=1<<28;ae*=16)if(L<=ae)return ae;return 0}function $t(L){var ae,ge;return ae=(L>65535)<<4,L>>>=ae,ge=(L>255)<<3,L>>>=ge,ae|=ge,ge=(L>15)<<2,L>>>=ge,ae|=ge,ge=(L>3)<<1,L>>>=ge,ae|=ge,ae|L>>1}function lr(){var L=U(8,function(){return[]});function ae(ht){var Pt=nt(ht),rr=L[$t(Pt)>>2];return rr.length>0?rr.pop():new ArrayBuffer(Pt)}function ge(ht){L[$t(ht.byteLength)>>2].push(ht)}function gt(ht,Pt){var rr=null;switch(ht){case Y:rr=new Int8Array(ae(Pt),0,Pt);break;case se:rr=new Uint8Array(ae(Pt),0,Pt);break;case Te:rr=new Int16Array(ae(2*Pt),0,Pt);break;case Ze:rr=new Uint16Array(ae(2*Pt),0,Pt);break;case We:rr=new Int32Array(ae(4*Pt),0,Pt);break;case te:rr=new Uint32Array(ae(4*Pt),0,Pt);break;case Ie:rr=new Float32Array(ae(4*Pt),0,Pt);break;default:return null}return rr.length!==Pt?rr.subarray(0,Pt):rr}function Zt(ht){ge(ht.buffer)}return{alloc:ae,free:ge,allocType:gt,freeType:Zt}}var pt=lr();pt.zero=lr();var tr=3408,Hr=3410,Rr=3411,Dt=3412,Dr=3413,Pr=3414,Mr=3415,Nn=33901,Lr=33902,jn=3379,ui=3386,zn=34921,Pn=36347,Vn=36348,Sa=35661,vi=35660,Li=34930,Wn=36349,Zn=34076,Jn=34024,Qi=7936,gs=7937,Bi=7938,ea=35724,Bu=34047,qs=36063,ji=34852,Wa=3553,Ea=34067,ua=34069,xo=33984,bi=6408,bo=5126,Xa=5121,Mo=36160,Xo=36053,Lc=36064,Yo=16384,Ca=function(L,ae){var ge=1;ae.ext_texture_filter_anisotropic&&(ge=L.getParameter(Bu));var gt=1,Zt=1;ae.webgl_draw_buffers&&(gt=L.getParameter(ji),Zt=L.getParameter(qs));var ht=!!ae.oes_texture_float;if(ht){var Pt=L.createTexture();L.bindTexture(Wa,Pt),L.texImage2D(Wa,0,bi,1,1,0,bi,bo,null);var rr=L.createFramebuffer();if(L.bindFramebuffer(Mo,rr),L.framebufferTexture2D(Mo,Lc,Wa,Pt,0),L.bindTexture(Wa,null),L.checkFramebufferStatus(Mo)!==Xo)ht=!1;else{L.viewport(0,0,1,1),L.clearColor(1,0,0,1),L.clear(Yo);var ar=pt.allocType(bo,4);L.readPixels(0,0,1,1,bi,bo,ar),L.getError()?ht=!1:(L.deleteFramebuffer(rr),L.deleteTexture(Pt),ht=ar[0]===1),pt.freeType(ar)}}var fr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),ir=!0;if(!fr){var vr=L.createTexture(),Tr=pt.allocType(Xa,36);L.activeTexture(xo),L.bindTexture(Ea,vr),L.texImage2D(ua,0,bi,3,3,0,bi,Xa,Tr),pt.freeType(Tr),L.bindTexture(Ea,null),L.deleteTexture(vr),ir=!L.getError()}return{colorBits:[L.getParameter(Hr),L.getParameter(Rr),L.getParameter(Dt),L.getParameter(Dr)],depthBits:L.getParameter(Pr),stencilBits:L.getParameter(Mr),subpixelBits:L.getParameter(tr),extensions:Object.keys(ae).filter(function(er){return!!ae[er]}),maxAnisotropic:ge,maxDrawbuffers:gt,maxColorAttachments:Zt,pointSizeDims:L.getParameter(Nn),lineWidthDims:L.getParameter(Lr),maxViewportDims:L.getParameter(ui),maxCombinedTextureUnits:L.getParameter(Sa),maxCubeMapSize:L.getParameter(Zn),maxRenderbufferSize:L.getParameter(Jn),maxTextureUnits:L.getParameter(Li),maxTextureSize:L.getParameter(jn),maxAttributes:L.getParameter(zn),maxVertexUniforms:L.getParameter(Pn),maxVertexTextureUnits:L.getParameter(vi),maxVaryingVectors:L.getParameter(Vn),maxFragmentUniforms:L.getParameter(Wn),glsl:L.getParameter(ea),renderer:L.getParameter(gs),vendor:L.getParameter(Qi),version:L.getParameter(Bi),readFloat:ht,npotTextureCube:ir}};function va(L){return!!L&&typeof L=="object"&&Array.isArray(L.shape)&&Array.isArray(L.stride)&&typeof L.offset=="number"&&L.shape.length===L.stride.length&&(Array.isArray(L.data)||X(L.data))}var Ri=function(L){return Object.keys(L).map(function(ae){return L[ae]})},K={shape:mi,flatten:rn};function he(L,ae,ge){for(var gt=0;gt<ae;++gt)ge[gt]=L[gt]}function je(L,ae,ge,gt){for(var Zt=0,ht=0;ht<ae;++ht)for(var Pt=L[ht],rr=0;rr<ge;++rr)gt[Zt++]=Pt[rr]}function It(L,ae,ge,gt,Zt,ht){for(var Pt=ht,rr=0;rr<ae;++rr)for(var ar=L[rr],fr=0;fr<ge;++fr)for(var ir=ar[fr],vr=0;vr<gt;++vr)Zt[Pt++]=ir[vr]}function _r(L,ae,ge,gt,Zt){for(var ht=1,Pt=ge+1;Pt<ae.length;++Pt)ht*=ae[Pt];var rr=ae[ge];if(ae.length-ge==4){var ar=ae[ge+1],fr=ae[ge+2],ir=ae[ge+3];for(Pt=0;Pt<rr;++Pt)It(L[Pt],ar,fr,ir,gt,Zt),Zt+=ht}else for(Pt=0;Pt<rr;++Pt)_r(L[Pt],ae,ge+1,gt,Zt),Zt+=ht}function rn(L,ae,ge,gt){var Zt=1;if(ae.length)for(var ht=0;ht<ae.length;++ht)Zt*=ae[ht];else Zt=0;var Pt=gt||pt.allocType(ge,Zt);switch(ae.length){case 0:break;case 1:he(L,ae[0],Pt);break;case 2:je(L,ae[0],ae[1],Pt);break;case 3:It(L,ae[0],ae[1],ae[2],Pt,0);break;default:_r(L,ae,0,Pt,0)}return Pt}function mi(L){for(var ae=[],ge=L;ge.length;ge=ge[0])ae.push(ge.length);return ae}var ma={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ya=5120,Ta=5122,qo=5124,uc=5121,lf=5123,Rc=5125,is=5126,Nu=5126,as={int8:Ya,int16:Ta,int32:qo,uint8:uc,uint16:lf,uint32:Rc,float:is,float32:Nu},ll=35048,vu=35040,_s={dynamic:ll,stream:vu,static:35044},Fl=K.flatten,Po=K.shape,la=35044,Bl=35040,Dc=5121,cf=5126,mu=[];mu[5120]=1,mu[5122]=2,mu[5124]=4,mu[5121]=1,mu[5123]=2,mu[5125]=4,mu[5126]=4;function yu(L){return ma[Object.prototype.toString.call(L)]|0}function Fc(L,ae){for(var ge=0;ge<ae.length;++ge)L[ge]=ae[ge]}function Ii(L,ae,ge,gt,Zt,ht,Pt){for(var rr=0,ar=0;ar<ge;++ar)for(var fr=0;fr<gt;++fr)L[rr++]=ae[Zt*ar+ht*fr+Pt]}function gu(L,ae,ge,gt){var Zt=0,ht={};function Pt(et){this.id=Zt++,this.buffer=L.createBuffer(),this.type=et,this.usage=la,this.byteLength=0,this.dimension=1,this.dtype=Dc,this.persistentData=null,ge.profile&&(this.stats={size:0})}Pt.prototype.bind=function(){L.bindBuffer(this.type,this.buffer)},Pt.prototype.destroy=function(){Tr(this)};var rr=[];function ar(et,Tt){var nr=rr.pop();return nr||(nr=new Pt(et)),nr.bind(),vr(nr,Tt,Bl,0,1,!1),nr}function fr(et){rr.push(et)}function ir(et,Tt,nr){et.byteLength=Tt.byteLength,L.bufferData(et.type,Tt,nr)}function vr(et,Tt,nr,Or,Wt,Zr){var Qt;if(et.usage=nr,Array.isArray(Tt)){if(et.dtype=Or||cf,Tt.length>0){var Sr;if(Array.isArray(Tt[0])){Qt=Po(Tt);for(var Xt=1,mr=1;mr<Qt.length;++mr)Xt*=Qt[mr];et.dimension=Xt,Sr=Fl(Tt,Qt,et.dtype),ir(et,Sr,nr),Zr?et.persistentData=Sr:pt.freeType(Sr)}else if(typeof Tt[0]=="number"){et.dimension=Wt;var an=pt.allocType(et.dtype,Tt.length);Fc(an,Tt),ir(et,an,nr),Zr?et.persistentData=an:pt.freeType(an)}else X(Tt[0])?(et.dimension=Tt[0].length,et.dtype=Or||yu(Tt[0])||cf,Sr=Fl(Tt,[Tt.length,Tt[0].length],et.dtype),ir(et,Sr,nr),Zr?et.persistentData=Sr:pt.freeType(Sr)):le.raise("invalid buffer data")}}else if(X(Tt))et.dtype=Or||yu(Tt),et.dimension=Wt,ir(et,Tt,nr),Zr&&(et.persistentData=new Uint8Array(new Uint8Array(Tt.buffer)));else if(va(Tt)){Qt=Tt.shape;var hn=Tt.stride,wr=Tt.offset,Kt=0,Vt=0,bn=0,yn=0;Qt.length===1?(Kt=Qt[0],Vt=1,bn=hn[0],yn=0):Qt.length===2?(Kt=Qt[0],Vt=Qt[1],bn=hn[0],yn=hn[1]):le.raise("invalid shape"),et.dtype=Or||yu(Tt.data)||cf,et.dimension=Vt;var qr=pt.allocType(et.dtype,Kt*Vt);Ii(qr,Tt.data,Kt,Vt,bn,yn,wr),ir(et,qr,nr),Zr?et.persistentData=qr:pt.freeType(qr)}else Tt instanceof ArrayBuffer?(et.dtype=Dc,et.dimension=Wt,ir(et,Tt,nr),Zr&&(et.persistentData=new Uint8Array(new Uint8Array(Tt)))):le.raise("invalid buffer data")}function Tr(et){ae.bufferCount--,gt(et);var Tt=et.buffer;le(Tt,"buffer must not be deleted already"),L.deleteBuffer(Tt),et.buffer=null,delete ht[et.id]}function er(et,Tt,nr,Or){ae.bufferCount++;var Wt=new Pt(Tt);ht[Wt.id]=Wt;function Zr(Xt){var mr=la,an=null,hn=0,wr=0,Kt=1;return Array.isArray(Xt)||X(Xt)||va(Xt)||Xt instanceof ArrayBuffer?an=Xt:typeof Xt=="number"?hn=Xt|0:Xt&&(le.type(Xt,"object","buffer arguments must be an object, a number or an array"),"data"in Xt&&(le(an===null||Array.isArray(an)||X(an)||va(an),"invalid data for buffer"),an=Xt.data),"usage"in Xt&&(le.parameter(Xt.usage,_s,"invalid buffer usage"),mr=_s[Xt.usage]),"type"in Xt&&(le.parameter(Xt.type,as,"invalid buffer type"),wr=as[Xt.type]),"dimension"in Xt&&(le.type(Xt.dimension,"number","invalid dimension"),Kt=Xt.dimension|0),"length"in Xt&&(le.nni(hn,"buffer length must be a nonnegative integer"),hn=Xt.length|0)),Wt.bind(),an?vr(Wt,an,mr,wr,Kt,Or):(hn&&L.bufferData(Wt.type,hn,mr),Wt.dtype=wr||Dc,Wt.usage=mr,Wt.dimension=Kt,Wt.byteLength=hn),ge.profile&&(Wt.stats.size=Wt.byteLength*mu[Wt.dtype]),Zr}function Qt(Xt,mr){le(mr+Xt.byteLength<=Wt.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Xt.byteLength+" starting from offset "+mr+" to a buffer of size "+Wt.byteLength),L.bufferSubData(Wt.type,mr,Xt)}function Sr(Xt,mr){var an=(mr||0)|0,hn;if(Wt.bind(),X(Xt)||Xt instanceof ArrayBuffer)Qt(Xt,an);else if(Array.isArray(Xt)){if(Xt.length>0)if(typeof Xt[0]=="number"){var wr=pt.allocType(Wt.dtype,Xt.length);Fc(wr,Xt),Qt(wr,an),pt.freeType(wr)}else if(Array.isArray(Xt[0])||X(Xt[0])){hn=Po(Xt);var Kt=Fl(Xt,hn,Wt.dtype);Qt(Kt,an),pt.freeType(Kt)}else le.raise("invalid buffer data")}else if(va(Xt)){hn=Xt.shape;var Vt=Xt.stride,bn=0,yn=0,qr=0,Qn=0;hn.length===1?(bn=hn[0],yn=1,qr=Vt[0],Qn=0):hn.length===2?(bn=hn[0],yn=hn[1],qr=Vt[0],Qn=Vt[1]):le.raise("invalid shape");var Dn=Array.isArray(Xt.data)?Wt.dtype:yu(Xt.data),Yn=pt.allocType(Dn,bn*yn);Ii(Yn,Xt.data,bn,yn,qr,Qn,Xt.offset),Qt(Yn,an),pt.freeType(Yn)}else le.raise("invalid data for buffer subdata");return Zr}return nr||Zr(et),Zr._reglType="buffer",Zr._buffer=Wt,Zr.subdata=Sr,ge.profile&&(Zr.stats=Wt.stats),Zr.destroy=function(){Tr(Wt)},Zr}function br(){Ri(ht).forEach(function(et){et.buffer=L.createBuffer(),L.bindBuffer(et.type,et.buffer),L.bufferData(et.type,et.persistentData||et.byteLength,et.usage)})}return ge.profile&&(ae.getTotalBufferSize=function(){var et=0;return Object.keys(ht).forEach(function(Tt){et+=ht[Tt].stats.size}),et}),{create:er,createStream:ar,destroyStream:fr,clear:function(){Ri(ht).forEach(Tr),rr.forEach(Tr)},getBuffer:function(et){return et&&et._buffer instanceof Pt?et._buffer:null},restore:br,_initBuffer:vr}}var Gf=0,Hf=0,Wf=1,lc=1,Nl=4,Xf=4,qi={points:Gf,point:Hf,lines:Wf,line:lc,triangles:Nl,triangle:Xf,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ff=0,zu=1,La=4,Ls=5120,Io=5121,_u=5122,Ko=5123,xu=5124,Oo=5125,cc=34963,Yf=35040,Di=35044;function dp(L,ae,ge,gt){var Zt={},ht=0,Pt={uint8:Io,uint16:Ko};ae.oes_element_index_uint&&(Pt.uint32=Oo);function rr(br){this.id=ht++,Zt[this.id]=this,this.buffer=br,this.primType=La,this.vertCount=0,this.type=0}rr.prototype.bind=function(){this.buffer.bind()};var ar=[];function fr(br){var et=ar.pop();return et||(et=new rr(ge.create(null,cc,!0,!1)._buffer)),vr(et,br,Yf,-1,-1,0,0),et}function ir(br){ar.push(br)}function vr(br,et,Tt,nr,Or,Wt,Zr){br.buffer.bind();var Qt;if(et){var Sr=Zr;!Zr&&(!X(et)||va(et)&&!X(et.data))&&(Sr=ae.oes_element_index_uint?Oo:Ko),ge._initBuffer(br.buffer,et,Tt,Sr,3)}else L.bufferData(cc,Wt,Tt),br.buffer.dtype=Qt||Io,br.buffer.usage=Tt,br.buffer.dimension=3,br.buffer.byteLength=Wt;if(Qt=Zr,!Zr){switch(br.buffer.dtype){case Io:case Ls:Qt=Io;break;case Ko:case _u:Qt=Ko;break;case Oo:case xu:Qt=Oo;break;default:le.raise("unsupported type for element array")}br.buffer.dtype=Qt}br.type=Qt,le(Qt!==Oo||!!ae.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Xt=Or;Xt<0&&(Xt=br.buffer.byteLength,Qt===Ko?Xt>>=1:Qt===Oo&&(Xt>>=2)),br.vertCount=Xt;var mr=nr;if(nr<0){mr=La;var an=br.buffer.dimension;an===1&&(mr=ff),an===2&&(mr=zu),an===3&&(mr=La)}br.primType=mr}function Tr(br){gt.elementsCount--,le(br.buffer!==null,"must not double destroy elements"),delete Zt[br.id],br.buffer.destroy(),br.buffer=null}function er(br,et){var Tt=ge.create(null,cc,!0),nr=new rr(Tt._buffer);gt.elementsCount++;function Or(Wt){if(!Wt)Tt(),nr.primType=La,nr.vertCount=0,nr.type=Io;else if(typeof Wt=="number")Tt(Wt),nr.primType=La,nr.vertCount=Wt|0,nr.type=Io;else{var Zr=null,Qt=Di,Sr=-1,Xt=-1,mr=0,an=0;Array.isArray(Wt)||X(Wt)||va(Wt)?Zr=Wt:(le.type(Wt,"object","invalid arguments for elements"),"data"in Wt&&(Zr=Wt.data,le(Array.isArray(Zr)||X(Zr)||va(Zr),"invalid data for element buffer")),"usage"in Wt&&(le.parameter(Wt.usage,_s,"invalid element buffer usage"),Qt=_s[Wt.usage]),"primitive"in Wt&&(le.parameter(Wt.primitive,qi,"invalid element buffer primitive"),Sr=qi[Wt.primitive]),"count"in Wt&&(le(typeof Wt.count=="number"&&Wt.count>=0,"invalid vertex count for elements"),Xt=Wt.count|0),"type"in Wt&&(le.parameter(Wt.type,Pt,"invalid buffer type"),an=Pt[Wt.type]),"length"in Wt?mr=Wt.length|0:(mr=Xt,an===Ko||an===_u?mr*=2:(an===Oo||an===xu)&&(mr*=4))),vr(nr,Zr,Qt,Sr,Xt,mr,an)}return Or}return Or(br),Or._reglType="elements",Or._elements=nr,Or.subdata=function(Wt,Zr){return Tt.subdata(Wt,Zr),Or},Or.destroy=function(){Tr(nr)},Or}return{create:er,createStream:fr,destroyStream:ir,getElements:function(br){return typeof br=="function"&&br._elements instanceof rr?br._elements:null},clear:function(){Ri(Zt).forEach(Tr)}}}var fc=new Float32Array(1),qf=new Uint32Array(fc.buffer),pf=5123;function hf(L){for(var ae=pt.allocType(pf,L.length),ge=0;ge<L.length;++ge)if(isNaN(L[ge]))ae[ge]=65535;else if(L[ge]===Infinity)ae[ge]=31744;else if(L[ge]===-Infinity)ae[ge]=64512;else{fc[0]=L[ge];var gt=qf[0],Zt=gt>>>31<<15,ht=(gt<<1>>>24)-127,Pt=gt>>13&(1<<10)-1;if(ht<-24)ae[ge]=Zt;else if(ht<-14){var rr=-14-ht;ae[ge]=Zt+(Pt+(1<<10)>>rr)}else ht>15?ae[ge]=Zt+31744:ae[ge]=Zt+(ht+15<<10)+Pt}return ae}function ca(L){return Array.isArray(L)||X(L)}var bu=function(L){return!(L&L-1)&&!!L},Zu=34467,ko=3553,Bc=34067,pc=34069,wu=6408,Ks=6406,hc=6407,Rs=6409,$s=6410,df=32854,cl=32855,Ni=36194,Nc=32819,Kf=32820,zl=33635,$f=34042,vf=6402,fl=34041,Zl=35904,Uu=35906,Ds=36193,pl=33776,hl=33777,Su=33778,dc=33779,dl=35986,xs=35987,zc=34798,mf=35840,Zc=35841,Eu=35842,Ul=35843,jl=36196,Cu=5121,Vl=5123,yf=5125,Tu=5126,gf=10242,Jf=10243,_f=10497,vl=33071,Uc=33648,vc=10240,xf=10241,ml=9728,Qf=9729,Tn=9984,Kr=9985,Gl=9986,ju=9987,Vu=33170,ii=4352,Vi=4353,bs=4354,jc=34046,mc=3317,Vc=37440,rh=37441,nh=37443,yc=37444,Gu=33984,Hu=[Tn,Gl,Kr,ju],fa=[0,Rs,$s,hc,wu],Fo={};Fo[Rs]=Fo[Ks]=Fo[vf]=1,Fo[fl]=Fo[$s]=2,Fo[hc]=Fo[Zl]=3,Fo[wu]=Fo[Uu]=4;function Hl(L){return"[object "+L+"]"}var Aa=Hl("HTMLCanvasElement"),Gr=Hl("OffscreenCanvas"),os=Hl("CanvasRenderingContext2D"),Gc=Hl("ImageBitmap"),Wl=Hl("HTMLImageElement"),Fs=Hl("HTMLVideoElement"),ss=Object.keys(ma).concat([Aa,Gr,os,Gc,Wl,Fs]),yl=[];yl[Cu]=1,yl[Tu]=4,yl[Ds]=2,yl[Vl]=2,yl[yf]=4;var dr=[];dr[df]=2,dr[cl]=2,dr[Ni]=2,dr[fl]=4,dr[pl]=.5,dr[hl]=.5,dr[Su]=1,dr[dc]=1,dr[dl]=.5,dr[xs]=1,dr[zc]=1,dr[mf]=.5,dr[Zc]=.25,dr[Eu]=.5,dr[Ul]=.25,dr[jl]=.5;function bf(L){return Array.isArray(L)&&(L.length===0||typeof L[0]=="number")}function gl(L){if(!Array.isArray(L))return!1;var ae=L.length;return!(ae===0||!ca(L[0]))}function Wu(L){return Object.prototype.toString.call(L)}function ws(L){return Wu(L)===Aa}function $o(L){return Wu(L)===Gr}function wf(L){return Wu(L)===os}function Sf(L){return Wu(L)===Gc}function us(L){return Wu(L)===Wl}function Xu(L){return Wu(L)===Fs}function Ef(L){if(!L)return!1;var ae=Wu(L);return ss.indexOf(ae)>=0?!0:bf(L)||gl(L)||va(L)}function gc(L){return ma[Object.prototype.toString.call(L)]|0}function ep(L,ae){var ge=ae.length;switch(L.type){case Cu:case Vl:case yf:case Tu:var gt=pt.allocType(L.type,ge);gt.set(ae),L.data=gt;break;case Ds:L.data=hf(ae);break;default:le.raise("unsupported texture type, must specify a typed array")}}function Cf(L,ae){return pt.allocType(L.type===Ds?Tu:L.type,ae)}function Js(L,ae){L.type===Ds?(L.data=hf(ae),pt.freeType(ae)):L.data=ae}function Ss(L,ae,ge,gt,Zt,ht){for(var Pt=L.width,rr=L.height,ar=L.channels,fr=Pt*rr*ar,ir=Cf(L,fr),vr=0,Tr=0;Tr<rr;++Tr)for(var er=0;er<Pt;++er)for(var br=0;br<ar;++br)ir[vr++]=ae[ge*er+gt*Tr+Zt*br+ht];Js(L,ir)}function Xn(L,ae,ge,gt,Zt,ht){var Pt;if(typeof dr[L]!="undefined"?Pt=dr[L]:Pt=Fo[L]*yl[ae],ht&&(Pt*=6),Zt){for(var rr=0,ar=ge;ar>=1;)rr+=Pt*ar*ar,ar/=2;return rr}else return Pt*ge*gt}function Qs(L,ae,ge,gt,Zt,ht,Pt){var rr={"don't care":ii,"dont care":ii,nice:bs,fast:Vi},ar={repeat:_f,clamp:vl,mirror:Uc},fr={nearest:ml,linear:Qf},ir=G({mipmap:ju,"nearest mipmap nearest":Tn,"linear mipmap nearest":Kr,"nearest mipmap linear":Gl,"linear mipmap linear":ju},fr),vr={none:0,browser:yc},Tr={uint8:Cu,rgba4:Nc,rgb565:zl,"rgb5 a1":Kf},er={alpha:Ks,luminance:Rs,"luminance alpha":$s,rgb:hc,rgba:wu,rgba4:df,"rgb5 a1":cl,rgb565:Ni},br={};ae.ext_srgb&&(er.srgb=Zl,er.srgba=Uu),ae.oes_texture_float&&(Tr.float32=Tr.float=Tu),ae.oes_texture_half_float&&(Tr.float16=Tr["half float"]=Ds),ae.webgl_depth_texture&&(G(er,{depth:vf,"depth stencil":fl}),G(Tr,{uint16:Vl,uint32:yf,"depth stencil":$f})),ae.webgl_compressed_texture_s3tc&&G(br,{"rgb s3tc dxt1":pl,"rgba s3tc dxt1":hl,"rgba s3tc dxt3":Su,"rgba s3tc dxt5":dc}),ae.webgl_compressed_texture_atc&&G(br,{"rgb atc":dl,"rgba atc explicit alpha":xs,"rgba atc interpolated alpha":zc}),ae.webgl_compressed_texture_pvrtc&&G(br,{"rgb pvrtc 4bppv1":mf,"rgb pvrtc 2bppv1":Zc,"rgba pvrtc 4bppv1":Eu,"rgba pvrtc 2bppv1":Ul}),ae.webgl_compressed_texture_etc1&&(br["rgb etc1"]=jl);var et=Array.prototype.slice.call(L.getParameter(Zu));Object.keys(br).forEach(function(xe){var yt=br[xe];et.indexOf(yt)>=0&&(er[xe]=yt)});var Tt=Object.keys(er);ge.textureFormats=Tt;var nr=[];Object.keys(er).forEach(function(xe){var yt=er[xe];nr[yt]=xe});var Or=[];Object.keys(Tr).forEach(function(xe){var yt=Tr[xe];Or[yt]=xe});var Wt=[];Object.keys(fr).forEach(function(xe){var yt=fr[xe];Wt[yt]=xe});var Zr=[];Object.keys(ir).forEach(function(xe){var yt=ir[xe];Zr[yt]=xe});var Qt=[];Object.keys(ar).forEach(function(xe){var yt=ar[xe];Qt[yt]=xe});var Sr=Tt.reduce(function(xe,yt){var ct=er[yt];return ct===Rs||ct===Ks||ct===Rs||ct===$s||ct===vf||ct===fl||ae.ext_srgb&&(ct===Zl||ct===Uu)?xe[ct]=ct:ct===cl||yt.indexOf("rgba")>=0?xe[ct]=wu:xe[ct]=hc,xe},{});function Xt(){this.internalformat=wu,this.format=wu,this.type=Cu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=yc,this.width=0,this.height=0,this.channels=0}function mr(xe,yt){xe.internalformat=yt.internalformat,xe.format=yt.format,xe.type=yt.type,xe.compressed=yt.compressed,xe.premultiplyAlpha=yt.premultiplyAlpha,xe.flipY=yt.flipY,xe.unpackAlignment=yt.unpackAlignment,xe.colorSpace=yt.colorSpace,xe.width=yt.width,xe.height=yt.height,xe.channels=yt.channels}function an(xe,yt){if(!(typeof yt!="object"||!yt)){if("premultiplyAlpha"in yt&&(le.type(yt.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),xe.premultiplyAlpha=yt.premultiplyAlpha),"flipY"in yt&&(le.type(yt.flipY,"boolean","invalid texture flip"),xe.flipY=yt.flipY),"alignment"in yt&&(le.oneOf(yt.alignment,[1,2,4,8],"invalid texture unpack alignment"),xe.unpackAlignment=yt.alignment),"colorSpace"in yt&&(le.parameter(yt.colorSpace,vr,"invalid colorSpace"),xe.colorSpace=vr[yt.colorSpace]),"type"in yt){var ct=yt.type;le(ae.oes_texture_float||!(ct==="float"||ct==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),le(ae.oes_texture_half_float||!(ct==="half float"||ct==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),le(ae.webgl_depth_texture||!(ct==="uint16"||ct==="uint32"||ct==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),le.parameter(ct,Tr,"invalid texture type"),xe.type=Tr[ct]}var jr=xe.width,ti=xe.height,pe=xe.channels,$=!1;"shape"in yt?(le(Array.isArray(yt.shape)&&yt.shape.length>=2,"shape must be an array"),jr=yt.shape[0],ti=yt.shape[1],yt.shape.length===3&&(pe=yt.shape[2],le(pe>0&&pe<=4,"invalid number of channels"),$=!0),le(jr>=0&&jr<=ge.maxTextureSize,"invalid width"),le(ti>=0&&ti<=ge.maxTextureSize,"invalid height")):("radius"in yt&&(jr=ti=yt.radius,le(jr>=0&&jr<=ge.maxTextureSize,"invalid radius")),"width"in yt&&(jr=yt.width,le(jr>=0&&jr<=ge.maxTextureSize,"invalid width")),"height"in yt&&(ti=yt.height,le(ti>=0&&ti<=ge.maxTextureSize,"invalid height")),"channels"in yt&&(pe=yt.channels,le(pe>0&&pe<=4,"invalid number of channels"),$=!0)),xe.width=jr|0,xe.height=ti|0,xe.channels=pe|0;var Be=!1;if("format"in yt){var Qe=yt.format;le(ae.webgl_depth_texture||!(Qe==="depth"||Qe==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),le.parameter(Qe,er,"invalid texture format");var tt=xe.internalformat=er[Qe];xe.format=Sr[tt],Qe in Tr&&("type"in yt||(xe.type=Tr[Qe])),Qe in br&&(xe.compressed=!0),Be=!0}!$&&Be?xe.channels=Fo[xe.format]:$&&!Be?xe.channels!==fa[xe.format]&&(xe.format=xe.internalformat=fa[xe.channels]):Be&&$&&le(xe.channels===Fo[xe.format],"number of channels inconsistent with specified format")}}function hn(xe){L.pixelStorei(Vc,xe.flipY),L.pixelStorei(rh,xe.premultiplyAlpha),L.pixelStorei(nh,xe.colorSpace),L.pixelStorei(mc,xe.unpackAlignment)}function wr(){Xt.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Kt(xe,yt){var ct=null;if(Ef(yt)?ct=yt:yt&&(le.type(yt,"object","invalid pixel data type"),an(xe,yt),"x"in yt&&(xe.xOffset=yt.x|0),"y"in yt&&(xe.yOffset=yt.y|0),Ef(yt.data)&&(ct=yt.data)),le(!xe.compressed||ct instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),yt.copy){le(!ct,"can not specify copy and data field for the same texture");var jr=Zt.viewportWidth,ti=Zt.viewportHeight;xe.width=xe.width||jr-xe.xOffset,xe.height=xe.height||ti-xe.yOffset,xe.needsCopy=!0,le(xe.xOffset>=0&&xe.xOffset<jr&&xe.yOffset>=0&&xe.yOffset<ti&&xe.width>0&&xe.width<=jr&&xe.height>0&&xe.height<=ti,"copy texture read out of bounds")}else if(!ct)xe.width=xe.width||1,xe.height=xe.height||1,xe.channels=xe.channels||4;else if(X(ct))xe.channels=xe.channels||4,xe.data=ct,!("type"in yt)&&xe.type===Cu&&(xe.type=gc(ct));else if(bf(ct))xe.channels=xe.channels||4,ep(xe,ct),xe.alignment=1,xe.needsFree=!0;else if(va(ct)){var pe=ct.data;!Array.isArray(pe)&&xe.type===Cu&&(xe.type=gc(pe));var $=ct.shape,Be=ct.stride,Qe,tt,Ue,Ne,Xe,de;$.length===3?(Ue=$[2],de=Be[2]):(le($.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Ue=1,de=1),Qe=$[0],tt=$[1],Ne=Be[0],Xe=Be[1],xe.alignment=1,xe.width=Qe,xe.height=tt,xe.channels=Ue,xe.format=xe.internalformat=fa[Ue],xe.needsFree=!0,Ss(xe,pe,Ne,Xe,de,ct.offset)}else if(ws(ct)||$o(ct)||wf(ct))ws(ct)||$o(ct)?xe.element=ct:xe.element=ct.canvas,xe.width=xe.element.width,xe.height=xe.element.height,xe.channels=4;else if(Sf(ct))xe.element=ct,xe.width=ct.width,xe.height=ct.height,xe.channels=4;else if(us(ct))xe.element=ct,xe.width=ct.naturalWidth,xe.height=ct.naturalHeight,xe.channels=4;else if(Xu(ct))xe.element=ct,xe.width=ct.videoWidth,xe.height=ct.videoHeight,xe.channels=4;else if(gl(ct)){var Re=xe.width||ct[0].length,ce=xe.height||ct.length,$e=xe.channels;ca(ct[0][0])?$e=$e||ct[0][0].length:$e=$e||1;for(var it=K.shape(ct),zt=1,mt=0;mt<it.length;++mt)zt*=it[mt];var Rt=Cf(xe,zt);K.flatten(ct,it,"",Rt),Js(xe,Rt),xe.alignment=1,xe.width=Re,xe.height=ce,xe.channels=$e,xe.format=xe.internalformat=fa[$e],xe.needsFree=!0}xe.type===Tu?le(ge.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):xe.type===Ds&&le(ge.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Vt(xe,yt,ct){var jr=xe.element,ti=xe.data,pe=xe.internalformat,$=xe.format,Be=xe.type,Qe=xe.width,tt=xe.height;hn(xe),jr?L.texImage2D(yt,ct,$,$,Be,jr):xe.compressed?L.compressedTexImage2D(yt,ct,pe,Qe,tt,0,ti):xe.needsCopy?(gt(),L.copyTexImage2D(yt,ct,$,xe.xOffset,xe.yOffset,Qe,tt,0)):L.texImage2D(yt,ct,$,Qe,tt,0,$,Be,ti||null)}function bn(xe,yt,ct,jr,ti){var pe=xe.element,$=xe.data,Be=xe.internalformat,Qe=xe.format,tt=xe.type,Ue=xe.width,Ne=xe.height;hn(xe),pe?L.texSubImage2D(yt,ti,ct,jr,Qe,tt,pe):xe.compressed?L.compressedTexSubImage2D(yt,ti,ct,jr,Be,Ue,Ne,$):xe.needsCopy?(gt(),L.copyTexSubImage2D(yt,ti,ct,jr,xe.xOffset,xe.yOffset,Ue,Ne)):L.texSubImage2D(yt,ti,ct,jr,Ue,Ne,Qe,tt,$)}var yn=[];function qr(){return yn.pop()||new wr}function Qn(xe){xe.needsFree&&pt.freeType(xe.data),wr.call(xe),yn.push(xe)}function Dn(){Xt.call(this),this.genMipmaps=!1,this.mipmapHint=ii,this.mipmask=0,this.images=Array(16)}function Yn(xe,yt,ct){var jr=xe.images[0]=qr();xe.mipmask=1,jr.width=xe.width=yt,jr.height=xe.height=ct,jr.channels=xe.channels=4}function yi(xe,yt){var ct=null;if(Ef(yt))ct=xe.images[0]=qr(),mr(ct,xe),Kt(ct,yt),xe.mipmask=1;else if(an(xe,yt),Array.isArray(yt.mipmap))for(var jr=yt.mipmap,ti=0;ti<jr.length;++ti)ct=xe.images[ti]=qr(),mr(ct,xe),ct.width>>=ti,ct.height>>=ti,Kt(ct,jr[ti]),xe.mipmask|=1<<ti;else ct=xe.images[0]=qr(),mr(ct,xe),Kt(ct,yt),xe.mipmask=1;mr(xe,xe.images[0]),xe.compressed&&(xe.internalformat===pl||xe.internalformat===hl||xe.internalformat===Su||xe.internalformat===dc)&&le(xe.width%4==0&&xe.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function xa(xe,yt){for(var ct=xe.images,jr=0;jr<ct.length;++jr){if(!ct[jr])return;Vt(ct[jr],yt,jr)}}var po=[];function ai(){var xe=po.pop()||new Dn;Xt.call(xe),xe.mipmask=0;for(var yt=0;yt<16;++yt)xe.images[yt]=null;return xe}function ha(xe){for(var yt=xe.images,ct=0;ct<yt.length;++ct)yt[ct]&&Qn(yt[ct]),yt[ct]=null;po.push(xe)}function Hi(){this.minFilter=ml,this.magFilter=ml,this.wrapS=vl,this.wrapT=vl,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=ii}function Na(xe,yt){if("min"in yt){var ct=yt.min;le.parameter(ct,ir),xe.minFilter=ir[ct],Hu.indexOf(xe.minFilter)>=0&&!("faces"in yt)&&(xe.genMipmaps=!0)}if("mag"in yt){var jr=yt.mag;le.parameter(jr,fr),xe.magFilter=fr[jr]}var ti=xe.wrapS,pe=xe.wrapT;if("wrap"in yt){var $=yt.wrap;typeof $=="string"?(le.parameter($,ar),ti=pe=ar[$]):Array.isArray($)&&(le.parameter($[0],ar),le.parameter($[1],ar),ti=ar[$[0]],pe=ar[$[1]])}else{if("wrapS"in yt){var Be=yt.wrapS;le.parameter(Be,ar),ti=ar[Be]}if("wrapT"in yt){var Qe=yt.wrapT;le.parameter(Qe,ar),pe=ar[Qe]}}if(xe.wrapS=ti,xe.wrapT=pe,"anisotropic"in yt){var tt=yt.anisotropic;le(typeof tt=="number"&&tt>=1&&tt<=ge.maxAnisotropic,"aniso samples must be between 1 and "),xe.anisotropic=yt.anisotropic}if("mipmap"in yt){var Ue=!1;switch(typeof yt.mipmap){case"string":le.parameter(yt.mipmap,rr,"invalid mipmap hint"),xe.mipmapHint=rr[yt.mipmap],xe.genMipmaps=!0,Ue=!0;break;case"boolean":Ue=xe.genMipmaps=yt.mipmap;break;case"object":le(Array.isArray(yt.mipmap),"invalid mipmap type"),xe.genMipmaps=!1,Ue=!0;break;default:le.raise("invalid mipmap type")}Ue&&!("min"in yt)&&(xe.minFilter=Tn)}}function za(xe,yt){L.texParameteri(yt,xf,xe.minFilter),L.texParameteri(yt,vc,xe.magFilter),L.texParameteri(yt,gf,xe.wrapS),L.texParameteri(yt,Jf,xe.wrapT),ae.ext_texture_filter_anisotropic&&L.texParameteri(yt,jc,xe.anisotropic),xe.genMipmaps&&(L.hint(Vu,xe.mipmapHint),L.generateMipmap(yt))}var Ka=0,ho={},So=ge.maxTextureUnits,Ia=Array(So).map(function(){return null});function Gn(xe){Xt.call(this),this.mipmask=0,this.internalformat=wu,this.id=Ka++,this.refCount=1,this.target=xe,this.texture=L.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new Hi,Pt.profile&&(this.stats={size:0})}function Ro(xe){L.activeTexture(Gu),L.bindTexture(xe.target,xe.texture)}function Ei(){var xe=Ia[0];xe?L.bindTexture(xe.target,xe.texture):L.bindTexture(ko,null)}function mn(xe){var yt=xe.texture;le(yt,"must not double destroy texture");var ct=xe.unit,jr=xe.target;ct>=0&&(L.activeTexture(Gu+ct),L.bindTexture(jr,null),Ia[ct]=null),L.deleteTexture(yt),xe.texture=null,xe.params=null,xe.pixels=null,xe.refCount=0,delete ho[xe.id],ht.textureCount--}G(Gn.prototype,{bind:function(){var xe=this;xe.bindCount+=1;var yt=xe.unit;if(yt<0){for(var ct=0;ct<So;++ct){var jr=Ia[ct];if(jr){if(jr.bindCount>0)continue;jr.unit=-1}Ia[ct]=xe,yt=ct;break}yt>=So&&le.raise("insufficient number of texture units"),Pt.profile&&ht.maxTextureUnits<yt+1&&(ht.maxTextureUnits=yt+1),xe.unit=yt,L.activeTexture(Gu+yt),L.bindTexture(xe.target,xe.texture)}return yt},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&mn(this)}});function ei(xe,yt){var ct=new Gn(ko);ho[ct.id]=ct,ht.textureCount++;function jr($,Be){var Qe=ct.texInfo;Hi.call(Qe);var tt=ai();return typeof $=="number"?typeof Be=="number"?Yn(tt,$|0,Be|0):Yn(tt,$|0,$|0):$?(le.type($,"object","invalid arguments to regl.texture"),Na(Qe,$),yi(tt,$)):Yn(tt,1,1),Qe.genMipmaps&&(tt.mipmask=(tt.width<<1)-1),ct.mipmask=tt.mipmask,mr(ct,tt),le.texture2D(Qe,tt,ge),ct.internalformat=tt.internalformat,jr.width=tt.width,jr.height=tt.height,Ro(ct),xa(tt,ko),za(Qe,ko),Ei(),ha(tt),Pt.profile&&(ct.stats.size=Xn(ct.internalformat,ct.type,tt.width,tt.height,Qe.genMipmaps,!1)),jr.format=nr[ct.internalformat],jr.type=Or[ct.type],jr.mag=Wt[Qe.magFilter],jr.min=Zr[Qe.minFilter],jr.wrapS=Qt[Qe.wrapS],jr.wrapT=Qt[Qe.wrapT],jr}function ti($,Be,Qe,tt){le(!!$,"must specify image data");var Ue=Be|0,Ne=Qe|0,Xe=tt|0,de=qr();return mr(de,ct),de.width=0,de.height=0,Kt(de,$),de.width=de.width||(ct.width>>Xe)-Ue,de.height=de.height||(ct.height>>Xe)-Ne,le(ct.type===de.type&&ct.format===de.format&&ct.internalformat===de.internalformat,"incompatible format for texture.subimage"),le(Ue>=0&&Ne>=0&&Ue+de.width<=ct.width&&Ne+de.height<=ct.height,"texture.subimage write out of bounds"),le(ct.mipmask&1<<Xe,"missing mipmap data"),le(de.data||de.element||de.needsCopy,"missing image data"),Ro(ct),bn(de,ko,Ue,Ne,Xe),Ei(),Qn(de),jr}function pe($,Be){var Qe=$|0,tt=Be|0||Qe;if(Qe===ct.width&&tt===ct.height)return jr;jr.width=ct.width=Qe,jr.height=ct.height=tt,Ro(ct);for(var Ue=0;ct.mipmask>>Ue;++Ue){var Ne=Qe>>Ue,Xe=tt>>Ue;if(!Ne||!Xe)break;L.texImage2D(ko,Ue,ct.format,Ne,Xe,0,ct.format,ct.type,null)}return Ei(),Pt.profile&&(ct.stats.size=Xn(ct.internalformat,ct.type,Qe,tt,!1,!1)),jr}return jr(xe,yt),jr.subimage=ti,jr.resize=pe,jr._reglType="texture2d",jr._texture=ct,Pt.profile&&(jr.stats=ct.stats),jr.destroy=function(){ct.decRef()},jr}function li(xe,yt,ct,jr,ti,pe){var $=new Gn(Bc);ho[$.id]=$,ht.cubeCount++;var Be=new Array(6);function Qe(Ne,Xe,de,Re,ce,$e){var it,zt=$.texInfo;for(Hi.call(zt),it=0;it<6;++it)Be[it]=ai();if(typeof Ne=="number"||!Ne){var mt=Ne|0||1;for(it=0;it<6;++it)Yn(Be[it],mt,mt)}else if(typeof Ne=="object")if(Xe)yi(Be[0],Ne),yi(Be[1],Xe),yi(Be[2],de),yi(Be[3],Re),yi(Be[4],ce),yi(Be[5],$e);else if(Na(zt,Ne),an($,Ne),"faces"in Ne){var Rt=Ne.faces;for(le(Array.isArray(Rt)&&Rt.length===6,"cube faces must be a length 6 array"),it=0;it<6;++it)le(typeof Rt[it]=="object"&&!!Rt[it],"invalid input for cube map face"),mr(Be[it],$),yi(Be[it],Rt[it])}else for(it=0;it<6;++it)yi(Be[it],Ne);else le.raise("invalid arguments to cube map");for(mr($,Be[0]),ge.npotTextureCube||le(bu($.width)&&bu($.height),"your browser does not support non power or two texture dimensions"),zt.genMipmaps?$.mipmask=(Be[0].width<<1)-1:$.mipmask=Be[0].mipmask,le.textureCube($,zt,Be,ge),$.internalformat=Be[0].internalformat,Qe.width=Be[0].width,Qe.height=Be[0].height,Ro($),it=0;it<6;++it)xa(Be[it],pc+it);for(za(zt,Bc),Ei(),Pt.profile&&($.stats.size=Xn($.internalformat,$.type,Qe.width,Qe.height,zt.genMipmaps,!0)),Qe.format=nr[$.internalformat],Qe.type=Or[$.type],Qe.mag=Wt[zt.magFilter],Qe.min=Zr[zt.minFilter],Qe.wrapS=Qt[zt.wrapS],Qe.wrapT=Qt[zt.wrapT],it=0;it<6;++it)ha(Be[it]);return Qe}function tt(Ne,Xe,de,Re,ce){le(!!Xe,"must specify image data"),le(typeof Ne=="number"&&Ne===(Ne|0)&&Ne>=0&&Ne<6,"invalid face");var $e=de|0,it=Re|0,zt=ce|0,mt=qr();return mr(mt,$),mt.width=0,mt.height=0,Kt(mt,Xe),mt.width=mt.width||($.width>>zt)-$e,mt.height=mt.height||($.height>>zt)-it,le($.type===mt.type&&$.format===mt.format&&$.internalformat===mt.internalformat,"incompatible format for texture.subimage"),le($e>=0&&it>=0&&$e+mt.width<=$.width&&it+mt.height<=$.height,"texture.subimage write out of bounds"),le($.mipmask&1<<zt,"missing mipmap data"),le(mt.data||mt.element||mt.needsCopy,"missing image data"),Ro($),bn(mt,pc+Ne,$e,it,zt),Ei(),Qn(mt),Qe}function Ue(Ne){var Xe=Ne|0;if(Xe!==$.width){Qe.width=$.width=Xe,Qe.height=$.height=Xe,Ro($);for(var de=0;de<6;++de)for(var Re=0;$.mipmask>>Re;++Re)L.texImage2D(pc+de,Re,$.format,Xe>>Re,Xe>>Re,0,$.format,$.type,null);return Ei(),Pt.profile&&($.stats.size=Xn($.internalformat,$.type,Qe.width,Qe.height,!1,!0)),Qe}}return Qe(xe,yt,ct,jr,ti,pe),Qe.subimage=tt,Qe.resize=Ue,Qe._reglType="textureCube",Qe._texture=$,Pt.profile&&(Qe.stats=$.stats),Qe.destroy=function(){$.decRef()},Qe}function Oa(){for(var xe=0;xe<So;++xe)L.activeTexture(Gu+xe),L.bindTexture(ko,null),Ia[xe]=null;Ri(ho).forEach(mn),ht.cubeCount=0,ht.textureCount=0}Pt.profile&&(ht.getTotalTextureSize=function(){var xe=0;return Object.keys(ho).forEach(function(yt){xe+=ho[yt].stats.size}),xe});function Us(){for(var xe=0;xe<So;++xe){var yt=Ia[xe];yt&&(yt.bindCount=0,yt.unit=-1,Ia[xe]=null)}Ri(ho).forEach(function(ct){ct.texture=L.createTexture(),L.bindTexture(ct.target,ct.texture);for(var jr=0;jr<32;++jr)if((ct.mipmask&1<<jr)!=0)if(ct.target===ko)L.texImage2D(ko,jr,ct.internalformat,ct.width>>jr,ct.height>>jr,0,ct.internalformat,ct.type,null);else for(var ti=0;ti<6;++ti)L.texImage2D(pc+ti,jr,ct.internalformat,ct.width>>jr,ct.height>>jr,0,ct.internalformat,ct.type,null);za(ct.texInfo,ct.target)})}function il(){for(var xe=0;xe<So;++xe){var yt=Ia[xe];yt&&(yt.bindCount=0,yt.unit=-1,Ia[xe]=null),L.activeTexture(Gu+xe),L.bindTexture(ko,null),L.bindTexture(Bc,null)}}return{create2D:ei,createCube:li,clear:Oa,getTexture:function(xe){return null},restore:Us,refresh:il}}var to=36161,Ma=32854,Bo=32855,No=36194,ls=33189,lo=36168,_l=34041,nn=35907,Wr=34836,_c=34842,wo=34843,Ra=[];Ra[Ma]=2,Ra[Bo]=2,Ra[No]=2,Ra[ls]=2,Ra[lo]=1,Ra[_l]=4,Ra[nn]=4,Ra[Wr]=16,Ra[_c]=8,Ra[wo]=6;function ya(L,ae,ge){return Ra[L]*ae*ge}var ta=function(L,ae,ge,gt,Zt){var ht={rgba4:Ma,rgb565:No,"rgb5 a1":Bo,depth:ls,stencil:lo,"depth stencil":_l};ae.ext_srgb&&(ht.srgba=nn),ae.ext_color_buffer_half_float&&(ht.rgba16f=_c,ht.rgb16f=wo),ae.webgl_color_buffer_float&&(ht.rgba32f=Wr);var Pt=[];Object.keys(ht).forEach(function(er){var br=ht[er];Pt[br]=er});var rr=0,ar={};function fr(er){this.id=rr++,this.refCount=1,this.renderbuffer=er,this.format=Ma,this.width=0,this.height=0,Zt.profile&&(this.stats={size:0})}fr.prototype.decRef=function(){--this.refCount<=0&&ir(this)};function ir(er){var br=er.renderbuffer;le(br,"must not double destroy renderbuffer"),L.bindRenderbuffer(to,null),L.deleteRenderbuffer(br),er.renderbuffer=null,er.refCount=0,delete ar[er.id],gt.renderbufferCount--}function vr(er,br){var et=new fr(L.createRenderbuffer());ar[et.id]=et,gt.renderbufferCount++;function Tt(Or,Wt){var Zr=0,Qt=0,Sr=Ma;if(typeof Or=="object"&&Or){var Xt=Or;if("shape"in Xt){var mr=Xt.shape;le(Array.isArray(mr)&&mr.length>=2,"invalid renderbuffer shape"),Zr=mr[0]|0,Qt=mr[1]|0}else"radius"in Xt&&(Zr=Qt=Xt.radius|0),"width"in Xt&&(Zr=Xt.width|0),"height"in Xt&&(Qt=Xt.height|0);"format"in Xt&&(le.parameter(Xt.format,ht,"invalid renderbuffer format"),Sr=ht[Xt.format])}else typeof Or=="number"?(Zr=Or|0,typeof Wt=="number"?Qt=Wt|0:Qt=Zr):Or?le.raise("invalid arguments to renderbuffer constructor"):Zr=Qt=1;if(le(Zr>0&&Qt>0&&Zr<=ge.maxRenderbufferSize&&Qt<=ge.maxRenderbufferSize,"invalid renderbuffer size"),!(Zr===et.width&&Qt===et.height&&Sr===et.format))return Tt.width=et.width=Zr,Tt.height=et.height=Qt,et.format=Sr,L.bindRenderbuffer(to,et.renderbuffer),L.renderbufferStorage(to,Sr,Zr,Qt),le(L.getError()===0,"invalid render buffer format"),Zt.profile&&(et.stats.size=ya(et.format,et.width,et.height)),Tt.format=Pt[et.format],Tt}function nr(Or,Wt){var Zr=Or|0,Qt=Wt|0||Zr;return Zr===et.width&&Qt===et.height||(le(Zr>0&&Qt>0&&Zr<=ge.maxRenderbufferSize&&Qt<=ge.maxRenderbufferSize,"invalid renderbuffer size"),Tt.width=et.width=Zr,Tt.height=et.height=Qt,L.bindRenderbuffer(to,et.renderbuffer),L.renderbufferStorage(to,et.format,Zr,Qt),le(L.getError()===0,"invalid render buffer format"),Zt.profile&&(et.stats.size=ya(et.format,et.width,et.height))),Tt}return Tt(er,br),Tt.resize=nr,Tt._reglType="renderbuffer",Tt._renderbuffer=et,Zt.profile&&(Tt.stats=et.stats),Tt.destroy=function(){et.decRef()},Tt}Zt.profile&&(gt.getTotalRenderbufferSize=function(){var er=0;return Object.keys(ar).forEach(function(br){er+=ar[br].stats.size}),er});function Tr(){Ri(ar).forEach(function(er){er.renderbuffer=L.createRenderbuffer(),L.bindRenderbuffer(to,er.renderbuffer),L.renderbufferStorage(to,er.format,er.width,er.height)}),L.bindRenderbuffer(to,null)}return{create:vr,clear:function(){Ri(ar).forEach(ir)},restore:Tr}},Es=36160,xl=36161,fi=3553,pa=34069,Hc=36064,Yu=36096,Wc=36128,eu=33306,zo=36053,Zo=36054,tu=36055,ga=36057,re=36061,Xl=36193,Xc=5121,bl=5126,Au=6407,xc=6408,Mu=6402,cs=[Au,xc],wl=[];wl[xc]=4,wl[Au]=3;var Cs=[];Cs[Xc]=1,Cs[bl]=4,Cs[Xl]=2;var fs=32854,Yc=32855,Yl=36194,qc=33189,Kc=36168,u=34041,f=35907,l=34836,h=34842,x=34843,S=[fs,Yc,Yl,f,h,x,l],E={};E[zo]="complete",E[Zo]="incomplete attachment",E[ga]="incomplete dimensions",E[tu]="incomplete, missing attachment",E[re]="unsupported";function P(L,ae,ge,gt,Zt,ht){var Pt={cur:null,next:null,dirty:!1,setFBO:null},rr=["rgba"],ar=["rgba4","rgb565","rgb5 a1"];ae.ext_srgb&&ar.push("srgba"),ae.ext_color_buffer_half_float&&ar.push("rgba16f","rgb16f"),ae.webgl_color_buffer_float&&ar.push("rgba32f");var fr=["uint8"];ae.oes_texture_half_float&&fr.push("half float","float16"),ae.oes_texture_float&&fr.push("float","float32");function ir(wr,Kt,Vt){this.target=wr,this.texture=Kt,this.renderbuffer=Vt;var bn=0,yn=0;Kt?(bn=Kt.width,yn=Kt.height):Vt&&(bn=Vt.width,yn=Vt.height),this.width=bn,this.height=yn}function vr(wr){wr&&(wr.texture&&wr.texture._texture.decRef(),wr.renderbuffer&&wr.renderbuffer._renderbuffer.decRef())}function Tr(wr,Kt,Vt){if(!!wr)if(wr.texture){var bn=wr.texture._texture,yn=Math.max(1,bn.width),qr=Math.max(1,bn.height);le(yn===Kt&&qr===Vt,"inconsistent width/height for supplied texture"),bn.refCount+=1}else{var Qn=wr.renderbuffer._renderbuffer;le(Qn.width===Kt&&Qn.height===Vt,"inconsistent width/height for renderbuffer"),Qn.refCount+=1}}function er(wr,Kt){Kt&&(Kt.texture?L.framebufferTexture2D(Es,wr,Kt.target,Kt.texture._texture.texture,0):L.framebufferRenderbuffer(Es,wr,xl,Kt.renderbuffer._renderbuffer.renderbuffer))}function br(wr){var Kt=fi,Vt=null,bn=null,yn=wr;typeof wr=="object"&&(yn=wr.data,"target"in wr&&(Kt=wr.target|0)),le.type(yn,"function","invalid attachment data");var qr=yn._reglType;return qr==="texture2d"?(Vt=yn,le(Kt===fi)):qr==="textureCube"?(Vt=yn,le(Kt>=pa&&Kt<pa+6,"invalid cube map target")):qr==="renderbuffer"?(bn=yn,Kt=xl):le.raise("invalid regl object for attachment"),new ir(Kt,Vt,bn)}function et(wr,Kt,Vt,bn,yn){if(Vt){var qr=gt.create2D({width:wr,height:Kt,format:bn,type:yn});return qr._texture.refCount=0,new ir(fi,qr,null)}else{var Qn=Zt.create({width:wr,height:Kt,format:bn});return Qn._renderbuffer.refCount=0,new ir(xl,null,Qn)}}function Tt(wr){return wr&&(wr.texture||wr.renderbuffer)}function nr(wr,Kt,Vt){wr&&(wr.texture?wr.texture.resize(Kt,Vt):wr.renderbuffer&&wr.renderbuffer.resize(Kt,Vt),wr.width=Kt,wr.height=Vt)}var Or=0,Wt={};function Zr(){this.id=Or++,Wt[this.id]=this,this.framebuffer=L.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Qt(wr){wr.colorAttachments.forEach(vr),vr(wr.depthAttachment),vr(wr.stencilAttachment),vr(wr.depthStencilAttachment)}function Sr(wr){var Kt=wr.framebuffer;le(Kt,"must not double destroy framebuffer"),L.deleteFramebuffer(Kt),wr.framebuffer=null,ht.framebufferCount--,delete Wt[wr.id]}function Xt(wr){var Kt;L.bindFramebuffer(Es,wr.framebuffer);var Vt=wr.colorAttachments;for(Kt=0;Kt<Vt.length;++Kt)er(Hc+Kt,Vt[Kt]);for(Kt=Vt.length;Kt<ge.maxColorAttachments;++Kt)L.framebufferTexture2D(Es,Hc+Kt,fi,null,0);L.framebufferTexture2D(Es,eu,fi,null,0),L.framebufferTexture2D(Es,Yu,fi,null,0),L.framebufferTexture2D(Es,Wc,fi,null,0),er(Yu,wr.depthAttachment),er(Wc,wr.stencilAttachment),er(eu,wr.depthStencilAttachment);var bn=L.checkFramebufferStatus(Es);!L.isContextLost()&&bn!==zo&&le.raise("framebuffer configuration not supported, status = "+E[bn]),L.bindFramebuffer(Es,Pt.next?Pt.next.framebuffer:null),Pt.cur=Pt.next,L.getError()}function mr(wr,Kt){var Vt=new Zr;ht.framebufferCount++;function bn(qr,Qn){var Dn;le(Pt.next!==Vt,"can not update framebuffer which is currently in use");var Yn=0,yi=0,xa=!0,po=!0,ai=null,ha=!0,Hi="rgba",Na="uint8",za=1,Ka=null,ho=null,So=null,Ia=!1;if(typeof qr=="number")Yn=qr|0,yi=Qn|0||Yn;else if(!qr)Yn=yi=1;else{le.type(qr,"object","invalid arguments for framebuffer");var Gn=qr;if("shape"in Gn){var Ro=Gn.shape;le(Array.isArray(Ro)&&Ro.length>=2,"invalid shape for framebuffer"),Yn=Ro[0],yi=Ro[1]}else"radius"in Gn&&(Yn=yi=Gn.radius),"width"in Gn&&(Yn=Gn.width),"height"in Gn&&(yi=Gn.height);("color"in Gn||"colors"in Gn)&&(ai=Gn.color||Gn.colors,Array.isArray(ai)&&le(ai.length===1||ae.webgl_draw_buffers,"multiple render targets not supported")),ai||("colorCount"in Gn&&(za=Gn.colorCount|0,le(za>0,"invalid color buffer count")),"colorTexture"in Gn&&(ha=!!Gn.colorTexture,Hi="rgba4"),"colorType"in Gn&&(Na=Gn.colorType,ha?(le(ae.oes_texture_float||!(Na==="float"||Na==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),le(ae.oes_texture_half_float||!(Na==="half float"||Na==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):Na==="half float"||Na==="float16"?(le(ae.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),Hi="rgba16f"):(Na==="float"||Na==="float32")&&(le(ae.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),Hi="rgba32f"),le.oneOf(Na,fr,"invalid color type")),"colorFormat"in Gn&&(Hi=Gn.colorFormat,rr.indexOf(Hi)>=0?ha=!0:ar.indexOf(Hi)>=0?ha=!1:ha?le.oneOf(Gn.colorFormat,rr,"invalid color format for texture"):le.oneOf(Gn.colorFormat,ar,"invalid color format for renderbuffer"))),("depthTexture"in Gn||"depthStencilTexture"in Gn)&&(Ia=!!(Gn.depthTexture||Gn.depthStencilTexture),le(!Ia||ae.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Gn&&(typeof Gn.depth=="boolean"?xa=Gn.depth:(Ka=Gn.depth,po=!1)),"stencil"in Gn&&(typeof Gn.stencil=="boolean"?po=Gn.stencil:(ho=Gn.stencil,xa=!1)),"depthStencil"in Gn&&(typeof Gn.depthStencil=="boolean"?xa=po=Gn.depthStencil:(So=Gn.depthStencil,xa=!1,po=!1))}var Ei=null,mn=null,ei=null,li=null;if(Array.isArray(ai))Ei=ai.map(br);else if(ai)Ei=[br(ai)];else for(Ei=new Array(za),Dn=0;Dn<za;++Dn)Ei[Dn]=et(Yn,yi,ha,Hi,Na);le(ae.webgl_draw_buffers||Ei.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),le(Ei.length<=ge.maxColorAttachments,"too many color attachments, not supported"),Yn=Yn||Ei[0].width,yi=yi||Ei[0].height,Ka?mn=br(Ka):xa&&!po&&(mn=et(Yn,yi,Ia,"depth","uint32")),ho?ei=br(ho):po&&!xa&&(ei=et(Yn,yi,!1,"stencil","uint8")),So?li=br(So):!Ka&&!ho&&po&&xa&&(li=et(Yn,yi,Ia,"depth stencil","depth stencil")),le(!!Ka+!!ho+!!So<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Oa=null;for(Dn=0;Dn<Ei.length;++Dn)if(Tr(Ei[Dn],Yn,yi),le(!Ei[Dn]||Ei[Dn].texture&&cs.indexOf(Ei[Dn].texture._texture.format)>=0||Ei[Dn].renderbuffer&&S.indexOf(Ei[Dn].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+Dn+" is invalid"),Ei[Dn]&&Ei[Dn].texture){var Us=wl[Ei[Dn].texture._texture.format]*Cs[Ei[Dn].texture._texture.type];Oa===null?Oa=Us:le(Oa===Us,"all color attachments much have the same number of bits per pixel.")}return Tr(mn,Yn,yi),le(!mn||mn.texture&&mn.texture._texture.format===Mu||mn.renderbuffer&&mn.renderbuffer._renderbuffer.format===qc,"invalid depth attachment for framebuffer object"),Tr(ei,Yn,yi),le(!ei||ei.renderbuffer&&ei.renderbuffer._renderbuffer.format===Kc,"invalid stencil attachment for framebuffer object"),Tr(li,Yn,yi),le(!li||li.texture&&li.texture._texture.format===u||li.renderbuffer&&li.renderbuffer._renderbuffer.format===u,"invalid depth-stencil attachment for framebuffer object"),Qt(Vt),Vt.width=Yn,Vt.height=yi,Vt.colorAttachments=Ei,Vt.depthAttachment=mn,Vt.stencilAttachment=ei,Vt.depthStencilAttachment=li,bn.color=Ei.map(Tt),bn.depth=Tt(mn),bn.stencil=Tt(ei),bn.depthStencil=Tt(li),bn.width=Vt.width,bn.height=Vt.height,Xt(Vt),bn}function yn(qr,Qn){le(Pt.next!==Vt,"can not resize a framebuffer which is currently in use");var Dn=Math.max(qr|0,1),Yn=Math.max(Qn|0||Dn,1);if(Dn===Vt.width&&Yn===Vt.height)return bn;for(var yi=Vt.colorAttachments,xa=0;xa<yi.length;++xa)nr(yi[xa],Dn,Yn);return nr(Vt.depthAttachment,Dn,Yn),nr(Vt.stencilAttachment,Dn,Yn),nr(Vt.depthStencilAttachment,Dn,Yn),Vt.width=bn.width=Dn,Vt.height=bn.height=Yn,Xt(Vt),bn}return bn(wr,Kt),G(bn,{resize:yn,_reglType:"framebuffer",_framebuffer:Vt,destroy:function(){Sr(Vt),Qt(Vt)},use:function(qr){Pt.setFBO({framebuffer:bn},qr)}})}function an(wr){var Kt=Array(6);function Vt(yn){var qr;le(Kt.indexOf(Pt.next)<0,"can not update framebuffer which is currently in use");var Qn={color:null},Dn=0,Yn=null,yi="rgba",xa="uint8",po=1;if(typeof yn=="number")Dn=yn|0;else if(!yn)Dn=1;else{le.type(yn,"object","invalid arguments for framebuffer");var ai=yn;if("shape"in ai){var ha=ai.shape;le(Array.isArray(ha)&&ha.length>=2,"invalid shape for framebuffer"),le(ha[0]===ha[1],"cube framebuffer must be square"),Dn=ha[0]}else"radius"in ai&&(Dn=ai.radius|0),"width"in ai?(Dn=ai.width|0,"height"in ai&&le(ai.height===Dn,"must be square")):"height"in ai&&(Dn=ai.height|0);("color"in ai||"colors"in ai)&&(Yn=ai.color||ai.colors,Array.isArray(Yn)&&le(Yn.length===1||ae.webgl_draw_buffers,"multiple render targets not supported")),Yn||("colorCount"in ai&&(po=ai.colorCount|0,le(po>0,"invalid color buffer count")),"colorType"in ai&&(le.oneOf(ai.colorType,fr,"invalid color type"),xa=ai.colorType),"colorFormat"in ai&&(yi=ai.colorFormat,le.oneOf(ai.colorFormat,rr,"invalid color format for texture"))),"depth"in ai&&(Qn.depth=ai.depth),"stencil"in ai&&(Qn.stencil=ai.stencil),"depthStencil"in ai&&(Qn.depthStencil=ai.depthStencil)}var Hi;if(Yn)if(Array.isArray(Yn))for(Hi=[],qr=0;qr<Yn.length;++qr)Hi[qr]=Yn[qr];else Hi=[Yn];else{Hi=Array(po);var Na={radius:Dn,format:yi,type:xa};for(qr=0;qr<po;++qr)Hi[qr]=gt.createCube(Na)}for(Qn.color=Array(Hi.length),qr=0;qr<Hi.length;++qr){var za=Hi[qr];le(typeof za=="function"&&za._reglType==="textureCube","invalid cube map"),Dn=Dn||za.width,le(za.width===Dn&&za.height===Dn,"invalid cube map shape"),Qn.color[qr]={target:pa,data:Hi[qr]}}for(qr=0;qr<6;++qr){for(var Ka=0;Ka<Hi.length;++Ka)Qn.color[Ka].target=pa+qr;qr>0&&(Qn.depth=Kt[0].depth,Qn.stencil=Kt[0].stencil,Qn.depthStencil=Kt[0].depthStencil),Kt[qr]?Kt[qr](Qn):Kt[qr]=mr(Qn)}return G(Vt,{width:Dn,height:Dn,color:Hi})}function bn(yn){var qr,Qn=yn|0;if(le(Qn>0&&Qn<=ge.maxCubeMapSize,"invalid radius for cube fbo"),Qn===Vt.width)return Vt;var Dn=Vt.color;for(qr=0;qr<Dn.length;++qr)Dn[qr].resize(Qn);for(qr=0;qr<6;++qr)Kt[qr].resize(Qn);return Vt.width=Vt.height=Qn,Vt}return Vt(wr),G(Vt,{faces:Kt,resize:bn,_reglType:"framebufferCube",destroy:function(){Kt.forEach(function(yn){yn.destroy()})}})}function hn(){Pt.cur=null,Pt.next=null,Pt.dirty=!0,Ri(Wt).forEach(function(wr){wr.framebuffer=L.createFramebuffer(),Xt(wr)})}return G(Pt,{getFramebuffer:function(wr){if(typeof wr=="function"&&wr._reglType==="framebuffer"){var Kt=wr._framebuffer;if(Kt instanceof Zr)return Kt}return null},create:mr,createCube:an,clear:function(){Ri(Wt).forEach(Sr)},restore:hn})}var R=5126,z=34962;function j(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=R,this.offset=0,this.stride=0,this.divisor=0}function ee(L,ae,ge,gt,Zt){for(var ht=ge.maxAttributes,Pt=new Array(ht),rr=0;rr<ht;++rr)Pt[rr]=new j;var ar=0,fr={},ir={Record:j,scope:{},state:Pt,currentVAO:null,targetVAO:null,restore:Tr()?Wt:function(){},createVAO:Zr,getVAO:br,destroyBuffer:vr,setVAO:Tr()?et:Tt,clear:Tr()?nr:function(){}};function vr(Qt){for(var Sr=0;Sr<Pt.length;++Sr){var Xt=Pt[Sr];Xt.buffer===Qt&&(L.disableVertexAttribArray(Sr),Xt.buffer=null)}}function Tr(){return ae.oes_vertex_array_object}function er(){return ae.angle_instanced_arrays}function br(Qt){return typeof Qt=="function"&&Qt._vao?Qt._vao:null}function et(Qt){if(Qt!==ir.currentVAO){var Sr=Tr();Qt?Sr.bindVertexArrayOES(Qt.vao):Sr.bindVertexArrayOES(null),ir.currentVAO=Qt}}function Tt(Qt){if(Qt!==ir.currentVAO){if(Qt)Qt.bindAttrs();else for(var Sr=er(),Xt=0;Xt<Pt.length;++Xt){var mr=Pt[Xt];mr.buffer?(L.enableVertexAttribArray(Xt),L.vertexAttribPointer(Xt,mr.size,mr.type,mr.normalized,mr.stride,mr.offfset),Sr&&mr.divisor&&Sr.vertexAttribDivisorANGLE(Xt,mr.divisor)):(L.disableVertexAttribArray(Xt),L.vertexAttrib4f(Xt,mr.x,mr.y,mr.z,mr.w))}ir.currentVAO=Qt}}function nr(){Ri(fr).forEach(function(Qt){Qt.destroy()})}function Or(){this.id=++ar,this.attributes=[];var Qt=Tr();Qt?this.vao=Qt.createVertexArrayOES():this.vao=null,fr[this.id]=this,this.buffers=[]}Or.prototype.bindAttrs=function(){for(var Qt=er(),Sr=this.attributes,Xt=0;Xt<Sr.length;++Xt){var mr=Sr[Xt];mr.buffer?(L.enableVertexAttribArray(Xt),L.bindBuffer(z,mr.buffer.buffer),L.vertexAttribPointer(Xt,mr.size,mr.type,mr.normalized,mr.stride,mr.offset),Qt&&mr.divisor&&Qt.vertexAttribDivisorANGLE(Xt,mr.divisor)):(L.disableVertexAttribArray(Xt),L.vertexAttrib4f(Xt,mr.x,mr.y,mr.z,mr.w))}for(var an=Sr.length;an<ht;++an)L.disableVertexAttribArray(an)},Or.prototype.refresh=function(){var Qt=Tr();Qt&&(Qt.bindVertexArrayOES(this.vao),this.bindAttrs(),ir.currentVAO=this)},Or.prototype.destroy=function(){if(this.vao){var Qt=Tr();this===ir.currentVAO&&(ir.currentVAO=null,Qt.bindVertexArrayOES(null)),Qt.deleteVertexArrayOES(this.vao),this.vao=null}fr[this.id]&&(delete fr[this.id],gt.vaoCount-=1)};function Wt(){var Qt=Tr();Qt&&Ri(fr).forEach(function(Sr){Sr.refresh()})}function Zr(Qt){var Sr=new Or;gt.vaoCount+=1;function Xt(mr){le(Array.isArray(mr),"arguments to vertex array constructor must be an array"),le(mr.length<ht,"too many attributes"),le(mr.length>0,"must specify at least one attribute");var an={},hn=Sr.attributes;hn.length=mr.length;for(var wr=0;wr<mr.length;++wr){var Kt=mr[wr],Vt=hn[wr]=new j,bn=Kt.data||Kt;if(Array.isArray(bn)||X(bn)||va(bn)){var yn;Sr.buffers[wr]&&(yn=Sr.buffers[wr],X(bn)&&yn._buffer.byteLength>=bn.byteLength?yn.subdata(bn):(yn.destroy(),Sr.buffers[wr]=null)),Sr.buffers[wr]||(yn=Sr.buffers[wr]=Zt.create(Kt,z,!1,!0)),Vt.buffer=Zt.getBuffer(yn),Vt.size=Vt.buffer.dimension|0,Vt.normalized=!1,Vt.type=Vt.buffer.dtype,Vt.offset=0,Vt.stride=0,Vt.divisor=0,Vt.state=1,an[wr]=1}else Zt.getBuffer(Kt)?(Vt.buffer=Zt.getBuffer(Kt),Vt.size=Vt.buffer.dimension|0,Vt.normalized=!1,Vt.type=Vt.buffer.dtype,Vt.offset=0,Vt.stride=0,Vt.divisor=0,Vt.state=1):Zt.getBuffer(Kt.buffer)?(Vt.buffer=Zt.getBuffer(Kt.buffer),Vt.size=(+Kt.size||Vt.buffer.dimension)|0,Vt.normalized=!!Kt.normalized||!1,"type"in Kt?(le.parameter(Kt.type,as,"invalid buffer type"),Vt.type=as[Kt.type]):Vt.type=Vt.buffer.dtype,Vt.offset=(Kt.offset||0)|0,Vt.stride=(Kt.stride||0)|0,Vt.divisor=(Kt.divisor||0)|0,Vt.state=1,le(Vt.size>=1&&Vt.size<=4,"size must be between 1 and 4"),le(Vt.offset>=0,"invalid offset"),le(Vt.stride>=0&&Vt.stride<=255,"stride must be between 0 and 255"),le(Vt.divisor>=0,"divisor must be positive"),le(!Vt.divisor||!!ae.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Kt?(le(wr>0,"first attribute must not be a constant"),Vt.x=+Kt.x||0,Vt.y=+Kt.y||0,Vt.z=+Kt.z||0,Vt.w=+Kt.w||0,Vt.state=2):le(!1,"invalid attribute spec for location "+wr)}for(var qr=0;qr<Sr.buffers.length;++qr)!an[qr]&&Sr.buffers[qr]&&(Sr.buffers[qr].destroy(),Sr.buffers[qr]=null);return Sr.refresh(),Xt}return Xt.destroy=function(){for(var mr=0;mr<Sr.buffers.length;++mr)Sr.buffers[mr]&&Sr.buffers[mr].destroy();Sr.buffers.length=0,Sr.destroy()},Xt._vao=Sr,Xt._reglType="vao",Xt(Qt)}return ir}var ne=35632,Ae=35633,Se=35718,De=35721;function _e(L,ae,ge,gt){var Zt={},ht={};function Pt(et,Tt,nr,Or){this.name=et,this.id=Tt,this.location=nr,this.info=Or}function rr(et,Tt){for(var nr=0;nr<et.length;++nr)if(et[nr].id===Tt.id){et[nr].location=Tt.location;return}et.push(Tt)}function ar(et,Tt,nr){var Or=et===ne?Zt:ht,Wt=Or[Tt];if(!Wt){var Zr=ae.str(Tt);Wt=L.createShader(et),L.shaderSource(Wt,Zr),L.compileShader(Wt),le.shaderError(L,Wt,Zr,et,nr),Or[Tt]=Wt}return Wt}var fr={},ir=[],vr=0;function Tr(et,Tt){this.id=vr++,this.fragId=et,this.vertId=Tt,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,gt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function er(et,Tt,nr){var Or,Wt,Zr=ar(ne,et.fragId),Qt=ar(Ae,et.vertId),Sr=et.program=L.createProgram();if(L.attachShader(Sr,Zr),L.attachShader(Sr,Qt),nr)for(Or=0;Or<nr.length;++Or){var Xt=nr[Or];L.bindAttribLocation(Sr,Xt[0],Xt[1])}L.linkProgram(Sr),le.linkError(L,Sr,ae.str(et.fragId),ae.str(et.vertId),Tt);var mr=L.getProgramParameter(Sr,Se);gt.profile&&(et.stats.uniformsCount=mr);var an=et.uniforms;for(Or=0;Or<mr;++Or)if(Wt=L.getActiveUniform(Sr,Or),Wt)if(Wt.size>1)for(var hn=0;hn<Wt.size;++hn){var wr=Wt.name.replace("[0]","["+hn+"]");rr(an,new Pt(wr,ae.id(wr),L.getUniformLocation(Sr,wr),Wt))}else rr(an,new Pt(Wt.name,ae.id(Wt.name),L.getUniformLocation(Sr,Wt.name),Wt));var Kt=L.getProgramParameter(Sr,De);gt.profile&&(et.stats.attributesCount=Kt);var Vt=et.attributes;for(Or=0;Or<Kt;++Or)Wt=L.getActiveAttrib(Sr,Or),Wt&&rr(Vt,new Pt(Wt.name,ae.id(Wt.name),L.getAttribLocation(Sr,Wt.name),Wt))}gt.profile&&(ge.getMaxUniformsCount=function(){var et=0;return ir.forEach(function(Tt){Tt.stats.uniformsCount>et&&(et=Tt.stats.uniformsCount)}),et},ge.getMaxAttributesCount=function(){var et=0;return ir.forEach(function(Tt){Tt.stats.attributesCount>et&&(et=Tt.stats.attributesCount)}),et});function br(){Zt={},ht={};for(var et=0;et<ir.length;++et)er(ir[et],null,ir[et].attributes.map(function(Tt){return[Tt.location,Tt.name]}))}return{clear:function(){var et=L.deleteShader.bind(L);Ri(Zt).forEach(et),Zt={},Ri(ht).forEach(et),ht={},ir.forEach(function(Tt){L.deleteProgram(Tt.program)}),ir.length=0,fr={},ge.shaderCount=0},program:function(et,Tt,nr,Or){le.command(et>=0,"missing vertex shader",nr),le.command(Tt>=0,"missing fragment shader",nr);var Wt=fr[Tt];Wt||(Wt=fr[Tt]={});var Zr=Wt[et];if(Zr&&(Zr.refCount++,!Or))return Zr;var Qt=new Tr(Tt,et);return ge.shaderCount++,er(Qt,nr,Or),Zr||(Wt[et]=Qt),ir.push(Qt),G(Qt,{destroy:function(){if(Qt.refCount--,Qt.refCount<=0){L.deleteProgram(Qt.program);var Sr=ir.indexOf(Qt);ir.splice(Sr,1),ge.shaderCount--}Wt[Qt.vertId].refCount<=0&&(L.deleteShader(ht[Qt.vertId]),delete ht[Qt.vertId],delete fr[Qt.fragId][Qt.vertId]),Object.keys(fr[Qt.fragId]).length||(L.deleteShader(Zt[Qt.fragId]),delete Zt[Qt.fragId],delete fr[Qt.fragId])}})},restore:br,shader:ar,frag:-1,vert:-1}}var Fe=6408,Ge=5121,at=3333,Ct=5126;function wt(L,ae,ge,gt,Zt,ht,Pt){function rr(ir){var vr;ae.next===null?(le(Zt.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),vr=Ge):(le(ae.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),vr=ae.next.colorAttachments[0].texture._texture.type,ht.oes_texture_float?(le(vr===Ge||vr===Ct,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),vr===Ct&&le(Pt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):le(vr===Ge,"Reading from a framebuffer is only allowed for the type 'uint8'"));var Tr=0,er=0,br=gt.framebufferWidth,et=gt.framebufferHeight,Tt=null;X(ir)?Tt=ir:ir&&(le.type(ir,"object","invalid arguments to regl.read()"),Tr=ir.x|0,er=ir.y|0,le(Tr>=0&&Tr<gt.framebufferWidth,"invalid x offset for regl.read"),le(er>=0&&er<gt.framebufferHeight,"invalid y offset for regl.read"),br=(ir.width||gt.framebufferWidth-Tr)|0,et=(ir.height||gt.framebufferHeight-er)|0,Tt=ir.data||null),Tt&&(vr===Ge?le(Tt instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):vr===Ct&&le(Tt instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),le(br>0&&br+Tr<=gt.framebufferWidth,"invalid width for read pixels"),le(et>0&&et+er<=gt.framebufferHeight,"invalid height for read pixels"),ge();var nr=br*et*4;return Tt||(vr===Ge?Tt=new Uint8Array(nr):vr===Ct&&(Tt=Tt||new Float32Array(nr))),le.isTypedArray(Tt,"data buffer for regl.read() must be a typedarray"),le(Tt.byteLength>=nr,"data buffer for regl.read() too small"),L.pixelStorei(at,4),L.readPixels(Tr,er,br,et,Fe,vr,Tt),Tt}function ar(ir){var vr;return ae.setFBO({framebuffer:ir.framebuffer},function(){vr=rr(ir)}),vr}function fr(ir){return!ir||!("framebuffer"in ir)?rr(ir):ar(ir)}return fr}function Mt(L){return Array.prototype.slice.call(L)}function qt(L){return Mt(L).join("")}function xr(){var L=0,ae=[],ge=[];function gt(vr){for(var Tr=0;Tr<ge.length;++Tr)if(ge[Tr]===vr)return ae[Tr];var er="g"+L++;return ae.push(er),ge.push(vr),er}function Zt(){var vr=[];function Tr(){vr.push.apply(vr,Mt(arguments))}var er=[];function br(){var et="v"+L++;return er.push(et),arguments.length>0&&(vr.push(et,"="),vr.push.apply(vr,Mt(arguments)),vr.push(";")),et}return G(Tr,{def:br,toString:function(){return qt([er.length>0?"var "+er.join(",")+";":"",qt(vr)])}})}function ht(){var vr=Zt(),Tr=Zt(),er=vr.toString,br=Tr.toString;function et(Tt,nr){Tr(Tt,nr,"=",vr.def(Tt,nr),";")}return G(function(){vr.apply(vr,Mt(arguments))},{def:vr.def,entry:vr,exit:Tr,save:et,set:function(Tt,nr,Or){et(Tt,nr),vr(Tt,nr,"=",Or,";")},toString:function(){return er()+br()}})}function Pt(){var vr=qt(arguments),Tr=ht(),er=ht(),br=Tr.toString,et=er.toString;return G(Tr,{then:function(){return Tr.apply(Tr,Mt(arguments)),this},else:function(){return er.apply(er,Mt(arguments)),this},toString:function(){var Tt=et();return Tt&&(Tt="else{"+Tt+"}"),qt(["if(",vr,"){",br(),"}",Tt])}})}var rr=Zt(),ar={};function fr(vr,Tr){var er=[];function br(){var Wt="a"+er.length;return er.push(Wt),Wt}Tr=Tr||0;for(var et=0;et<Tr;++et)br();var Tt=ht(),nr=Tt.toString,Or=ar[vr]=G(Tt,{arg:br,toString:function(){return qt(["function(",er.join(),"){",nr(),"}"])}});return Or}function ir(){var vr=['"use strict";',rr,"return {"];Object.keys(ar).forEach(function(br){vr.push('"',br,'":',ar[br].toString(),",")}),vr.push("}");var Tr=qt(vr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),er=Function.apply(null,ae.concat(Tr));return er.apply(null,ge)}return{global:rr,link:gt,block:Zt,proc:fr,scope:ht,cond:Pt,compile:ir}}var pr="xyzw".split(""),Fr=5121,tn=1,pn=2,ln=0,pi=1,yr=2,$r=3,kn=4,wn=5,vn=6,Un="dither",Sn="blend.enable",_n="blend.color",Da="blend.equation",Wi="blend.func",Gi="depth.enable",ro="depth.func",ra="depth.range",_a="depth.mask",Fa="colorMask",no="cull.enable",Ts="cull.face",co="frontFace",Jo="lineWidth",Lo="polygonOffset.enable",ru="polygonOffset.offset",qu="sample.alpha",nu="sample.enable",iu="sample.coverage",Sl="stencil.enable",Bs="stencil.mask",Ku="stencil.func",Ba="stencil.opFront",na="stencil.opBack",au="scissor.enable",Ns="scissor.box",Uo="viewport",di="profile",io="framebuffer",ao="vert",ps="frag",$u="elements",ou="primitive",ql="count",Ju="offset",bc="instances",zs="vao",El="Width",$c="Height",Zs=io+El,qa=io+$c,ih=Uo+El,vp=Uo+$c,mp="drawingBuffer",yp=mp+El,gp=mp+$c,ah=[Wi,Da,Ku,Ba,na,iu,Uo,Ns,ru],Cl=34962,oh=34963,Tf=35632,_p=35633,Qu=3553,Jc=34067,jo=2884,sh=3042,uh=3024,lh=2960,ch=2929,fh=3089,ph=32823,tp=32926,hh=32928,Tl=5126,Af=35664,ia=35665,Kl=35666,Mf=5124,$l=35667,Jl=35668,Ql=35669,rp=35670,Pf=35671,ec=35672,wc=35673,Sc=35674,If=35675,el=35676,Qc=35678,tc=35680,xp=4,Pu=1028,tl=1029,su=2304,bp=2305,Yh=32775,qh=32776,Kh=519,Al=7680,Ec=0,dh=1,vh=32774,mh=513,wp=36160,$h=36064,rl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Cc=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],ef={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},nl={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Ml={frag:Tf,vert:_p},fo={cw:su,ccw:bp};function Of(L){return Array.isArray(L)||X(L)||va(L)}function Sp(L){return L.sort(function(ae,ge){return ae===Uo?-1:ge===Uo?1:ae<ge?-1:1})}function Qo(L,ae,ge,gt){this.thisDep=L,this.contextDep=ae,this.propDep=ge,this.append=gt}function As(L){return L&&!(L.thisDep||L.contextDep||L.propDep)}function Pa(L){return new Qo(!1,!1,!1,L)}function Vo(L,ae){var ge=L.type;if(ge===ln){var gt=L.data.length;return new Qo(!0,gt>=1,gt>=2,ae)}else if(ge===kn){var Zt=L.data;return new Qo(Zt.thisDep,Zt.contextDep,Zt.propDep,ae)}else{if(ge===wn)return new Qo(!1,!1,!1,ae);if(ge===vn){for(var ht=!1,Pt=!1,rr=!1,ar=0;ar<L.data.length;++ar){var fr=L.data[ar];if(fr.type===pi)rr=!0;else if(fr.type===yr)Pt=!0;else if(fr.type===$r)ht=!0;else if(fr.type===ln){ht=!0;var ir=fr.data;ir>=1&&(Pt=!0),ir>=2&&(rr=!0)}else fr.type===kn&&(ht=ht||fr.data.thisDep,Pt=Pt||fr.data.contextDep,rr=rr||fr.data.propDep)}return new Qo(ht,Pt,rr,ae)}else return new Qo(ge===$r,ge===yr,ge===pi,ae)}}var Ep=new Qo(!1,!1,!1,function(){});function yh(L,ae,ge,gt,Zt,ht,Pt,rr,ar,fr,ir,vr,Tr,er,br){var et=fr.Record,Tt={add:32774,subtract:32778,"reverse subtract":32779};ge.ext_blend_minmax&&(Tt.min=Yh,Tt.max=qh);var nr=ge.angle_instanced_arrays,Or=ge.webgl_draw_buffers,Wt={dirty:!0,profile:br.profile},Zr={},Qt=[],Sr={},Xt={};function mr(pe){return pe.replace(".","_")}function an(pe,$,Be){var Qe=mr(pe);Qt.push(pe),Zr[Qe]=Wt[Qe]=!!Be,Sr[Qe]=$}function hn(pe,$,Be){var Qe=mr(pe);Qt.push(pe),Array.isArray(Be)?(Wt[Qe]=Be.slice(),Zr[Qe]=Be.slice()):Wt[Qe]=Zr[Qe]=Be,Xt[Qe]=$}an(Un,uh),an(Sn,sh),hn(_n,"blendColor",[0,0,0,0]),hn(Da,"blendEquationSeparate",[vh,vh]),hn(Wi,"blendFuncSeparate",[dh,Ec,dh,Ec]),an(Gi,ch,!0),hn(ro,"depthFunc",mh),hn(ra,"depthRange",[0,1]),hn(_a,"depthMask",!0),hn(Fa,Fa,[!0,!0,!0,!0]),an(no,jo),hn(Ts,"cullFace",tl),hn(co,co,bp),hn(Jo,Jo,1),an(Lo,ph),hn(ru,"polygonOffset",[0,0]),an(qu,tp),an(nu,hh),hn(iu,"sampleCoverage",[1,!1]),an(Sl,lh),hn(Bs,"stencilMask",-1),hn(Ku,"stencilFunc",[Kh,0,-1]),hn(Ba,"stencilOpSeparate",[Pu,Al,Al,Al]),hn(na,"stencilOpSeparate",[tl,Al,Al,Al]),an(au,fh),hn(Ns,"scissor",[0,0,L.drawingBufferWidth,L.drawingBufferHeight]),hn(Uo,Uo,[0,0,L.drawingBufferWidth,L.drawingBufferHeight]);var wr={gl:L,context:Tr,strings:ae,next:Zr,current:Wt,draw:vr,elements:ht,buffer:Zt,shader:ir,attributes:fr.state,vao:fr,uniforms:ar,framebuffer:rr,extensions:ge,timer:er,isBufferArgs:Of},Kt={primTypes:qi,compareFuncs:ef,blendFuncs:rl,blendEquations:Tt,stencilOps:nl,glTypes:as,orientationType:fo};le.optional(function(){wr.isArrayLike=ca}),Or&&(Kt.backBuffer=[tl],Kt.drawBuffer=U(gt.maxDrawbuffers,function(pe){return pe===0?[0]:U(pe,function($){return $h+$})}));var Vt=0;function bn(){var pe=xr(),$=pe.link,Be=pe.global;pe.id=Vt++,pe.batchId="0";var Qe=$(wr),tt=pe.shared={props:"a0"};Object.keys(wr).forEach(function(Re){tt[Re]=Be.def(Qe,".",Re)}),le.optional(function(){pe.CHECK=$(le),pe.commandStr=le.guessCommand(),pe.command=$(pe.commandStr),pe.assert=function(Re,ce,$e){Re("if(!(",ce,"))",this.CHECK,".commandRaise(",$($e),",",this.command,");")},Kt.invalidBlendCombinations=Cc});var Ue=pe.next={},Ne=pe.current={};Object.keys(Xt).forEach(function(Re){Array.isArray(Wt[Re])&&(Ue[Re]=Be.def(tt.next,".",Re),Ne[Re]=Be.def(tt.current,".",Re))});var Xe=pe.constants={};Object.keys(Kt).forEach(function(Re){Xe[Re]=Be.def(JSON.stringify(Kt[Re]))}),pe.invoke=function(Re,ce){switch(ce.type){case ln:var $e=["this",tt.context,tt.props,pe.batchId];return Re.def($(ce.data),".call(",$e.slice(0,Math.max(ce.data.length+1,4)),")");case pi:return Re.def(tt.props,ce.data);case yr:return Re.def(tt.context,ce.data);case $r:return Re.def("this",ce.data);case kn:return ce.data.append(pe,Re),ce.data.ref;case wn:return ce.data.toString();case vn:return ce.data.map(function(it){return pe.invoke(Re,it)})}},pe.attribCache={};var de={};return pe.scopeAttrib=function(Re){var ce=ae.id(Re);if(ce in de)return de[ce];var $e=fr.scope[ce];$e||($e=fr.scope[ce]=new et);var it=de[ce]=$($e);return it},pe}function yn(pe){var $=pe.static,Be=pe.dynamic,Qe;if(di in $){var tt=!!$[di];Qe=Pa(function(Ne,Xe){return tt}),Qe.enable=tt}else if(di in Be){var Ue=Be[di];Qe=Vo(Ue,function(Ne,Xe){return Ne.invoke(Xe,Ue)})}return Qe}function qr(pe,$){var Be=pe.static,Qe=pe.dynamic;if(io in Be){var tt=Be[io];return tt?(tt=rr.getFramebuffer(tt),le.command(tt,"invalid framebuffer object"),Pa(function(Ne,Xe){var de=Ne.link(tt),Re=Ne.shared;Xe.set(Re.framebuffer,".next",de);var ce=Re.context;return Xe.set(ce,"."+Zs,de+".width"),Xe.set(ce,"."+qa,de+".height"),de})):Pa(function(Ne,Xe){var de=Ne.shared;Xe.set(de.framebuffer,".next","null");var Re=de.context;return Xe.set(Re,"."+Zs,Re+"."+yp),Xe.set(Re,"."+qa,Re+"."+gp),"null"})}else if(io in Qe){var Ue=Qe[io];return Vo(Ue,function(Ne,Xe){var de=Ne.invoke(Xe,Ue),Re=Ne.shared,ce=Re.framebuffer,$e=Xe.def(ce,".getFramebuffer(",de,")");le.optional(function(){Ne.assert(Xe,"!"+de+"||"+$e,"invalid framebuffer object")}),Xe.set(ce,".next",$e);var it=Re.context;return Xe.set(it,"."+Zs,$e+"?"+$e+".width:"+it+"."+yp),Xe.set(it,"."+qa,$e+"?"+$e+".height:"+it+"."+gp),$e})}else return null}function Qn(pe,$,Be){var Qe=pe.static,tt=pe.dynamic;function Ue(de){if(de in Qe){var Re=Qe[de];le.commandType(Re,"object","invalid "+de,Be.commandStr);var ce=!0,$e=Re.x|0,it=Re.y|0,zt,mt;return"width"in Re?(zt=Re.width|0,le.command(zt>=0,"invalid "+de,Be.commandStr)):ce=!1,"height"in Re?(mt=Re.height|0,le.command(mt>=0,"invalid "+de,Be.commandStr)):ce=!1,new Qo(!ce&&$&&$.thisDep,!ce&&$&&$.contextDep,!ce&&$&&$.propDep,function(en,qn){var Jr=en.shared.context,xn=zt;"width"in Re||(xn=qn.def(Jr,".",Zs,"-",$e));var Bn=mt;return"height"in Re||(Bn=qn.def(Jr,".",qa,"-",it)),[$e,it,xn,Bn]})}else if(de in tt){var Rt=tt[de],sr=Vo(Rt,function(en,qn){var Jr=en.invoke(qn,Rt);le.optional(function(){en.assert(qn,Jr+"&&typeof "+Jr+'==="object"',"invalid "+de)});var xn=en.shared.context,Bn=qn.def(Jr,".x|0"),xi=qn.def(Jr,".y|0"),ba=qn.def('"width" in ',Jr,"?",Jr,".width|0:","(",xn,".",Zs,"-",Bn,")"),vo=qn.def('"height" in ',Jr,"?",Jr,".height|0:","(",xn,".",qa,"-",xi,")");return le.optional(function(){en.assert(qn,ba+">=0&&"+vo+">=0","invalid "+de)}),[Bn,xi,ba,vo]});return $&&(sr.thisDep=sr.thisDep||$.thisDep,sr.contextDep=sr.contextDep||$.contextDep,sr.propDep=sr.propDep||$.propDep),sr}else return $?new Qo($.thisDep,$.contextDep,$.propDep,function(en,qn){var Jr=en.shared.context;return[0,0,qn.def(Jr,".",Zs),qn.def(Jr,".",qa)]}):null}var Ne=Ue(Uo);if(Ne){var Xe=Ne;Ne=new Qo(Ne.thisDep,Ne.contextDep,Ne.propDep,function(de,Re){var ce=Xe.append(de,Re),$e=de.shared.context;return Re.set($e,"."+ih,ce[2]),Re.set($e,"."+vp,ce[3]),ce})}return{viewport:Ne,scissor_box:Ue(Ns)}}function Dn(pe,$){var Be=pe.static,Qe=typeof Be[ps]=="string"&&typeof Be[ao]=="string";if(Qe){if(Object.keys($.dynamic).length>0)return null;var tt=$.static,Ue=Object.keys(tt);if(Ue.length>0&&typeof tt[Ue[0]]=="number"){for(var Ne=[],Xe=0;Xe<Ue.length;++Xe)le(typeof tt[Ue[Xe]]=="number","must specify all vertex attribute locations when using vaos"),Ne.push([tt[Ue[Xe]]|0,Ue[Xe]]);return Ne}}return null}function Yn(pe,$,Be){var Qe=pe.static,tt=pe.dynamic;function Ue(ce){if(ce in Qe){var $e=ae.id(Qe[ce]);le.optional(function(){ir.shader(Ml[ce],$e,le.guessCommand())});var it=Pa(function(){return $e});return it.id=$e,it}else if(ce in tt){var zt=tt[ce];return Vo(zt,function(mt,Rt){var sr=mt.invoke(Rt,zt),en=Rt.def(mt.shared.strings,".id(",sr,")");return le.optional(function(){Rt(mt.shared.shader,".shader(",Ml[ce],",",en,",",mt.command,");")}),en})}return null}var Ne=Ue(ps),Xe=Ue(ao),de=null,Re;return As(Ne)&&As(Xe)?(de=ir.program(Xe.id,Ne.id,null,Be),Re=Pa(function(ce,$e){return ce.link(de)})):Re=new Qo(Ne&&Ne.thisDep||Xe&&Xe.thisDep,Ne&&Ne.contextDep||Xe&&Xe.contextDep,Ne&&Ne.propDep||Xe&&Xe.propDep,function(ce,$e){var it=ce.shared.shader,zt;Ne?zt=Ne.append(ce,$e):zt=$e.def(it,".",ps);var mt;Xe?mt=Xe.append(ce,$e):mt=$e.def(it,".",ao);var Rt=it+".program("+mt+","+zt;return le.optional(function(){Rt+=","+ce.command}),$e.def(Rt+")")}),{frag:Ne,vert:Xe,progVar:Re,program:de}}function yi(pe,$){var Be=pe.static,Qe=pe.dynamic;function tt(){if($u in Be){var ce=Be[$u];Of(ce)?ce=ht.getElements(ht.create(ce,!0)):ce&&(ce=ht.getElements(ce),le.command(ce,"invalid elements",$.commandStr));var $e=Pa(function(zt,mt){if(ce){var Rt=zt.link(ce);return zt.ELEMENTS=Rt,Rt}return zt.ELEMENTS=null,null});return $e.value=ce,$e}else if($u in Qe){var it=Qe[$u];return Vo(it,function(zt,mt){var Rt=zt.shared,sr=Rt.isBufferArgs,en=Rt.elements,qn=zt.invoke(mt,it),Jr=mt.def("null"),xn=mt.def(sr,"(",qn,")"),Bn=zt.cond(xn).then(Jr,"=",en,".createStream(",qn,");").else(Jr,"=",en,".getElements(",qn,");");return le.optional(function(){zt.assert(Bn.else,"!"+qn+"||"+Jr,"invalid elements")}),mt.entry(Bn),mt.exit(zt.cond(xn).then(en,".destroyStream(",Jr,");")),zt.ELEMENTS=Jr,Jr})}return null}var Ue=tt();function Ne(){if(ou in Be){var ce=Be[ou];return le.commandParameter(ce,qi,"invalid primitve",$.commandStr),Pa(function(it,zt){return qi[ce]})}else if(ou in Qe){var $e=Qe[ou];return Vo($e,function(it,zt){var mt=it.constants.primTypes,Rt=it.invoke(zt,$e);return le.optional(function(){it.assert(zt,Rt+" in "+mt,"invalid primitive, must be one of "+Object.keys(qi))}),zt.def(mt,"[",Rt,"]")})}else if(Ue)return As(Ue)?Ue.value?Pa(function(it,zt){return zt.def(it.ELEMENTS,".primType")}):Pa(function(){return xp}):new Qo(Ue.thisDep,Ue.contextDep,Ue.propDep,function(it,zt){var mt=it.ELEMENTS;return zt.def(mt,"?",mt,".primType:",xp)});return null}function Xe(ce,$e){if(ce in Be){var it=Be[ce]|0;return le.command(!$e||it>=0,"invalid "+ce,$.commandStr),Pa(function(mt,Rt){return $e&&(mt.OFFSET=it),it})}else if(ce in Qe){var zt=Qe[ce];return Vo(zt,function(mt,Rt){var sr=mt.invoke(Rt,zt);return $e&&(mt.OFFSET=sr,le.optional(function(){mt.assert(Rt,sr+">=0","invalid "+ce)})),sr})}else if($e&&Ue)return Pa(function(mt,Rt){return mt.OFFSET="0",0});return null}var de=Xe(Ju,!0);function Re(){if(ql in Be){var ce=Be[ql]|0;return le.command(typeof ce=="number"&&ce>=0,"invalid vertex count",$.commandStr),Pa(function(){return ce})}else if(ql in Qe){var $e=Qe[ql];return Vo($e,function(mt,Rt){var sr=mt.invoke(Rt,$e);return le.optional(function(){mt.assert(Rt,"typeof "+sr+'==="number"&&'+sr+">=0&&"+sr+"===("+sr+"|0)","invalid vertex count")}),sr})}else if(Ue)if(As(Ue)){if(Ue)return de?new Qo(de.thisDep,de.contextDep,de.propDep,function(mt,Rt){var sr=Rt.def(mt.ELEMENTS,".vertCount-",mt.OFFSET);return le.optional(function(){mt.assert(Rt,sr+">=0","invalid vertex offset/element buffer too small")}),sr}):Pa(function(mt,Rt){return Rt.def(mt.ELEMENTS,".vertCount")});var it=Pa(function(){return-1});return le.optional(function(){it.MISSING=!0}),it}else{var zt=new Qo(Ue.thisDep||de.thisDep,Ue.contextDep||de.contextDep,Ue.propDep||de.propDep,function(mt,Rt){var sr=mt.ELEMENTS;return mt.OFFSET?Rt.def(sr,"?",sr,".vertCount-",mt.OFFSET,":-1"):Rt.def(sr,"?",sr,".vertCount:-1")});return le.optional(function(){zt.DYNAMIC=!0}),zt}return null}return{elements:Ue,primitive:Ne(),count:Re(),instances:Xe(bc,!1),offset:de}}function xa(pe,$){var Be=pe.static,Qe=pe.dynamic,tt={};return Qt.forEach(function(Ue){var Ne=mr(Ue);function Xe(de,Re){if(Ue in Be){var ce=de(Be[Ue]);tt[Ne]=Pa(function(){return ce})}else if(Ue in Qe){var $e=Qe[Ue];tt[Ne]=Vo($e,function(it,zt){return Re(it,zt,it.invoke(zt,$e))})}}switch(Ue){case no:case Sn:case Un:case Sl:case Gi:case au:case Lo:case qu:case nu:case _a:return Xe(function(de){return le.commandType(de,"boolean",Ue,$.commandStr),de},function(de,Re,ce){return le.optional(function(){de.assert(Re,"typeof "+ce+'==="boolean"',"invalid flag "+Ue,de.commandStr)}),ce});case ro:return Xe(function(de){return le.commandParameter(de,ef,"invalid "+Ue,$.commandStr),ef[de]},function(de,Re,ce){var $e=de.constants.compareFuncs;return le.optional(function(){de.assert(Re,ce+" in "+$e,"invalid "+Ue+", must be one of "+Object.keys(ef))}),Re.def($e,"[",ce,"]")});case ra:return Xe(function(de){return le.command(ca(de)&&de.length===2&&typeof de[0]=="number"&&typeof de[1]=="number"&&de[0]<=de[1],"depth range is 2d array",$.commandStr),de},function(de,Re,ce){le.optional(function(){de.assert(Re,de.shared.isArrayLike+"("+ce+")&&"+ce+".length===2&&typeof "+ce+'[0]==="number"&&typeof '+ce+'[1]==="number"&&'+ce+"[0]<="+ce+"[1]","depth range must be a 2d array")});var $e=Re.def("+",ce,"[0]"),it=Re.def("+",ce,"[1]");return[$e,it]});case Wi:return Xe(function(de){le.commandType(de,"object","blend.func",$.commandStr);var Re="srcRGB"in de?de.srcRGB:de.src,ce="srcAlpha"in de?de.srcAlpha:de.src,$e="dstRGB"in de?de.dstRGB:de.dst,it="dstAlpha"in de?de.dstAlpha:de.dst;return le.commandParameter(Re,rl,Ne+".srcRGB",$.commandStr),le.commandParameter(ce,rl,Ne+".srcAlpha",$.commandStr),le.commandParameter($e,rl,Ne+".dstRGB",$.commandStr),le.commandParameter(it,rl,Ne+".dstAlpha",$.commandStr),le.command(Cc.indexOf(Re+", "+$e)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+Re+", "+$e+")",$.commandStr),[rl[Re],rl[$e],rl[ce],rl[it]]},function(de,Re,ce){var $e=de.constants.blendFuncs;le.optional(function(){de.assert(Re,ce+"&&typeof "+ce+'==="object"',"invalid blend func, must be an object")});function it(Jr,xn){var Bn=Re.def('"',Jr,xn,'" in ',ce,"?",ce,".",Jr,xn,":",ce,".",Jr);return le.optional(function(){de.assert(Re,Bn+" in "+$e,"invalid "+Ue+"."+Jr+xn+", must be one of "+Object.keys(rl))}),Bn}var zt=it("src","RGB"),mt=it("dst","RGB");le.optional(function(){var Jr=de.constants.invalidBlendCombinations;de.assert(Re,Jr+".indexOf("+zt+'+", "+'+mt+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Rt=Re.def($e,"[",zt,"]"),sr=Re.def($e,"[",it("src","Alpha"),"]"),en=Re.def($e,"[",mt,"]"),qn=Re.def($e,"[",it("dst","Alpha"),"]");return[Rt,en,sr,qn]});case Da:return Xe(function(de){if(typeof de=="string")return le.commandParameter(de,Tt,"invalid "+Ue,$.commandStr),[Tt[de],Tt[de]];if(typeof de=="object")return le.commandParameter(de.rgb,Tt,Ue+".rgb",$.commandStr),le.commandParameter(de.alpha,Tt,Ue+".alpha",$.commandStr),[Tt[de.rgb],Tt[de.alpha]];le.commandRaise("invalid blend.equation",$.commandStr)},function(de,Re,ce){var $e=de.constants.blendEquations,it=Re.def(),zt=Re.def(),mt=de.cond("typeof ",ce,'==="string"');return le.optional(function(){function Rt(sr,en,qn){de.assert(sr,qn+" in "+$e,"invalid "+en+", must be one of "+Object.keys(Tt))}Rt(mt.then,Ue,ce),de.assert(mt.else,ce+"&&typeof "+ce+'==="object"',"invalid "+Ue),Rt(mt.else,Ue+".rgb",ce+".rgb"),Rt(mt.else,Ue+".alpha",ce+".alpha")}),mt.then(it,"=",zt,"=",$e,"[",ce,"];"),mt.else(it,"=",$e,"[",ce,".rgb];",zt,"=",$e,"[",ce,".alpha];"),Re(mt),[it,zt]});case _n:return Xe(function(de){return le.command(ca(de)&&de.length===4,"blend.color must be a 4d array",$.commandStr),U(4,function(Re){return+de[Re]})},function(de,Re,ce){return le.optional(function(){de.assert(Re,de.shared.isArrayLike+"("+ce+")&&"+ce+".length===4","blend.color must be a 4d array")}),U(4,function($e){return Re.def("+",ce,"[",$e,"]")})});case Bs:return Xe(function(de){return le.commandType(de,"number",Ne,$.commandStr),de|0},function(de,Re,ce){return le.optional(function(){de.assert(Re,"typeof "+ce+'==="number"',"invalid stencil.mask")}),Re.def(ce,"|0")});case Ku:return Xe(function(de){le.commandType(de,"object",Ne,$.commandStr);var Re=de.cmp||"keep",ce=de.ref||0,$e="mask"in de?de.mask:-1;return le.commandParameter(Re,ef,Ue+".cmp",$.commandStr),le.commandType(ce,"number",Ue+".ref",$.commandStr),le.commandType($e,"number",Ue+".mask",$.commandStr),[ef[Re],ce,$e]},function(de,Re,ce){var $e=de.constants.compareFuncs;le.optional(function(){function Rt(){de.assert(Re,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Rt(ce+"&&typeof ",ce,'==="object"'),Rt('!("cmp" in ',ce,")||(",ce,".cmp in ",$e,")")});var it=Re.def('"cmp" in ',ce,"?",$e,"[",ce,".cmp]",":",Al),zt=Re.def(ce,".ref|0"),mt=Re.def('"mask" in ',ce,"?",ce,".mask|0:-1");return[it,zt,mt]});case Ba:case na:return Xe(function(de){le.commandType(de,"object",Ne,$.commandStr);var Re=de.fail||"keep",ce=de.zfail||"keep",$e=de.zpass||"keep";return le.commandParameter(Re,nl,Ue+".fail",$.commandStr),le.commandParameter(ce,nl,Ue+".zfail",$.commandStr),le.commandParameter($e,nl,Ue+".zpass",$.commandStr),[Ue===na?tl:Pu,nl[Re],nl[ce],nl[$e]]},function(de,Re,ce){var $e=de.constants.stencilOps;le.optional(function(){de.assert(Re,ce+"&&typeof "+ce+'==="object"',"invalid "+Ue)});function it(zt){return le.optional(function(){de.assert(Re,'!("'+zt+'" in '+ce+")||("+ce+"."+zt+" in "+$e+")","invalid "+Ue+"."+zt+", must be one of "+Object.keys(nl))}),Re.def('"',zt,'" in ',ce,"?",$e,"[",ce,".",zt,"]:",Al)}return[Ue===na?tl:Pu,it("fail"),it("zfail"),it("zpass")]});case ru:return Xe(function(de){le.commandType(de,"object",Ne,$.commandStr);var Re=de.factor|0,ce=de.units|0;return le.commandType(Re,"number",Ne+".factor",$.commandStr),le.commandType(ce,"number",Ne+".units",$.commandStr),[Re,ce]},function(de,Re,ce){le.optional(function(){de.assert(Re,ce+"&&typeof "+ce+'==="object"',"invalid "+Ue)});var $e=Re.def(ce,".factor|0"),it=Re.def(ce,".units|0");return[$e,it]});case Ts:return Xe(function(de){var Re=0;return de==="front"?Re=Pu:de==="back"&&(Re=tl),le.command(!!Re,Ne,$.commandStr),Re},function(de,Re,ce){return le.optional(function(){de.assert(Re,ce+'==="front"||'+ce+'==="back"',"invalid cull.face")}),Re.def(ce,'==="front"?',Pu,":",tl)});case Jo:return Xe(function(de){return le.command(typeof de=="number"&&de>=gt.lineWidthDims[0]&&de<=gt.lineWidthDims[1],"invalid line width, must be a positive number between "+gt.lineWidthDims[0]+" and "+gt.lineWidthDims[1],$.commandStr),de},function(de,Re,ce){return le.optional(function(){de.assert(Re,"typeof "+ce+'==="number"&&'+ce+">="+gt.lineWidthDims[0]+"&&"+ce+"<="+gt.lineWidthDims[1],"invalid line width")}),ce});case co:return Xe(function(de){return le.commandParameter(de,fo,Ne,$.commandStr),fo[de]},function(de,Re,ce){return le.optional(function(){de.assert(Re,ce+'==="cw"||'+ce+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),Re.def(ce+'==="cw"?'+su+":"+bp)});case Fa:return Xe(function(de){return le.command(ca(de)&&de.length===4,"color.mask must be length 4 array",$.commandStr),de.map(function(Re){return!!Re})},function(de,Re,ce){return le.optional(function(){de.assert(Re,de.shared.isArrayLike+"("+ce+")&&"+ce+".length===4","invalid color.mask")}),U(4,function($e){return"!!"+ce+"["+$e+"]"})});case iu:return Xe(function(de){le.command(typeof de=="object"&&de,Ne,$.commandStr);var Re="value"in de?de.value:1,ce=!!de.invert;return le.command(typeof Re=="number"&&Re>=0&&Re<=1,"sample.coverage.value must be a number between 0 and 1",$.commandStr),[Re,ce]},function(de,Re,ce){le.optional(function(){de.assert(Re,ce+"&&typeof "+ce+'==="object"',"invalid sample.coverage")});var $e=Re.def('"value" in ',ce,"?+",ce,".value:1"),it=Re.def("!!",ce,".invert");return[$e,it]})}}),tt}function po(pe,$){var Be=pe.static,Qe=pe.dynamic,tt={};return Object.keys(Be).forEach(function(Ue){var Ne=Be[Ue],Xe;if(typeof Ne=="number"||typeof Ne=="boolean")Xe=Pa(function(){return Ne});else if(typeof Ne=="function"){var de=Ne._reglType;de==="texture2d"||de==="textureCube"?Xe=Pa(function(Re){return Re.link(Ne)}):de==="framebuffer"||de==="framebufferCube"?(le.command(Ne.color.length>0,'missing color attachment for framebuffer sent to uniform "'+Ue+'"',$.commandStr),Xe=Pa(function(Re){return Re.link(Ne.color[0])})):le.commandRaise('invalid data for uniform "'+Ue+'"',$.commandStr)}else ca(Ne)?Xe=Pa(function(Re){var ce=Re.global.def("[",U(Ne.length,function($e){return le.command(typeof Ne[$e]=="number"||typeof Ne[$e]=="boolean","invalid uniform "+Ue,Re.commandStr),Ne[$e]}),"]");return ce}):le.commandRaise('invalid or missing data for uniform "'+Ue+'"',$.commandStr);Xe.value=Ne,tt[Ue]=Xe}),Object.keys(Qe).forEach(function(Ue){var Ne=Qe[Ue];tt[Ue]=Vo(Ne,function(Xe,de){return Xe.invoke(de,Ne)})}),tt}function ai(pe,$){var Be=pe.static,Qe=pe.dynamic,tt={};return Object.keys(Be).forEach(function(Ue){var Ne=Be[Ue],Xe=ae.id(Ue),de=new et;if(Of(Ne))de.state=tn,de.buffer=Zt.getBuffer(Zt.create(Ne,Cl,!1,!0)),de.type=0;else{var Re=Zt.getBuffer(Ne);if(Re)de.state=tn,de.buffer=Re,de.type=0;else if(le.command(typeof Ne=="object"&&Ne,"invalid data for attribute "+Ue,$.commandStr),"constant"in Ne){var ce=Ne.constant;de.buffer="null",de.state=pn,typeof ce=="number"?de.x=ce:(le.command(ca(ce)&&ce.length>0&&ce.length<=4,"invalid constant for attribute "+Ue,$.commandStr),pr.forEach(function(en,qn){qn<ce.length&&(de[en]=ce[qn])}))}else{Of(Ne.buffer)?Re=Zt.getBuffer(Zt.create(Ne.buffer,Cl,!1,!0)):Re=Zt.getBuffer(Ne.buffer),le.command(!!Re,'missing buffer for attribute "'+Ue+'"',$.commandStr);var $e=Ne.offset|0;le.command($e>=0,'invalid offset for attribute "'+Ue+'"',$.commandStr);var it=Ne.stride|0;le.command(it>=0&&it<256,'invalid stride for attribute "'+Ue+'", must be integer betweeen [0, 255]',$.commandStr);var zt=Ne.size|0;le.command(!("size"in Ne)||zt>0&&zt<=4,'invalid size for attribute "'+Ue+'", must be 1,2,3,4',$.commandStr);var mt=!!Ne.normalized,Rt=0;"type"in Ne&&(le.commandParameter(Ne.type,as,"invalid type for attribute "+Ue,$.commandStr),Rt=as[Ne.type]);var sr=Ne.divisor|0;"divisor"in Ne&&(le.command(sr===0||nr,'cannot specify divisor for attribute "'+Ue+'", instancing not supported',$.commandStr),le.command(sr>=0,'invalid divisor for attribute "'+Ue+'"',$.commandStr)),le.optional(function(){var en=$.commandStr,qn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(Ne).forEach(function(Jr){le.command(qn.indexOf(Jr)>=0,'unknown parameter "'+Jr+'" for attribute pointer "'+Ue+'" (valid parameters are '+qn+")",en)})}),de.buffer=Re,de.state=tn,de.size=zt,de.normalized=mt,de.type=Rt||Re.dtype,de.offset=$e,de.stride=it,de.divisor=sr}}tt[Ue]=Pa(function(en,qn){var Jr=en.attribCache;if(Xe in Jr)return Jr[Xe];var xn={isStream:!1};return Object.keys(de).forEach(function(Bn){xn[Bn]=de[Bn]}),de.buffer&&(xn.buffer=en.link(de.buffer),xn.type=xn.type||xn.buffer+".dtype"),Jr[Xe]=xn,xn})}),Object.keys(Qe).forEach(function(Ue){var Ne=Qe[Ue];function Xe(de,Re){var ce=de.invoke(Re,Ne),$e=de.shared,it=de.constants,zt=$e.isBufferArgs,mt=$e.buffer;le.optional(function(){de.assert(Re,ce+"&&(typeof "+ce+'==="object"||typeof '+ce+'==="function")&&('+zt+"("+ce+")||"+mt+".getBuffer("+ce+")||"+mt+".getBuffer("+ce+".buffer)||"+zt+"("+ce+'.buffer)||("constant" in '+ce+"&&(typeof "+ce+'.constant==="number"||'+$e.isArrayLike+"("+ce+".constant))))",'invalid dynamic attribute "'+Ue+'"')});var Rt={isStream:Re.def(!1)},sr=new et;sr.state=tn,Object.keys(sr).forEach(function(xn){Rt[xn]=Re.def(""+sr[xn])});var en=Rt.buffer,qn=Rt.type;Re("if(",zt,"(",ce,")){",Rt.isStream,"=true;",en,"=",mt,".createStream(",Cl,",",ce,");",qn,"=",en,".dtype;","}else{",en,"=",mt,".getBuffer(",ce,");","if(",en,"){",qn,"=",en,".dtype;",'}else if("constant" in ',ce,"){",Rt.state,"=",pn,";","if(typeof "+ce+'.constant === "number"){',Rt[pr[0]],"=",ce,".constant;",pr.slice(1).map(function(xn){return Rt[xn]}).join("="),"=0;","}else{",pr.map(function(xn,Bn){return Rt[xn]+"="+ce+".constant.length>"+Bn+"?"+ce+".constant["+Bn+"]:0;"}).join(""),"}}else{","if(",zt,"(",ce,".buffer)){",en,"=",mt,".createStream(",Cl,",",ce,".buffer);","}else{",en,"=",mt,".getBuffer(",ce,".buffer);","}",qn,'="type" in ',ce,"?",it.glTypes,"[",ce,".type]:",en,".dtype;",Rt.normalized,"=!!",ce,".normalized;");function Jr(xn){Re(Rt[xn],"=",ce,".",xn,"|0;")}return Jr("size"),Jr("offset"),Jr("stride"),Jr("divisor"),Re("}}"),Re.exit("if(",Rt.isStream,"){",mt,".destroyStream(",en,");","}"),Rt}tt[Ue]=Vo(Ne,Xe)}),tt}function ha(pe,$){var Be=pe.static,Qe=pe.dynamic;if(zs in Be){var tt=Be[zs];return tt!==null&&fr.getVAO(tt)===null&&(tt=fr.createVAO(tt)),Pa(function(Ne){return Ne.link(fr.getVAO(tt))})}else if(zs in Qe){var Ue=Qe[zs];return Vo(Ue,function(Ne,Xe){var de=Ne.invoke(Xe,Ue);return Xe.def(Ne.shared.vao+".getVAO("+de+")")})}return null}function Hi(pe){var $=pe.static,Be=pe.dynamic,Qe={};return Object.keys($).forEach(function(tt){var Ue=$[tt];Qe[tt]=Pa(function(Ne,Xe){return typeof Ue=="number"||typeof Ue=="boolean"?""+Ue:Ne.link(Ue)})}),Object.keys(Be).forEach(function(tt){var Ue=Be[tt];Qe[tt]=Vo(Ue,function(Ne,Xe){return Ne.invoke(Xe,Ue)})}),Qe}function Na(pe,$,Be,Qe,tt){var Ue=pe.static,Ne=pe.dynamic;le.optional(function(){var Jr=[io,ao,ps,$u,ou,Ju,ql,bc,di,zs].concat(Qt);function xn(Bn){Object.keys(Bn).forEach(function(xi){le.command(Jr.indexOf(xi)>=0,'unknown parameter "'+xi+'"',tt.commandStr)})}xn(Ue),xn(Ne)});var Xe=Dn(pe,$),de=qr(pe,tt),Re=Qn(pe,de,tt),ce=yi(pe,tt),$e=xa(pe,tt),it=Yn(pe,tt,Xe);function zt(Jr){var xn=Re[Jr];xn&&($e[Jr]=xn)}zt(Uo),zt(mr(Ns));var mt=Object.keys($e).length>0,Rt={framebuffer:de,draw:ce,shader:it,state:$e,dirty:mt,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Rt.profile=yn(pe,tt),Rt.uniforms=po(Be,tt),Rt.drawVAO=Rt.scopeVAO=ha(pe,tt),!Rt.drawVAO&&it.program&&!Xe&&ge.angle_instanced_arrays){var sr=!0,en=it.program.attributes.map(function(Jr){var xn=$.static[Jr];return sr=sr&&!!xn,xn});if(sr&&en.length>0){var qn=fr.getVAO(fr.createVAO(en));Rt.drawVAO=new Qo(null,null,null,function(Jr,xn){return Jr.link(qn)}),Rt.useVAO=!0}}return Xe?Rt.useVAO=!0:Rt.attributes=ai($,tt),Rt.context=Hi(Qe,tt),Rt}function za(pe,$,Be){var Qe=pe.shared,tt=Qe.context,Ue=pe.scope();Object.keys(Be).forEach(function(Ne){$.save(tt,"."+Ne);var Xe=Be[Ne],de=Xe.append(pe,$);Array.isArray(de)?Ue(tt,".",Ne,"=[",de.join(),"];"):Ue(tt,".",Ne,"=",de,";")}),$(Ue)}function Ka(pe,$,Be,Qe){var tt=pe.shared,Ue=tt.gl,Ne=tt.framebuffer,Xe;Or&&(Xe=$.def(tt.extensions,".webgl_draw_buffers"));var de=pe.constants,Re=de.drawBuffer,ce=de.backBuffer,$e;Be?$e=Be.append(pe,$):$e=$.def(Ne,".next"),Qe||$("if(",$e,"!==",Ne,".cur){"),$("if(",$e,"){",Ue,".bindFramebuffer(",wp,",",$e,".framebuffer);"),Or&&$(Xe,".drawBuffersWEBGL(",Re,"[",$e,".colorAttachments.length]);"),$("}else{",Ue,".bindFramebuffer(",wp,",null);"),Or&&$(Xe,".drawBuffersWEBGL(",ce,");"),$("}",Ne,".cur=",$e,";"),Qe||$("}")}function ho(pe,$,Be){var Qe=pe.shared,tt=Qe.gl,Ue=pe.current,Ne=pe.next,Xe=Qe.current,de=Qe.next,Re=pe.cond(Xe,".dirty");Qt.forEach(function(ce){var $e=mr(ce);if(!($e in Be.state)){var it,zt;if($e in Ne){it=Ne[$e],zt=Ue[$e];var mt=U(Wt[$e].length,function(sr){return Re.def(it,"[",sr,"]")});Re(pe.cond(mt.map(function(sr,en){return sr+"!=="+zt+"["+en+"]"}).join("||")).then(tt,".",Xt[$e],"(",mt,");",mt.map(function(sr,en){return zt+"["+en+"]="+sr}).join(";"),";"))}else{it=Re.def(de,".",$e);var Rt=pe.cond(it,"!==",Xe,".",$e);Re(Rt),$e in Sr?Rt(pe.cond(it).then(tt,".enable(",Sr[$e],");").else(tt,".disable(",Sr[$e],");"),Xe,".",$e,"=",it,";"):Rt(tt,".",Xt[$e],"(",it,");",Xe,".",$e,"=",it,";")}}}),Object.keys(Be.state).length===0&&Re(Xe,".dirty=false;"),$(Re)}function So(pe,$,Be,Qe){var tt=pe.shared,Ue=pe.current,Ne=tt.current,Xe=tt.gl;Sp(Object.keys(Be)).forEach(function(de){var Re=Be[de];if(!(Qe&&!Qe(Re))){var ce=Re.append(pe,$);if(Sr[de]){var $e=Sr[de];As(Re)?ce?$(Xe,".enable(",$e,");"):$(Xe,".disable(",$e,");"):$(pe.cond(ce).then(Xe,".enable(",$e,");").else(Xe,".disable(",$e,");")),$(Ne,".",de,"=",ce,";")}else if(ca(ce)){var it=Ue[de];$(Xe,".",Xt[de],"(",ce,");",ce.map(function(zt,mt){return it+"["+mt+"]="+zt}).join(";"),";")}else $(Xe,".",Xt[de],"(",ce,");",Ne,".",de,"=",ce,";")}})}function Ia(pe,$){nr&&(pe.instancing=$.def(pe.shared.extensions,".angle_instanced_arrays"))}function Gn(pe,$,Be,Qe,tt){var Ue=pe.shared,Ne=pe.stats,Xe=Ue.current,de=Ue.timer,Re=Be.profile;function ce(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var $e,it;function zt(Jr){$e=$.def(),Jr($e,"=",ce(),";"),typeof tt=="string"?Jr(Ne,".count+=",tt,";"):Jr(Ne,".count++;"),er&&(Qe?(it=$.def(),Jr(it,"=",de,".getNumPendingQueries();")):Jr(de,".beginQuery(",Ne,");"))}function mt(Jr){Jr(Ne,".cpuTime+=",ce(),"-",$e,";"),er&&(Qe?Jr(de,".pushScopeStats(",it,",",de,".getNumPendingQueries(),",Ne,");"):Jr(de,".endQuery();"))}function Rt(Jr){var xn=$.def(Xe,".profile");$(Xe,".profile=",Jr,";"),$.exit(Xe,".profile=",xn,";")}var sr;if(Re){if(As(Re)){Re.enable?(zt($),mt($.exit),Rt("true")):Rt("false");return}sr=Re.append(pe,$),Rt(sr)}else sr=$.def(Xe,".profile");var en=pe.block();zt(en),$("if(",sr,"){",en,"}");var qn=pe.block();mt(qn),$.exit("if(",sr,"){",qn,"}")}function Ro(pe,$,Be,Qe,tt){var Ue=pe.shared;function Ne(de){switch(de){case Af:case $l:case Pf:return 2;case ia:case Jl:case ec:return 3;case Kl:case Ql:case wc:return 4;default:return 1}}function Xe(de,Re,ce){var $e=Ue.gl,it=$.def(de,".location"),zt=$.def(Ue.attributes,"[",it,"]"),mt=ce.state,Rt=ce.buffer,sr=[ce.x,ce.y,ce.z,ce.w],en=["buffer","normalized","offset","stride"];function qn(){$("if(!",zt,".buffer){",$e,".enableVertexAttribArray(",it,");}");var xn=ce.type,Bn;if(ce.size?Bn=$.def(ce.size,"||",Re):Bn=Re,$("if(",zt,".type!==",xn,"||",zt,".size!==",Bn,"||",en.map(function(ba){return zt+"."+ba+"!=="+ce[ba]}).join("||"),"){",$e,".bindBuffer(",Cl,",",Rt,".buffer);",$e,".vertexAttribPointer(",[it,Bn,xn,ce.normalized,ce.stride,ce.offset],");",zt,".type=",xn,";",zt,".size=",Bn,";",en.map(function(ba){return zt+"."+ba+"="+ce[ba]+";"}).join(""),"}"),nr){var xi=ce.divisor;$("if(",zt,".divisor!==",xi,"){",pe.instancing,".vertexAttribDivisorANGLE(",[it,xi],");",zt,".divisor=",xi,";}")}}function Jr(){$("if(",zt,".buffer){",$e,".disableVertexAttribArray(",it,");",zt,".buffer=null;","}if(",pr.map(function(xn,Bn){return zt+"."+xn+"!=="+sr[Bn]}).join("||"),"){",$e,".vertexAttrib4f(",it,",",sr,");",pr.map(function(xn,Bn){return zt+"."+xn+"="+sr[Bn]+";"}).join(""),"}")}mt===tn?qn():mt===pn?Jr():($("if(",mt,"===",tn,"){"),qn(),$("}else{"),Jr(),$("}"))}Qe.forEach(function(de){var Re=de.name,ce=Be.attributes[Re],$e;if(ce){if(!tt(ce))return;$e=ce.append(pe,$)}else{if(!tt(Ep))return;var it=pe.scopeAttrib(Re);le.optional(function(){pe.assert($,it+".state","missing attribute "+Re)}),$e={},Object.keys(new et).forEach(function(zt){$e[zt]=$.def(it,".",zt)})}Xe(pe.link(de),Ne(de.info.type),$e)})}function Ei(pe,$,Be,Qe,tt){for(var Ue=pe.shared,Ne=Ue.gl,Xe,de=0;de<Qe.length;++de){var Re=Qe[de],ce=Re.name,$e=Re.info.type,it=Be.uniforms[ce],zt=pe.link(Re),mt=zt+".location",Rt;if(it){if(!tt(it))continue;if(As(it)){var sr=it.value;if(le.command(sr!==null&&typeof sr!="undefined",'missing uniform "'+ce+'"',pe.commandStr),$e===Qc||$e===tc){le.command(typeof sr=="function"&&($e===Qc&&(sr._reglType==="texture2d"||sr._reglType==="framebuffer")||$e===tc&&(sr._reglType==="textureCube"||sr._reglType==="framebufferCube")),"invalid texture for uniform "+ce,pe.commandStr);var en=pe.link(sr._texture||sr.color[0]._texture);$(Ne,".uniform1i(",mt,",",en+".bind());"),$.exit(en,".unbind();")}else if($e===Sc||$e===If||$e===el){le.optional(function(){le.command(ca(sr),"invalid matrix for uniform "+ce,pe.commandStr),le.command($e===Sc&&sr.length===4||$e===If&&sr.length===9||$e===el&&sr.length===16,"invalid length for matrix uniform "+ce,pe.commandStr)});var qn=pe.global.def("new Float32Array(["+Array.prototype.slice.call(sr)+"])"),Jr=2;$e===If?Jr=3:$e===el&&(Jr=4),$(Ne,".uniformMatrix",Jr,"fv(",mt,",false,",qn,");")}else{switch($e){case Tl:le.commandType(sr,"number","uniform "+ce,pe.commandStr),Xe="1f";break;case Af:le.command(ca(sr)&&sr.length===2,"uniform "+ce,pe.commandStr),Xe="2f";break;case ia:le.command(ca(sr)&&sr.length===3,"uniform "+ce,pe.commandStr),Xe="3f";break;case Kl:le.command(ca(sr)&&sr.length===4,"uniform "+ce,pe.commandStr),Xe="4f";break;case rp:le.commandType(sr,"boolean","uniform "+ce,pe.commandStr),Xe="1i";break;case Mf:le.commandType(sr,"number","uniform "+ce,pe.commandStr),Xe="1i";break;case Pf:le.command(ca(sr)&&sr.length===2,"uniform "+ce,pe.commandStr),Xe="2i";break;case $l:le.command(ca(sr)&&sr.length===2,"uniform "+ce,pe.commandStr),Xe="2i";break;case ec:le.command(ca(sr)&&sr.length===3,"uniform "+ce,pe.commandStr),Xe="3i";break;case Jl:le.command(ca(sr)&&sr.length===3,"uniform "+ce,pe.commandStr),Xe="3i";break;case wc:le.command(ca(sr)&&sr.length===4,"uniform "+ce,pe.commandStr),Xe="4i";break;case Ql:le.command(ca(sr)&&sr.length===4,"uniform "+ce,pe.commandStr),Xe="4i";break}$(Ne,".uniform",Xe,"(",mt,",",ca(sr)?Array.prototype.slice.call(sr):sr,");")}continue}else Rt=it.append(pe,$)}else{if(!tt(Ep))continue;Rt=$.def(Ue.uniforms,"[",ae.id(ce),"]")}$e===Qc?(le(!Array.isArray(Rt),"must specify a scalar prop for textures"),$("if(",Rt,"&&",Rt,'._reglType==="framebuffer"){',Rt,"=",Rt,".color[0];","}")):$e===tc&&(le(!Array.isArray(Rt),"must specify a scalar prop for cube maps"),$("if(",Rt,"&&",Rt,'._reglType==="framebufferCube"){',Rt,"=",Rt,".color[0];","}")),le.optional(function(){function vo(Vs,Lf){pe.assert($,Vs,'bad data or missing for uniform "'+ce+'".  '+Lf)}function kf(Vs){le(!Array.isArray(Rt),"must not specify an array type for uniform"),vo("typeof "+Rt+'==="'+Vs+'"',"invalid type, expected "+Vs)}function js(Vs,Lf){Array.isArray(Rt)?le(Rt.length===Vs,"must have length "+Vs):vo(Ue.isArrayLike+"("+Rt+")&&"+Rt+".length==="+Vs,"invalid vector, should have length "+Vs,pe.commandStr)}function np(Vs){le(!Array.isArray(Rt),"must not specify a value type"),vo("typeof "+Rt+'==="function"&&'+Rt+'._reglType==="texture'+(Vs===Qu?"2d":"Cube")+'"',"invalid texture type",pe.commandStr)}switch($e){case Mf:kf("number");break;case $l:js(2,"number");break;case Jl:js(3,"number");break;case Ql:js(4,"number");break;case Tl:kf("number");break;case Af:js(2,"number");break;case ia:js(3,"number");break;case Kl:js(4,"number");break;case rp:kf("boolean");break;case Pf:js(2,"boolean");break;case ec:js(3,"boolean");break;case wc:js(4,"boolean");break;case Sc:js(4,"number");break;case If:js(9,"number");break;case el:js(16,"number");break;case Qc:np(Qu);break;case tc:np(Jc);break}});var xn=1;switch($e){case Qc:case tc:var Bn=$.def(Rt,"._texture");$(Ne,".uniform1i(",mt,",",Bn,".bind());"),$.exit(Bn,".unbind();");continue;case Mf:case rp:Xe="1i";break;case $l:case Pf:Xe="2i",xn=2;break;case Jl:case ec:Xe="3i",xn=3;break;case Ql:case wc:Xe="4i",xn=4;break;case Tl:Xe="1f";break;case Af:Xe="2f",xn=2;break;case ia:Xe="3f",xn=3;break;case Kl:Xe="4f",xn=4;break;case Sc:Xe="Matrix2fv";break;case If:Xe="Matrix3fv";break;case el:Xe="Matrix4fv";break}if($(Ne,".uniform",Xe,"(",mt,","),Xe.charAt(0)==="M"){var xi=Math.pow($e-Sc+2,2),ba=pe.global.def("new Float32Array(",xi,")");Array.isArray(Rt)?$("false,(",U(xi,function(vo){return ba+"["+vo+"]="+Rt[vo]}),",",ba,")"):$("false,(Array.isArray(",Rt,")||",Rt," instanceof Float32Array)?",Rt,":(",U(xi,function(vo){return ba+"["+vo+"]="+Rt+"["+vo+"]"}),",",ba,")")}else xn>1?$(U(xn,function(vo){return Array.isArray(Rt)?Rt[vo]:Rt+"["+vo+"]"})):(le(!Array.isArray(Rt),"uniform value must not be an array"),$(Rt));$(");")}}function mn(pe,$,Be,Qe){var tt=pe.shared,Ue=tt.gl,Ne=tt.draw,Xe=Qe.draw;function de(){var Bn=Xe.elements,xi,ba=$;return Bn?((Bn.contextDep&&Qe.contextDynamic||Bn.propDep)&&(ba=Be),xi=Bn.append(pe,ba)):xi=ba.def(Ne,".",$u),xi&&ba("if("+xi+")"+Ue+".bindBuffer("+oh+","+xi+".buffer.buffer);"),xi}function Re(){var Bn=Xe.count,xi,ba=$;return Bn?((Bn.contextDep&&Qe.contextDynamic||Bn.propDep)&&(ba=Be),xi=Bn.append(pe,ba),le.optional(function(){Bn.MISSING&&pe.assert($,"false","missing vertex count"),Bn.DYNAMIC&&pe.assert(ba,xi+">=0","missing vertex count")})):(xi=ba.def(Ne,".",ql),le.optional(function(){pe.assert(ba,xi+">=0","missing vertex count")})),xi}var ce=de();function $e(Bn){var xi=Xe[Bn];return xi?xi.contextDep&&Qe.contextDynamic||xi.propDep?xi.append(pe,Be):xi.append(pe,$):$.def(Ne,".",Bn)}var it=$e(ou),zt=$e(Ju),mt=Re();if(typeof mt=="number"){if(mt===0)return}else Be("if(",mt,"){"),Be.exit("}");var Rt,sr;nr&&(Rt=$e(bc),sr=pe.instancing);var en=ce+".type",qn=Xe.elements&&As(Xe.elements);function Jr(){function Bn(){Be(sr,".drawElementsInstancedANGLE(",[it,mt,en,zt+"<<(("+en+"-"+Fr+")>>1)",Rt],");")}function xi(){Be(sr,".drawArraysInstancedANGLE(",[it,zt,mt,Rt],");")}ce?qn?Bn():(Be("if(",ce,"){"),Bn(),Be("}else{"),xi(),Be("}")):xi()}function xn(){function Bn(){Be(Ue+".drawElements("+[it,mt,en,zt+"<<(("+en+"-"+Fr+")>>1)"]+");")}function xi(){Be(Ue+".drawArrays("+[it,zt,mt]+");")}ce?qn?Bn():(Be("if(",ce,"){"),Bn(),Be("}else{"),xi(),Be("}")):xi()}nr&&(typeof Rt!="number"||Rt>=0)?typeof Rt=="string"?(Be("if(",Rt,">0){"),Jr(),Be("}else if(",Rt,"<0){"),xn(),Be("}")):Jr():xn()}function ei(pe,$,Be,Qe,tt){var Ue=bn(),Ne=Ue.proc("body",tt);return le.optional(function(){Ue.commandStr=$.commandStr,Ue.command=Ue.link($.commandStr)}),nr&&(Ue.instancing=Ne.def(Ue.shared.extensions,".angle_instanced_arrays")),pe(Ue,Ne,Be,Qe),Ue.compile().body}function li(pe,$,Be,Qe){Ia(pe,$),Be.useVAO?Be.drawVAO?$(pe.shared.vao,".setVAO(",Be.drawVAO.append(pe,$),");"):$(pe.shared.vao,".setVAO(",pe.shared.vao,".targetVAO);"):($(pe.shared.vao,".setVAO(null);"),Ro(pe,$,Be,Qe.attributes,function(){return!0})),Ei(pe,$,Be,Qe.uniforms,function(){return!0}),mn(pe,$,$,Be)}function Oa(pe,$){var Be=pe.proc("draw",1);Ia(pe,Be),za(pe,Be,$.context),Ka(pe,Be,$.framebuffer),ho(pe,Be,$),So(pe,Be,$.state),Gn(pe,Be,$,!1,!0);var Qe=$.shader.progVar.append(pe,Be);if(Be(pe.shared.gl,".useProgram(",Qe,".program);"),$.shader.program)li(pe,Be,$,$.shader.program);else{Be(pe.shared.vao,".setVAO(null);");var tt=pe.global.def("{}"),Ue=Be.def(Qe,".id"),Ne=Be.def(tt,"[",Ue,"]");Be(pe.cond(Ne).then(Ne,".call(this,a0);").else(Ne,"=",tt,"[",Ue,"]=",pe.link(function(Xe){return ei(li,pe,$,Xe,1)}),"(",Qe,");",Ne,".call(this,a0);"))}Object.keys($.state).length>0&&Be(pe.shared.current,".dirty=true;")}function Us(pe,$,Be,Qe){pe.batchId="a1",Ia(pe,$);function tt(){return!0}Ro(pe,$,Be,Qe.attributes,tt),Ei(pe,$,Be,Qe.uniforms,tt),mn(pe,$,$,Be)}function il(pe,$,Be,Qe){Ia(pe,$);var tt=Be.contextDep,Ue=$.def(),Ne="a0",Xe="a1",de=$.def();pe.shared.props=de,pe.batchId=Ue;var Re=pe.scope(),ce=pe.scope();$(Re.entry,"for(",Ue,"=0;",Ue,"<",Xe,";++",Ue,"){",de,"=",Ne,"[",Ue,"];",ce,"}",Re.exit);function $e(en){return en.contextDep&&tt||en.propDep}function it(en){return!$e(en)}if(Be.needsContext&&za(pe,ce,Be.context),Be.needsFramebuffer&&Ka(pe,ce,Be.framebuffer),So(pe,ce,Be.state,$e),Be.profile&&$e(Be.profile)&&Gn(pe,ce,Be,!1,!0),Qe)Be.useVAO?Be.drawVAO?$e(Be.drawVAO)?ce(pe.shared.vao,".setVAO(",Be.drawVAO.append(pe,ce),");"):Re(pe.shared.vao,".setVAO(",Be.drawVAO.append(pe,Re),");"):Re(pe.shared.vao,".setVAO(",pe.shared.vao,".targetVAO);"):(Re(pe.shared.vao,".setVAO(null);"),Ro(pe,Re,Be,Qe.attributes,it),Ro(pe,ce,Be,Qe.attributes,$e)),Ei(pe,Re,Be,Qe.uniforms,it),Ei(pe,ce,Be,Qe.uniforms,$e),mn(pe,Re,ce,Be);else{var zt=pe.global.def("{}"),mt=Be.shader.progVar.append(pe,ce),Rt=ce.def(mt,".id"),sr=ce.def(zt,"[",Rt,"]");ce(pe.shared.gl,".useProgram(",mt,".program);","if(!",sr,"){",sr,"=",zt,"[",Rt,"]=",pe.link(function(en){return ei(Us,pe,Be,en,2)}),"(",mt,");}",sr,".call(this,a0[",Ue,"],",Ue,");")}}function xe(pe,$){var Be=pe.proc("batch",2);pe.batchId="0",Ia(pe,Be);var Qe=!1,tt=!0;Object.keys($.context).forEach(function(zt){Qe=Qe||$.context[zt].propDep}),Qe||(za(pe,Be,$.context),tt=!1);var Ue=$.framebuffer,Ne=!1;Ue?(Ue.propDep?Qe=Ne=!0:Ue.contextDep&&Qe&&(Ne=!0),Ne||Ka(pe,Be,Ue)):Ka(pe,Be,null),$.state.viewport&&$.state.viewport.propDep&&(Qe=!0);function Xe(zt){return zt.contextDep&&Qe||zt.propDep}ho(pe,Be,$),So(pe,Be,$.state,function(zt){return!Xe(zt)}),(!$.profile||!Xe($.profile))&&Gn(pe,Be,$,!1,"a1"),$.contextDep=Qe,$.needsContext=tt,$.needsFramebuffer=Ne;var de=$.shader.progVar;if(de.contextDep&&Qe||de.propDep)il(pe,Be,$,null);else{var Re=de.append(pe,Be);if(Be(pe.shared.gl,".useProgram(",Re,".program);"),$.shader.program)il(pe,Be,$,$.shader.program);else{Be(pe.shared.vao,".setVAO(null);");var ce=pe.global.def("{}"),$e=Be.def(Re,".id"),it=Be.def(ce,"[",$e,"]");Be(pe.cond(it).then(it,".call(this,a0,a1);").else(it,"=",ce,"[",$e,"]=",pe.link(function(zt){return ei(il,pe,$,zt,2)}),"(",Re,");",it,".call(this,a0,a1);"))}}Object.keys($.state).length>0&&Be(pe.shared.current,".dirty=true;")}function yt(pe,$){var Be=pe.proc("scope",3);pe.batchId="a2";var Qe=pe.shared,tt=Qe.current;za(pe,Be,$.context),$.framebuffer&&$.framebuffer.append(pe,Be),Sp(Object.keys($.state)).forEach(function(Ne){var Xe=$.state[Ne],de=Xe.append(pe,Be);ca(de)?de.forEach(function(Re,ce){Be.set(pe.next[Ne],"["+ce+"]",Re)}):Be.set(Qe.next,"."+Ne,de)}),Gn(pe,Be,$,!0,!0),[$u,Ju,ql,bc,ou].forEach(function(Ne){var Xe=$.draw[Ne];!Xe||Be.set(Qe.draw,"."+Ne,""+Xe.append(pe,Be))}),Object.keys($.uniforms).forEach(function(Ne){var Xe=$.uniforms[Ne].append(pe,Be);Array.isArray(Xe)&&(Xe="["+Xe.join()+"]"),Be.set(Qe.uniforms,"["+ae.id(Ne)+"]",Xe)}),Object.keys($.attributes).forEach(function(Ne){var Xe=$.attributes[Ne].append(pe,Be),de=pe.scopeAttrib(Ne);Object.keys(new et).forEach(function(Re){Be.set(de,"."+Re,Xe[Re])})}),$.scopeVAO&&Be.set(Qe.vao,".targetVAO",$.scopeVAO.append(pe,Be));function Ue(Ne){var Xe=$.shader[Ne];Xe&&Be.set(Qe.shader,"."+Ne,Xe.append(pe,Be))}Ue(ao),Ue(ps),Object.keys($.state).length>0&&(Be(tt,".dirty=true;"),Be.exit(tt,".dirty=true;")),Be("a1(",pe.shared.context,",a0,",pe.batchId,");")}function ct(pe){if(!(typeof pe!="object"||ca(pe))){for(var $=Object.keys(pe),Be=0;Be<$.length;++Be)if(si.isDynamic(pe[$[Be]]))return!0;return!1}}function jr(pe,$,Be){var Qe=$.static[Be];if(!Qe||!ct(Qe))return;var tt=pe.global,Ue=Object.keys(Qe),Ne=!1,Xe=!1,de=!1,Re=pe.global.def("{}");Ue.forEach(function($e){var it=Qe[$e];if(si.isDynamic(it)){typeof it=="function"&&(it=Qe[$e]=si.unbox(it));var zt=Vo(it,null);Ne=Ne||zt.thisDep,de=de||zt.propDep,Xe=Xe||zt.contextDep}else{switch(tt(Re,".",$e,"="),typeof it){case"number":tt(it);break;case"string":tt('"',it,'"');break;case"object":Array.isArray(it)&&tt("[",it.join(),"]");break;default:tt(pe.link(it));break}tt(";")}});function ce($e,it){Ue.forEach(function(zt){var mt=Qe[zt];if(!!si.isDynamic(mt)){var Rt=$e.invoke(it,mt);it(Re,".",zt,"=",Rt,";")}})}$.dynamic[Be]=new si.DynamicVariable(kn,{thisDep:Ne,contextDep:Xe,propDep:de,ref:Re,append:ce}),delete $.static[Be]}function ti(pe,$,Be,Qe,tt){var Ue=bn();Ue.stats=Ue.link(tt),Object.keys($.static).forEach(function(Xe){jr(Ue,$,Xe)}),ah.forEach(function(Xe){jr(Ue,pe,Xe)});var Ne=Na(pe,$,Be,Qe,Ue);return Oa(Ue,Ne),yt(Ue,Ne),xe(Ue,Ne),G(Ue.compile(),{destroy:function(){Ne.shader.program.destroy()}})}return{next:Zr,current:Wt,procs:function(){var pe=bn(),$=pe.proc("poll"),Be=pe.proc("refresh"),Qe=pe.block();$(Qe),Be(Qe);var tt=pe.shared,Ue=tt.gl,Ne=tt.next,Xe=tt.current;Qe(Xe,".dirty=false;"),Ka(pe,$),Ka(pe,Be,null,!0);var de;nr&&(de=pe.link(nr)),ge.oes_vertex_array_object&&Be(pe.link(ge.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var Re=0;Re<gt.maxAttributes;++Re){var ce=Be.def(tt.attributes,"[",Re,"]"),$e=pe.cond(ce,".buffer");$e.then(Ue,".enableVertexAttribArray(",Re,");",Ue,".bindBuffer(",Cl,",",ce,".buffer.buffer);",Ue,".vertexAttribPointer(",Re,",",ce,".size,",ce,".type,",ce,".normalized,",ce,".stride,",ce,".offset);").else(Ue,".disableVertexAttribArray(",Re,");",Ue,".vertexAttrib4f(",Re,",",ce,".x,",ce,".y,",ce,".z,",ce,".w);",ce,".buffer=null;"),Be($e),nr&&Be(de,".vertexAttribDivisorANGLE(",Re,",",ce,".divisor);")}return Be(pe.shared.vao,".currentVAO=null;",pe.shared.vao,".setVAO(",pe.shared.vao,".targetVAO);"),Object.keys(Sr).forEach(function(it){var zt=Sr[it],mt=Qe.def(Ne,".",it),Rt=pe.block();Rt("if(",mt,"){",Ue,".enable(",zt,")}else{",Ue,".disable(",zt,")}",Xe,".",it,"=",mt,";"),Be(Rt),$("if(",mt,"!==",Xe,".",it,"){",Rt,"}")}),Object.keys(Xt).forEach(function(it){var zt=Xt[it],mt=Wt[it],Rt,sr,en=pe.block();if(en(Ue,".",zt,"("),ca(mt)){var qn=mt.length;Rt=pe.global.def(Ne,".",it),sr=pe.global.def(Xe,".",it),en(U(qn,function(Jr){return Rt+"["+Jr+"]"}),");",U(qn,function(Jr){return sr+"["+Jr+"]="+Rt+"["+Jr+"];"}).join("")),$("if(",U(qn,function(Jr){return Rt+"["+Jr+"]!=="+sr+"["+Jr+"]"}).join("||"),"){",en,"}")}else Rt=Qe.def(Ne,".",it),sr=Qe.def(Xe,".",it),en(Rt,");",Xe,".",it,"=",Rt,";"),$("if(",Rt,"!==",sr,"){",en,"}");Be(en)}),pe.compile()}(),compile:ti}}function Jh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var gh=34918,Go=34919,Cp=35007,Tp=function(L,ae){if(!ae.ext_disjoint_timer_query)return null;var ge=[];function gt(){return ge.pop()||ae.ext_disjoint_timer_query.createQueryEXT()}function Zt(nr){ge.push(nr)}var ht=[];function Pt(nr){var Or=gt();ae.ext_disjoint_timer_query.beginQueryEXT(Cp,Or),ht.push(Or),er(ht.length-1,ht.length,nr)}function rr(){ae.ext_disjoint_timer_query.endQueryEXT(Cp)}function ar(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var fr=[];function ir(){return fr.pop()||new ar}function vr(nr){fr.push(nr)}var Tr=[];function er(nr,Or,Wt){var Zr=ir();Zr.startQueryIndex=nr,Zr.endQueryIndex=Or,Zr.sum=0,Zr.stats=Wt,Tr.push(Zr)}var br=[],et=[];function Tt(){var nr,Or,Wt=ht.length;if(Wt!==0){et.length=Math.max(et.length,Wt+1),br.length=Math.max(br.length,Wt+1),br[0]=0,et[0]=0;var Zr=0;for(nr=0,Or=0;Or<ht.length;++Or){var Qt=ht[Or];ae.ext_disjoint_timer_query.getQueryObjectEXT(Qt,Go)?(Zr+=ae.ext_disjoint_timer_query.getQueryObjectEXT(Qt,gh),Zt(Qt)):ht[nr++]=Qt,br[Or+1]=Zr,et[Or+1]=nr}for(ht.length=nr,nr=0,Or=0;Or<Tr.length;++Or){var Sr=Tr[Or],Xt=Sr.startQueryIndex,mr=Sr.endQueryIndex;Sr.sum+=br[mr]-br[Xt];var an=et[Xt],hn=et[mr];hn===an?(Sr.stats.gpuTime+=Sr.sum/1e6,vr(Sr)):(Sr.startQueryIndex=an,Sr.endQueryIndex=hn,Tr[nr++]=Sr)}Tr.length=nr}}return{beginQuery:Pt,endQuery:rr,pushScopeStats:er,update:Tt,getNumPendingQueries:function(){return ht.length},clear:function(){ge.push.apply(ge,ht);for(var nr=0;nr<ge.length;nr++)ae.ext_disjoint_timer_query.deleteQueryEXT(ge[nr]);ht.length=0,ge.length=0},restore:function(){ht.length=0,ge.length=0}}},Ap=16384,Mp=256,Pp=1024,Qh=34962,_h="webglcontextlost",Ip="webglcontextrestored",Op=1,xh=2,bh=3;function Tc(L,ae){for(var ge=0;ge<L.length;++ge)if(L[ge]===ae)return ge;return-1}function kp(L){var ae=Ji(L);if(!ae)return null;var ge=ae.gl,gt=ge.getContextAttributes(),Zt=ge.isContextLost(),ht=N(ge,ae);if(!ht)return null;var Pt=Mn(),rr=Jh(),ar=ht.extensions,fr=Tp(ge,ar),ir=$n(),vr=ge.drawingBufferWidth,Tr=ge.drawingBufferHeight,er={tick:0,time:0,viewportWidth:vr,viewportHeight:Tr,framebufferWidth:vr,framebufferHeight:Tr,drawingBufferWidth:vr,drawingBufferHeight:Tr,pixelRatio:ae.pixelRatio},br={},et={elements:null,primitive:4,count:-1,offset:0,instances:-1},Tt=Ca(ge,ar),nr=gu(ge,rr,ae,Wt),Or=ee(ge,ar,Tt,rr,nr);function Wt(mn){return Or.destroyBuffer(mn)}var Zr=dp(ge,ar,nr,rr),Qt=_e(ge,Pt,rr,ae),Sr=Qs(ge,ar,Tt,function(){an.procs.poll()},er,rr,ae),Xt=ta(ge,ar,Tt,rr,ae),mr=P(ge,ar,Tt,Sr,Xt,rr),an=yh(ge,Pt,ar,Tt,nr,Zr,Sr,mr,br,Or,Qt,et,er,fr,ae),hn=wt(ge,mr,an.procs.poll,er,gt,ar,Tt),wr=an.next,Kt=ge.canvas,Vt=[],bn=[],yn=[],qr=[ae.onDestroy],Qn=null;function Dn(){if(Vt.length===0){fr&&fr.update(),Qn=null;return}Qn=Fn.next(Dn),So();for(var mn=Vt.length-1;mn>=0;--mn){var ei=Vt[mn];ei&&ei(er,null,0)}ge.flush(),fr&&fr.update()}function Yn(){!Qn&&Vt.length>0&&(Qn=Fn.next(Dn))}function yi(){Qn&&(Fn.cancel(Dn),Qn=null)}function xa(mn){mn.preventDefault(),Zt=!0,yi(),bn.forEach(function(ei){ei()})}function po(mn){ge.getError(),Zt=!1,ht.restore(),Qt.restore(),nr.restore(),Sr.restore(),Xt.restore(),mr.restore(),Or.restore(),fr&&fr.restore(),an.procs.refresh(),Yn(),yn.forEach(function(ei){ei()})}Kt&&(Kt.addEventListener(_h,xa,!1),Kt.addEventListener(Ip,po,!1));function ai(){Vt.length=0,yi(),Kt&&(Kt.removeEventListener(_h,xa),Kt.removeEventListener(Ip,po)),Qt.clear(),mr.clear(),Xt.clear(),Sr.clear(),Zr.clear(),nr.clear(),Or.clear(),fr&&fr.clear(),qr.forEach(function(mn){mn()})}function ha(mn){le(!!mn,"invalid args to regl({...})"),le.type(mn,"object","invalid args to regl({...})");function ei(tt){var Ue=G({},tt);delete Ue.uniforms,delete Ue.attributes,delete Ue.context,delete Ue.vao,"stencil"in Ue&&Ue.stencil.op&&(Ue.stencil.opBack=Ue.stencil.opFront=Ue.stencil.op,delete Ue.stencil.op);function Ne(Xe){if(Xe in Ue){var de=Ue[Xe];delete Ue[Xe],Object.keys(de).forEach(function(Re){Ue[Xe+"."+Re]=de[Re]})}}return Ne("blend"),Ne("depth"),Ne("cull"),Ne("stencil"),Ne("polygonOffset"),Ne("scissor"),Ne("sample"),"vao"in tt&&(Ue.vao=tt.vao),Ue}function li(tt,Ue){var Ne={},Xe={};return Object.keys(tt).forEach(function(de){var Re=tt[de];if(si.isDynamic(Re)){Xe[de]=si.unbox(Re,de);return}else if(Ue&&Array.isArray(Re)){for(var ce=0;ce<Re.length;++ce)if(si.isDynamic(Re[ce])){Xe[de]=si.unbox(Re,de);return}}Ne[de]=Re}),{dynamic:Xe,static:Ne}}var Oa=li(mn.context||{},!0),Us=li(mn.uniforms||{},!0),il=li(mn.attributes||{},!1),xe=li(ei(mn),!1),yt={gpuTime:0,cpuTime:0,count:0},ct=an.compile(xe,il,Us,Oa,yt),jr=ct.draw,ti=ct.batch,pe=ct.scope,$=[];function Be(tt){for(;$.length<tt;)$.push(null);return $}function Qe(tt,Ue){var Ne;if(Zt&&le.raise("context lost"),typeof tt=="function")return pe.call(this,null,tt,0);if(typeof Ue=="function")if(typeof tt=="number")for(Ne=0;Ne<tt;++Ne)pe.call(this,null,Ue,Ne);else if(Array.isArray(tt))for(Ne=0;Ne<tt.length;++Ne)pe.call(this,tt[Ne],Ue,Ne);else return pe.call(this,tt,Ue,0);else if(typeof tt=="number"){if(tt>0)return ti.call(this,Be(tt|0),tt|0)}else if(Array.isArray(tt)){if(tt.length)return ti.call(this,tt,tt.length)}else return jr.call(this,tt)}return G(Qe,{stats:yt,destroy:function(){ct.destroy()}})}var Hi=mr.setFBO=ha({framebuffer:si.define.call(null,Op,"framebuffer")});function Na(mn,ei){var li=0;an.procs.poll();var Oa=ei.color;Oa&&(ge.clearColor(+Oa[0]||0,+Oa[1]||0,+Oa[2]||0,+Oa[3]||0),li|=Ap),"depth"in ei&&(ge.clearDepth(+ei.depth),li|=Mp),"stencil"in ei&&(ge.clearStencil(ei.stencil|0),li|=Pp),le(!!li,"called regl.clear with no buffer specified"),ge.clear(li)}function za(mn){if(le(typeof mn=="object"&&mn,"regl.clear() takes an object as input"),"framebuffer"in mn)if(mn.framebuffer&&mn.framebuffer_reglType==="framebufferCube")for(var ei=0;ei<6;++ei)Hi(G({framebuffer:mn.framebuffer.faces[ei]},mn),Na);else Hi(mn,Na);else Na(null,mn)}function Ka(mn){le.type(mn,"function","regl.frame() callback must be a function"),Vt.push(mn);function ei(){var li=Tc(Vt,mn);le(li>=0,"cannot cancel a frame twice");function Oa(){var Us=Tc(Vt,Oa);Vt[Us]=Vt[Vt.length-1],Vt.length-=1,Vt.length<=0&&yi()}Vt[li]=Oa}return Yn(),{cancel:ei}}function ho(){var mn=wr.viewport,ei=wr.scissor_box;mn[0]=mn[1]=ei[0]=ei[1]=0,er.viewportWidth=er.framebufferWidth=er.drawingBufferWidth=mn[2]=ei[2]=ge.drawingBufferWidth,er.viewportHeight=er.framebufferHeight=er.drawingBufferHeight=mn[3]=ei[3]=ge.drawingBufferHeight}function So(){er.tick+=1,er.time=Gn(),ho(),an.procs.poll()}function Ia(){Sr.refresh(),ho(),an.procs.refresh(),fr&&fr.update()}function Gn(){return($n()-ir)/1e3}Ia();function Ro(mn,ei){le.type(ei,"function","listener callback must be a function");var li;switch(mn){case"frame":return Ka(ei);case"lost":li=bn;break;case"restore":li=yn;break;case"destroy":li=qr;break;default:le.raise("invalid event, must be one of frame,lost,restore,destroy")}return li.push(ei),{cancel:function(){for(var Oa=0;Oa<li.length;++Oa)if(li[Oa]===ei){li[Oa]=li[li.length-1],li.pop();return}}}}var Ei=G(ha,{clear:za,prop:si.define.bind(null,Op),context:si.define.bind(null,xh),this:si.define.bind(null,bh),draw:ha({}),buffer:function(mn){return nr.create(mn,Qh,!1,!1)},elements:function(mn){return Zr.create(mn,!1)},texture:Sr.create2D,cube:Sr.createCube,renderbuffer:Xt.create,framebuffer:mr.create,framebufferCube:mr.createCube,vao:Or.createVAO,attributes:gt,frame:Ka,on:Ro,limits:Tt,hasExtension:function(mn){return Tt.extensions.indexOf(mn.toLowerCase())>=0},read:hn,destroy:ai,_gl:ge,_refresh:Ia,poll:function(){So(),fr&&fr.update()},now:Gn,stats:rr});return ae.onDone(null,Ei),Ei}return kp})},69848:function(hr){(function(X,G){hr.exports=G()})(this,function(){"use strict";function X(ot,He,ut,Ye,Lt,ur){if(!(Lt-Ye<=ut)){var Ir=Ye+Lt>>1;G(ot,He,Ir,Ye,Lt,ur%2),X(ot,He,ut,Ye,Ir-1,ur+1),X(ot,He,ut,Ir+1,Lt,ur+1)}}function G(ot,He,ut,Ye,Lt,ur){for(;Lt>Ye;){if(Lt-Ye>600){var Ir=Lt-Ye+1,Vr=ut-Ye+1,Ee=Math.log(Ir),Ve=.5*Math.exp(2*Ee/3),ke=.5*Math.sqrt(Ee*Ve*(Ir-Ve)/Ir)*(Vr-Ir/2<0?-1:1),vt=Math.max(Ye,Math.floor(ut-Vr*Ve/Ir+ke)),Ke=Math.min(Lt,Math.floor(ut+(Ir-Vr)*Ve/Ir+ke));G(ot,He,ut,vt,Ke,ur)}var H=He[2*ut+ur],Je=Ye,Et=Lt;for(Me(ot,He,Ye,ut),He[2*Lt+ur]>H&&Me(ot,He,Ye,Lt);Je<Et;){for(Me(ot,He,Je,Et),Je++,Et--;He[2*Je+ur]<H;)Je++;for(;He[2*Et+ur]>H;)Et--}He[2*Ye+ur]===H?Me(ot,He,Ye,Et):(Et++,Me(ot,He,Et,Lt)),Et<=ut&&(Ye=Et+1),ut<=Et&&(Lt=Et-1)}}function Me(ot,He,ut,Ye){ve(ot,ut,Ye),ve(He,2*ut,2*Ye),ve(He,2*ut+1,2*Ye+1)}function ve(ot,He,ut){var Ye=ot[He];ot[He]=ot[ut],ot[ut]=Ye}function v(ot,He,ut,Ye,Lt,ur,Ir){for(var Vr=[0,ot.length-1,0],Ee=[],Ve,ke;Vr.length;){var vt=Vr.pop(),Ke=Vr.pop(),H=Vr.pop();if(Ke-H<=Ir){for(var Je=H;Je<=Ke;Je++)Ve=He[2*Je],ke=He[2*Je+1],Ve>=ut&&Ve<=Lt&&ke>=Ye&&ke<=ur&&Ee.push(ot[Je]);continue}var Et=Math.floor((H+Ke)/2);Ve=He[2*Et],ke=He[2*Et+1],Ve>=ut&&Ve<=Lt&&ke>=Ye&&ke<=ur&&Ee.push(ot[Et]);var _t=(vt+1)%2;(vt===0?ut<=Ve:Ye<=ke)&&(Vr.push(H),Vr.push(Et-1),Vr.push(_t)),(vt===0?Lt>=Ve:ur>=ke)&&(Vr.push(Et+1),Vr.push(Ke),Vr.push(_t))}return Ee}function ye(ot,He,ut,Ye,Lt,ur){for(var Ir=[0,ot.length-1,0],Vr=[],Ee=Lt*Lt;Ir.length;){var Ve=Ir.pop(),ke=Ir.pop(),vt=Ir.pop();if(ke-vt<=ur){for(var Ke=vt;Ke<=ke;Ke++)Z(He[2*Ke],He[2*Ke+1],ut,Ye)<=Ee&&Vr.push(ot[Ke]);continue}var H=Math.floor((vt+ke)/2),Je=He[2*H],Et=He[2*H+1];Z(Je,Et,ut,Ye)<=Ee&&Vr.push(ot[H]);var _t=(Ve+1)%2;(Ve===0?ut-Lt<=Je:Ye-Lt<=Et)&&(Ir.push(vt),Ir.push(H-1),Ir.push(_t)),(Ve===0?ut+Lt>=Je:Ye+Lt>=Et)&&(Ir.push(H+1),Ir.push(ke),Ir.push(_t))}return Vr}function Z(ot,He,ut,Ye){var Lt=ot-ut,ur=He-Ye;return Lt*Lt+ur*ur}var oe=function(ot){return ot[0]},me=function(ot){return ot[1]},ie=function(He,ut,Ye,Lt,ur){ut===void 0&&(ut=oe),Ye===void 0&&(Ye=me),Lt===void 0&&(Lt=64),ur===void 0&&(ur=Float64Array),this.nodeSize=Lt,this.points=He;for(var Ir=He.length<65536?Uint16Array:Uint32Array,Vr=this.ids=new Ir(He.length),Ee=this.coords=new ur(He.length*2),Ve=0;Ve<He.length;Ve++)Vr[Ve]=Ve,Ee[2*Ve]=ut(He[Ve]),Ee[2*Ve+1]=Ye(He[Ve]);X(Vr,Ee,Lt,0,Vr.length-1,0)};ie.prototype.range=function(He,ut,Ye,Lt){return v(this.ids,this.coords,He,ut,Ye,Lt,this.nodeSize)},ie.prototype.within=function(He,ut,Ye){return ye(this.ids,this.coords,He,ut,Ye,this.nodeSize)};var fe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(ot){return ot}},J=Math.fround||function(ot){return function(He){return ot[0]=+He,ot[0]}}(new Float32Array(1)),be=function(He){this.options=Ar(Object.create(fe),He),this.trees=new Array(this.options.maxZoom+1)};be.prototype.load=function(He){var ut=this.options,Ye=ut.log,Lt=ut.minZoom,ur=ut.maxZoom,Ir=ut.nodeSize;Ye&&console.time("total time");var Vr="prepare "+He.length+" points";Ye&&console.time(Vr),this.points=He;for(var Ee=[],Ve=0;Ve<He.length;Ve++)!He[Ve].geometry||Ee.push(M(He[Ve],Ve));this.trees[ur+1]=new ie(Ee,cr,Bt,Ir,Float32Array),Ye&&console.timeEnd(Vr);for(var ke=ur;ke>=Lt;ke--){var vt=+Date.now();Ee=this._cluster(Ee,ke),this.trees[ke]=new ie(Ee,cr,Bt,Ir,Float32Array),Ye&&console.log("z%d: %d clusters in %dms",ke,Ee.length,+Date.now()-vt)}return Ye&&console.timeEnd("total time"),this},be.prototype.getClusters=function(He,ut){var Ye=((He[0]+180)%360+360)%360-180,Lt=Math.max(-90,Math.min(90,He[1])),ur=He[2]===180?180:((He[2]+180)%360+360)%360-180,Ir=Math.max(-90,Math.min(90,He[3]));if(He[2]-He[0]>=360)Ye=-180,ur=180;else if(Ye>ur){var Vr=this.getClusters([Ye,Lt,180,Ir],ut),Ee=this.getClusters([-180,Lt,ur,Ir],ut);return Vr.concat(Ee)}for(var Ve=this.trees[this._limitZoom(ut)],ke=Ve.range(Ft(Ye),jt(Ir),Ft(ur),jt(Lt)),vt=[],Ke=0,H=ke;Ke<H.length;Ke+=1){var Je=H[Ke],Et=Ve.points[Je];vt.push(Et.numPoints?Jt(Et):this.points[Et.index])}return vt},be.prototype.getChildren=function(He){var ut=this._getOriginId(He),Ye=this._getOriginZoom(He),Lt="No cluster with the specified id.",ur=this.trees[Ye];if(!ur)throw new Error(Lt);var Ir=ur.points[ut];if(!Ir)throw new Error(Lt);for(var Vr=this.options.radius/(this.options.extent*Math.pow(2,Ye-1)),Ee=ur.within(Ir.x,Ir.y,Vr),Ve=[],ke=0,vt=Ee;ke<vt.length;ke+=1){var Ke=vt[ke],H=ur.points[Ke];H.parentId===He&&Ve.push(H.numPoints?Jt(H):this.points[H.index])}if(Ve.length===0)throw new Error(Lt);return Ve},be.prototype.getLeaves=function(He,ut,Ye){ut=ut||10,Ye=Ye||0;var Lt=[];return this._appendLeaves(Lt,He,ut,Ye,0),Lt},be.prototype.getTile=function(He,ut,Ye){var Lt=this.trees[this._limitZoom(He)],ur=Math.pow(2,He),Ir=this.options,Vr=Ir.extent,Ee=Ir.radius,Ve=Ee/Vr,ke=(Ye-Ve)/ur,vt=(Ye+1+Ve)/ur,Ke={features:[]};return this._addTileFeatures(Lt.range((ut-Ve)/ur,ke,(ut+1+Ve)/ur,vt),Lt.points,ut,Ye,ur,Ke),ut===0&&this._addTileFeatures(Lt.range(1-Ve/ur,ke,1,vt),Lt.points,ur,Ye,ur,Ke),ut===ur-1&&this._addTileFeatures(Lt.range(0,ke,Ve/ur,vt),Lt.points,-1,Ye,ur,Ke),Ke.features.length?Ke:null},be.prototype.getClusterExpansionZoom=function(He){for(var ut=this._getOriginZoom(He)-1;ut<=this.options.maxZoom;){var Ye=this.getChildren(He);if(ut++,Ye.length!==1)break;He=Ye[0].properties.cluster_id}return ut},be.prototype._appendLeaves=function(He,ut,Ye,Lt,ur){for(var Ir=this.getChildren(ut),Vr=0,Ee=Ir;Vr<Ee.length;Vr+=1){var Ve=Ee[Vr],ke=Ve.properties;if(ke&&ke.cluster?ur+ke.point_count<=Lt?ur+=ke.point_count:ur=this._appendLeaves(He,ke.cluster_id,Ye,Lt,ur):ur<Lt?ur++:He.push(Ve),He.length===Ye)break}return ur},be.prototype._addTileFeatures=function(He,ut,Ye,Lt,ur,Ir){for(var Vr=0,Ee=He;Vr<Ee.length;Vr+=1){var Ve=Ee[Vr],ke=ut[Ve],vt=ke.numPoints,Ke=void 0,H=void 0,Je=void 0;if(vt)Ke=Ht(ke),H=ke.x,Je=ke.y;else{var Et=this.points[ke.index];Ke=Et.properties,H=Ft(Et.geometry.coordinates[0]),Je=jt(Et.geometry.coordinates[1])}var _t={type:1,geometry:[[Math.round(this.options.extent*(H*ur-Ye)),Math.round(this.options.extent*(Je*ur-Lt))]],tags:Ke},Yr=void 0;vt?Yr=ke.id:this.options.generateId?Yr=ke.index:this.points[ke.index].id&&(Yr=this.points[ke.index].id),Yr!==void 0&&(_t.id=Yr),Ir.features.push(_t)}},be.prototype._limitZoom=function(He){return Math.max(this.options.minZoom,Math.min(+He,this.options.maxZoom+1))},be.prototype._cluster=function(He,ut){for(var Ye=[],Lt=this.options,ur=Lt.radius,Ir=Lt.extent,Vr=Lt.reduce,Ee=Lt.minPoints,Ve=ur/(Ir*Math.pow(2,ut)),ke=0;ke<He.length;ke++){var vt=He[ke];if(!(vt.zoom<=ut)){vt.zoom=ut;for(var Ke=this.trees[ut+1],H=Ke.within(vt.x,vt.y,Ve),Je=vt.numPoints||1,Et=Je,_t=0,Yr=H;_t<Yr.length;_t+=1){var wi=Yr[_t],On=Ke.points[wi];On.zoom>ut&&(Et+=On.numPoints||1)}if(Et>=Ee){for(var An=vt.x*Je,gn=vt.y*Je,Cn=Vr&&Je>1?this._map(vt,!0):null,sn=(ke<<5)+(ut+1)+this.points.length,Oi=0,Si=H;Oi<Si.length;Oi+=1){var da=Si[Oi],sa=Ke.points[da];if(!(sa.zoom<=ut)){sa.zoom=ut;var Ai=sa.numPoints||1;An+=sa.x*Ai,gn+=sa.y*Ai,sa.parentId=sn,Vr&&(Cn||(Cn=this._map(vt,!0)),Vr(Cn,this._map(sa)))}}vt.parentId=sn,Ye.push(Pe(An/Et,gn/Et,sn,Et,Cn))}else if(Ye.push(vt),Et>1)for(var uo=0,Mi=H;uo<Mi.length;uo+=1){var Pi=Mi[uo],To=Ke.points[Pi];To.zoom<=ut||(To.zoom=ut,Ye.push(To))}}}return Ye},be.prototype._getOriginId=function(He){return He-this.points.length>>5},be.prototype._getOriginZoom=function(He){return(He-this.points.length)%32},be.prototype._map=function(He,ut){if(He.numPoints)return ut?Ar({},He.properties):He.properties;var Ye=this.points[He.index].properties,Lt=this.options.map(Ye);return ut&&Lt===Ye?Ar({},Lt):Lt};function Pe(ot,He,ut,Ye,Lt){return{x:J(ot),y:J(He),zoom:Infinity,id:ut,parentId:-1,numPoints:Ye,properties:Lt}}function M(ot,He){var ut=ot.geometry.coordinates,Ye=ut[0],Lt=ut[1];return{x:J(Ft(Ye)),y:J(jt(Lt)),zoom:Infinity,index:He,parentId:-1}}function Jt(ot){return{type:"Feature",id:ot.id,properties:Ht(ot),geometry:{type:"Point",coordinates:[ft(ot.x),dt(ot.y)]}}}function Ht(ot){var He=ot.numPoints,ut=He>=1e4?Math.round(He/1e3)+"k":He>=1e3?Math.round(He/100)/10+"k":He;return Ar(Ar({},ot.properties),{cluster:!0,cluster_id:ot.id,point_count:He,point_count_abbreviated:ut})}function Ft(ot){return ot/360+.5}function jt(ot){var He=Math.sin(ot*Math.PI/180),ut=.5-.25*Math.log((1+He)/(1-He))/Math.PI;return ut<0?0:ut>1?1:ut}function ft(ot){return(ot-.5)*360}function dt(ot){var He=(180-ot*360)*Math.PI/180;return 360*Math.atan(Math.exp(He))/Math.PI-90}function Ar(ot,He){for(var ut in He)ot[ut]=He[ut];return ot}function cr(ot){return ot.x}function Bt(ot){return ot.y}return be})},75752:function(hr){hr.exports.RADIUS=6378137,hr.exports.FLATTENING=1/298.257223563,hr.exports.POLAR_RADIUS=63567523142e-4}}]);
